define("modules/clean/browse/browse_bolt_client",["require","exports","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=o.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=o.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new s.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new s.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=o.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==o.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=o.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e){var t=this;this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),this.initialBoltDataRequest=r.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(r,s,o){t.setInitialBoltData(r),e()},error:function(e,r,s){t.status=o.BrowseBoltClientStatus.NotReady},complete:function(){delete t.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=o.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=a}),define("modules/clean/file_operations/notifications",["require","exports","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,s,o,a,i,n,l,c,d){"use strict";function u(e,t,r,s,o){var a=function(){return i.rollbackChangeSets({changesets:r,userId:t.id,progressText:c._("Undoing…"),rollbackHints:s?s:void 0,onSuccess:function(){d.Notify.success(c._("Undo complete.")),o&&o()}})};n.notifyWithUndo(e,r,a)}function p(e,t){var i=s.browse_uri_for_fq_path(t,e),n=o.Emstring.em_snippet(a.filename(e),40);return{href:i,text:r.escape(n)}}function h(e,t,r,s,o,a){var i;if(s){var n=p(s,t);i=c.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),i=new l.HTML(i)}else i=c.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});u(i,t,r,o,a)}function _(e,t,r,s,o,a){var i;if(s){var n=p(s,t);i=c.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:n.href,dest_name:n.text}),i=new l.HTML(i)}else i=c.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});u(i,t,r,o,a)}function f(e,t,r,s,o){u(c.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,s,o)}function m(e,t,r,s){u(c._("Rename complete."),e,t,r,s)}function S(e,t,r){u(c._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function g(e){var t=c.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});d.Notify.success(t)}function w(e){var t,s=e.length;if(1===s){var o=r.escape(a.filename(e[0].fq_path));t=c._("Restored <strong>%(filename)s</strong>.").format({filename:o}),t=new l.HTML(t)}else t=c.ungettext("Restored %(num)s file.","Restored %(num)s files.",s).format({num:s});d.Notify.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.notifyCopySuccess=h,t.notifyMoveSuccess=_,t.notifyDeleteSuccess=f,t.notifyRenameSuccess=m,t.notifyFolderCreationSuccess=S,t.notifyPurgeSuccess=g,t.notifyRestoreSuccess=w}),define("modules/clean/illustration_helper",["require","exports","modules/clean/static_urls"],function(e,t,r){"use strict";function s(e){return r.static_url("/static/images/empty_states/"+e+".png")}Object.defineProperty(t,"__esModule",{value:!0}),t.empty_state_url=s}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,s,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),n=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],s=0,i=e;s<i.length;s++){var n=i[s],l=n[this.keyName];if(null==l)return void a.Notify.warning(o._("Invalid server response"));null==this.items[l]&&(this.items[l]=n,r.push(n),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),s.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var s=0,o=r.items;s<o.length;s++){var a=o[s];a.fq_path=e.fqPathPrefix+a.fq_path}e.addPage(r.items)},error:function(){a.Notify.error(o._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=n;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new i(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(n);t.PaginationManager=l}),define("modules/clean/react/app_actions/app_actions_store",["require","exports","tslib","modules/clean/api_v2/client"],function(e,t,r,s){"use strict";function o(){if(null===i){i=new a(new s.ApiV2Client)}return i}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){this.actionIdToAppAction={},this.client=e}return e.prototype.getActionsForFile=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var s;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.getActionsForFileBatch([e],t)];case 1:return s=r.sent(),[2,s[e.file_id]]}})})},e.prototype.getActionsForFileBatch=function(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,this.loadActionsByUser(e,t)]})})},e.prototype.loadActionsByUser=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var s,o,a,i;return r.__generator(this,function(r){switch(r.label){case 0:this.extToCategories||(this.extToCategories=this.loadUsersActions(t)),s=this.extToCategories,o={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.extToCategories];case 2:return a=r.sent(),e.forEach(function(e){o[e.file_id]=a[e.ext]}),[3,4];case 3:return i=r.sent(),s===this.extToCategories&&(this.extToCategories=void 0),[3,4];case 4:return[2,o]}})})},e.prototype.loadUsersActions=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,s,o=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.client.ns("app_actions").rpc("get_available_actions_for_user",void 0,{subjectUserId:e})];case 1:return t=r.sent(),t.actions.forEach(function(e){o.actionIdToAppAction[e.id]||(o.actionIdToAppAction[e.id]=e)}),s={},t.exts_to_action_ids.forEach(function(e){var t={},r=[];e.action_ids.forEach(function(e){var s=o.actionIdToAppAction[e],a=t[s.category];a?a.actions.push(s):(a={category:s.category,actions:[s]},t[s.category]=a,r.push(a))}),r=r.map(function(e){return{category:e.category,actions:o.prioritizeActions(e.actions)}}),r.sort(function(e,t){return e.category<t.category?-1:t.category<e.category?1:0}),s[e.ext]=r}),[2,s]}})})},e.prototype.prioritizeActions=function(e){return e.sort(function(e,t){return e.priority&&t.priority?t.priority-e.priority:e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0})},e})();t.AppActionsStore=a;var i=null;t.getAppActionsStore=o}),define("modules/clean/react/async_folder_selector_modal",["require","exports"],function(e,t){"use strict";function r(t){e(["modules/clean/react/folder_selector_modal"],function(e){e.FolderSelectorModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.show=r}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/history","modules/clean/react/fileops_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/clean/viewer","modules/constants/python","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/search/constants","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/dispatcher","modules/clean/react/files_view/types","modules/clean/react/snackbar","modules/clean/user_education/user_education_client","modules/clean/sharing/browse_exports"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f,m,S,g,w,F,E,y,T,v,R,A,b,I,C,P,D){"use strict";function N(){return e("modules/clean/react/file_viewer/controller")}function L(){return e.defined("modules/clean/react/file_viewer/controller")}Object.defineProperty(t,"__esModule",{value:!0});var O=(function(){function e(e){var s=this;this.nameNewFolder=function(){_.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_FOLDER_NAME})},this.createFolderPending=function(){_.BrowseDispatcher.dispatch({type:h.BrowseActionType.CREATE_FOLDER_PENDING})},this.cancelCreateFolder=function(){_.BrowseDispatcher.dispatch({type:h.BrowseActionType.CANCEL_CREATE_FOLDER}),window.setTimeout(function(){P.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,s=e.changesets;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.CREATE_FOLDER_COMPLETE}),i.notifyFolderCreationSuccess(t,r,s),window.setTimeout(function(){P.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolder=function(e){var t=e.folderName,o=e.pathName,a=e.nsId,i=void 0===a?null:a,n=e.checkFSWs,l=S.getBrowseStore().user();s.createFolderPending(),s.dataApi.createNewFolder({pathName:o,folderName:t,nsId:i,checkFSWs:n,userId:l.id,onSuccess:function(o){var a=o.changesets,i=o.createdFolder,n=o.failureDetails;if(n){var c=function(){s.createFolder(r.__assign({},e,{checkFSWs:!1}))};d.showFileSystemWarningsModal({fsws:n,onFinalAccept:c,confirmText:T._("Create folder"),onAbortAction:s.cancelCreateFolder})}else s.createFolderComplete({user:l,folderName:t,changesets:a}),i&&s.selectRowsFromBoltClient([i])},onError:s.cancelCreateFolder})},this.doDeleteFilesWithModal=function(e){var t=e.files,r=e.expSubgrowthBizWebClientOQDelete,o=S.getBrowseStore(),a=o.user(),l=o.context();d.showDelete(a,t,l,n.filename(l.currentFQPath),function(){s.dataApi.deleteFiles({files:t,userId:a.id,onSuccess:function(e){var r=e.changesets,o=e.rollbackHints,n=e.fileDeltas;b.SearchResultsDispatcher.dispatch({type:R.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:e.before.fq_path,after:null}})}}),i.notifyDeleteSuccess(t.length,a,r,o,function(){s.selectRowsFromBoltClient(t),b.SearchResultsDispatcher.dispatch({type:R.CHANGE_FILES_ACTION,data:{fileDeltas:n.filter(function(e){return!!e.before}).map(function(e){return{before:null,after:e.before}})}})})}})},r)},this.onPurgeSuccessCallback=function(e){i.notifyPurgeSuccess(e.length),t.browseActions.reloadCurrentPath(),b.SearchResultsDispatcher.dispatch({type:R.CHANGE_FILES_ACTION,data:{fileDeltas:e.map(function(e){return{before:e.fq_path,after:null}})}})},this.onPurge=function(e,t){s.dataApi.purgeFiles({files:t,userId:e,onSuccess:s.onPurgeSuccessCallback})},this.doPermanentlyDeleteWithPurgeModal=function(e){var t=e.files,r=S.getBrowseStore(),o=r.user(),a=r.context();d.showPurgeModal({userId:o.id,context:a,files:t,onPurge:s.onPurge})},this.doPermanentDeleteWithModal=function(e){var t=e.files;if(e.expShouldShowPurgeModal)s.doPermanentlyDeleteWithPurgeModal({files:t});else{var r=S.getBrowseStore(),o=r.user();d.showPermanentlyDelete(o,t,function(){return s.dataApi.purgeFiles({files:t,userId:o.id,onSuccess:s.onPurgeSuccessCallback})})}},this.onRestore=function(e,t,r){s.dataApi.restoreFiles({files:t,userId:e,onSuccess:function(){i.notifyRestoreSuccess(t)},isSearchMode:r})},this.doRestoreFilesWithModal=function(e){var t=e.files,r=e.isSearchMode;if(r){var o=S.getBrowseStore(),a=o.user(),i=o.context();d.showRestore(a,t,i,function(e,t){s.onRestore(e,t,r)})}else s.doRestoreFilesWithUnifiedTrashModal({files:t})},this.doRestoreFilesWithUnifiedTrashModal=function(e){var t=e.files,r=S.getBrowseStore(),o=r.user(),a=r.context();d.showUnifiedTrashModal({userId:o.id,context:a,files:t,onRestore:function(e,t){s.onRestore(e,t,!1)}})},this.dataApi=e}return e.prototype.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,s=e.user,o=e.viewer;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.APP_INIT,data:{experiments:t,shouldShowDeletedFiles:r,user:s,viewer:o}})},e.prototype.initializeEverything=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,o=e.context,a=e.mountPoints,i=e.fqPathsToSelect,n=e.loadingState,l=e.teamFolders;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.INITIALIZE_EVERYTHING,data:{path:t,files:r,paginatedTotalNumFiles:s,context:o,mountPoints:a,fqPathsToSelect:i,loadingState:n,teamFolders:l}})},e.prototype.load=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,o=e.context;m.browseNavActions.load({path:t,files:r,paginatedTotalNumFiles:s,context:o})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,s=e.files,o=e.paginatedTotalNumFiles;m.browseNavActions.addFilesAndSetLoadingState({path:t,loadingState:r,files:s,paginatedTotalNumFiles:o})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;m.browseNavActions.setMountPoints({mountPoints:t})},e.prototype.setTeamFolders=function(e){var t=e.teamFolders;m.browseNavActions.setTeamFolders({teamFolders:t})},e.prototype.setPath=function(e){var t=e.path,r=e.onPathLoaded,s=e.logFetchedDataRequiredForTTI,o=void 0!==s&&s,a=e.ajaxWebTimer;m.browseNavActions.setPath({path:t,onPathLoaded:r,logFetchedDataRequiredForTTI:o,ajaxWebTimer:a})},e.prototype.reloadCurrentPath=function(){var e=S.getBrowseStore();this.setPath({path:e.path()})},e.prototype.updatePreview=function(e){var t=e.files;L()&&N().updateFiles(t)},e.prototype.closeFileViewer=function(){L()&&N().close()},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;m.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.copyFilesToClipboard=function(e){if(e.length){if(e.some(function(e){return e.isDeleted}))return void v.Notify.error(T._("Deleted files cannot be added to the clipboard"));if(e.some(f.File.isTeamSharedFolder))return void v.Notify.error(T._("Team Folders can’t be copied."));var t=T.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.length).format({num_items:e.length});v.Notify.success(t),_.BrowseDispatcher.dispatch({type:h.BrowseActionType.COPY_FILES_TO_CLIPBOARD,data:{files:e}})}},e.prototype.pasteClipboardFilesToCurrentPath=function(){c.copyFiles({user:S.getBrowseStore().user(),files:S.getBrowseStore().clipboardFiles(),newPath:S.getBrowseStore().path(),checkFSWs:!0,dataApi:this.dataApi})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},e.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},e.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:t}})},e.prototype.resetFileJump=function(){_.BrowseDispatcher.dispatch({type:h.BrowseActionType.RESET_FILE_JUMP})},e.prototype.copyFiles=function(e){c.copyFiles(e)},e.prototype.moveFiles=function(e){c.moveFiles(e)},e.prototype.showFileRename=function(e){var t=e.file;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_NEW_FILE_NAME,data:{file:t}})},e.prototype.cancelFileRename=function(e){var t=e.file;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.CANCEL_FILE_RENAME,data:{file:t}})},e.prototype.setFileRenameComplete=function(e){var t=e.file;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_RENAME_COMPLETE,data:{file:t}})},e.prototype.renameFile=function(e){var t=this,r=e.file,s=e.newName,o=e.isSearchMode;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_FILE_RENAME_PENDING,data:{file:r}});var a=S.getBrowseStore().user();this.dataApi.renameFile({file:r,newName:s,userId:a.id,onSuccess:function(e){var s=e.renamedFile,n=e.changesets,l=e.rollbackHints;i.notifyRenameSuccess(a,n,l,function(){t.selectRowsFromBoltClient([r])}),o&&b.SearchResultsDispatcher.dispatch({type:R.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:r.fq_path,after:r.is_dir?s.set("icon",r.icon):s}]}}),t.selectRowsFromBoltClient([s])},onError:function(){t.cancelFileRename({file:r})}})},e.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.CHANGE_FILES,data:{path:t,fileDeltas:r}})},e.prototype.openLocalCopy=function(e){var t=e.fqPath,r=e.nsId,s=e.userId,o=function(){u.logOpenLocalCopySuccess({team_id:g.Viewer.get_viewer().team_id,url:F.get_uri().path})},a=function(e){u.logOpenLocalCopyError({error_message:e,team_id:g.Viewer.get_viewer().team_id,url:F.get_uri().path}),v.Notify.error(T._("Please make sure you are logged into the same account on your Dropbox desktop app."))};this.dataApi.openLocalCopy({nsId:r,fqPath:t,userId:s,onSuccess:o,onError:a})},e.prototype.getMountPointUpdateForCurrentPath=function(e){var t,r,o=S.getBrowseStore().path(),a=S.getBrowseStore().mountPoints(),i=a?a.toJS():{},n=function(e){return e===o},l=parseInt(s.findKey(i,n),10);if(l)t=e[l]||null,r=i[l]||null;else{r=null;t=!!s.findKey(e,n)?o:null}return[r,t]},e.prototype.getPathForNewMountPoint=function(e,t){return e&&!t?S.getBrowseStore().path():e&&t?n.paths_are_equal(e,t)?null:t:!e&&t?S.getBrowseStore().path():null},e.prototype.showUserNotificationForPathChange=function(e,t){function r(e){return s.escape(n.filename(e))}function a(e){v.Notify.success(new y.HTML(e))}function i(e){v.Notify.error(new y.HTML(e))}var l=t.old_fq_path,c=o.get_browse_root(e)+t.new_fq_path,d=!t.is_changing_view,u=null!=t.change_type?t.change_type.toLowerCase():null;if("moved"===u)if(d)a(T._("This folder has been moved"));else{var p=T._('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>').format({folder_name:r(l),href:s.escape(c)});i(p)}else if("renamed"===u)if(d){var p=T._("This folder has been renamed to ‘%(folder_name)s’").format({folder_name:r(t.change_to_fq_path)});a(p)}else{var p=T._('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>').format({folder_name:r(l),href:s.escape(c)});i(p)}else if("deleted"===u){var p=T._("The folder ‘%(folder_name)s’ has been deleted").format({folder_name:r(l)});i(p)}},e.prototype.computeAndApplyDeltasFromBoltClient=function(e){var t=e.path,r=e.payload,s=r.added,o=r.moved,a=r.removed,i=r.mount_points,n=r.parent_changes;if(n&&n.change_to_fq_path){var l=S.getBrowseStore().user();return this.showUserNotificationForPathChange(l,n),void this.setUrl({path:n.change_to_fq_path})}var c=this.getMountPointUpdateForCurrentPath(i),d=c[0],u=c[1];d&&!u&&v.Notify.success(T._("The folder was unshared."));var p=this.getPathForNewMountPoint(d,u);if(p)return void this.setPath({path:p});this.setMountPoints({mountPoints:i});for(var h=S.getBrowseStore().filesMap(),_=[],m=0,g=s;m<g.length;m++){var w=g[m],F=null,E=f.File.fromServerObject(w);_.push({before:F,after:E})}for(var y=0,R=o;y<R.length;y++){var A=R[y],b=A[0],w=A[1],F=h.get(b,null),E=f.File.fromServerObject(w);_.push({before:F,after:E})}for(var I=0,C=a;I<C.length;I++){var P=C[I],F=h.get(P,null),E=null;_.push({before:F,after:E})}this.applyFileDeltas({path:t,fileDeltas:_})},e.prototype.setSelection=function(e){var t=e.selection;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_SELECTION,data:{selection:t}})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,s=void 0!==r&&r,o=e.onFileViewerUnmount,a=e.fileViewAction,i=void 0===a?w.FileViewActionType.CLICK:a,n=e.fileViewOrigin,l=void 0===n?w.FileViewOriginType.BROWSE:n,c=S.getBrowseStore().user(),u=S.getBrowseStore().context();if(t.isDeleted)this.doRestoreFilesWithModal({files:[t],isSearchMode:i===w.FileViewActionType.SEARCH});else if(t.is_dir)f.File.isNoAccessSharedFolder(t)?d.showNoAccess(c,t,u):this.setUrl({path:t.fq_path});else{var p=S.getBrowseStore().getIndexOfFile(t),_=p<0?[t]:S.getBrowseStore().files().toArray();if(p<0&&(p=0),t.is_cloud_doc&&t.preview_url)F.unsafe_open_tab(t.preview_url);else{var m=function(){A.showElementsBehindFileViewer(),o&&o()};A.asyncOpenPreview({containerId:h.BROWSE_FILE_VIEWER_ELEMENT_ID,files:_,indexOfPreviewFile:p,shouldFocusComment:s,user:c,onFileViewerDidMount:A.hideElementsBehindFileViewer,onFileViewerUnmount:m,fileViewAction:i,fileViewOrigin:l,fileViewTarget:w.FileViewTargetType.PRIVATE})}}},e.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&w.FileViewActionType.CLICK;if(f.File.isNoAccessSharedFolder(t))d.showNoAccess(S.getBrowseStore().user(),t,S.getBrowseStore().context());else{var s=n.parent_dir(t.fq_path);this.setUrl({path:s})}},e.prototype.navigateToParentFolder=function(){var e=n.parent_dir(S.getBrowseStore().path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,s=void 0===r||r,o=e.shouldUpdateUrl,a=void 0===o||o;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:t}}),s&&this.reloadCurrentPath(),a&&(t?l.update_query_param(h.BrowseQueryArg.d,"1"):l.remove_query_param(h.BrowseQueryArg.d))},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.setViewType=function(e){var t=e.viewType,r=e.isSearchMode;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_VIEW_TYPE,data:{viewType:t,isSearchMode:r}})},e.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES,data:{canDisplayFolderSizes:t}})},e.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,s=e.canDisplayFolderSizes;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_COLUMN_CONFIGURATION,data:{columns:t,viewType:r,canDisplayFolderSizes:s}})},e.prototype.setTilesPerRow=function(e){var t=e.tilesPerRow;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_TILES_PER_ROW,data:{tilesPerRow:t}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,s=e.user;if(1===t.count()&&!t.first().is_dir)return void a.get_blockserver_link({url:t.first().direct_blockserver_link});if(r.blockHash){var o=r.currentFQPath,i=t.toArray().map(function(e){return e.fq_path});a.get_zip({fq_paths:i,subject_uid:s.id,block_hash:r.blockHash,parent_path:o})}},e.prototype.createNewFile=function(e){var t=e.userId,r=e.pathName,s=e.documentType,o={fq_path:r,extension:s,_subject_uid:String(t),t:E.Cookies.read("__Host-js_csrf")},a=this.constructFormForCreateNewFile(o);document.body.appendChild(a),a.submit()},e.prototype.constructFormForCreateNewFile=function(e){var t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(var r=0,s=Object.keys(e);r<s.length;r++){var o=s[r],a=document.createElement("input");a.type="hidden",a.name=o,a.value=e[o],t.appendChild(a)}return t},e.prototype.createCloudDoc=function(e){var t,r=e.pathName,s=e.title,o=e.documentType;switch(o){case h.CloudDoc.PAPER:t="Paper doc";break;case h.CloudDoc.GOOGLE_DSS_DOC:t="Google Doc";break;case h.CloudDoc.GOOGLE_DSS_SHEET:t="Google Sheet";break;case h.CloudDoc.GOOGLE_DSS_SLIDES:t="Google Slides";break;default:t="Cloud Doc"}C.Snackbar.sync(T._("Creating new %(type)s...").format({type:t}),!0);var a=S.getBrowseStore().user().id;this.dataApi.createCloudDoc({pathName:r,title:s,documentType:o,userId:a,onSuccess:function(e){var r=(e.changesets,e.createdFile);C.Snackbar.complete(T._("%(type)s created!").format({type:t})),F.redirect(r.preview_url)},onError:function(e){C.Snackbar.fail(e)}})},e.prototype.addCommentStatusBatch=function(e){var t=e.commentStatusByFqPath;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},e.prototype.setDropTarget=function(e){var t=e.target;_.BrowseDispatcher.dispatch({type:h.BrowseActionType.SET_DROP_TARGET,data:{target:t}})},e.prototype.setDataApi=function(e){this.dataApi=e,m.browseNavActions.setDataApi(e)},e.prototype.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(this,void 0,void 0,function(){var e,s,o,a,i,n,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=S.getBrowseStore().user(),s=h.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),_.BrowseDispatcher.dispatch({type:h.BrowseActionType.REQUEST_FETCH_FOLDER_SIZES,data:{fqPath:t.fq_path}}),[4,this.dataApi.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return o=r.sent(),_.BrowseDispatcher.dispatch({type:h.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:o}}),a=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL})];case 3:i=r.sent(),i.queue&&(a=a.concat(i.queue)),r.label=4;case 4:return a.length>0&&s>0?(s--,n=Math.min(h.MAX_FOLDER_SIZE_QUEUE_SIZE,a.length),l=a.splice(0,n),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return i=r.sent(),i.queue&&a&&(a=a.concat(i.queue)),[3,4];case 6:return c=0!==s&&i.queue&&0===i.queue.length?I.FetchFolderSizeState.COMPLETE:I.FetchFolderSizeState.ERROR,_.BrowseDispatcher.dispatch({type:h.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:c}}),[3,8];case 7:return d=r.sent(),_.BrowseDispatcher.dispatch({type:h.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:I.FetchFolderSizeState.ERROR}}),[3,8];case 8:return[2]}})})},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var s;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.dataApi.fetchSameNamespaceFolderSizes(e,t)];case 1:return s=r.sent(),_.BrowseDispatcher.dispatch({type:h.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:s}}),[2,s]}})})},e.prototype.handleShowShareModal=function(e,t){var r=S.getBrowseStore(),s=r.user(),o=r.context();D.asyncShowShareModal(s,e,{browseContext:o,origin:t},m.browseNavActions.setPath,m.browseNavActions.setUrl)},e})();t.browseActions=new O(p)}),define("modules/clean/react/browse/api",["require","exports","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,s,o,a,i,n,l,c){"use strict";function d(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function u(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,a=e.userId,i=e.onSuccess,n=e.includeDeletedFiles,l=void 0!==n&&n,c=e.sortFoldersFirst,u=void 0===c||c,p=e.onError;return s.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:u,include_file_info:"True",path2:o},url:"/browse",subject_user:a,success:function(e,t,r){var s=d(e);s&&i({path:o,data:s,xhr:r})},error:function(e,t,r){p&&p(e,t,r)}})}function p(e){var t=e.files,o=e.newPath,a=e.userId,c=e.onSuccess,d=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(o)?(l.Notify.error(n._("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:o,fsw_request:d?"check":void 0},subject_user:a,progress_text:n._("Copying files..."),success:function(e){try{var t=r.isString(e)?JSON.parse(e):e;c({newFiles:t.new_browse_files?t.new_browse_files.map(i.File.fromServerObject):[],destinationPath:o,changesets:t.changesets,rollbackHints:t.rollback_hints,failureDetails:t.failure_details})}catch(e){}}})}function h(e){var t=e.files,o=e.userId,a=e.onSuccess,i=t.map(function(e){return e.fq_path});return s.WebProgressRequest({url:"/cmd/delete",data:{files:i},subject_user:o,progress_text:n._("Deleting files..."),success:function(e){try{var s=r.isString(e)?JSON.parse(e):e;a({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:s.changesets,rollbackHints:s.rollback_hints})}catch(e){}}})}function _(e){var t=e.path,o=e.files,a=e.newPath,c=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer,p=e.checkFSWs;if(t===a)return l.Notify.error(n._("Those files already exist in that folder.")),null;var h=o.map(function(e){return e.fq_path});return h.includes(a)?(l.Notify.error(n._("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/move",data:{files:h,to_path:a,allow_ownership_transfer:u,fsw_request:p?"check":void 0},subject_user:c,progress_text:n._("Moving files..."),skipNotifyError:!u,success:function(e){try{var s=r.isString(e)?JSON.parse(e):e;d({path:t,
destinationPath:a,newFiles:s.new_browse_files?s.new_browse_files.map(i.File.fromServerObject):[],changesets:s.changesets,rollbackHints:s.rollback_hints,failureDetails:s.failure_details})}catch(e){}},error:function(t,r,s){l.Notify.error(s),e.onError&&e.onError(s)}})}function f(e){var t=e.file,r=e.newName,o=e.userId,a=e.onSuccess,i=e.onError;return s.WebRequest({url:new c.URI({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o,data:{to_path:r},success:function(e,r,s){var o=d(e);if(o){var n=t.merge(o.new_browse_files[0]);a({changesets:o.changesets,renamedFile:n,rollbackHints:o.rollback_hints})}else i&&i()},error:i})}function m(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.isSearchMode;return s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path}),source:a?"search":"browse"},subject_user:r,dataType:"json",progress_text:n._("Restoring…"),success:function(){o()}})}function S(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.progressText,i=void 0===a?n._("Deleting…"):a;return s.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:i,success:function(e){var r=d(e);r&&"success"===r.status&&o(t)}})}function g(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,a=e.progressText,i=e.rollbackHints,n=void 0===i?{}:i,l=e.onSuccess;return s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o),rollback_hints:JSON.stringify(n)},subject_user:t,progress_text:a,success:function(){l()}})}function w(e){var t=e.pathName,r=e.folderName,o=e.userId,a=e.onSuccess,n=e.onError,l=e.checkFSWs;return s.WebProgressRequest({url:new c.URI({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:l?"check":void 0},subject_user:o,success:function(e){var t=d(e);if(t){var r=t.new_browse_files?i.File.fromServerObject(t.new_browse_files[0]):null;a({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){n()}})}function F(e){var t=e.pathName,r=e.title,o=e.documentType,a=e.userId,n=e.onSuccess,l=e.onError,u=(t+"/"+r+"."+o).replace("//","/");return s.WebRequest({url:new c.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:a,data:{to_path:u,title:r},success:function(e){var t=d(e);if(t){n({changesets:null,createdFile:i.File.fromServerObject(t.new_browse_files[0])})}},error:function(e,t,r){l(r)},skipNotifyError:!0})}function E(e){var t=e.path,o=e.userId,a=e.namespaceToJournalIdMap,i=e.onSuccess,n=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:r.map(a,function(e,t){return t+"_"+e}).join(","),show_deleted:!!n};return s.WebRequest({url:"/update/list_dir",subject_user:o,data:c,dataType:"text",success:function(e){var t=d(e);t&&i(t)}})}function y(e,t){return(new o.ApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function T(e,t){return(new o.ApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}function v(e,t){return(new a.ApiV2RootAwareClient).ns("ml").rpc("get_folder_suggestion",{paths:t,action:"MOVE"},{subjectUserId:e})}function R(t){var r=t.fqPath,s=t.nsId,o=t.userId,a=t.onSuccess,i=t.onError;e(["modules/clean/unity/features"],function(e){e.open_file(s,r,o,a,i,!1)})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadPath=u,t.copyFiles=p,t.deleteFiles=h,t.moveFiles=_,t.renameFile=f,t.restoreFiles=m,t.purgeFiles=S,t.rollbackChangeSets=g,t.createNewFolder=w,t.createCloudDoc=F,t.getChangesForDirectory=E,t.fetchSharedFolderSizes=y,t.fetchSameNamespaceFolderSizes=T,t.fetchMoveSuggestion=v,t.openLocalCopy=R}),define("modules/clean/react/browse/browse",["require","exports","tslib","external/react","external/react-dom","external/lodash","modules/clean/em_string","modules/clean/filepath","modules/clean/filepath","modules/clean/history","modules/clean/react/async_overquota_modal_controller","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/browse/browse_bolt_client","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/actions","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/clean/pagelet_logger","modules/clean/web_timing_logger","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/python","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/action_creators","modules/clean/storage","modules/clean/react/files_view/types","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/nav_actions","modules/clean/react/snackbar","modules/clean/user_education/user_education_client","modules/clean/search/search_results/log_helper","modules/clean/filetypes","modules/clean/web_user_action_events","modules/clean/react/browse/action_logger","modules/clean/analytics","modules/clean/search/logger","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/react/app_actions/app_actions_store","modules/clean/upsell/prompt_event_emitter"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f,m,S,g,w,F,E,y,T,v,R,A,b,I,C,P,D,N,L,O,x,M,U,B,q,k,V,W,H,j,G,Q,z,K,J,Y,X,Z,$,ee,te,re,se){"use strict";function oe(e){U.Notify.success(M._("%(file_name)s added to your Dropbox.").format({file_name:l.filename(e)}))}function ae(e){var t=M._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:i.Emstring.em_snippet(l.filename(e),I.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});U.Notify.success(new x.HTML(t))}function ie(e){var t=l.parent_dir(e);"/"!==t&&U.Notify.success(M._("Folder is in %(path)s").format({path:i.Emstring.em_snippet(t,22)}))}function ne(e){var t=le();c.replace_state(e,a.pick.apply(a,[t,_.BrowseQueryArg.d,_.BrowseQueryArg.select,_.BrowseQueryArg.preview].concat(_.FRAMEWORK_ARGS)))}function le(){var e=c.deconstruct_url().qargs;return{d:e[_.BrowseQueryArg.d],select:e[_.BrowseQueryArg.select],path:e[_.BrowseQueryArg.path],last_fq_path:e[_.BrowseQueryArg.last_fq_path],query:e[_.BrowseQueryArg.query],query_unnormalized:e[_.BrowseQueryArg.query_unnormalized],preview:e[_.BrowseQueryArg.preview],search_session_id:e[_.BrowseQueryArg.search_session_id],country_override:e[_.BrowseQueryArg.country_override],cProfile:e[_.BrowseQueryArg.cProfile],public_mode_override:e[_.BrowseQueryArg.public_mode_override],stormcrow_override:e[_.BrowseQueryArg.stormcrow_override],stormcrow_override_data_field:e[_.BrowseQueryArg.stormcrow_override_data_field],stormcrow_override_population:e[_.BrowseQueryArg.stormcrow_override_population],stormcrow_override_ttl:e[_.BrowseQueryArg.stormcrow_override_ttl],stormcrow_panel:e[_.BrowseQueryArg.stormcrow_panel],uncompressed_js:e[_.BrowseQueryArg.uncompressed_js],use_packages:e[_.BrowseQueryArg.use_packages],file_categories:e[_.BrowseQueryArg.file_categories]}}Object.defineProperty(t,"__esModule",{value:!0});var ce;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(ce||(ce={}));var de=(function(t){function i(s){var i=t.call(this,s)||this;i.logOnceFetchedDataRequiredForTTI=a.once(function(){return N.log_js_modules_fetched_data_required_for_tti()}),i.previousHistoryCallbackMode=ce.BROWSE,i.handlePreviewAndShareModalsOnLoad=function(t){var s=i.getPathFromProps(),o=i.state.user,a=!!i.props["open-preview"],n=!!i.props["show-share-modal"],l=i.props["share-prefill-email"];if(a&&!t){U.Notify.error(M._("The file doesn’t exist"));var d=i.state.urlPrefix,u=i.getUrlForFQPath(d,s),p=le();delete p.preview,c.replace_state(u,p)}if(t){var h=f.File.fromServerObject(t);y.asyncOpenPreview({containerId:_.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[h],fileViewAction:q.FileViewActionType.CLICK,fileViewOrigin:q.FileViewOriginType.BROWSE,fileViewTarget:q.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:o,updateBrowserLocation:!1,onFileViewerDidMount:y.hideElementsBehindFileViewer,onFileViewerUnmount:function(){y.showElementsBehindFileViewer();var e=i.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getFilesViewTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),i.restoreUrlAfterFileViewClose()}}),n&&N.waitForTTI().then(function(){i.mounted&&b.asyncShowPrefilledShareModal({user:o,sharePrefillEmail:l,content:h,setPath:G.browseNavActions.setPath,setUrl:G.browseNavActions.setUrl})})}else n&&N.waitForTTI().then(function(){if(i.mounted){var e=i.props["ns-id"],t=i.props["ns-path"];b.asyncShowPrefilledShareModal({user:o,sharePrefillEmail:l,content:{fqPath:s,isFolder:!0,nsId:e&&t?e:null,targetNsId:e&&!t?e:null},setPath:G.browseNavActions.setPath,setUrl:G.browseNavActions.setUrl})}});n||i.props["showing-mobile-billing-modal"]||i.props["showing-client-modal"]||N.waitForTTI().then(function(){e(["modules/clean/upsell/prompt_loader"],function(e){return r.__awaiter(i,void 0,void 0,function(){return r.__generator(this,function(e){return se.promptBufferedEventEmitter.on(se.Events.ON_PROMPT_INITIALIZED,function(e){e&&(e.didMainCampaignLoad()||e.didCampaignForUserEducationLoad())}),[2]})})})})},i.receiveStateFromStores=function(){i.setState(i.getStateFromStores())},i.handleComponentTTI=function(e){i.browseLogger&&(i.browseLogger.componentReady(e),i.browseLogger.ttiLogged&&i.ajaxRequestWebTimer&&(i.ajaxRequestWebTimer.markTimeToInteractive(),delete i.ajaxRequestWebTimer))},i.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return n.normalize(e.path)+n.normalize(e.name)});u.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},i.getIsFileJumping=function(){return m.getBrowseStore().isFileJumping()},i.getFileByFullPath=function(e){return m.getBrowseStore().getFileByFullPath(e)},i.setBrowseViewRef=function(e){i.browseViewRef=e},i.startBoltLiveUpdate=function(){i.browseBoltClient.startLiveUpdate(function(){i.getChangesRequest&&i.getChangesRequest.abort();var e=i.state,t=e.user,r=e.path,s=e.shouldShowDeletedFiles;i.getChangesRequest=p.getChangesForDirectory({path:r,userId:t.id,namespaceToJournalIdMap:i.browseBoltClient.getNsMap(),includeDeletedFiles:s,onSuccess:function(e){delete i.getChangesRequest,u.browseActions.computeAndApplyDeltasFromBoltClient({payload:e,path:r}),i.browseBoltClient.handleUpdateBoltClient(e.bolt_data)}})})},i.handleFileLocationChange=function(e,t){e="/"+B.URI.decode(e),i.ensureFileViewerIsOpenedOrClosedIfNeeded(t),i.previousHistoryCallbackMode===ce.BROWSE&&n.paths_are_equal(m.getBrowseStore().path(),e)||(i.previousHistoryCallbackMode=ce.BROWSE,i.navigateToPath({path:e}))},i.getPathFromProps=function(){return i.props["init-fq-path"]||"/"},i.handleSearchLocationChange=function(e,t){if(t){var r=i.searchBarExperiments,s=i.searchResultsExperiments,o=t.query||t.query_unnormalized||"";e=t.path||t.last_fq_path||"/";var a=t.search_session_id||"",l=t.file_categories||"",c=void 0,d=void 0;if(te.isInDeletedFilterRightRailExperiment(r)&&(c="1"===t.d,setTimeout(function(){u.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:c,shouldUpdateUrl:!1,shouldReloadFolder:!1}),c&&u.browseActions.setViewType({viewType:H.ViewType.List})},0)),o&&(!n.paths_are_equal(e,i.state.path)||o!==i.state.latestQuery||te.isInDeletedFilterRightRailExperiment(r)&&c!==i.state.shouldShowDeletedFiles||k.isInFileTypeFilterExperiment(s)&&l!==k.fileCategoriesToString(i.state.fileCategories))){var p=i.state.user;setTimeout(function(){G.browseNavActions.clear({path:e,context:new f.BrowseContext})}),i.previousHistoryCallbackMode=ce.SEARCH,n.paths_are_equal(m.getBrowseStore().path(),e)||u.browseActions.setPath({path:e}),k.isInFileTypeFilterExperiment(s)&&l!==k.fileCategoriesToString(i.state.fileCategories)&&(d=k.fileCategoriesFromString(l),T.searchResultsActions.setFileTypeFilter({fileCategories:d})),i.searchBarStore.dispatch(V.setBrowseScope({browseScope:e})),i.searchBarStore.dispatch(V.setSearchQueryAndFetchResults({user:p,query:o,searchSessionId:a}));var h=i.searchResultsExperiments,_=h.expShowSymlinkIcon,S=h.expUseFileInfoEndpoint;T.searchResultsActions.runSearch({user:p,path:e,query:o,searchSessionId:a,showSymlinkIcon:!!_,webTimer:i.ajaxRequestWebTimer,logOnceFetchedDataRequiredForTTI:i.logOnceFetchedDataRequiredForTTI,deletedFiles:c,expSinglePageSearch:te.isInSinglePageSearchExperiment(i.searchBarExperiments),useFileInfoEndpoint:!!S,fileCategories:d})}}},i.handleSearchExit=function(){i.searchBarStore.dispatch(V.clearSearchBar()),T.searchResultsActions.clearSearch()},i.markTTVIfNeeded=function(){if(!i.hasTTVBeenLogged&&i.mounted&&(i.prefetchComplete||i.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(o.findDOMNode(i)),N.mark_time_to_view(),i.hasTTVBeenLogged=!0}},i.handleFileListUpdated=function(){i.fileViewerIsShown()?i.state.files.isEmpty()?u.browseActions.closeFileViewer():u.browseActions.updatePreview({files:i.state.files.toJS()}):i.ensureFileViewerIsOpenedOrClosedIfNeeded(le())},i.handleOnNavigateToPath=function(e){u.browseActions.setUrl({path:e})},i.handleOnNavigateToParentFolder=function(){u.browseActions.navigateToParentFolder()},i.handleDelete=function(e){var t=i.state.context,r=e.some(f.File.isTeamSharedFolder),s=e.some(function(e){return e.read_only}),o=e.every(function(e){return e.isDeleted});if(!t.isCurrentPathWriteable()||r||s)r?U.Notify.error(M._("Team folders can’t be deleted.")):U.Notify.warning(M._("You don’t have permission to delete files in this folder."));else{var a=i.browsePostTTIExperiments,n=a.expSubgrowthBizWebClientOQDelete,l=a.expShouldShowPurgeModal;o?u.browseActions.doPermanentDeleteWithModal({files:e,expShouldShowPurgeModal:!!l}):u.browseActions.doDeleteFilesWithModal({files:e,expSubgrowthBizWebClientOQDelete:!!n})}},i.handleOnNavigateToFileOrFolder=function(e,t){i.ensureFullFileObjectPopulated(e,i.completeNavigateToFileOrFolder,t)},i.ensureFullFileObjectPopulated=function(e,t,r){var s=i.searchResultsExperiments.expUseFileInfoEndpoint;i.state.isSearchMode?T.searchResultsActions.fetchCompleteSearchResultSRP({searchResult:e,user:i.state.user,onSuccess:t,useFileInfoEndpoint:!!s}):t(e,r)},i.completeNavigateToFileOrFolder=function(e,t){var r=i.state,s=r.user,o=r.viewer,a=r.isSearchMode,l=r.viewType,c=e.ns_id,d=e.sjid,p=e.file_id,h=e.fq_path,_=e.bytes,f=e.ext,m=e.request_id;if(X.logOpenRow({uid:s.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:c,file_sjid:d,file_id:p,file_name:n.filename(e.fq_path),file_path:h,file_size:_,file_extension:f,request_id:m}),e.type===J.FileTypes.TEAM_SHARED_FOLDER&&(z.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),Z.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:o.team_id})),a){var S=Y.WebUserActionLogEvent.FILE_VIEW;e.is_unmounted?S=Y.WebUserActionLogEvent.UNMOUNTED_VIEW:e.is_dir&&(S=Y.WebUserActionLogEvent.FOLDER_OPEN),K.recordSearchResultsAction({result:e,user:s,action_type:S,view_type:l})}a&&e.is_unmounted?b.asyncShowSharedContentLinkSyncModal(s,e):u.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:a?q.FileViewActionType.SEARCH:q.FileViewActionType.CLICK})},i.actionHandlers={onDelete:i.handleDelete,onShowRename:function(e){return u.browseActions.showFileRename({file:e})},onRestore:function(e){var t=i.state,r=t.user,s=t.isOverFreeQuota,o=t.isSearchMode;!r.is_team&&s?d.showOverquota("wb_oq_rstdel_f"):u.browseActions.doRestoreFilesWithModal({files:e,isSearchMode:o})},onPermanentDelete:function(e){var t=i.browsePostTTIExperiments.expShouldShowPurgeModal;u.browseActions.doPermanentDeleteWithModal({files:e,expShouldShowPurgeModal:!!t})},onShowComment:function(e){return i.onShowComment(e)}},i.filesViewActionHandlers={onDelete:i.handleDelete,onShowRename:function(e){return u.browseActions.showFileRename({file:e})},onCopyToClipboard:function(e){return u.browseActions.copyFilesToClipboard(e)},onPasteFromClipboard:function(){return u.browseActions.pasteClipboardFilesToCurrentPath()},onNewFolderSubmit:function(e){return u.browseActions.createFolder({pathName:i.state.context.currentFQPath,folderName:e,nsId:i.state.context.rootNSID,checkFSWs:!0})},onNewFolderCancel:function(){return u.browseActions.cancelCreateFolder()},onRenameSubmit:function(e,t){return u.browseActions.renameFile({file:e,newName:t,isSearchMode:i.state.isSearchMode})},onRenameCancel:function(e){return u.browseActions.cancelFileRename({file:e})},onSetDropTarget:function(e){return u.browseActions.setDropTarget({target:e})},onSwitchViewType:function(e){return u.browseActions.setViewType({viewType:e,isSearchMode:i.state.isSearchMode})},onTilesPerRowChange:function(e){return u.browseActions.setTilesPerRow({tilesPerRow:e})},onColumnsChanged:function(e,t,r){return u.browseActions.setColumnConfiguration({columns:e,viewType:t,canDisplayFolderSizes:r})},onCanDisplayFolderSizesChanged:function(e){return u.browseActions.setColumnDependentCapabilities({canDisplayFolderSizes:e})},onAddFileJumpKeyCode:function(e){return u.browseActions.addFileJumpKeyCode({keyChar:e})},onResetFileJump:function(){return u.browseActions.resetFileJump()},onShowShare:function(e,t){return u.browseActions.handleShowShareModal(e,t)}},i.uploadAjaxInterceptor={interceptUploadPrecheck:function(e){return e},interceptUpload:function(e,t){var s=i.uploaderExperiments.expWebNsidRouting,o=t.ns_id_for_routing;if(s&&!o){var a=m.getBrowseStore().mountPoints(),n=i.state.context.rootNSID;O.assert(null!=a,"mountPoints is null"),O.assert(null!=n,"rootNSID is null"),o=E.getNsId(a,n,e.dest)}return r.__assign({},t,{ns_id_for_routing:o})}},i.handleSearch=function(e,t,r,s){var o=k.buildSearchURL({user:i.state.user,searchPath:t,normalizedQuery:e,searchSessionId:r?R.searchSessionId(i.searchBarStore.getState()):A.getSearchResultsStore().searchSessionId(),searchToken:k.getSearchCsrfToken(),qargs:s});i.ensureTimer("search_results"),c.push_state(o.getPath(),o.getQuery())},i.handleSearchFiltersChanged=function(e){var t=e.path,r=e.deletedFiles,s=e.fileCategories,o=i.state,a=o.user,n=o.searchSessionId,l=o.latestQuery;t&&t!==i.state.path&&$.logScopeChipChanged({searchSessionId:n,user:a,chipAdded:!ee.isScopeChipRoot(t),filePath:t,viewport:"right-rail",searchType:"full_page"}),void 0!==r&&r!==i.state.shouldShowDeletedFiles&&$.logDeletedFilterChanged({searchSessionId:n,user:a,deletedFiles:r,viewport:"right-rail",searchType:"full_page"}),void 0!==s&&i.state.fileCategories;var c={};if(void 0!==r&&(c.d=r?"1":"0"),void 0!==s&&!Object.keys(s).every(function(e){return"unchecked"===s[e]})){var d=k.fileCategoriesToString(s);c.file_categories=d}i.handleSearch(l,void 0!==t?t:i.state.path,!1,c)},i.fileViewerIsShown=function(){if(i.state.arePostTTIModulesLoaded){return e("modules/clean/react/file_viewer/controller").isShown()}return!1},i.ensureFileViewerClosedIfNotPreviewing=function(e){!e.preview&&i.fileViewerIsShown()&&u.browseActions.closeFileViewer()},i.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){var t=i.fileViewerIsShown();if(e.preview&&!t){var r=m.getBrowseStore().getFileByFilename(e.preview);r&&u.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&u.browseActions.closeFileViewer()},i.getLearnMoreLinkHandler=function(){window.open("/help/business/unsynced-team-folder","_blank")},N.log_js_modules_application_code_start();var l=m.getBrowseStore(),h=A.getSearchResultsStore(),S=P.Viewer.get_viewer(),w=S.get_user_by_id(i.props["user-id"]);return u.browseActions.appInit({experiments:i.browseExperiments,shouldShowDeletedFiles:!!i.props["should-show-deleted-files"],user:w,viewer:S}),v.getStoreForSearchBar().dispatch(V.setExperiments({experiments:i.searchBarExperiments})),i.searchBarStore=v.getStoreForSearchBar(),i.appActionsStore=re.getAppActionsStore(),l.add_change_listener(i.receiveStateFromStores),h.add_change_listener(i.receiveStateFromStores),F.uploaderStore.add_change_listener(i.receiveStateFromStores),window.addEventListener(g.ALL_UPLOADS_COMPLETE_EVENT,i.onAllUploadsComplete),i.state=r.__assign({},i.getStateFromStores(),{arePostTTIModulesLoaded:!1}),i}return r.__extends(i,t),Object.defineProperty(i.prototype,"uploaderExperiments",{get:function(){return this.props["exp-uploader-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"uploaderPostTTIExperiments",{get:function(){return this.state.uploaderPostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"searchBarExperiments",{get:function(){return this.props["exp-search-bar-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"searchResultsExperiments",{get:function(){return this.props["exp-search-results-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"browseExperiments",{get:function(){return this.props["exp-browse-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"browsePostTTIExperiments",{get:function(){return this.state.browsePostTTIExperiments||{}},enumerable:!0,configurable:!0}),i.prototype.componentWillMount=function(){var t,r=this;t=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new D.PageletLogger("browse",t,!0,{view_type:this.state.viewType.toLowerCase()});var s=this.state,o=s.urlPrefix,a=s.user,i=s.viewer,n=this.props["search-query"],l=this.props["share-link"],d=!!this.props["open-preview"],p=this.getPathFromProps();n||l||d||ne(this.getUrlForFQPath(o,p));var h=i.get_users().map(function(e){return e.id});W.UserLocalStorage.clearOtherUsers(h),this.browseBoltClient=new S.BrowseBoltClient(a.id);var _=new j.BrowsePrefetchLoader({user:a,path:p,fqPathsToSelect:this.props["select-fq-paths"]},function(e){r.prefetchComplete=!0,r.searchBarStore.dispatch(V.setBrowseScope({browseScope:p})),r.handlePreviewAndShareModalsOnLoad(e.preview_file_info),N.log_js_modules_fetched_data_required_for_tti(),r.markTTVIfNeeded()},function(){r.prefetchComplete=!0,u.browseActions.setUrl({path:""}),r.navigateToPath({path:""})},function(t){var s=t["exp-browse-post-tti-experiments"],o=t["exp-uploader-post-tti-experiments"],a=!!t["is-over-free-quota"],i=!!t["maybe-render-team-admin-modals"];s.expShouldShowNcctPaywall&&L.redirect("/ncct-trial-end"),i&&new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(function(e){(0,e.postTTINCCTReminderModal)()}),r.setState({browsePostTTIExperiments:s,uploaderPostTTIExperiments:o,isOverFreeQuota:a})},function(e){O.reportException({err:e||new Error("failed to load post TTI experiments")})});_.isPrefetching()?_.handlePrefetch():n||this.navigateToPath({path:p,logFetchedDataRequiredForTTI:!0}),c.add_callback(o,this.handleFileLocationChange,!0),c.add_callback("/search",this.handleSearchLocationChange,!n),c.add_exit_callback("/search",this.handleSearchExit)},i.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var r=this.getPathFromProps(),s=this.state.user,o=this.props["search-query"],n=this.props["share-link"],c=!!this.props["open-preview"];this.props["from-scl-sync-modal"]&&(s.is_cdm_member?ae(r):oe(r)),this.props["show-share-success-snackbar"]&&C.showInBandShareSuccessSnackbar(l.filename(r)),this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),!o&&n&&!c&&s.is_cdm_member&&ie(r),this.markTTVIfNeeded(),i.mountFileViewerTarget(),N.waitForTTI().then(function(){t.props["search-query"]||t.fetchAndStartBoltUpdates();var r=function(e,r,s,o,i,n,l,c,d,u,p,h,_,f,S,g){var w=s.SharedWithStore,F=i.checkForMissingStarredData,E=i.StarredStore,y=p.BloodhoundContactsV2,T=_.EmailVerification;if(t.mounted){var v=t.state,R=v.user,A=v.path,b=v.files,I=b.toArray();w.initializeWith({path:A,files:I}),F({items:I,user:R});var C=E.addListener(function(){t.setState({starredState:E.getLoadingStates()})}),P=m.getBrowseStore(),D=function(){return a.defer(function(){F({items:t.state.files.toArray(),user:R})})};P.add_change_listener(D),t.removeStarredStoreListener=function(){C(),P.remove_change_listener(D)},y.getOrCreateForUser(R),h.setup(),t.setState({arePostTTIModulesLoaded:!0}),t.props["email-just-verified"]?T.getForRole(R.role).show_verified_modal():t.props["email-just-verified-and-changed"]?T.getForRole(R.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&T.getForRole(R.role).show_sent_modal()}};r.perfName="browse_post_tti",e(["modules/clean/react/file_viewer/controller","modules/clean/react/browse/file_actions","modules/clean/react/browse/shared_with","modules/clean/react/files_view/overflow_menu_with_star","modules/clean/react/starred/browse_exports","modules/clean/react/file_modal_controller","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/react/browse/comment_status","modules/clean/account/email","modules/clean/unity_browse_interface","modules/clean/unity/features","modules/clean/unity/check_file_cache"],r)})},i.prototype.componentWillUpdate=function(e,t){t.isSearchMode&&!this.state.isSearchMode?this.browseBoltClient.stopLiveUpdate():!t.isSearchMode&&this.state.isSearchMode&&this.fetchAndStartBoltUpdates(),t.files.equals(this.state.files)||a.defer(this.handleFileListUpdated)},i.prototype.componentWillUnmount=function(){if(e.defined("modules/clean/react/browse/comment_status")){e("modules/clean/react/browse/comment_status").teardown()}this.removeStarredStoreListener&&this.removeStarredStoreListener(),i.unmountFileViewerTarget(),m.getBrowseStore().remove_change_listener(this.receiveStateFromStores),A.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),F.uploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(g.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),this.mounted=!1},i.prototype.getStateFromStores=function(){var e=m.getBrowseStore(),t=A.getSearchResultsStore(),s=t.latestQuery(),o=!!s,a={files:e.files(),filesWithoutTeamFolders:e.filesWithoutTeamFolders(),paginatedTotalNumFiles:e.paginatedTotalNumFiles(),teamFolders:e.teamFolders(),loadingState:e.loadingState(),path:e.path(),fileRename:e.fileRename(),shouldShowDeletedFiles:e.shouldShowDeletedFiles(),isDraggingInternalFiles:w.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:w.FileUploaderController.isDraggingExternalFiles(),activeDropTarget:e.activeDropTarget(),isUploadModalOpen:w.FileUploaderController.isUploadModalOpen(),isTextSelectable:!!e.fileRename(),createNewFolderState:e.newFolderCreationState(),isSearchMode:o,currentSort:e.currentSort(),viewType:e.viewType(),canDisplayFolderSizes:e.canDisplayFolderSizes(),viewTypeColumns:e.viewTypeColumns(),urlPrefix:e.urlPrefix(),isQueryingFolderSizes:e.isQueryingFolderSizes(),tilesPerRow:e.tilesPerRow(),user:e.user(),viewer:e.viewer(),fileCategories:t.fileCategories()};return o?r.__assign({},a,{context:t.browseContext(),selection:t.selection(),selectedFiles:t.selectedFiles(),searchSessionId:t.searchSessionId(),latestQuery:s}):r.__assign({},a,{context:e.context(),selection:e.selection(),selectedFiles:e.selectedFiles(),latestQuery:void 0})},i.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.state.urlPrefix,r=this.getUrlForFQPath(t,this.state.path);e=this.props["open-preview"]?a.omit(le(),_.BrowseQueryArg.preview,_.BrowseQueryArg.select):{},c.replace_state(r,e)},i.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":B.URI.encode_parts(t))},i.prototype.fetchAndStartBoltUpdates=function(){this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate)},i.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&delete this.ajaxRequestWebTimer,this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{this.ajaxRequestWebTimer=N.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},i.prototype.navigateToPath=function(e){var t=e.path,r=e.logFetchedDataRequiredForTTI,s=void 0!==r&&r;this.browseLogger&&this.browseLogger.ttiLogged&&this.ensureTimer("browse_ajax","browse_ajax_nav"),u.browseActions.setPath({path:t,logFetchedDataRequiredForTTI:s,onPathLoaded:this.markTTVIfNeeded,ajaxWebTimer:this.ajaxRequestWebTimer}),this.searchBarStore.dispatch(V.clearSearchBar()),this.searchBarStore.dispatch(V.setBrowseScope({browseScope:t}))},i.prototype.onShowComment=function(e){this.ensureFullFileObjectPopulated(e,function(e){u.browseActions.navigateToFileOrFolder({file:e,shouldFocusComment:!0})})},i.prototype.shouldShowUnsyncNotification=function(){return this.props["should-show-unsync-notification"]},i.prototype.showUnsyncNotification=function(){Q.Snackbar.show(s.createElement(Q.Snackbar,{variant:"generic",title:M._("Do you also need this on your computer?",{comment:'\'"this" refers to the folder that the user is currently browsing. (limited space, please keep the phase short)'}),timeoutDelayMs:1e5,actionButtonText:M._("Learn more"),closeButtonText:M._("Close"),onActionClick:this.getLearnMoreLinkHandler}))},i.prototype.render=function(){var e=this.state,t=e.user,r=e.activeDropTarget,o=e.context,a=e.path,i=e.createNewFolderState,n=e.currentSort,l=e.isUploadModalOpen,c=e.selection,d=e.fileRename,u=e.files,p=e.teamFolders,_=e.isTextSelectable,f=e.loadingState,m=e.selectedFiles,S=e.isSearchMode,g=e.viewType,w=e.canDisplayFolderSizes,F=e.viewTypeColumns,E=e.starredState,y=e.filesWithoutTeamFolders,T=e.arePostTTIModulesLoaded,v=e.isDraggingExternalFiles,R=e.isDraggingInternalFiles,A=e.isQueryingFolderSizes,b=e.paginatedTotalNumFiles,I=e.tilesPerRow,C=e.shouldShowDeletedFiles,P=e.isOverFreeQuota,D=e.searchSessionId,N=e.latestQuery,L=e.fileCategories;return s.createElement(h.BrowseView,{autoTeamGroupId:this.props["auto-team-group-id"],ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,filesViewActionHandlers:this.filesViewActionHandlers,onNavigateToParentFolder:this.handleOnNavigateToParentFolder,onNavigateToPath:this.handleOnNavigateToPath,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,activeDropTarget:r,context:o,createNewFolderState:i,currentSort:n,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:d,files:u,filesWithoutTeamFolders:y,getIsFileJumping:this.getIsFileJumping,getFileByFullPath:this.getFileByFullPath,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:v,isDraggingInternalFiles:R,isFileViewerShown:this.fileViewerIsShown,isSearchMode:S,isTextSelectable:_,isUploadModalOpen:l,loadingState:f,onSearch:this.handleSearch,path:a,selectedFiles:m,selection:c,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:C,starredState:E,teamFolders:p,totalNumItems:b,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:t,viewType:g,canDisplayFolderSizes:w,columns:F[g],viewTypeColumns:F,tilesPerRow:I,arePostTTIModulesLoaded:T,isNoComment:this.props["is-no-comment"],isOverFreeQuota:P,isQueryingFolderSizes:A,nsId:this.props["ns-id"],uploaderExperiments:this.uploaderExperiments,uploaderPostTTIExperiments:this.uploaderPostTTIExperiments,searchBarExperiments:this.searchBarExperiments,searchResultsExperiments:this.searchResultsExperiments,browseExperiments:this.browseExperiments,browsePostTTIExperiments:this.browsePostTTIExperiments,searchSessionId:D,latestQuery:N,onSearchFiltersChanged:this.handleSearchFiltersChanged,appActionsStore:this.appActionsStore,
fileCategories:L})},i.mountFileViewerTarget=function(){var e=document.getElementById(_.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=_.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},i.unmountFileViewerTarget=function(){var e=document.getElementById(_.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},i})(s.Component);t.BrowseApp=de}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","modules/core/exception","modules/clean/react/files_view/types","modules/clean/react/browse/actions","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,s,o,a,i,n,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);n.Notify.error(t)}}Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(e,t,n,d,u,p){var h=e.user,_=e.path,f=e.fqPathsToSelect;void 0===p&&(p=window);var m=this;this.isPrefetching=function(){return!!m.browsePreloadHandler&&!!m.firstPagePreloadHandler},this.handlePrefetch=function(){r.assert(m.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),m.browsePreloadHandler(m.handlePrefetchDataSuccess,m.onPrefetchError),l.waitForTTI().then(function(){m.postTTIPreloadHandler(m.handlePostTTIDataSuccess,m.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=function(e){var t=void 0;try{t=JSON.parse(e)}catch(e){return void m.onPostTTIPrefetchError(e)}if(!t)return void m.onPostTTIPrefetchError();m.onPostTTIPrefetchComplete(t)},this.handlePrefetchDataSuccess=function(e){var t=m.extractAjaxInitData(e);if(!t)return void m.onPrefetchError();var r,i,n=[],l=0,c=s.LoadingState.LOADING_FIRST_PAGE,d=m.firstPagePreloadHandler.getDataIfAvailable();if(d){if(!d.payload||d.error)return void m.onPrefetchError();var u=m.extractAjaxFileInfo(d.payload);if(!u)return void m.onPrefetchError();r=u.file_info,i=u.first_page,i?(n=[],l=i.total_num_items,c=s.LoadingState.LOADING_REMAINING_PAGES):r&&(n=r,l=n.length,c=s.LoadingState.LOADED)}var p=a.BrowseContext.fromServerObject(t);o.browseActions.initializeEverything({path:m.path,files:n,paginatedTotalNumFiles:l,context:p,mountPoints:t.ns_id_to_mount_point,fqPathsToSelect:m.fqPathsToSelect,loadingState:c,teamFolders:t.team_folders_js_info}),r||i?(i&&m.initializePaginationManager(i),m.onPrefetchComplete(t)):m.firstPagePreloadHandler(function(e){m.handleFirstPagePrefetchDataSuccess(e,t,p)},m.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t,r){var s=m.extractAjaxFileInfo(e);if(!s)return void m.onPrefetchError();s.paginated?m.initializePaginationManager(s.first_page):o.browseActions.load({path:m.path,files:s.file_info,paginatedTotalNumFiles:s.file_info.length,context:r}),m.onPrefetchComplete(t)},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=i.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:m.user.id,newDataAvailableCallback:function(e,r){var a=e.areAllItemsReady(),i=a?s.LoadingState.LOADED:s.LoadingState.LOADING_REMAINING_PAGES;o.browseActions.addFilesAndSetLoadingState({path:m.path,files:r,paginatedTotalNumFiles:t,loadingState:i}),a&&e.stopAutoFetching()}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=h,this.path=_,this.fqPathsToSelect=f,this.onPrefetchComplete=t,this.onPrefetchError=n,this.onPostTTIPrefetchComplete=d,this.onPostTTIPrefetchError=u,this.browsePreloadHandler=p.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=p.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=p.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","external/react","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/browse/logger_util","modules/clean/react/browse/actions","modules/clean/filetypes","modules/clean/react/files_view/types","modules/clean/react/files_view/controller","modules/clean/react/browse/models","modules/clean/react/file_uploader/file_uploader","modules/clean/react/maestro/layout","modules/clean/search/search_results/log_helper","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/sharing/browse_exports","modules/clean/sharing/access_level","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/clean/web_user_action_events","modules/clean/react/files_view/constants","modules/clean/react/browse/title","modules/clean/react/browse/sidebar","modules/clean/search/search_bar/experiments"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f,m,S,g,w,F,E,y,T,v,R,A,b,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var C=[w.NameSpaceAccess.ACCESS_NO_ACCESS,w.NameSpaceAccess.ACCESS_READER,w.NameSpaceAccess.ACCESS_READER_NO_COMMENT],P=(function(t){function w(d){var u=t.call(this,d)||this;return u.handleGetOverflowMenuActions=function(e,t,r){return u.handleGetFileActionsForSetOfFiles(s.Set([e]),t,r,!1)},u.handleGetFileActionsForSetOfFiles=function(t,r,s,o){if(u.props.arePostTTIModulesLoaded){var a=u.props,i=a.context,n=a.user,l=a.actionHandlers,c=a.isSearchMode,d=a.isOverFreeQuota,p=a.isQueryingFolderSizes,h=a.browsePostTTIExperiments,_=a.viewType,f=e("modules/clean/react/browse/file_actions"),m=h.expShowAddToShowcase,S=h.expShowAddFolderToShowcase,g=h.expShowAddToShowcaseUpsell,w=h.expBrowseMoveSuggestions,F=h.expHasCreatedShowcase,E=h.expHasShowcaseFreemium,y=h.expNewBrowseMoveDialog,T="ON"===w;return f.getActionsForFileCollection({files:t,context:i,user:n,viewType:_,canDisplayFolderSizes:r,actionHandlers:l,skipSharing:!1,isSearchMode:c,isOverFreeQuota:d,isQueryingFolderSizes:p,canShowUJPopup:o,showAddToShowcase:!!m,showAddFolderToShowcase:!!S,showAddToShowcaseUpsell:!!g,addToShowcaseUpsellVariant:g||"OFF",hasCreatedShowcase:!!F,hasShowcaseFreemium:!!E,responsive:s,showNewMoveDialog:!!y,showMoveSuggestionModal:T})}return[]},u.handleLocationLinkClick=function(e,t){if(!t){var r=a.parent_dir(e.fq_path);u.props.onNavigateToPath(r)}},u.handleOpenPaper=function(e){var t=u.props,r=t.user,s=t.isSearchMode,o=t.viewType;s&&f.recordSearchResultsAction({result:e,user:r,action_type:v.WebUserActionLogEvent.PAPER_OPEN,view_type:o}),T.redirect(e.url)},u.handleUploadButtonClick=function(e){h.FileUploaderController.setPath(u.props.path),h.FileUploaderController.handleUploadButtonClick(e)},u.handleShowFileUploader=function(){h.FileUploaderController.setPath(u.props.path),h.FileUploaderController.showModal()},u.handleSelectionChange=function(e){var t=u.props.getFileByFullPath(e.selected.first());if(t){var r=t.ns_id,s=t.sjid,o=t.file_id,n=t.fq_path,c=t.bytes,d=t.ext,p=t.request_id;i.logSelectRow({uid:u.props.user.id,entity_type:t.is_dir?"folder":"file",view_type:u.props.viewType,file_nsid:r,file_sjid:s,file_id:o,file_name:a.filename(t.fq_path),file_path:n,file_size:c,file_extension:d,request_id:p})}l.browseActions.setSelection({selection:e})},u.handleFileListSortChange=function(e,t){i.logSortRecords({uid:u.props.user.id,sort_by:e,sort_direction:t,view_type:u.props.viewType}),l.browseActions.sortFiles({sortField:e,sortDirection:t})},u.handleStarClick=function(e,t){var r=t?v.WebUserActionLogEvent.STAR:v.WebUserActionLogEvent.REMOVE_STAR,s=u.props,o=s.user,a=s.isSearchMode,l=s.viewType,c=s.selectedFiles,d=n.countFilesAndFolders(c),p=d.num_files_selected,h=d.num_folders_selected;a&&f.recordSearchResultsAction({result:e,user:o,action_type:r,view_type:l}),i.logBrowseAction(o.id,"BROWSE",r,p,h,l,e)},u.handleSearchFromSearchBar=function(e){var t=e.query,r=e.searchPath;t?u.props.onSearch(t,r,!0):l.browseActions.setUrl({path:r})},u.handleSearchResultOpen=function(e){e instanceof p.File?e.is_unmounted?g.asyncShowSharedContentLinkSyncModal(u.props.user,e):(m.logDropdownSearchAction({result:e,user:u.props.user,action_type:e.is_dir?v.WebUserActionLogEvent.FOLDER_OPEN:v.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),l.browseActions.navigateToFileOrFolder({file:e,fileViewAction:y.FileViewActionType.SEARCH})):(e instanceof p.Paper||e instanceof p.PaperFolder)&&(m.logDropdownSearchAction({result:e,user:u.props.user,action_type:v.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),T.open_tab(e.url))},u.handleResultObjectPathClick=function(e){m.logDropdownSearchAction({result:e,user:u.props.user,action_type:v.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),l.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:y.FileViewActionType.SEARCH})},u.setFilesViewControllerRef=function(e){u.filesViewControllerRef=e},u.handleSearchFromSearchResults=function(e,t,r){u.props.onSearch(e,t,!1,r)},u.renderSharedWithController=function(t){var r=u.props,s=r.context;if(!r.arePostTTIModulesLoaded)return null;if(t.type===c.FileTypes.TEAM_SHARED_FOLDER&&("archived"===t.team_folder_status||"archive_in_progress"===t.team_folder_status))return null;var a=u.props.selectedFiles,i=!!a.size,n=e("modules/clean/react/browse/shared_with").SharedWithController;return o.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},o.createElement(n,{file:t,browseContext:s,inSelectMode:i}))},u.renderAppContent=function(e){return u.props.isSearchMode?u.renderSearchResults(e):u.renderFilesViewController(e)},u.renderSidebar=function(e){var t=u.props.fileCategories;return o.createElement(b.BrowseSidebar,r.__assign({},u.props,{onSearch:u.handleSearchFromSearchResults,onUploadButtonClick:u.handleUploadButtonClick,onGetFileActionsForFiles:u.handleGetFileActionsForSetOfFiles,responsive:e,fileCategories:t}))},u.state={searchBarProps:u.getCurrentSearchBarProps(u.props),fileIdToActionCategories:{}},u}return r.__extends(w,t),w.prototype.componentWillReceiveProps=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)}),this.props.files===e.files?[3,2]:[4,this.getAppActions(e.files,e.path)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},w.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,E.waitForTTI()];case 1:return t.sent(),this.defineFileUploader(),this.maybeOpenUploaderOnMount(),e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),F.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON()),[4,this.getAppActions(this.props.files,this.props.path)];case 2:return t.sent(),[2]}})})},w.prototype.componentDidUpdate=function(){this.props.loadingState===d.LoadingState.LOADED&&F.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},w.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},w.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props,t=e.selectedFiles,r=e.context;return r.isInsideSharedFolder&&C.includes(r.currentSharedFolderPermissionRole)?d.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?t.some(function(e){return e.isDeleted||e.type===c.FileTypes.TEAM_SHARED_FOLDER})?d.DropTargetHighlightMode.NONE:t.some(function(e){return e.type===c.FileTypes.SHARED_FOLDER})?r.currentNSAllowsNesting?d.DropTargetHighlightMode.NONSELECTED_FOLDERS:d.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:d.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?d.DropTargetHighlightMode.ALL_FOLDERS:d.DropTargetHighlightMode.NONE},w.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments,onSearchFiltersChanged:e.onSearchFiltersChanged}},w.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},w.prototype.shouldShowPinnedTeamFolder=function(){var e=this.props,t=e.context,r=e.browseExperiments,s=e.loadingState,o=e.path,a=e.teamFolders,i=e.viewType;if(r.expSubgrowthBizTrialOnboarding&&("/"!==o||i!==d.ViewType.List))return!1;var n=s===d.LoadingState.LOADED;return t.showPinnedTeamFolder&&!a.isEmpty()&&n},w.prototype.getAppActions=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var s,o,a=this;return r.__generator(this,function(i){switch(i.label){case 0:return[4,E.waitForTTI()];case 1:return i.sent(),s=[],e.toArray().forEach(function(e){e&&e instanceof p.File&&!e.isDeleted&&s.push(e)}),[4,this.props.appActionsStore.getActionsForFileBatch(s,this.props.user.id)];case 2:return o=i.sent(),this.setState(function(e){return a.props.path===t?{fileIdToActionCategories:r.__assign({},e.fileIdToActionCategories,o)}:e}),[2]}})})},w.prototype.renderSearchResults=function(e){var t=this.props,r=t.actionHandlers,s=t.filesViewActionHandlers,a=t.fileRename,i=t.path,n=t.user,l=t.handleComponentTTI,c=t.isFileViewerShown,d=t.arePostTTIModulesLoaded,u=t.getIsFileJumping,p=t.ensureFileViewerClosedIfNotPreviewing,_=t.browseExperiments,f=t.searchResultsExperiments,m=t.searchBarExperiments,g=t.onNavigateToParentFolder,w=t.onNavigateToPath,F=t.shouldShowDeletedFiles,E=t.onNavigateToFileOrFolder,y=t.onSearchFiltersChanged,T=t.starredState;return o.createElement(S.SearchResultsController,{actionHandlers:r,filesViewActionHandlers:s,path:i,user:n,searchResultsExperiments:f,searchBarExperiments:m,browseExperiments:_,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:h.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:l,ensureFileViewerClosedIfNotPreviewing:p,getIsFileJumping:u,renderSharedWithController:this.renderSharedWithController,isFileViewerShown:c,fileRename:a,arePostTTIModulesLoaded:d,getOverflowMenuActions:this.handleGetOverflowMenuActions,onNavigateToFileOrFolder:E,onNavigateToParentFolder:g,onNavigateToPath:w,onOpenPaper:this.handleOpenPaper,shouldShowDeletedFiles:I.isInDeletedFilterRightRailExperiment(m)?F:void 0,responsive:e,onSearchFiltersChanged:y,starredState:T})},w.prototype.renderFilesViewController=function(e){var t=this.shouldShowPinnedTeamFolder(),s=t?this.props.filesWithoutTeamFolders:this.props.files,a=this.props.browseExperiments,i=a.expSubgrowthBizTrialOnboarding,n=a.expBrowseLargeGridView;return o.createElement("div",{className:"maestro-browse-app-content"},o.createElement(u.FilesViewController,r.__assign({},this.props.filesViewActionHandlers,{getOverflowMenuActions:this.handleGetOverflowMenuActions,renderSharedWithController:this.renderSharedWithController,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onNavigateToParentFolder:this.props.onNavigateToParentFolder,onOpenPaper:this.handleOpenPaper,activeDropTarget:this.props.activeDropTarget,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:s,responsive:e,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,isSubgrowthPinnedExp:t&&i,numTeamFolders:this.props.teamFolders.size,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,fileIdToActionCategories:this.state.fileIdToActionCategories,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:h.FileUploaderController.setPathAndPermissions,shouldShowPinnedTeamFolders:t,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,tilesPerRow:this.props.tilesPerRow,viewTypes:"ON"===n?R.AllViewTypesExperiment:R.AllViewTypes,viewTypeLabels:"ON"===n?R.ViewTypeLabelsExperiment:R.ViewTypeLabels,starredState:this.props.starredState})))},w.prototype.defineFileUploader=function(){h.FileUploaderController.loadCoreComponent()},w.prototype.render=function(){var e=this.props.user;return o.createElement("div",null,o.createElement(_.MaestroChrome,{user:e,titleRegion:o.createElement(A.BrowseTitle,r.__assign({},this.props)),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps}))},w.defaultProps={selectedFiles:s.OrderedMap(),viewType:d.ViewType.List},w})(o.PureComponent);t.BrowseView=P}),define("modules/clean/react/browse/dispatcher",["require","exports","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/react/browse/store"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseDispatcher={dispatch:function(e){r.assert(o.browseStoreInstantiated(),"Must call getBrowseStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/react/browse/global_actions",["require","exports","external/lodash","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/nav_actions","modules/clean/react/file_uploader/action_logger","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/user_education/user_education_client","modules/clean/web_user_action_events"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f,m,S,g,w){"use strict";function F(t){var s=t.arePostTTIModulesLoaded,a=t.context,i=t.user,l=t.viewType,d=t.showDeletedFiles,p=t.onUpload,m=void 0===p?r.noop:p,S=t.isNoComment,F=void 0!==S&&S,y=t.autoTeamGroupId,T=(t.browseExperiments,t.browsePostTTIExperiments),v=a.isCurrentlyInRoot,A=!a.canViewContainingNSMembers,M=a.isCurrentPathWriteable(),U=_.is_input_webkitdirectory_supported(),B={className:"action-upload",label:R(E.UploadFiles),popoverLabel:R(E.Files),iconName:U?"upload-file":"upload",performAction:function(){return m(!1)},disabled:!M},q=U?{className:"action-upload",label:R(E.UploadFolder),popoverLabel:R(E.Folder),iconName:"upload-folder",performAction:function(){return m(!0)},disabled:!M}:void 0,k=!a.isInsideSandboxFolder,V=[];if(a.isInsideTeamFolderTree||!a.isInsideDeletedSharedFolder&&!a.isInsideDeletedNestedSharedFolder)if(a.isInsideDeletedFolder)V.push({label:R(E.RestoreFolder),iconName:"restore",className:"action-restore",performAction:N(i,l,a),disabled:!M});else{var W={label:R(E.NewFolder),iconName:"new-folder",performAction:b(i,l,a,y,T.expSubgrowthProOQNewFolder),disabled:!M,className:"action-new-folder"},H={label:R(v?E.NewSharedFolder:E.ShareFolder),iconName:"new-shared-folder",performAction:P(i,a,T.expSubgrowthProOQNewFolder),disabled:A,className:"action-share-folder"},j={label:R(E.NewTeamFolder),iconName:"new-team-folder",performAction:O(i,a),disabled:!1,className:"action-team-folder"};i.is_cdm_member&&"/"===a.currentFQPath?(g.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_setup_team_space",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure_v2",stepName:"team_folder_modal"}],W.performAction),V.push(B),U&&V.push(q),V.push(W)):v?(V.push(B),U&&V.push(q),!i.is_cdm_member&&u.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&V.push(j),V.push(H,W)):(k&&V.push(H),V.push(B),U&&V.push(q),V.push(W));var G=T.expEnableCloudDocs,Q=T.expShowFileCreateMenu;if(G&&(V.push({label:R(E.NewPaperDoc),iconName:"new-paper-doc",className:"action-paper-docs",performAction:C(n.CloudDoc.PAPER,a),disabled:!M}),V.push({label:R(E.NewGoogleDssDoc),iconName:"new-paper-doc",className:"action-google-dss-doc",performAction:C(n.CloudDoc.GOOGLE_DSS_DOC,a),disabled:!M}),V.push({label:R(E.NewGoogleDssSheet),iconName:"new-paper-doc",className:"action-google-dss-sheet",performAction:C(n.CloudDoc.GOOGLE_DSS_SHEET,a),disabled:!M}),V.push({label:R(E.NewGoogleDssSlides),iconName:"new-paper-doc",className:"action-google-dss-slides",performAction:C(n.CloudDoc.GOOGLE_DSS_SLIDES,a),disabled:!M})),Q){var z={label:R(E.NewMicrosoftWordDoc),iconName:"microsoft_docx",className:"action-create-file-word",performAction:I(i.id,n.MicrosoftFileTypes.WORD,a)},K={label:R(E.NewMicrosoftExcelWorkbook),iconName:"microsoft_xlsx",className:"action-create-file-excel",performAction:I(i.id,n.MicrosoftFileTypes.EXCEL,a)},J={label:R(E.NewMicrosoftPowerPointPresentation),iconName:"microsoft_pptx",className:"action-create-file-powerpoint",performAction:I(i.id,n.MicrosoftFileTypes.POWERPOINT,a)};V.push({label:R(E.NewFileCreate),iconName:"new-paper-doc",className:"action-create-file",performAction:function(){o.logFileCreateClick({uid:i.id,action:w.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU})},disabled:!M,subItems:[z,K,J]})}F||V.push({label:R(d?E.HideDeletedFiles:E.ShowDeletedFiles),iconName:d?"hide":"show-deleted-files",performAction:D(i,l,d),disabled:A,className:"action-deleted-files"}),!h.Viewer.get_viewer().is_assume_user_session&&(u.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&u.GoldenGate.hasNewOwnershipModel(i.id)&&a.isInsideTeamFolderTree||!i.is_cdm_member&&u.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&a.isCurrentlyInRoot)&&V.push({label:R(E.ManageAsAdmin),iconName:"settings-gear",performAction:O(i,a)})}else V.push({label:R(E.ReAddSharedFolder),iconName:"restore",performAction:L(i,a),disabled:!M});if(q&&V[0]===B){f.assert(V[1]===q,"`uploadFolderItem` does not immediately follow `uploadFilesItem`");var Y={className:"action-upload",label:R(E.Upload),iconName:"upload",performAction:function(){return c.logUploadAction(i.id,w.WebUserActionLogEvent.UPLOAD_CLICK)},disabled:!M,subItems:[B,q]};V.splice(0,2,Y)}if(s){var X=e("modules/clean/unity/features");"V1"===T.expSubgrowthBizTeamsTriggersClientLinkWork&&null!=X&&i.is_team&&V.push({iconName:"monitor",label:R(E.ShowLocalCopy),performAction:x(i,a)})}return V}Object.defineProperty(t,"__esModule",{value:!0});var E;(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewGoogleDssDoc=6]="NewGoogleDssDoc",e[e.NewGoogleDssSheet=7]="NewGoogleDssSheet",e[e.NewGoogleDssSlides=8]="NewGoogleDssSlides",e[e.NewPaperDoc=9]="NewPaperDoc",e[e.NewFileCreate=10]="NewFileCreate",e[e.NewFolder=11]="NewFolder",e[e.NewMicrosoftExcelWorkbook=12]="NewMicrosoftExcelWorkbook",e[e.NewMicrosoftPowerPointPresentation=13]="NewMicrosoftPowerPointPresentation",e[e.NewMicrosoftWordDoc=14]="NewMicrosoftWordDoc",e[e.RestoreFolder=15]="RestoreFolder",e[e.ReAddSharedFolder=16]="ReAddSharedFolder",e[e.ShowDeletedFiles=17]="ShowDeletedFiles",e[e.HideDeletedFiles=18]="HideDeletedFiles",e[e.NewSharedFolder=19]="NewSharedFolder",e[e.ShareFolder=20]="ShareFolder",e[e.ManageAsAdmin=21]="ManageAsAdmin",e[e.NewTeamFolder=22]="NewTeamFolder",e[e.ShowLocalCopy=23]="ShowLocalCopy"})(E||(E={}));var y={},T=function(){return _.mac?m._("Show in Finder"):_.windows?m._("Show in Explorer"):m._("Show local copy")},v=function(e){switch(e){case E.UploadFiles:return m._("Upload files");case E.UploadFolder:return m._("Upload folder");case E.Upload:return m._("Upload");case E.Files:return m._("Files");case E.Folder:return m._("Folder");case E.NewGoogleDssDoc:return m._("New Google Doc");case E.NewGoogleDssSheet:return m._("New Google Sheet");case E.NewGoogleDssSlides:return m._("New Google Slides");case E.NewPaperDoc:return m._("New Paper Document");case E.NewFileCreate:return m._("Create new file");case E.NewFolder:return m._("New folder");case E.NewMicrosoftExcelWorkbook:return m._("Excel workbook");case E.NewMicrosoftPowerPointPresentation:return m._("PowerPoint presentation");case E.NewMicrosoftWordDoc:return m._("Word document");case E.RestoreFolder:return m._("Restore folder");case E.ReAddSharedFolder:return m._("Re-add shared folder");case E.ShowDeletedFiles:return m._("Show deleted files");case E.HideDeletedFiles:return m._("Hide deleted files");case E.NewSharedFolder:return m._("New shared folder");case E.ShareFolder:return m._("Share folder");case E.ManageAsAdmin:return m._("View in admin console");case E.NewTeamFolder:return m._("New team folder");case E.ShowLocalCopy:return T()}},R=function(e){return e in y||(y[e]=v(e)),y[e]},A=function(e){switch(e){case n.MicrosoftFileTypes.WORD:return w.WebUserActionLogEvent.FILE_CREATE_WORD;case n.MicrosoftFileTypes.EXCEL:return w.WebUserActionLogEvent.FILE_CREATE_EXCEL;case n.MicrosoftFileTypes.POWERPOINT:return w.WebUserActionLogEvent.FILE_CREATE_POWERPOINT}},b=function(t,r,n,c,p){return function(){if("V1"===p)e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_fo_fi"})});else{var h=n.currentNSID,_=n.currentFQPath;if(o.logCreateFolder({uid:t.id,view_type:r,file_nsid:h,file_path:_,file_name:s.filename(_)}),t.is_cdm_member&&"/"===_){f.assert(!!c,"All CDM Users should have an auto team group in their team");var g=function(){S.Notify.error(m._("There was a problem completing this request.")),i.browseActions.cancelCreateFolder()},w=function(e){var t=e.user,r=e.folderName,s=e.fqPath;i.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),i.browseActions.selectFilesByFqPath({fqPathsToSelect:[s]})};u.asyncShowAppropriateNewFolderModalForCdmUser({user:t,context:n,autoTeamGroupId:c,showFileSystemWarningsModal:a.showFileSystemWarningsModal,onPending:i.browseActions.createFolderPending,onComplete:w,onCancel:g,autoTeamGroupDefaultAccessLevel:d.ACCESS_LEVEL.WRITER,setPath:l.browseNavActions.setPath,setUrl:l.browseNavActions.setUrl})}else i.browseActions.nameNewFolder();"CONTROL"===p&&e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}}},I=function(e,t,r){return function(){o.logFileCreateClick({uid:e,action:A(t)}),i.browseActions.createNewFile({userId:e,pathName:r.currentFQPath,documentType:t})}},C=function(e,t){return function(){i.browseActions.createCloudDoc({pathName:t.currentFQPath,title:"Untitled",documentType:e})}},P=function(t,r,s){return function(){"V1"===s?e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_shfo_fi"})}):r.isCurrentlyInRoot?u.asyncShowShareAFolderWizardModal(t):u.asyncShowShareModal(t,r,{origin:p.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS},l.browseNavActions.setPath,l.browseNavActions.setUrl),"CONTROL"===s&&e(["modules/clean/growth/experiments/overquota_helper"],function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}},D=function(e,t,r){return function(){o.logToggleDeletedFiles({uid:e.id,show_deleted_files:!r,view_type:t}),i.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!r})}},N=function(e,t,r){return function(){var a=r.currentNSID,n=r.currentFQPath;o.logRestore({uid:e.id,view_type:t,file_nsid:a,file_path:n,file_name:s.filename(n),num_files_selected:0,num_folders_selected:1}),i.browseActions.doRestoreFilesWithUnifiedTrashModal({})}},L=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),s=t.inactiveNSIDByFQPath[r],o=t.isInsideDeletedNestedSharedFolder;s&&u.asyncMountSharedFolder(s,e.role,p.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,o)}},O=function(e,t){return function(){u.asyncGoToContentManagerForPath({isLimitedTeam:h.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}},x=function(e,t){return function(){var r=t.currentNSID,s=t.currentFQPath;o.logOpenLocalCopyClick({team_id:h.Viewer.get_viewer().team_id,url:_.get_uri().path}),i.browseActions.openLocalCopy({fqPath:s,nsId:r,userId:e.id})}};t.getGlobalActions=F}),define("modules/clean/react/browse/nav_actions",["require","exports","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/selection","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(){function e(e){var t=this;this.dataApi=e,this.setPath=function(e){var r=e.path,o=e.onPathLoaded,d=e.logFetchedDataRequiredForTTI,h=void 0!==d&&d,_=e.ajaxWebTimer,f=c.getBrowseStore(),m=f.user().id;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.SET_PATH,data:{path:r}}),t.setLoadingState({loadingState:i.LoadingState.LOADING_FIRST_PAGE,path:r});var S=function(e){var r=e.path,a=e.data,n=e.xhr;if(h&&u.log_js_modules_fetched_data_required_for_tti(),_){var c=n.getResponseHeader("x-dropbox-request-id");_.end(c?c:void 0)}t.setMountPoints({mountPoints:a.ns_id_to_mount_point}),t.setTeamFolders({teamFolders:a.team_folders_js_info});var d=l.BrowseContext.fromServerObject(a);if(a.paginated){t.clear({path:r,context:d});var p=a.first_page.total_num_items;s.PaginationManager.create({firstPage:a.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:m,newDataAvailableCallback:function(e,s){var o=e.areAllItemsReady()?i.LoadingState.LOADED:i.LoadingState.LOADING_REMAINING_PAGES;t.addFilesAndSetLoadingState({path:r,files:s,paginatedTotalNumFiles:p,loadingState:o}),e.areAllItemsReady()&&e.stopAutoFetching()}}).startAutoFetching()}else{var S=a.file_info,g=S?S.length:0;t.load({path:r,files:S,paginatedTotalNumFiles:g,context:d})}o&&o(f.context())};t.dataApi.loadPath({sortLabel:f.sortLabel(),sortIsAscending:f.sortIsAscending(),path:r,userId:m,sortFoldersFirst:!p.mac,includeDeletedFiles:f.shouldShowDeletedFiles(),onSuccess:S,onError:function(){"/"!==r&&t.setPath({path:"/",onPathLoaded:o})}})}}return e.prototype.setUrl=function(e){var t=e.path,s=(e.qargs,{});"1"===r.deconstruct_url().qargs.d&&(s.d="1");var o=t?h.URI.encode_parts(t):"";r.push_state(c.getBrowseStore().urlPrefix()+o,s),n.BrowseDispatcher.dispatch({type:a.BrowseActionType.SET_SELECTION,data:{selection:d.createSelection()}})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.SET_MOUNT_POINTS,data:{mountPoints:t}})},
e.prototype.setTeamFolders=function(e){var t=e.teamFolders;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.SET_TEAM_FOLDERS,data:{teamFolders:t}})},e.prototype.load=function(e){var t=e.path,r=e.files,s=e.paginatedTotalNumFiles,o=e.context;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.LOAD_PATH,data:{path:t,files:r,paginatedTotalNumFiles:s,context:o}})},e.prototype.clear=function(e){var t=e.path,r=e.context;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.CLEAR_FILES,data:{path:t,context:r}})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,s=e.files,o=e.paginatedTotalNumFiles;n.BrowseDispatcher.dispatch({type:a.BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:s,paginatedTotalNumFiles:o}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=_,t.browseNavActions=new _(o)}),define("modules/clean/react/browse/sidebar",["require","exports","tslib","external/react","modules/clean/search/search_results/sidebar_view","modules/clean/react/browse/sidebar_view"],function(e,t,r,s,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseSidebar=function(e){var t=e.autoTeamGroupId,i=e.arePostTTIModulesLoaded,n=e.canDisplayFolderSizes,l=e.context,c=e.handleComponentTTI,d=e.isNoComment,u=e.isSearchMode,p=e.selectedFiles,h=e.shouldShowDeletedFiles,_=e.starredState,f=e.user,m=e.viewType,S=e.uploaderExperiments,g=e.uploaderPostTTIExperiments,w=e.browseExperiments,F=e.browsePostTTIExperiments,E=e.uploadAjaxInterceptor,y=e.searchResultsExperiments,T=e.searchBarExperiments,v=e.actionHandlers,R=e.path,A=e.onSearch,b=e.onUploadButtonClick,I=e.onGetFileActionsForFiles,C=e.responsive,P=e.onSearchFiltersChanged,D=e.fileCategories,N={user:f,selectedFiles:p,arePostTTIModulesLoaded:i,context:l,viewType:m,shouldShowDeletedFiles:h,responsive:C};return u?s.createElement(o.SearchResultsSidebarView,r.__assign({},N,{path:R,actionHandlers:v,searchResultsExperiments:y,searchBarExperiments:T,onSearch:A,onSearchFiltersChanged:P,fileCategories:D})):s.createElement(a.BrowseSidebarView,r.__assign({},N,{autoTeamGroupId:t,canDisplayFolderSizes:n,uploaderExperiments:S,uploaderPostTTIExperiments:g,browseExperiments:w,browsePostTTIExperiments:F,handleComponentTTI:c,onUploadButtonClick:b,isNoComment:d,onGetFileActionsForFiles:I,starredState:_,uploadAjaxInterceptor:E}))}}),define("modules/clean/react/browse/sidebar_view",["require","exports","tslib","external/react","modules/clean/react/app_actions_view","modules/clean/react/browse/global_actions","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/core/i18n"],function(e,t,r,s,o,a,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(t){function c(e){var r=t.call(this,e)||this;return r.state={appActionsProps:r.getCurrentAppActionsProps(r.props)},r}return r.__extends(c,t),c.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes&&e.uploadAjaxInterceptor===this.props.uploadAjaxInterceptor&&e.responsive.isMatchedMedium===this.props.responsive.isMatchedMedium&&e.responsive.isMatchedLarge===this.props.responsive.isMatchedLarge&&e.uploaderExperiments===this.props.uploaderExperiments&&e.uploaderPostTTIExperiments===this.props.uploaderPostTTIExperiments&&e.browseExperiments===this.props.browseExperiments&&e.browsePostTTIExperiments===this.props.browsePostTTIExperiments||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},c.prototype.renderSingleSelectionAudienceBox=function(t){var r=t.selectedFiles,o=t.arePostTTIModulesLoaded,a=t.context,i=r.first();if(o){var n=e("modules/clean/react/browse/shared_with").SharedWithController;return s.createElement(n,{file:i,browseContext:a,isInAudienceBox:!0})}return null},c.prototype.getCurrentAppActionsProps=function(t){function r(e){if(e.subItems){var t=e.subItems.map(r);return{displayName:e.label,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge,subItems:t}}return{displayName:e.label,popoverMenuName:e.popoverLabel,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge}}var o,n=t.selectedFiles,c=t.autoTeamGroupId,d=t.context,u=t.canDisplayFolderSizes,p=t.onGetFileActionsForFiles,h=t.user,_=t.viewType,f=t.shouldShowDeletedFiles,m=t.onUploadButtonClick,S=t.isNoComment,g=t.browseExperiments,w=t.browsePostTTIExperiments,F=t.arePostTTIModulesLoaded,E=t.handleComponentTTI,y=t.responsive,T=i.getSelectedFilesText(n,d),v=n.count(),R=s.createElement("div",null);if(v>0)o=p(n,u,y,!0),1===v&&(R=this.renderSingleSelectionAudienceBox(t));else if(o=a.getGlobalActions({arePostTTIModulesLoaded:F,context:d,user:h,viewType:_,showDeletedFiles:f,onUpload:m,isNoComment:S,autoTeamGroupId:c,browseExperiments:g,browsePostTTIExperiments:w}),F){var A=e("modules/clean/react/browse/shared_with").SharedWithController;R=s.createElement(A,{browseContext:d,isInAudienceBox:!0})}var b=o.map(r);return t.isNoComment&&(R=s.createElement("div",null)),{headerText:T,popoverTriggerLabel:l._("Actions"),primaryMenuItem:b[0],primarySubnode:R,secondaryMenuItems:b.slice(1),handleComponentTTI:E}},c.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.context,r=e.viewType,o=e.uploadAjaxInterceptor,a=e.uploaderExperiments,i=e.uploaderPostTTIExperiments;return null!=t.currentFQPath?s.createElement(n.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,ajaxInterceptor:o,uploaderExperiments:a,uploaderPostTTIExperiments:i,browseViewType:r}):null},c.prototype.render=function(){return s.createElement("div",{className:"maestro-browse-action-sidebar"},this.maybeRenderBrowseFileUploader(),s.createElement(o.AppActionsView,r.__assign({},this.state.appActionsProps,{responsive:this.props.responsive})))},c})(s.PureComponent);t.BrowseSidebarView=c}),define("modules/clean/react/browse/title",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/file_uploader/file_uploader","modules/clean/react/browse/actions","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/path_breadcrumbs"],function(e,t,r,s,o,a,i,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleGetUrlForPath=function(e){return a.browse_uri_for_fq_path(t.props.user,e).toString()},t}return r.__extends(t,e),t.setPageTitle=function(e){e&&(document.title=o._("%(folder_name)s - Dropbox").format({folder_name:i.filename(e,o._("Files"))}))},t.prototype.componentDidMount=function(){t.setPageTitle(this.props.path)},t.prototype.componentWillReceiveProps=function(e){e.path!==this.props.path&&t.setPageTitle(e.path)},t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,a=e.isDraggingInternalFiles,p=e.isDraggingExternalFiles,h=e.isUploadModalOpen;if(e.isSearchMode)return s.createElement(d.MaestroHeaderTitle,null,o._("Search results"));var _=i.filename("",c.Viewer.get_root_name(r)),f="work"===r.role?o._("Work"):o._("Personal");return s.createElement(u.PathBreadcrumbs,{path:t,isDraggingInternalFiles:a,setFileUploaderPath:n.FileUploaderController.setPathAndPermissions,getUrlForPath:this.handleGetUrlForPath,firstBreadcrumbName:_,firstBreadcrumbAlt:f,shouldHighlightDropTargets:a||p&&!h,setUrl:l.browseActions.setUrl})},t})(s.PureComponent);t.BrowseTitle=p}),define("modules/clean/react/file_uploader/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/web_upload_action_logger","modules/clean/web_user_action_logger","modules/clean/web_user_action_events"],function(e,t,r,s,o,a,i){"use strict";function n(e){return e&&!!e.uploadId}function l(e){return e&&!!e.batchId}function c(e){return e===i.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===i.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===i.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===i.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===i.WebUserActionLogEvent.DISMISS_INLINE_STATUS||e===i.WebUserActionLogEvent.UPLOAD_CLICK||e===i.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===i.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===i.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}function d(e,t,i,d,u,p,h){var _={num_files:p,num_dirs:h,chooser_type:d,upload_method:u};if(n(i)){var f=i;_=r.__assign({},_,{upload_id:f.uploadId,file_size:f.size,file_extension:s.file_extension(f.name),failure_reason:f.errorType,batch_id:f.batchId})}else if(l(i)){var f=i;_=r.__assign({},_,{file_size:f.size,file_extension:s.file_extension(f.name),batch_id:f.batchId})}c(t)?a.WebUserActionLog.log(e,t,_):(t=t,_.client_timestamp=Math.round(Date.now()/1e3),o.WebUploadActionLog.log(e,t,_))}Object.defineProperty(t,"__esModule",{value:!0}),t.logUploadAction=d}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES"})(t.UploaderActionType||(t.UploaderActionType={}));var o;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(o=t.FileStatusType||(t.FileStatusType={}));var a;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR"})(a=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(s.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:o.PENDING,errorType:a.GENERIC,errorMessage:"",batchId:void 0},"FileUpload"));t.FileUpload=i,t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError";(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,s,o,a,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=s.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[]},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===i.FileStatusType.CANCELLED},t.prototype.inlineStatusShouldBeDismissed=function(){return this._inlineStatusShouldBeDismissed},t.prototype.path=function(){return this._path},t.prototype.folderNsId=function(){return this._folderNsId},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===i.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.confirmedFSWBatchIds=function(){return this._confirmedFSWBatchIds},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setPathData=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,s=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=s,this._confirmedFSWs=[],this.emit_change()},t.prototype.setFolderNsId=function(e){var t=e.folderNsId;this._folderNsId=t},t.prototype.initializeEverything=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},s=0,o=t;s<o.length;s++){var a=o[s];r[a.uploadId]=a}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=t,"missing file to upload"),l.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",i.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===i.FileStatusType.UPLOADING||l.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",i.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,s=t;r<s.length;r++){var o=s[r];this._fileList=this._fileList.update(o.uploadId,function(e){return e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING?e.set("status",i.FileStatusType.CANCELLED):e}),o.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,s=this._currentUploadId;s&&(this._fileList=this._fileList.update(s,function(e){return e.set("percentUploaded",t)}),this._numSecondsLeft=r),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,s=e.errorMessage,o=this._fileList.get(t);o&&(o.uploadId!==this._currentUploadId&&l.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:o.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:s}}),this._fileList=this._fileList.update(o.uploadId,function(e){return e.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",s)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,s=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=s,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;this._inlineStatusShouldBeDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,s=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",n.generateUploadId())),t=t.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",s),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this,r=e.fswIds,s=e.batchId;r.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(s)||this._confirmedFSWBatchIds.push(s)},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case a.BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case a.BrowseActionType.APP_INIT:case i.UploaderActionType.SET_USER:this.setUser(t.data);break;case a.BrowseActionType.LOAD_PATH:this.setPathData(t.data);break;case i.UploaderActionType.SET_PATH:this.setPath(t.data);break;case i.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case i.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case i.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case i.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case i.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case i.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case i.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case i.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case i.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case i.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case i.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case i.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data)}},t})(o.Store);t.UploaderStoreClass=c,t.uploaderStore=new c}),define("modules/clean/react/file_uploader/utils",["require","exports","modules/clean/base64","modules/clean/react/file_uploader/constants","modules/core/browser"],function(e,t,r,s,o){"use strict";function a(){return n()}function i(){return"batch-"+n()}function n(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var s=r.encode(e);return s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_"),s=s.replace(/\=*$/,"")}function l(e){var t=e.fileList,r=e.uploadId;return!!t.find(function(e){return e.status in[s.FileStatusType.PENDING,s.FileStatusType.UPLOADING]&&e.uploadId!==r})}function c(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}function d(e,t,r){var s=t,o=0;return e.forEach(function(e,t){for(var a=0,i=e.split("/"),n=r.split("/");a<i.length&&a<n.length&&i[a]===n[a];)a++;a===i.length&&a>1&&a>o&&(o=a,s=Number(t))}),s}Object.defineProperty(t,"__esModule",{value:!0}),t.generateUploadId=a,t.generateBatchId=i,t.checkIfThereArePendingUploadsWithoutCurrent=l,t.calculateSizeOfUploads=c,t.getNsId=d,t.getOQmodalOQALocationCode=function(e){return"/h"===(e||o.get_uri().path)?"ho":"fb"}}),define("modules/clean/react/fileops_actions",["require","exports","tslib","modules/core/notify","modules/core/i18n","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api"],function(e,t,r,s,o,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyFiles=function(e){var s=e.files,l=e.newPath,c=e.checkFSWs,d=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,_=e.dataApi;!(void 0===_?n:_).copyFiles({files:s,newPath:l,checkFSWs:c,userId:h.id,onSuccess:function(n){var c=n.newFiles,u=n.changesets,_=n.rollbackHints,f=n.failureDetails;if(f){var m=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};a.showFileSystemWarningsModal({fsws:f,onFinalAccept:m,confirmText:o._("Copy")})}else d&&d(c),i.notifyCopySuccess(s.length,h,u,l,_,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var l=e.path,c=e.files,d=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,_=e.onUndo,f=e.user,m=e.dataApi,S=void 0===m?n:m,g=function(s){var n=s.newFiles,l=s.changesets,u=s.rollbackHints,h=s.failureDetails;if(h){var m=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};a.showFileSystemWarningsModal({fsws:h,onFinalAccept:m,confirmText:o._("Move")})}else i.notifyMoveSuccess(c.length,f,l,d,u,function(){_&&_()}),p&&p(n)},w=function(e){"This will result in losing ownership of these folders."===e&&(s.Notify.clear(),a.showConfirmOwnershipTransferModal(function(){S.moveFiles({path:l,files:c,newPath:d,userId:f.id,onSuccess:g,allowOwnershipTransfer:!0})}))};!S.moveFiles({path:l,files:c,newPath:d,checkFSWs:u,userId:f.id,onSuccess:g,onError:w,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/search/api",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/search_helpers","modules/clean/search/constants","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers"],function(e,t,r,s,o,a,i,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,s=e.query,o=e.start,a=e.maxResults,l=e.searchSessionId,c=e.nsid,u=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,_=e.isDropdown,f=e.isAdminConsole,m=e.showSymlinkIcon,S=e.webTimer,g=e.onSuccess,w=e.onError,F=e.overrideUrl,E=d.getCurrentTimezoneOffset(),y={query:s,search_token:i.getSearchCsrfToken(),fq_path:r,ns_id:c,filename_only:!!u,max_results:a,deleted:!!p,start:o,show_paper_results:!!h,is_dropdown:!!_,is_admin_console:!!f,show_unmounted_results:!0,timezone_offset:E,show_symlink_icon:m,include_browse_context:!0},T=F?F:n.FULLTEXT_SEARCH_ENDPOINT;this._fetchResults({requestData:y,user:t,searchSessionId:l,url:T,onSuccess:g,onError:w,webTimer:S})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var o=s[r];switch(o.search_result_type){case l.SearchResultTypes.FILE:t.push(a.File.fromServerObject(o));break;case l.SearchResultTypes.PAPER:t.push(a.Paper.fromServerObject(o));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(a.PaperFolder.fromServerObject(o))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,s=e.maxResults,o=e.start,a=e.path,l=e.query,c=e.fileCategories,d=e.searchSessionId,p=e.showSymlinkIcon,h=e.includeBrowseContext,_=e.webTimer,f=e.onSuccess,m=e.onError,S=c?u.fileCategoriesToString(c):"",g=r.__assign({query:l,search_token:i.getSearchCsrfToken(),fq_path:a,start:o,max_results:s,show_paper_results:!0,show_symlink_icon:p,include_browse_context:h,search_session_id:d},S&&{file_categories:S});this._fetchResults({requestData:g,user:t,searchSessionId:d,url:n.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT,onSuccess:f,onError:m,webTimer:_})},e.prototype._fetchResults=function(e){var t=this,r=e.requestData,a=e.user,i=e.searchSessionId,n=e.url,l=e.onSuccess,d=e.onError,u=e.webTimer;null!=this._activeRequest&&this._activeRequest.abort();var p={path_scoped:"/"!==r.fq_path,search_type:this._getSearchType(r),query_string:r.query,start:r.start,search_session_id:i,timezone_offset:r.timezone_offset,file_categories:r.file_categories};o.SearchClientActivityLogger.log("query_started",a.id,p);var h=(new Date).getTime();this._activeRequest=s.WebRequest({url:n,data:r,dataType:"json",subject_user:a,success:function(e,s,n){var d;r.include_browse_context&&(d=c.extractBrowseContext(e));var _=e.search_results,f=n.getResponseHeader("x-dropbox-request-id");_.forEach(function(e){return e.request_id=f});var m=t._extractSearchResultsList(_);l({context:d,searchResults:m,deleted:!!r.deleted});var S=o.SearchClientActivityLogger.create_search_log_dict(p,f,h,r.query,m.length,null,i);o.SearchClientActivityLogger.log("query_completed",a.id,S),u&&u.end(f?f:void 0)},error:function(e,t,s){"abort"!==t&&"function"==typeof d&&d(s);var n=e.getResponseHeader("x-dropbox-request-id"),l=o.SearchClientActivityLogger.create_search_log_dict(p,n,h,r.query,null,t,i);o.SearchClientActivityLogger.log("query_failed",a.id,l),u&&u.abort()},complete:function(){this._activeRequest=null}})},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,r=e.user,o=e.onSuccess,i=e.onError,l=e.useFileInfoEndpoint,c=t.filter(function(e){return e instanceof a.File}),d=c.map(function(e){return[e.ns_id,e.sjid]}),u=c.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});d.length>0&&s.WebRequest({url:l?n.FILE_INFO_ENDPOINT:n.SEARCH_METADATA_ENDPOINT,data:l?{nsid_sjid_fq_mount_point_tuples:JSON.stringify(u)}:{nsid_sjid_pairs:JSON.stringify(d)},dataType:"json",subject_user:r,success:function(e,t,r){for(var s=l?e.file_results:e.search_results,a=[],i=0,n=s;i<n.length;i++){var c=n[i];a.push(c)}o(a)},error:function(e,t,r){"abort"!==t&&"function"==typeof i&&i(r)}})},e})();t.SearchApiClient=p,t.searchApiClient=new p}),define("modules/clean/search/search_results/actions",["require","exports","tslib","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/constants","modules/clean/search/store_helpers"],function(e,t,r,s,o,a,i,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(e,t){void 0===e&&(e=i.searchApiClient),void 0===t&&(t=n.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,r=e.user,o=e.path,i=e.query,n=e.searchSessionId,d=e.webTimer,u=e.logOnceFetchedDataRequiredForTTI,p=e.deletedFiles,h=e.showSymlinkIcon,_=e.expSinglePageSearch,f=e.useFileInfoEndpoint,m=e.fileCategories,S=c.generateRandomId();_||a.SearchResultsDispatcher.dispatch({type:s.CLEAR_SEARCH_ACTION}),a.SearchResultsDispatcher.dispatch({type:s.START_SEARCH_ACTION,data:{query:i,searchSessionId:n,queryId:S}});var g=l.MaxResults.MAX_SEARCH_RESULTS;p!==!0?this._searchApi.loadPartialResults({user:r,path:o,query:i,start:0,searchSessionId:n,showSymlinkIcon:h,includeBrowseContext:!0,webTimer:d,maxResults:g,fileCategories:m,onSuccess:function(e){var s=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:s,context:a,deletedFiles:!!p,queryId:S}),void 0===p&&t._loadDeletedResults({path:o,user:r}),t._searchApi.fetchAdditionalFileMetadata({searchResults:s,user:r,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:S})},useFileInfoEndpoint:f})}}):this._searchApi.loadResults({user:r,path:o,query:i,start:0,maxResults:g,showPaperResults:!0,searchSessionId:n,showSymlinkIcon:h,webTimer:d,loadDeleted:p,onSuccess:function(e){var s=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:s,context:a,deletedFiles:!!p,queryId:S}),void 0===p&&t._loadDeletedResults({path:o,user:r})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=this,r=e.searchResult,s=e.user,a=e.onSuccess,i=e.onError,l=e.useFileInfoEndpoint;if(r.isDeleted)return a(r);var c=n.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);if(c){a(this._mergePartialAndCompleteResult({partialResult:r,completeResult:c,useFileInfoEndpoint:l}))}else this._searchApi.fetchAdditionalFileMetadata({searchResults:[r],user:s,useFileInfoEndpoint:l,onSuccess:function(e){if(e.length>0){a(t._mergePartialAndCompleteResult({partialResult:r,completeResult:e[0],useFileInfoEndpoint:l}))}else if(i){var s=o._("There was a problem completing this request.");i(s)}},onError:i})},e.prototype._mergePartialAndCompleteResult=function(e){var t=e.partialResult,s=e.completeResult;return e.useFileInfoEndpoint?r.__assign({},t,s):r.__assign({},s,{filename_highlights:t.filename_highlights,highlight_spans:t.highlight_spans,match_type:t.match_type,request_id:t.request_id,sort_key:t.sort_key,sort_rank:t.sort_rank})},e.prototype.loadMoreResults=function(e){var t=this,r=e.path,o=e.user,i=e.useFileInfoEndpoint,n=e.deletedFiles,c=e.showSymlinkIcon,d=!1;if(this._searchResultsStore.loadingState()===s.SearchLoadingState.LOADED){if(void 0===n)if(this._searchResultsStore.hasMoreResults())d=!1;else{if(!this._searchResultsStore.hasMoreResults(!0))return;d=!0}else{if(!this._searchResultsStore.hasMoreResults(n))return;d=n}a.SearchResultsDispatcher.dispatch({type:s.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:d}});var u=d?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size,p=this._searchResultsStore.queryId();if(d)this._searchApi.loadResults({user:o,path:r,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:d,start:u,maxResults:l.MaxResults.MAX_SEARCH_RESULTS,searchSessionId:this._searchResultsStore.searchSessionId(),showSymlinkIcon:c,onSuccess:function(e){var s=e.searchResults,a=(e.context,e.deleted);t._appendSearchResults({searchResults:s,deleted:a}),void 0===n&&t._loadDeletedResults({path:r,user:o})}});else{var h=this._searchResultsStore.latestQuery();this._searchApi.loadPartialResults({user:o,path:r,query:h,start:u,showSymlinkIcon:c,includeBrowseContext:!1,searchSessionId:this._searchResultsStore.searchSessionId(),maxResults:l.MaxResults.MAX_SEARCH_RESULTS,onSuccess:function(e){var s=e.searchResults;e.context;t._appendSearchResults({searchResults:s,deleted:!1}),t._searchApi.fetchAdditionalFileMetadata({searchResults:s,user:o,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:p})},useFileInfoEndpoint:i}),void 0===n&&t._loadDeletedResults({path:r,user:o})}})}}},e.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,o=e.deletedFiles,i=e.queryId;a.SearchResultsDispatcher.dispatch({
type:s.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:r,deletedFiles:o,queryId:i}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,r=e.queryId;a.SearchResultsDispatcher.dispatch({type:s.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,queryId:r}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,r=e.deleted;a.SearchResultsDispatcher.dispatch({type:s.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,deleted:r}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r})},e.prototype.setSearchSelection=function(e){var t=e.selection;a.SearchResultsDispatcher.dispatch({type:s.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.clearSearch=function(){a.SearchResultsDispatcher.dispatch({type:s.CLEAR_SEARCH_ACTION})},e.prototype.setFileTypeFilter=function(e){var t=e.fileCategories;a.SearchResultsDispatcher.dispatch({type:s.SET_FILE_TYPE_FILTER_ACTION,data:{fileCategories:t}})},e})();t.SearchResultsActions=d,t.searchResultsActions=new d}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/lodash","external/react","external/react-dom","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/files_view/types","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/web_user_action_events"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(t){function c(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._onBrowseStoreChanged=function(){e.setState(e._getStateFromBrowseStore())},e._handleScroll=function(){if(a.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props,r=t.path,s=t.user,o=t.shouldShowDeletedFiles,i=t.searchResultsExperiments,n=i.expShowSymlinkIcon,l=i.expUseFileInfoEndpoint;u.searchResultsActions.loadMoreResults({path:r,user:s,useFileInfoEndpoint:!!l,showSymlinkIcon:!!n,deletedFiles:o})}},e._handleSelectionChange=function(e){u.searchResultsActions.setSearchSelection({selection:e})},e._handleLocationLinkClick=function(t,r){var s=e.props.user;if(p.recordSearchResultsAction({result:t,user:s,action_type:f.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:d.ViewType.List}),!r){var o=i.parent_dir(t.fq_path);e.props.onNavigateToPath(o)}},e._handleFilesViewShowShare=function(t,r){var s=e.props,o=s.user,a=s.filesViewActionHandlers;p.recordSearchResultsAction({result:t,user:o,action_type:f.WebUserActionLogEvent.SHARE,view_type:d.ViewType.List}),a.onShowShare(t,r)},e}return r.__extends(c,t),c.prototype.componentWillMount=function(){this.state=this._getStateFromStores()},c.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},c.prototype.componentDidMount=function(){h.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),l.getBrowseStore().add_change_listener(this._onBrowseStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromStores()),window.scrollTo(0,0)},c.prototype.componentWillUnmount=function(){h.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged),l.getBrowseStore().remove_change_listener(this._onBrowseStoreChanged)},c.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){s.defer(function(){var e=[];h.getSearchResultsStore().searchResults().forEach(function(t){t instanceof n.File&&e.push(t),(t instanceof n.Paper||t instanceof n.PaperFolder)&&e.push(t)}),r({items:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},c.prototype._getStateFromStores=function(){return r.__assign({},this._getStateFromBrowseStore(),this._getStateFromSearchResultsStore())},c.prototype._getStateFromBrowseStore=function(){var e=l.getBrowseStore();return{viewType:e.viewType(),tilesPerRow:e.tilesPerRow()}},c.prototype._getStateFromSearchResultsStore=function(){var e=h.getSearchResultsStore();return{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:e.loadingState(),latestQuery:e.latestQuery(),searchSessionId:e.searchSessionId(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles()}},c.prototype.render=function(){var e=this.props,t=e.actionHandlers,a=e.searchResultsExperiments,i=e.searchBarExperiments,n=e.maestroSearchBarProps,l=e.onSearch,c=e.onNavigateToFileOrFolder,d=e.setFileUploaderPath,u=e.path,p=e.user,h=e.handleComponentTTI,f=e.ensureFileViewerClosedIfNotPreviewing,m=e.getIsFileJumping,S=e.isFileViewerShown,g=e.fileRename,w=e.arePostTTIModulesLoaded,F=e.getOverflowMenuActions,E=e.filesViewActionHandlers,y=e.onNavigateToParentFolder,T=e.shouldShowDeletedFiles,v=e.browseExperiments,R=e.onOpenPaper,A=e.renderSharedWithController,b=e.responsive,I=e.onSearchFiltersChanged,C=e.starredState,P=this.state,D=P.context,N=P.hasMoreResults,L=P.loadingState,O=P.latestQuery,x=P.searchSessionId,M=P.searchResults,U=P.selection,B=P.selectedFiles,q=P.viewType,k=P.tilesPerRow,V=r.__assign({},E,{onShowShare:this._handleFilesViewShowShare});return o.createElement(_.SearchResultsView,{filesViewActionHandlers:V,searchResultsExperiments:a,searchBarExperiments:i,browseExperiments:v,maestroSearchBarProps:n,onSearch:l,onScroll:s.throttle(this._handleScroll,200),setFileUploaderPath:d,onSelectionChange:this._handleSelectionChange,path:u,user:p,actionHandlers:t,handleComponentTTI:h,ensureFileViewerClosedIfNotPreviewing:f,getIsFileJumping:m,isFileViewerShown:S,fileRename:g,arePostTTIModulesLoaded:w,getOverflowMenuActions:F,onLocationLinkClick:this._handleLocationLinkClick,onNavigateToFileOrFolder:c,onNavigateToParentFolder:y,onOpenPaper:R,context:D,hasMoreResults:N,loadingState:L,latestQuery:O,searchSessionId:x,searchResults:M,selection:U,selectedFiles:B,viewType:q,tilesPerRow:k,shouldShowDeletedFiles:T,renderSharedWithController:A,responsive:b,onSearchFiltersChanged:I,starredState:C})},c})(o.Component);t.SearchResultsController=c(m,["/static/css/browse/browse-vflAThZlB.css","/static/css/search/search_results-vflIJb4fN.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultsDispatcher={dispatch:function(e){r.assert(o.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,s,o,a){"use strict";function i(e){var t=e.result,i=e.user,n=e.action_type,l=e.view_type,c=s.getSearchResultsStore().searchSessionId(),d=s.getSearchResultsStore().latestQuery(),u={rawQuery:d,normalizedQuery:d};o.getStoreForSearchBar().dispatch(a.addQueryToHistory({user:i,query:u,searchSessionId:c,requestId:t.request_id||""})),r.logSearchAction({searchSessionId:c,result:t,user:i,action_type:n,search_type:"full_page",viewport:"full-view",view_type:l})}Object.defineProperty(t,"__esModule",{value:!0}),t.recordSearchResultsAction=i}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","external/react","modules/core/i18n","spectrum/tertiary_link","spectrum/label","spectrum/radio_button","spectrum/checkbox","modules/clean/filepath","modules/clean/react/async_folder_selector_modal","modules/clean/react/path_filter_button","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/search/search_bar/experiments"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(f){var m=e.call(this,f)||this;m.showFolderFilterModal=function(){var e=m.props,t=e.user,r=e.path,s=e.onFiltersChanged,a=e.deletedFiles,i=e.searchResultsExperiments,n=void 0===i?{}:i;d.show({primaryAction:o._("Select"),secondaryAction:o._("Cancel"),title:o._("Select a folder"),ariaLabel:o._("Folder selector"),user:t,initialFolderSelection:r,forceRootSelectable:!0,onFolderSelected:function(e){s({path:e,deletedFiles:a})},showFolderPicker:!!n.expUseNewFolderPicker})},m.resetFilters=function(){var e=m.props,t=e.searchBarExperiments,r=e.onFiltersChanged,s={};_.isInDeletedFilterRightRailExperiment(t)&&(s.deletedFiles=!1),s.path="/",r(s)},m.shouldRenderResetButton=function(){var e=m.props,t=e.path,r=e.deletedFiles;return!c.paths_are_equal(t,"/")||!!r},m.renderResetButton=function(){return s.createElement(a.TertiaryLink,{onClick:m.resetFilters,className:"search-filters__reset"},o._("Reset filters"))},m.renderPathFilter=function(){var e=m.props.path;return s.createElement("div",{className:"filter-item__row"},s.createElement("div",{className:"filter-item__column"},s.createElement("div",{className:"filter-item__desc"},o._("In folder")),s.createElement(u.PathFilterButton,{path:e,defaultText:o._("Any folder"),dropdownClasses:"filter-item__filter",onClick:m.showFolderFilterModal})))},m.handleDeletedFilesAll=function(){m.props.onFiltersChanged({deletedFiles:!1})},m.handleDeletedFilesDeleted=function(){m.props.onFiltersChanged({deletedFiles:!0})},m.handleFileTypeChanged=function(e,t,s){var o=s.target.name;m.props.onFiltersChanged({fileCategories:r.__assign({},m.props.fileCategories,(a={},a[o]=e,a))});var a},m.renderDeletedFilter=function(){var e=m.props.deletedFiles;return s.createElement("div",{className:"filter-item__row"},s.createElement("div",{className:"filter-item__column"},s.createElement("div",{className:"filter-item__desc"},o._("By status")),s.createElement("div",null,s.createElement(i.Label,{htmlFor:"filter-type-all"},s.createElement(n.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:m.handleDeletedFilesAll}),o._("Available"))),s.createElement("div",null,s.createElement(i.Label,{htmlFor:"filter-type-deleted"},s.createElement(n.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:m.handleDeletedFilesDeleted}),o._("Deleted")))))},m.renderFileTypeFilter=function(){var e=m.renderFileTypeFilterCheckboxes();return s.createElement("div",{className:"filter-item__row"},s.createElement("div",{className:"filter-item__column"},s.createElement("div",{className:"filter-item__desc"},o._("By type")),e))},m.renderFileTypeFilterCheckboxes=function(){var e=[];return Object.keys(t.FileCategoryLabels).forEach(function(r){var o=t.FileCategoryLabels[r],a="filter-type-file-"+r;e.push(s.createElement("div",{key:a},s.createElement(i.Label,{htmlFor:a},s.createElement(l.Checkbox,{name:r,"aria-checked":!0,checked:m.props.fileCategories[r],id:a,onChange:m.handleFileTypeChanged}),o)))}),e};var S=m.props.searchResultsExperiments;return h.isInFileTypeFilterExperiment(S)&&void 0===t.FileCategoryLabels&&(t.FileCategoryLabels=(g={},g[p.FileCategory.IMAGE]=o._("Images"),g[p.FileCategory.DOCUMENT]=o._("Documents"),g[p.FileCategory.PDF]=o._("PDFs"),g[p.FileCategory.SPREADSHEET]=o._("Spreadsheets"),g[p.FileCategory.PRESENTATION]=o._("Presentations"),g[p.FileCategory.AUDIO]=o._("Audio"),g[p.FileCategory.VIDEO]=o._("Video"),g[p.FileCategory.FOLDER]=o._("Folders"),g[p.FileCategory.PAPER]=o._("Paper docs"),g[p.FileCategory.OTHER]=o._("Other"),g)),m;var g}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.searchResultsExperiments,r=e.searchBarExperiments;return s.createElement("div",null,s.createElement("div",{className:"filter-header"},s.createElement("h3",null,o._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),s.createElement("div",{className:"filter-item"},this.renderPathFilter()),s.createElement("div",{className:"filter-item"},h.isInFileTypeFilterExperiment(t)&&this.renderFileTypeFilter()),s.createElement("div",{className:"filter-item"},_.isInDeletedFilterRightRailExperiment(r)&&this.renderDeletedFilter()))},t})(s.Component);t.SearchFilters=f}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","external/react","modules/clean/react/browse/util","modules/core/i18n","modules/clean/search/search_results/search_filters","modules/clean/react/app_actions_view"],function(e,t,r,s,o,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(t){function l(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(l,t),l.prototype.render=function(){var t=this.props,r=t.context,l=t.selectedFiles,c=t.arePostTTIModulesLoaded,d=t.user,u=t.path,p=t.actionHandlers,h=t.searchResultsExperiments,_=t.searchBarExperiments,f=t.shouldShowDeletedFiles,m=t.viewType,S=t.responsive,g=t.onSearchFiltersChanged,w=t.fileCategories;if(l.size){var F=[];if(c){F=e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:l,context:r,user:d,viewType:m,actionHandlers:p,isSearchMode:!0,responsive:S})}if(F.length){var E=F[0],y={displayName:E.label,handleClick:E.performAction,iconName:E.iconName,className:E.className,disabled:E.disabled},T=F.slice(1).map(function(e){return{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),v=o.getSelectedFilesText(l,r);return s.createElement(n.AppActionsView,{headerText:v,popoverTriggerLabel:a._("Actions"),primaryMenuItem:y,secondaryMenuItems:T,responsive:S})}}return s.createElement(i.SearchFilters,{user:d,searchResultsExperiments:h,searchBarExperiments:_,path:u,onFiltersChanged:g,deletedFiles:f,fileCategories:w})},l})(s.PureComponent);t.SearchResultsSidebarView=l}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,s,o,a,i,n,l,c,d){"use strict";function u(){return null===_&&(_=new h),_}function p(){return null!==_}Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=n.SearchLoadingState.LOADED,this._fullSearchResults=s.OrderedMap(),this._searchResults=s.List(),this._selection=void 0,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._tilesPerRow=1,this._fileCategories=r.__assign({},n.FILE_CATEGORIES_UNCHECKED)},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionId=function(){return this._searchSessionId},t.prototype.queryId=function(){return this._queryId},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new c.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.tilesPerRow=function(){return this._tilesPerRow},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=i.createSelection())},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof c.File&&e.selection().selected.has(t.fq_path)});return s.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.fileCategories=function(){return this._fileCategories},t.prototype._setRawQuery=function(e,t){t?this._searchSessionId=t:d.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionId=d.generateRandomId()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.searchSessionId,s=e.queryId;this._setRawQuery(t,r),this._latestQuery=d.normalize(t),this._loadingState=n.SearchLoadingState.LOADING_FIRST_PAGE,this._queryId=s,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,s=e.deletedFiles;e.queryId===this.queryId()&&(this._setSearchResultsInternal(t,s),this._loadingState=n.SearchLoadingState.LOADED,r&&(this._browseContext=r),this._updateMoreResults(t),this.emit_change())},t.prototype._setFullSearchResults=function(e){var t=e.searchResults;if(e.queryId===this._queryId){for(var r=0,s=t;r<s.length;r++){var o=s[r];this._fullSearchResults=this._fullSearchResults.set(o.fq_path,o)}this._loadingState=n.SearchLoadingState.LOADED,this.emit_change()}},t.prototype._setSearchResultsInternal=function(e,t){this._searchResults=s.List(e),t&&(this._numDeletedResults=e.length)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=n.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState=n.SearchLoadingState.LOADED,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){var e=this._fileCategories;this._resetSearchResults(),this._fileCategories=e,this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===n.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._setTilesPerRow=function(e){var t=e.tilesPerRow;this._tilesPerRow=t,this.emit_change()},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?s._searchResults=s._searchResults.push(t):e&&!t?(r=s._searchResults.findIndex(function(t){return t instanceof c.File&&o.paths_are_equal(t.fq_path,e)}),s._searchResults=s._searchResults.delete(r)):e&&t&&(r=s._searchResults.findIndex(function(t){return t instanceof c.File&&o.paths_are_equal(t.fq_path,e)}),s._searchResults=r>-1?s._searchResults.set(r,t):s._searchResults.push(t))},s=this,a=0,i=t;a<i.length;a++){var n=i[a];r(n.before,n.after)}this.emit_change()}},t.prototype._updateContext=function(e){this._browseContext=e.context},t.prototype._updateFileTypeFilter=function(e){var t=e.fileCategories;this._fileCategories=t,this.emit_change()},t.prototype._new_payload=function(e){switch(e.action.type){case n.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case n.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case n.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case n.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case n.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case n.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case n.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case n.CLEAR_SEARCH_ACTION:this._clearSearch();break;case n.SET_FILE_TYPE_FILTER_ACTION:this._updateFileTypeFilter(e.action.data);break;case l.BrowseActionType.LOAD_PATH:this._updateContext(e.action.data);break;case l.BrowseActionType.SET_TILES_PER_ROW:this._setTilesPerRow(e.action.data)}},t})(a.Store);t.SearchResultsStore=h;var _=null;t.getSearchResultsStore=u,t.searchResultsStoreInstantiated=p}),define("modules/clean/search/search_results/view",["require","exports","tslib","external/lodash","external/react","spectrum/table","spectrum/tip_card","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/illustration_helper","modules/clean/react_format","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/fixed_table_head","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/core/i18n","modules/core/uri"],function(e,t,r,s,o,a,i,n,l,c,d,u,p,h,_,f,m,S,g,w,F,E,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var T=(function(e){function t(t){var r=e.call(this,t)||this;return r._handleScroll=function(){r.props.onScroll()},r._ensureFileViewerClosedIfNotPreviewing=function(){var e=c.deconstruct_url().qargs;r.props.ensureFileViewerClosedIfNotPreviewing(e)},r._handleFullSearchOnClick=function(e){e.preventDefault(),r.props.onSearch(r.props.latestQuery,"/")},r._handleEmptyFolderViewTTI=function(){r.props.handleComponentTTI("FilesViewController")},r._handleSearchAllFiles=function(e){e.preventDefault();var t=r.props.path;r.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},r._handleSearchDeletedFiles=function(e){e.preventDefault();var t=r.props.path;r.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},r._handleSearchAllFolders=function(e){e.preventDefault();var t=r.props.shouldShowDeletedFiles;r.props.onSearchFiltersChanged({path:"/",deletedFiles:t})},r._getEmptyFolderViewUrl=function(e,t){var s=r.props,o=s.user,a=s.latestQuery,i=s.searchSessionId;return F.buildSearchURL({user:o,searchPath:e,normalizedQuery:a,searchSessionId:i,searchToken:F.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},r._renderEmptyFolderSubtitle=function(){var e=r.props,t=e.path,s=e.shouldShowDeletedFiles,a=e.searchBarExperiments;return l.paths_are_equal(t,"/")?s?u.reactFormat(E._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:o.createElement("a",{href:r._getEmptyFolderViewUrl(t,!1),onClick:r._handleSearchAllFiles})}):w.isInDeletedFilterRightRailExperiment(a)?u.reactFormat(E._("Try different keywords or <Link>search deleted files</Link>"),{Link:o.createElement("a",{href:r._getEmptyFolderViewUrl(t,!0),onClick:r._handleSearchDeletedFiles})}):E._("Try different keywords"):s?u.reactFormat(E._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:o.createElement("a",{href:r._getEmptyFolderViewUrl("/",s),onClick:r._handleSearchAllFolders}),LinkDeleted:o.createElement("a",{href:r._getEmptyFolderViewUrl(t,!1),onClick:r._handleSearchAllFiles})}):w.isInDeletedFilterRightRailExperiment(a)?u.reactFormat("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>",{LinkScope:o.createElement("a",{href:r._getEmptyFolderViewUrl("/",s),onClick:r._handleSearchAllFolders}),LinkDeleted:o.createElement("a",{href:r._getEmptyFolderViewUrl(t,!0),onClick:r._handleSearchDeletedFiles})}):u.reactFormat("<LinkScope>Search all folders</LinkScope>",{LinkScope:o.createElement("a",{href:r._getEmptyFolderViewUrl("/"),onClick:r._handleSearchAllFolders})})},r._renderEmptyFolderView=function(e){var t=r.props.path,s=l.paths_are_equal(t,"/"),i=E._("No results found");if(r.shouldRenderNewEmptyState())return o.createElement("div",null,o.createElement(a.Table,{columnFlex:[p.CHECKBOX_CELL_FLEX,1]},o.createElement(f.FixedTableHead,{offsetHeight:p.DEFAULT_COLUMN_HEADER_HEIGHT},o.createElement(a.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},o.createElement("div",{className:"brws-vertically-center"})),o.createElement(a.TableHeadCell,{role:"columnheader",scope:"col",className:"brws-column-header-table-cell"},o.createElement("div",{className:"normal brws-column-header-menu"},o.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},r._searchResultsTitle(e))))),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null),o.createElement("td",null)))),o.createElement("div",{className:"u-font-center u-pad-top-xl"},o.createElement(S.Image,{src:d.empty_state_url("search"),srcHiRes:d.empty_state_url("search@2x"),alt:""}),o.createElement("h2",{className:"u-font-strong empty-folder-table-title"},i),o.createElement("span",null,r._renderEmptyFolderSubtitle())));var n=s?E._("Please update your search and try again"):E._("Search all of my Dropbox instead"),c=s?void 0:r._getFullSearchLink(),u=s?void 0:r._handleFullSearchOnClick;return o.createElement(_.EmptyFolderTable,{title:i,subtitle:n,subtitleLink:c,subtitleOnClick:u,onTTI:r._handleEmptyFolderViewTTI})},r._renderDeletedFilesTipcard=function(){return w.isInDeletedFilterRightRailExperiment(r.props.searchBarExperiments)&&r.props.shouldShowDeletedFiles&&r.props.loadingState===g.SearchLoadingState.LOADED&&r.props.searchResults.count()>0?o.createElement(i.TipCard,{className:"mc-tip-card--deleted-files"},u.reactFormat(E._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:o.createElement("a",{href:"/deleted_files"})})):null},r.state={},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){c.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),c.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,s=e.user;return y.URI.parse("/search/"+s.role).setQuery({path:"/",query:t,searchSessionId:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props.searchBarExperiments;return w.isInDeletedFilterRightRailExperiment(e)||w.isInSinglePageSearchExperiment(e)},t.prototype._searchResultsTitle=function(e){var t=this.props,r=t.searchResults,s=t.path,a=t.latestQuery,i=t.viewType,c=t.shouldShowDeletedFiles,d=r.size,p=l.paths_are_equal(s,"/");if(!this.shouldRenderNewEmptyState()&&0===d)return"";var h,_=e.isMatchedMedium?e.isMatchedLarge?30:20:10;i===m.ViewType.List&&(_/=2);if(p){var f=n.Emstring.em_snippet(a,_,.6);h=c?E.ungettext("%(size)d deleted result for “%(query)s”","%(size)d deleted results for “%(query)s”",d).format({size:d,query:f}):E.ungettext("%(size)d result for “%(query)s”","%(size)d results for “%(query)s”",d).format({size:d,query:f})}else{var S=n.Emstring.em_snippet(l.filename(s),_/2,.6),f=n.Emstring.em_snippet(a,_/2,.6);h=c?u.reactFormat(E.ungettext("%(size)d deleted result for “%(query)s” in <strong>%(path)s</strong>","%(size)d deleted results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:o.createElement("strong",null)}):u.reactFormat(E.ungettext("%(size)d result for “%(query)s” in <strong>%(path)s</strong>","%(size)d results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:f,path:S}),{strong:o.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,s=e.loadingState;return w.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?m.LoadingState.LOADED:s===g.SearchLoadingState.LOADING_FIRST_PAGE?m.LoadingState.LOADING_FIRST_PAGE:s===g.SearchLoadingState.LOADING_ADDITIONAL_PAGE?m.LoadingState.LOADING_REMAINING_PAGES:m.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){var t=this.props,a=t.getOverflowMenuActions,i=t.onLocationLinkClick,n=t.onNavigateToFileOrFolder,l=t.onNavigateToParentFolder,c=t.onOpenPaper,d=t.context,u=t.fileRename,_=t.searchResults,f=t.getIsFileJumping,S=t.isFileViewerShown,g=t.arePostTTIModulesLoaded,w=t.handleComponentTTI,F=t.onSelectionChange,E=t.selectedFiles,y=t.selection,T=t.setFileUploaderPath,v=t.viewType,R=t.user,A=t.tilesPerRow,b=t.path,I=t.filesViewActionHandlers,C=t.browseExperiments.expBrowseLargeGridView,P=t.renderSharedWithController,D=t.starredState;return o.createElement(h.FilesViewController,r.__assign({},I,{getOverflowMenuActions:a,onLocationLinkClick:i,onNavigateToFileOrFolder:n,onNavigateToParentFolder:l,onOpenPaper:c,context:d,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:m.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:u,items:_,getIsFileJumping:f,isFileViewerShown:S,isSearchMode:!0,arePostTTIModulesLoaded:g,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:w,onSelectionChange:F,onSortChange:s.noop,path:b,selectedFiles:E,selection:y,setFileUploaderPath:T,showFileUploaderModal:s.noop,user:R,viewType:v,totalNumFiles:_.size,responsive:e,columns:this._generateColumns(e),tilesPerRow:A,renderSharedWithController:P,viewTypes:"ON"===C?p.AllViewTypesExperiment:p.AllViewTypes,viewTypeLabels:"ON"===C?p.ViewTypeLabelsExperiment:p.ViewTypeLabels,starredState:D}))},t.prototype._generateColumns=function(e){var t=this;return(this.props.shouldShowDeletedFiles?p.SEARCH_LIST_VIEW_COLUMNS_DELETED:p.SEARCH_LIST_VIEW_COLUMNS).map(function(s,o){return r.__assign({},s,{label:0===o?t._searchResultsTitle(e):s.label})})},t.prototype.render=function(){var e=this.props.responsive;return o.createElement("div",{className:"search-results"},this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(o.Component);t.SearchResultsView=T}),define("modules/clean/web_upload_action_logger",["require","exports","modules/clean/ajax"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_ERRORS=3;var s=(function(){function e(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}return e.prototype.log=function(e,s,o){var a=this;return this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise(function(i,n){r.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:s,extra_params:JSON.stringify(o)},error:function(e){429===e.status?a.errorCount=t.MAX_ERRORS:a.errorCount++,a.lastError=Date.now(),n(e)},success:function(e){try{var t=JSON.parse(e);t&&!t.continue_sending&&(a.shouldReport=!1),a.errorCount=0,i(e)}catch(e){throw a.errorCount++,a.lastError=Date.now(),n(e),e}}})}):Promise.resolve({})},e})();t.WebUploadActionLog=new s,t.WebUploadActionLogClass=s});
//# sourceMappingURL=pkg-browse-uncommon.min.js-vflZbkXxW.map