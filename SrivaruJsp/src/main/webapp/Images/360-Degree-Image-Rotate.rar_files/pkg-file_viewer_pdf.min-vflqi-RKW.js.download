define("modules/clean/frame_messenger/frame_messenger_client",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedOriginForPosting=null,t._validActions=[],t._parentMessageQueue=[],t._onParentReady=null,t}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this._trustedOriginForPosting=null,this._validActions=t,this._trustedMessageHandler=e,this._onParentReady=n},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.requestParentOrigin()},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={});var n=this.packagePostMessage(e,t);null===this._trustedOriginForPosting?this._parentMessageQueue.push(n):this.getWindow().parent.postMessage(n,this._trustedOriginForPosting)},t.prototype.dispatchMessage=function(e,t){"parent-ready"===t.action?this.updateParentOrigin(e.origin):i(t.action,this._validActions)&&null!==this._trustedMessageHandler&&this._trustedMessageHandler(t)},t.prototype.resetOriginsForPosting=function(){this._trustedOriginForPosting=null},t.prototype.updateParentOrigin=function(e){var t=this._trustedOriginForPosting;if(!this.isOriginAllowed(e))return!1;if(this._trustedOriginForPosting=e,this._parentMessageQueue.length>0){for(var n=0;n<this._parentMessageQueue.length;n++){var o=this._parentMessageQueue[n],i=JSON.parse(o);this.postMessageToParent(i.action,i.parameters)}this._parentMessageQueue=[]}return null!=this._trustedOriginForPosting&&null==t&&null!==this._onParentReady&&this._onParentReady(),!0},t.prototype.requestParentOrigin=function(){var e=this;this.getWindow().parent.postMessage('{"action": "child-requesting-parent-origin"}',"*");var n=function(){null===e._trustedOriginForPosting&&e.requestParentOrigin()};this.getWindow().setTimeout(n,t._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t})(o.FrameMessengerBase);t.FrameMessengerClient=r}),define("modules/clean/react/file_viewer/frame_interface",["require","exports","tslib","modules/clean/react/file_viewer/interface","modules/clean/react/previews/frame_messenger_host"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["annotation-end-drag","annotation-enter","annotation-hidden","annotation-leave","annotation-placed","annotation-start-drag","annotation-ui-click","annotation-ui-enter","annotation-ui-leave","annotation-ui-over","mouse-up","on-keydown","page-rendered","scale-change","scroll"],a=(function(e){function t(n){var o=e.call(this,n)||this;return o.handleMessageFromFrame=function(e){o.eventEmitter.emit(e.action,e.parameters)},t.frameMessengerFactory?o.frameMessenger=t.frameMessengerFactory():o.frameMessenger=new i.PreviewFrameMessengerHost,o.frameMessenger.configureChildMessaging('iframe[name="preview-content"]',o.handleMessageFromFrame,r),o.frameMessenger.startListening(),o}return n.__extends(t,e),t.prototype.dispatchEvent=function(e,t){this.frameMessenger.postMessageToChildren(e,t)},t.prototype.destroy=function(){this.frameMessenger.stopListening()},t.setFrameMessengerFactory=function(e){t.frameMessengerFactory=e},t})(o.FileViewerInterface);t.FileViewerFrameInterface=a}),define("modules/clean/react/file_viewer/interface",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){this.eventEmitter=e}return e.prototype.destroy=function(){},e})();t.FileViewerInterface=n}),define("modules/clean/react/file_viewer/sidebar_helpers",["require","exports","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/actions","modules/clean/react/size_class/constants"],function(e,t,n,o,i){"use strict";function r(e,t,o){return t===i.SizeClass.Large&&!o&&(e===n.DocType.ppt||e===n.DocType.pdf)}Object.defineProperty(t,"__esModule",{value:!0}),t.mapDispatchToProps={onSidebarOpen:o.openSidebar,onSidebarClose:o.closeSidebar},t.isSidebarEnabled=r}),define("modules/clean/react/previews/pdf_viewer/annotation_creation_layer",["require","exports","tslib","external/keymaster","external/lodash","external/react","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/transform","modules/clean/annotations/annotation_controller"],function(e,t,n,o,i,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={draftAnnotationVersion:0,postedAnnotationKey:""},t.resetDraftAnnotation=function(e){void 0===e&&(e=""),t.setState({draftAnnotationVersion:t.state.draftAnnotationVersion+1,postedAnnotationKey:e})},t.onResize=i.debounce(t.resetDraftAnnotation,1e3,{leading:!0,trailing:!1}),t.onUpdateAnnotations=function(e){var n=e.annotations.filter(function(e){return"POSTING"===e.commentActivity.status});if(n.length>0){var o=n[0].commentActivity.activity_key;o!==t.state.postedAnnotationKey&&t.resetDraftAnnotation(o)}},t.onAnnotationHiddenCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-hidden")},t.onAnnotationPlacedCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-placed",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationStartDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-start-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEndDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-end-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScrollCallback=function(e){e&&t.props.frameMessenger.postMessageToParent("scroll",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScaleChangeCallback=function(e){t.props.frameMessenger.postMessageToParent("scale-change",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-enter",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-leave",{annotation:t.finalizeAnnotation(e)})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){a.eventEmitter.on("resize",this.onResize),a.eventEmitter.on("update-annotations",this.onUpdateAnnotations),o("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.componentWillUnmount=function(){a.eventEmitter.off("resize",this.onResize),a.eventEmitter.off("update-annotations",this.onUpdateAnnotations),o.unbind("esc","fileviewer",this.resetDraftAnnotation)},t.prototype.finalizeAnnotation=function(e){return e.pdf_coordinates=s.transformViewportCoordinates(this.props.pageNumber,this.props.parentOffset.left,this.props.parentOffset.top,this.props.width,this.props.height,this.props.scaleFactor,e.viewportCoordinates),e.pdf_page={rotate:0,view:{}},e},t.prototype.render=function(){return r.createElement("div",{className:"db-annotation-creation-layer"},r.createElement(l,{parentContainerOffset:this.props.parentOffset,controllerEventHandlers:this.props.delegate,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,draftAnnotationVersion:this.state.draftAnnotationVersion}))},t.defaultProps={scaleFactor:1},t})(r.Component);t.AnnotationCreationLayer=c}),define("modules/clean/react/previews/pdf_viewer/annotation_view_layer",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_region_ui","modules/clean/react/previews/pdf_viewer/transform","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/css"],function(e,t,n,o,i,r,a,s,l,c,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderedAnnotations={},t.onAnnotationClickCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-click",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-enter",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-leave",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onHighlightAnnotation=function(e){if(t.renderedAnnotations[e.activity_key]){var n=!1,i=t.renderedAnnotations[e.activity_key],r=o(".page-container"),a=o(i.firstChild);n=!1,t.isElementVisible(a,r)||(n=!0,r.animate({scrollTop:r.scrollTop()+a.offset().top-300+"px"},300)),i.classList.remove("start-highlight-animation"),i.classList.remove("start-highlight-animation--delay"),requestAnimationFrame(function(){i.classList.add("start-highlight-animation"),n&&i.classList.add("start-highlight-animation--delay")})}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){p.eventEmitter.on("highlight-annotation",this.onHighlightAnnotation)},t.prototype.componentWillUnmount=function(){p.eventEmitter.off("highlight-annotation",this.onHighlightAnnotation)},t.prototype.isElementVisible=function(e,t){var n=e.offset().top;return 0<n&&n<t.height()},t.prototype.render=function(){var e=this,t=null;return this.props.annotations&&(t=this.props.annotations.map(function(t,o){var p=a.Annotation.createAnnotationFromDict(t.annotation);p.viewportCoordinates=c.transformPdfCoordinates(0,e.props.height,t.annotation.pdf_coordinates);var d={key:t.commentActivity.activity_key,annotation:p,scaleFactor:e.props.scaleFactor,commentActivity:t.commentActivity,options:t.options,onAnnotationClickCallback:e.onAnnotationClickCallback,onAnnotationEnterCallback:e.onAnnotationEnterCallback,onAnnotationLeaveCallback:e.onAnnotationLeaveCallback,ref:function(n){return e.renderedAnnotations[t.commentActivity.activity_key]=r.findDOMNode(n)}};return p.type===a.AnnotationTypes.HIGHLIGHT?i.createElement(s,n.__assign({},d)):p.type===a.AnnotationTypes.REGION?i.createElement(l,n.__assign({},d)):null})),i.createElement("div",{className:"db-annotation-layer db-annotation-view-layer"},t)},t.defaultProps={scaleFactor:1},t})(i.PureComponent),m=["/static/css/comments_annotations-vflT6HX_-.css"],f=d(u,m);t.AnnotationViewLayer=f}),define("modules/clean/react/previews/pdf_viewer/app",["require","exports","tslib","external/react","external/keymaster","modules/clean/previews/util","modules/clean/react/previews/pdf_viewer/connection_pool","modules/clean/react/previews/constants","modules/clean/react/modal","modules/clean/react/previews/pdf_viewer/password_modal","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_viewer/viewer","modules/core/i18n","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/font"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,m,f,g,h){"use strict";function v(e){return void 0!==e.image}Object.defineProperty(t,"__esModule",{value:!0});var w=["pdf"],_=(function(e){function t(t){var o=e.call(this,t)||this;return o.isFirstPasswordAttempt=!0,o.inProgressPages={},o.downloadSucceedLogged=!1,o.renderSucceededLogged=!1,o.submitPassword=function(e){o.refreshBlob(e)},o.dismissPassword=function(){o.props.onError&&o.props.onError(s.ErrorType.PasswordProtectedError)},o.onScrollToAnnotation=function(e){var t=function(n,o){o===e.page-1&&(f.eventEmitter.off("page-set-to",t),f.eventEmitter.emit("highlight-annotation",e.commentActivity))};f.eventEmitter.on("page-set-to",t),f.eventEmitter.emit("set-current-page",e.page-1)},o.onScrollToPage=function(e){return n.__awaiter(o,void 0,void 0,function(){var t,o,i;return n.__generator(this,function(n){switch(n.label){case 0:this.props.frameMessenger.postMessageToParent("page-change",{current_page:e+1,pages_count:this.state.metadata?this.state.metadata.page_count:0,doc_type:r.isPptExtension(this.props.fileExtension)?d.DocType.ppt:d.DocType.pdf}),t=50*Math.floor(e/50),t+50-e<15&&(t+=50),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(t)];case 2:return o=n.sent(),o&&this.setState({text:this.addPdfgenText(o.text,this.state.text),links:o.text&&(o.text.links||void 0)}),[3,4];case 3:return i=n.sent(),f.eventEmitter.emit("error",m._("Failed to load PDF")),[3,4];case 4:return[2]}})})},o.onFileFeedbackUIReady=function(){o.props.frameMessenger.postMessageToParent("page-rendered")},o.onUpdateAnnotations=function(e){var t=e.annotations.reduce(function(e,t,n,o){var i=t.annotation.pdf_coordinates[0].page,r=i-1;return e[r]=e[r]||[],e[r].push(t),e},[]);o.setState({annotations:t})},o.onRemoveAllAnnotations=function(){o.setState({annotations:[]})},o.onEnableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!0})},o.onDisableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!1})},o.onEnableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!0})},o.onDisableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!1})},o.onMetadataLoad=function(e){o.props.onMetadataLoad&&o.props.onMetadataLoad(e)},o.onPageRenderComplete=function(e,t,n){o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_rendered"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_render"]=t.duration())),!o.renderSucceededLogged&&o.props.timelineCallbacks.onFirstRenderSucceeded&&(o.renderSucceededLogged=!0,o.props.timelineCallbacks.onFirstRenderSucceeded(),o.props.frameMessenger.postMessageToParent("page-rendered"))},o.onPageImageLoad=function(e,t,n){o.props.timelineCallbacks.onFirstImageLoad&&o.props.timelineCallbacks.onFirstImageLoad(),o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_image_loaded"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_image_load"]=t.duration())),!o.downloadSucceedLogged&&o.props.timelineCallbacks.onDownloadSucceeded&&(o.downloadSucceedLogged=!0,o.props.timelineCallbacks.onDownloadSucceeded())},o.onPrintKeyPressed=function(){return f.eventEmitter.emit("print",{context:d.UserActionContext.Keyboard}),!1},o.state={urls:t.urls,isAnnotationHighlightEnabled:!0},t.previewThumbnailUrl?o.placeholderImageUrl=t.previewThumbnailUrl:o.placeholderImageUrl=o.state.urls.imageUrl(0,0),o}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.connectionPool=new a.ConnectionPool({maxConnections:3}),this.props.timelineCallbacks.onDownloadAttempted&&this.props.timelineCallbacks.onDownloadAttempted(),this.requestMetadata(),this.refreshIntervalId=window.setInterval(function(){e.refreshBlob()},108e5)},t.prototype.addPdfgenText=function(e,t){if(void 0===t&&(t={}),!e||!e.pages)return t;var n=e.fonts?e.fonts.map(h.renderFont):[];for(var o in e.pages)e.pages.hasOwnProperty(o)&&(t[o]=(e.pages[o]||[]).map(function(e){return{d:e.d,t:e.t,r:e.r,h:e.h,font:n[e.f]?n[e.f]:void 0}}));return t},t.prototype.requestMetadata=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,i,r;return n.__generator(this,function(n){switch(n.label){case 0:e=g.makeTimer().time(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fetchDataForPage(0)];case 2:return t=n.sent(),[3,4];case 3:return i=n.sent(),401===i.jqXHR.status&&"1"===i.jqXHR.getResponseHeader("x-dropbox-pdf-password-needed")?w.indexOf(this.props.fileExtension)>-1?(r=o.createElement(c.PasswordModal,{onSubmit:this.submitPassword,onDismiss:this.dismissPassword,isFirstAttempt:this.isFirstPasswordAttempt}),l.Modal.showInstance(r),this.isFirstPasswordAttempt=!1,this.props.timelineCallbacks.onPasswordPrompt&&this.props.timelineCallbacks.onPasswordPrompt()):this.props.onError&&this.props.onError(s.ErrorType.PasswordProtectedError):this.props.onError&&this.props.onError(s.ErrorType.LoadError),[2];case 4:return t&&t.metadata&&t.metadata.page_count>0?(this.props.filePreviewSession&&(this.props.filePreviewSession.logSSREvent("metadata_succeeded"),this.props.filePreviewSession.ssrTiming.metadata=e.timeEnd().duration()),this.onMetadataLoad(t.metadata),this.setState({metadata:t.metadata,text:this.addPdfgenText(t.text),links:t.text&&(t.text.links||void 0)},this.props.onMetadataApplied),this.props.onLoad&&this.props.onLoad()):this.props.onError&&this.props.onError(s.ErrorType.LoadError),[2]}})})},t.prototype.componentDidMount=function(){f.eventEmitter.on("scrolled-to-page",this.onScrollToPage),f.eventEmitter.on("file-feedback-ui-ready",this.onFileFeedbackUIReady),f.eventEmitter.on("scroll-to-annotation",this.onScrollToAnnotation),f.eventEmitter.on("update-annotations",this.onUpdateAnnotations),f.eventEmitter.on("remove-all-annotations",this.onRemoveAllAnnotations),f.eventEmitter.on("enable-annotation-creation",this.onEnableAnnotationCreation),f.eventEmitter.on("disable-annotation-creation",this.onDisableAnnotationCreation),f.eventEmitter.on("enable-region-creation",this.onEnableRegionCreation),f.eventEmitter.on("disable-region-creation",this.onDisableRegionCreation),i("p, command+p, control+p","fileviewer",this.onPrintKeyPressed)},t.prototype.componentWillUnmount=function(){f.eventEmitter.off("scrolled-to-page",this.onScrollToPage),f.eventEmitter.off("file-feedback-ui-ready",this.onFileFeedbackUIReady),f.eventEmitter.off("scroll-to-annotation",this.onScrollToAnnotation),f.eventEmitter.off("update-annotations",this.onUpdateAnnotations),f.eventEmitter.off("remove-all-annotations",this.onRemoveAllAnnotations),f.eventEmitter.off("enable-annotation-creation",this.onEnableAnnotationCreation),f.eventEmitter.off("disable-annotation-creation",this.onDisableAnnotationCreation),f.eventEmitter.off("enable-region-creation",this.onEnableRegionCreation),f.eventEmitter.off("disable-region-creation",this.onDisableRegionCreation),i.unbind("p, command+p, control+p","fileviewer",this.onPrintKeyPressed),this.connectionPool.shutdown(),window.clearInterval(this.refreshIntervalId)},t.prototype.fetchDataForPage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,r,a,s=this;return n.__generator(this,function(n){switch(n.label){case 0:if(e%50!==0)throw new Error("invalid page lower bound");if(this.state.metadata&&this.state.metadata.page_count<=e)return[2,void 0];if(t=e+50,this.state.text&&this.state.text[e])return[3,4];o=this.state.urls.textUrl(0===e,e,t),n.label=1;case 1:return n.trys.push([1,3,,4]),i={dataType:"json",type:"GET",url:o,xhrFields:{withCredentials:!0},skipInjectCsrf:p.skipCsrfTokenInjection(o)},[4,this.connectionPool.request(i,function(t){s.inProgressPages[e]?t():s.inProgressPages[e]=!0})];case 2:return r=n.sent(),delete this.inProgressPages[e],[2,r];case 3:if(a=n.sent(),delete this.inProgressPages[e],401===a.jqXHR.status)throw a;return[3,4];case 4:return[2,void 0]}})})},t.prototype.refreshBlob=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,r,a=this;return n.__generator(this,function(n){switch(n.label){case 0:return(t=this.state.urls.refreshUrl())?(o={},i=function(){},void 0!==e&&(o={password:e},i=function(){return a.requestMetadata()}),[4,this.connectionPool.request({url:t,dataType:"json",type:"POST",data:o,skipInjectCsrf:p.skipCsrfTokenInjection(t)})]):[3,2];case 1:r=n.sent(),this.setState({urls:this.updateUrls(r)},i),n.label=2;case 2:return[2]}})})},t.prototype.updateUrls=function(e){return v(e)?new p.SsrUrlSet({imageUrl:e.image,textUrl:e.text,refreshUrl:e.refresh}):this.state.urls.newSetWithBlob(e.old_blob,e.new_blob)},t.prototype.render=function(){var e={annotations:this.state.annotations||[],isAnnotationCreationEnabled:!!this.state.isAnnotationCreationEnabled,isAnnotationRegionEnabled:!!this.state.isAnnotationRegionEnabled,isAnnotationHighlightEnabled:!!this.state.isAnnotationHighlightEnabled,frameMessenger:this.props.frameMessenger};return o.createElement(u.Viewer,{annotationProps:e,fileExtension:this.props.fileExtension,isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isToolbarVisible:this.props.isToolbarVisible,links:this.state.links,metadata:this.state.metadata,onExitFullscreen:this.props.onExitFullscreen,onPageImageLoad:this.onPageImageLoad,onPageRenderComplete:this.onPageRenderComplete,onPlaceholderImageLoad:this.props.timelineCallbacks.onPlaceholderImageLoad,placeholderImageUrl:this.placeholderImageUrl,printProps:this.props.printProps,sizeClass:this.props.sizeClass,text:this.state.text,urls:this.state.urls})},t})(o.PureComponent);t.App=_}),define("modules/clean/react/previews/pdf_viewer/connection_pool",["require","exports","tslib","modules/clean/ajax"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.inflightConnections=0,this.waitingConnections=[],this.maxConnections=e.maxConnections}return e.prototype.request=function(e,t){var n=this;return new Promise(function(o,i){n.waitingConnections.push({request:e,onBeforeExecute:t,resolve:o,reject:i}),n.maybeSendRequest()})},e.prototype.shutdown=function(){this.waitingConnections=[]},e.prototype.maybeSendRequest=function(){var e=this;if(0!==this.waitingConnections.length)for(var t=function(){var t=i.waitingConnections.pop();if(!t)return{value:void 0};if(t.onBeforeExecute){var r=!1,a=function(){return r=!0};if(t.onBeforeExecute(a),r)return"continue"}i.inflightConnections++,o.SilentBackgroundRequest(n.__assign({},t.request,{success:function(e){return t.resolve(e)},error:function(e,n,o){return t.reject({error:o,jqXHR:e})},complete:function(){e.inflightConnections--,e.maybeSendRequest()}}))},i=this;this.inflightConnections<this.maxConnections;){var r=t();if("object"==typeof r)return r.value}},e})();t.ConnectionPool=i}),define("modules/clean/react/previews/pdf_viewer/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventEmitter=new n}),define("modules/clean/react/previews/pdf_viewer/font",["require","exports"],function(e,t){"use strict";function n(e){var t=e.n.lastIndexOf(",");return{fontFamily:'"'+(t>-1?e.n.substr(0,t):e.n)+'", '+(1&e.f?"monospace":"serif"),isBold:(e.f&1<<18)>0,isItalic:(64&e.f)>0}}Object.defineProperty(t,"__esModule",{value:!0});t.renderFont=n}),define("modules/clean/react/previews/pdf_viewer/frame_messenger_shims",["require","exports","tslib","external/eventemitter3","modules/clean/frame_messenger/frame_messenger_client","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o,i,r){"use strict";function a(){return{parentEmitter:new o,childEmitter:new o}}Object.defineProperty(t,"__esModule",{value:!0});t.makeChannel=a;var s=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){this.handler=t,this.validActions=n},t.prototype.startListening=function(){this.channel.childEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.childEmitter.off("message",this.eventListener)},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={}),this.channel.parentEmitter.emit("message",{action:e,parameters:t})},t})(r.FrameMessengerHost);t.FrameMessengerHostShim=s;var l=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this.validActions=t,this.handler=e},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={}),this.channel.childEmitter.emit("message",{action:e,parameters:t})},t.prototype.startListening=function(){this.channel.parentEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.parentEmitter.off("message",this.eventListener)},t})(i.FrameMessengerClient);t.FrameMessengerClientShim=l}),define("modules/clean/react/previews/pdf_viewer/keyboard_bindings",["require","exports","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode"],function(e,t,n,o){"use strict";function i(e,n,o){var i=e?t.getLeftRightKeyboardBindings(n,o):[];return t.getPageUpPageDownKeyboardBindings(n,o).concat(t.getUpDownKeyboardBindings(n,o),i)}function r(e,i,r,a,s){var l=e?t.getUpDownKeyboardBindings(a,s):t.getUpDownKeyboardBindings(i,r),c=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:o.KeyCode.UP},callback:a}),p=n.hydrateKeyboardBinding({keyboardEventCriteria:{altKey:!0,which:o.KeyCode.DOWN},callback:s}),d=e?t.getLeftRightKeyboardBindings(a,s).slice():[];return l.concat([c,p],t.getPageUpPageDownKeyboardBindings(a,s),d)}function a(e,t,i){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.F},callback:i})].concat(n.getEqualsKeyBindings(e),n.getMinusKeyBindings(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.getLeftRightKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.LEFT},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.RIGHT},callback:t})]},t.getUpDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.DOWN},callback:t})]},t.getPageUpPageDownKeyboardBindings=function(e,t){return[n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.PAGE_UP},callback:e}),n.hydrateKeyboardBinding({keyboardEventCriteria:{which:o.KeyCode.PAGE_DOWN},callback:t})]},t.getPPTKeyboardBindings=i,t.getPDFKeyboardBindings=r,t.getViewerKeyboardBindings=a}),define("modules/clean/react/previews/pdf_viewer/links_layer",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/referrer_cleansing_redirect","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n,o,i,r,a){"use strict";function s(e){return!!e.ur}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.links.map(function(e,t){var n=e.a,l=e.r,c=l[0],p=l[1],d=l[2],u=l[3];u<0&&(p+=u,u=-u),d<0&&(c+=d,d=-d);var m={position:"absolute",bottom:p,left:c,width:d,height:u};return s(n)?n.ur.startsWith("mailto:")?o.createElement("a",{key:t,style:m,href:n.ur,"aria-label":i._("External Link")}):o.createElement("a",{key:t,style:m,href:r.get_redirect_uri(a.normalizeUrl(n.ur)).toString(),target:"_blank",rel:"noreferrer noopener","aria-label":i._("External Link")}):o.createElement("a",{key:t,style:m,href:"#pageContainer"+(n.pn+1),"aria-label":i._("Internal Link")})});return o.createElement("div",{className:"links-layer-inner"},e)},t})(o.PureComponent),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"links-layer",style:{position:"absolute",bottom:0,left:0,width:0,height:0,transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"}},o.createElement(l,{links:this.props.links}))},t})(o.PureComponent);t.LinksLayer=c}),define("modules/clean/react/previews/pdf_viewer/page",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/async/loadable","modules/clean/react/previews/pdf_viewer/annotation_creation_layer","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/links_layer","modules/clean/react/previews/pdf_viewer/annotation_view_layer","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,a,s,l,c,p,d,u){"use strict";var m=this;Object.defineProperty(t,"__esModule",{value:!0});var f=r.Loadable({loader:function(){return n.__awaiter(m,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,u.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,n){e(["modules/clean/react/previews/pdf_viewer/text_layer"],t,n)})];case 2:return t=n.sent().TextLayer,[2,t]}})})}}),g=(function(){function e(){this.imageLoad=new p.TimingStat,this.pageRender=new p.TimingStat}return e})(),h=(function(e){function t(t){var n=e.call(this,t)||this;return n.timingStats=new g,n.imageLoaded=!1,n.textRendered=!1,n.hasError=!1,n.imageElRef=function(e){return n.imageEl=e},n.onMouseDown=function(e){e.persist(),n.updateOffset(),n.annotationCreationDelegate.onMouseDownCallback(e)},n.onMouseMove=function(e){e.persist(),n.annotationCreationDelegate.onMouseMoveCallback(e)},n.onMouseUp=function(e){e.persist(),n.annotationCreationDelegate.onMouseUpCallback(e)},n.updateOffset=function(){var e=i.findDOMNode(n),t=e.getBoundingClientRect(),o=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||o.scrollTop,s=window.pageXOffset||r.scrollLeft||o.scrollLeft,l=r.clientTop||o.clientTop||0,c=r.clientLeft||o.clientLeft||0,p=t.top+a-l,d=t.left+s-c,u=t.right-t.left,m=t.bottom-t.top;n.setState({offset:{top:p,left:d,bottom:p+m,right:d+u}})},n.onScroll=function(){n.updateOffset(),n.annotationCreationDelegate.onScrollCallback()},n.onImageLoaded=function(){n.imageLoaded||(n.imageLoaded=!0,n.timingStats.imageLoad.timeEnd(),n.props.onImageLoad&&n.props.onImageLoad(n.props.pageData.pageIndex,n.timingStats.imageLoad),n.onTimingEventCompleted())},n.onTextRendered=function(){n.textRendered||(n.textRendered=!0,n.onTimingEventCompleted())},n.shouldMarkTimingEventCompleted=function(){return n.imageLoaded&&(n.props.loadImageOnly||n.textRendered)},n.onTimingEventCompleted=function(){n.shouldMarkTimingEventCompleted()&&(n.timingStats.pageRender.timeEnd(),n.props.onRenderComplete&&n.props.onRenderComplete(n.props.pageData.pageIndex,n.timingStats.pageRender))},n.onError=function(){n.hasError=!0,n.props.onImageError&&n.props.onImageError(n.props.pageData.pageIndex)},n.state={},n.annotationCreationDelegate={onMouseDownCallback:function(e){},onMouseMoveCallback:function(e){},onMouseUpCallback:function(e){},onScrollCallback:function(){}},n}return n.__extends(t,e),t.prototype.startTiming=function(){this.timingStats=new g,this.timingStats.imageLoad.time(),this.timingStats.pageRender.time()},t.prototype.componentWillMount=function(){this.startTiming()},t.prototype.componentDidMount=function(){s.eventEmitter.on("scroll",this.onScroll),this.updateOffset(),this.imageEl&&this.imageEl.complete&&!this.hasError&&this.onImageLoaded()},t.prototype.componentWillUnmount=function(){s.eventEmitter.off("scroll",this.onScroll)},t.prototype.componentWillUpdate=function(e,t){this.props.pageData.pageIndex!==e.pageData.pageIndex&&(this.imageLoaded=!1,this.textRendered=!1,this.hasError=!1,this.startTiming())},t.prototype.render=function(){var e=null,t=null,n=null,i=null,r=this.props.pageData.pageIndex+1,s="pageContainer"+r,p="pageImage"+r,u=d.calculatedFetchedScaleFactor(this.props.clientScaleFactor,{originalWidth:this.props.pageData.dimension[0],originalHeight:this.props.pageData.dimension[1]}),m=o.createElement("div",{className:"page-image-wrapper"},o.createElement("img",{ref:this.imageElRef,alt:"",key:p,width:"100%",role:"tabpanel","aria-hidden":"true",
src:this.props.urls.imageUrl(this.props.pageData.pageIndex,100*u),onLoad:this.onImageLoaded,onError:this.onError}));if(this.props.loadImageOnly||(e=o.createElement(f,{width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],textboxes:this.props.pageData.textboxes||[],clientScaleFactor:this.props.clientScaleFactor,onRender:this.onTextRendered}),t=o.createElement(l.LinksLayer,{width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],links:this.props.pageData.links||[],clientScaleFactor:this.props.clientScaleFactor})),this.props.annotationProps){var g=this.props.annotationProps;n=o.createElement(c.AnnotationViewLayer,{annotations:g.annotations||[],page:r,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,frameMessenger:g.frameMessenger});var h=g.isAnnotationCreationEnabled;this.props.annotationProps.isAnnotationCreationEnabled&&(i=o.createElement(a.AnnotationCreationLayer,{pageNumber:r,width:this.props.pageData.dimension[0],height:this.props.pageData.dimension[1],scaleFactor:this.props.clientScaleFactor,parentOffset:this.state.offset,delegate:this.annotationCreationDelegate,frameMessenger:g.frameMessenger,isAnnotationCreationEnabled:h,isAnnotationHighlightEnabled:g.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:g.isAnnotationRegionEnabled}))}var v=o.createElement("div",{className:"c-loader"}),w={width:this.props.pageData.dimension[0]*this.props.clientScaleFactor,height:this.props.pageData.dimension[1]*this.props.clientScaleFactor};return o.createElement("div",{id:s,className:"page","data-page-number":r,style:w,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp},v,i,n,m,e,t)},t})(o.PureComponent);t.Page=h}),define("modules/clean/react/previews/pdf_viewer/password_modal",["require","exports","tslib","external/classnames","external/react","modules/clean/react/input","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,o,i,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=function(e){n.setState({password:e.target.value})},n.onClickSubmit=function(){n.props.onSubmit(n.state.password)},n.onFormSubmit=function(e){e.preventDefault(),n.onClickSubmit(),n.modalInstance&&n.modalInstance.close()},n.modalRef=function(e){return n.modalInstance=e},n.state={password:""},n}return n.__extends(t,e),t.prototype.getMessage=function(){return this.props.isFirstAttempt?s._("Enter the password to open this file."):s._("The password you entered is incorrect, please try again.")},t.prototype.render=function(){var e=o({"db-modal-message":!0,"wrong-password":!this.props.isFirstAttempt});return i.createElement(a.Modal,{className:"password-modal",title:s._("This file is password protected"),acceptButtonText:s._("Submit"),dismissButtonText:s._("Cancel"),onAccept:this.onClickSubmit,onDismiss:this.props.onDismiss,style:"default-maestro",ref:this.modalRef},i.createElement("form",{method:"post",onSubmit:this.onFormSubmit},i.createElement("div",{className:e},this.getMessage(),i.createElement(r.password,{value:this.state.password,placeholder:s._("Password"),onChange:this.onChange}),i.createElement("input",{type:"submit",style:{display:"none"}}))))},t})(i.PureComponent);t.PasswordModal=l}),define("modules/clean/react/previews/pdf_viewer/pdf_viewer",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/core/browser","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/sidebar"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(t){var n=e.call(this,t)||this;return n.pageContainerRef=function(e){return n.pageContainerDOM=e},n.updateTextLayerPageIndex=function(){n.setState({textLayerPage:n.state.currentPage})},n.debouncedUpdateTextLayerPageIndex=i.debounce(n.updateTextLayerPageIndex,200),n.onScrollTopChange=function(e){if(void 0===e&&(e=function(e){}),n.props.metadata&&n.props.clientScaleFactor){c.eventEmitter.emit("scroll"),n.props.annotationProps&&n.props.annotationProps.frameMessenger.postMessageToParent("scroll");for(var t=n.pageContainerDOM.scrollTop+n.pageContainerDOM.clientHeight/2,o=0,i=n.props.clientScaleFactor,r=0,a=n.props.metadata.dimensions;r<a.length;r++){var s=a[r],l=(s[0],s[1]),p=s[2],d=(l*i+18)*p;if(!(t>d)){o+=Math.floor((t+1)/(l*i+18));break}t-=d,o+=p}o!==n.state.currentPage?n.onPageNumberUpdated(o,function(){return e(o)}):e(o)}},n.throttledOnScrollTopChange=i.throttle(n.onScrollTopChange,100),n.debouncedOnScrollTopChange=i.debounce(n.onScrollTopChange,200),n.maxScrollSpeed=100,n.onScroll=function(){var e=n.checkScrollSpeed();if(Math.abs(e)>n.maxScrollSpeed)return void n.debouncedOnScrollTopChange();n.throttledOnScrollTopChange(),n.debouncedUpdateTextLayerPageIndex()},n.lastPos=null,n.checkScrollSpeed=function(){var e=0,t=n.pageContainerDOM.scrollTop;return null!==n.lastPos&&(e=t-n.lastPos),n.lastPos=t,e},n.pageDown=function(){n.setPage(n.state.currentPage+1)},n.pageUp=function(){n.setPage(n.state.currentPage-1)},n.scrollDown=function(){n.setScrollTop(n.pageContainerDOM.scrollTop+60)},n.scrollUp=function(){n.setScrollTop(n.pageContainerDOM.scrollTop-60)},n.onSetCurrentPage=function(e){n.setPage(e,function(t){c.eventEmitter.emit("page-set-to",t,e)})},n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPage)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPage)},n.onPageUp=l.withPreventDefault(n.pageUp),n.onPageDown=l.withPreventDefault(n.pageDown),n.onScrollUp=l.withPreventDefault(n.scrollUp),n.onScrollDown=l.withPreventDefault(n.scrollDown),n.handleSidebarClick=function(e){n.setPage(e),n.focusSidebar()},n.fullScreenKeyboardBindings=p.getPDFKeyboardBindings(!0,n.onScrollUp,n.onScrollDown,n.onPageUp,n.onPageDown),n.sidebarFocusedKeyboardBindings=p.getPDFKeyboardBindings(!1,n.pageUp,n.pageDown,n.pageUp,n.pageDown),n.keyboardBindings=p.getPDFKeyboardBindings(!1,n.onScrollUp,n.onScrollDown,n.onPageUp,n.onPageDown),n.getKeyboardBindings=function(e,t){return e?n.fullScreenKeyboardBindings:t?n.sidebarFocusedKeyboardBindings:n.keyboardBindings},n.focusSidebar=function(){n.setState({isSidebarFocused:!0})},n.unfocusSidebar=function(){n.setState({isSidebarFocused:!1})},n.state={currentPage:0,textLayerPage:0,fetchedImageScaleFactor:0,isSidebarFocused:!1},n.isMobileOrTablet=a.is_mobile_or_tablet(),n.backwardBatchSize=n.isMobileOrTablet?1:3,n.forwardBatchSize=n.isMobileOrTablet?2:4,n}return n.__extends(t,e),t.prototype.onPageNumberUpdated=function(e,t){void 0===t&&(t=function(){}),this.setState({currentPage:e},t),c.eventEmitter.emit("scrolled-to-page",e)},t.prototype.setPage=function(e,t){if(void 0===t&&(t=function(e){}),!(e<0||e>=this.props.metadata.page_count)&&this.props.clientScaleFactor){for(var n=0,o=this.props.clientScaleFactor,i=0,r=this.props.metadata.dimensions;i<r.length;i++){var a=r[i],s=(a[0],a[1]),l=a[2];if(!(e>=l)){n+=(18+s*o)*e;break}n+=(18+s*o)*l,e-=l}this.setScrollTop(n,t)}},t.prototype.setScrollTop=function(e,t){void 0===t&&(t=function(e){}),this.pageContainerDOM.scrollTop=e,this.onScrollTopChange(t),this.updateTextLayerPageIndex()},t.prototype.getStartPage=function(e){return Math.max(0,e-this.backwardBatchSize)},t.prototype.getEndPage=function(e){return Math.min(this.props.metadata.page_count,e+this.forwardBatchSize)},t.prototype.componentDidMount=function(){c.eventEmitter.on("page-down",this.pageDown),c.eventEmitter.on("page-up",this.pageUp),c.eventEmitter.on("set-current-page",this.onSetCurrentPage)},t.prototype.componentWillReceiveProps=function(e){e.clientScaleFactor!==this.props.clientScaleFactor&&this.props.annotationProps&&u.resetAnnotationState(this.props.annotationProps.frameMessenger,this.pageContainerDOM),!e.isFullscreen&&e.isSidebarOpen||this.unfocusSidebar()},t.prototype.componentDidUpdate=function(e,t){if(this.pageContainerDOM&&this.props.clientScaleFactor&&e.clientScaleFactor&&this.props.clientScaleFactor!==e.clientScaleFactor){var n=this.pageContainerDOM.scrollTop,o=this.pageContainerDOM.scrollLeft,i=18*(this.state.currentPage+1),r=this.props.clientScaleFactor/e.clientScaleFactor;n>i&&(this.pageContainerDOM.scrollTop=(n-i)*r+i),o>18&&(this.pageContainerDOM.scrollLeft=(o-18)*r+18),this.maxScrollSpeed*=e.clientScaleFactor/this.props.clientScaleFactor}},t.prototype.componentWillUnmount=function(){c.eventEmitter.off("page-down",this.pageDown),c.eventEmitter.off("page-up",this.pageUp),c.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.getViewportDimensions=function(){if(this.pageContainerDOM){var e=this.pageContainerDOM.getBoundingClientRect();return{width:e.width-36,height:e.height}}},t.prototype.getViewport=function(){return this.pageContainerDOM},t.prototype.render=function(){var e,t,n=this,l=this.props,c=l.annotationProps,p=l.clientScaleFactor,f=l.isFullscreen,g=l.isSidebarOpen,h=l.onImageError,v=l.urls,w=this.state.isSidebarFocused,_=this.getStartPage(this.state.currentPage),b=this.getEndPage(this.state.currentPage),P=[];if(p){P=i.range(_,b).map(function(e){return r.createElement(d.Page,{key:e,pageData:n.props.pages[e],urls:v,clientScaleFactor:p,loadImageOnly:n.isMobileOrTablet,annotationProps:u.annotationsAtPage(c,e),onRenderComplete:n.onPageRenderComplete,onImageLoad:n.onPageImageLoad,onImageError:h})});var y=this.props.pages.map(function(e){return e.dimension}),E=_>0?u.getTotalSize(y.slice(0,_),p,18)[1]+18:0;e={height:u.getTotalSize(y,p,18)[1],margin:"auto"},t={top:E}}var S=this.getKeyboardBindings(!!f,w);return r.createElement("div",{className:"pdf-viewer"},r.createElement(s.KeyboardBindingConnector,{keyboardBindings:S}),g?r.createElement(m.Sidebar,{className:"pdf-viewer__sidebar",currentPageIndex:this.state.currentPage,pages:this.props.pages,isFocused:w,onClick:this.handleSidebarClick,onFocus:this.focusSidebar,onBlur:this.unfocusSidebar}):null,r.createElement("div",{className:o("viewer-container__sizer","page-container","pdf-viewer__pages",{"ios-enable-inertial-scroll":a.iOS}),onScroll:this.onScroll,ref:this.pageContainerRef},r.createElement("div",{style:e},r.createElement("div",{className:"page-container-inner",style:t},P))))},t})(r.PureComponent);t.PdfViewer=f}),define("modules/clean/react/previews/pdf_viewer/ppt_viewer",["require","exports","tslib","external/react","external/lodash","modules/core/browser","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/react/previews/pdf_viewer/sidebar"],function(e,t,n,o,i,r,a,s,l,c,p,d,u){"use strict";function m(){return!r.is_mobile_or_tablet()}Object.defineProperty(t,"__esModule",{value:!0});t.deviceSupported=m;var f=(function(e){function t(t){var n=e.call(this,t)||this;return n.slideContainerRef=function(e){return n.slideContainerDOM=e},n.handleWheel=function(e){e.deltaY>0?n.debouncedPageDown():e.deltaY<0&&n.debouncedPageUp()},n.onSetCurrentPage=function(e){n.setPage(e,function(){a.eventEmitter.emit("page-set-to",e,e)})},n.pageDown=function(){n.props.annotationProps&&l.resetAnnotationState(n.props.annotationProps.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex+1)},n.pageUp=function(){n.props.annotationProps&&l.resetAnnotationState(n.props.annotationProps.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex-1)},n.debouncedPageDown=i.debounce(n.pageDown,40,{leading:!0,trailing:!1}),n.debouncedPageUp=i.debounce(n.pageUp,40,{leading:!0,trailing:!1}),n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPageIndex)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPageIndex)},n.handleSidebarClick=function(e){n.setPage(e)},n.fullScreenKeyboardBindings=d.getPPTKeyboardBindings(!0,n.pageUp,n.pageDown),n.keyboardBindings=d.getPPTKeyboardBindings(!1,n.pageUp,n.pageDown),n.state={currentPageIndex:0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){a.eventEmitter.on("page-down",this.pageDown),a.eventEmitter.on("page-up",this.pageUp),a.eventEmitter.on("set-current-page",this.onSetCurrentPage),this.prefetchImageAroundPage(this.state.currentPageIndex)},t.prototype.componentWillUnmount=function(){a.eventEmitter.off("page-down",this.pageDown),a.eventEmitter.off("page-up",this.pageUp),a.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.getViewportDimensions=function(){if(this.slideContainerDOM)return this.slideContainerDOM.getBoundingClientRect()},t.prototype.getViewport=function(){return this.slideContainerDOM},t.prototype.prefetchImageAroundPage=function(e){for(var t=e+1;t<Math.min(e+5+1,this.props.pages.length);t++){var n=this.pageDimension(t);l.prefetchImage(this.props.urls.imageUrl(t,100*c.calculatedFetchedScaleFactor(this.props.clientScaleFactor||0,{originalWidth:n[0],originalHeight:n[1]})))}},t.prototype.setPage=function(e,t){void 0===t&&(t=function(){}),e<0||e>=this.props.pages.length||(this.setState({currentPageIndex:e},t),a.eventEmitter.emit("scrolled-to-page",e),this.prefetchImageAroundPage(e))},t.prototype.pageDimension=function(e){return this.props.pages[e].dimension},t.prototype.render=function(){var e=this.state.currentPageIndex,t=this.props,n=t.isFullscreen,i=t.isSidebarOpen,r=t.clientScaleFactor;return o.createElement("div",{className:"ppt-viewer"},o.createElement(p.KeyboardBindingConnector,{keyboardBindings:n?this.fullScreenKeyboardBindings:this.keyboardBindings}),i?o.createElement(u.Sidebar,{className:"ppt-viewer__sidebar",currentPageIndex:e,pages:this.props.pages,onClick:this.handleSidebarClick}):null,o.createElement("div",{className:"ppt-viewer__slide slide-container"},o.createElement("div",{className:"viewer-container__sizer",ref:this.slideContainerRef,onWheel:this.handleWheel},r?o.createElement(s.Page,{key:this.state.currentPageIndex,pageData:this.props.pages[e],urls:this.props.urls,clientScaleFactor:r,onRenderComplete:this.onPageRenderComplete,onImageLoad:this.onPageImageLoad,loadImageOnly:!1,annotationProps:l.annotationsAtPage(this.props.annotationProps,e),onImageError:this.props.onImageError}):null)))},t})(o.PureComponent);t.PowerPointViewer=f}),define("modules/clean/react/previews/pdf_viewer/sidebar",["require","exports","tslib","external/react","external/react-dom","external/classnames","spectrum/culled_list","modules/core/i18n","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n,o,i,r,a,s,l){"use strict";function c(e){return e.map(function(e){return p(e.dimension)+2*t.SIDEBAR_THUMBNAIL_BORDER+t.SIDEBAR_PAGE_NUMBER_FONT_HEIGHT+t.SIDEBAR_PAGE_NUMBER_MARGIN_BOTTOM})}function p(e){return l.scaleDimension(e,{maxWidth:t.SIDEBAR_THUMBNAIL_WIDTH})[1]}function d(e,t,n){var o=e.scrollTop,i=e.clientHeight,r=o+i,a=t.slice(0,n).reduce(function(e,t){return e+t},0);(a<o||a+t[n]>r)&&(e.scrollTop=a)}function u(e){var n=e.page,i=e.isSelected,a=e.topOffset,c=e.onClick,p=l.scaleDimension(n.dimension,{maxWidth:t.SIDEBAR_THUMBNAIL_WIDTH}),d=p[0],u=p[1],f=n.pageIndex,g=n.thumbnailUrl;return o.createElement("li",{className:r("sidebar__list-item","list-item",{"sidebar__list-item--selected":i}),style:{transform:"translateY("+a+"px)"}},o.createElement("a",{href:"#",onClick:c(f),tabIndex:-1},o.createElement(m,{style:{width:d+"px",height:u+"px"},className:"list-item__thumbnail",src:g,alt:s._("Page %(page_num)s").format({page_num:f+1}),role:"tab",loader:o.createElement("div",{className:"c-loader"})}),o.createElement("span",{className:"list-item__number"},f+1)))}Object.defineProperty(t,"__esModule",{value:!0}),t.SIDEBAR_WIDTH=184,t.SIDEBAR_THUMBNAIL_BORDER=4,t.SIDEBAR_PAGE_NUMBER_FONT_HEIGHT=16,t.SIDEBAR_PAGE_NUMBER_MARGIN_BOTTOM=16,t.SIDEBAR_THUMBNAIL_WIDTH=120;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoaded:!1},t.onLoad=function(e){var n=t.props.onLoad;n&&n(e),t.setState({isLoaded:!0})},t.onError=function(e){var n=t.props.onError;n&&n(e),t.setState({isLoaded:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.loader,i=e.className,a=e.style,s=n.__rest(e,["loader","className","style"]);return o.createElement("div",{className:i,style:a},o.createElement("img",n.__assign({},s,{onLoad:this.onLoad,onError:this.onError,className:r({hidden:!this.state.isLoaded})})),this.state.isLoaded?null:t)},t})(o.PureComponent),f=(function(e){function t(t){var n=e.call(this,t)||this;return n.onClickItem=function(e){return function(t){n.props.onClick&&n.props.onClick(e)}},n.handleResize=function(){n.setState({height:n.container.getBoundingClientRect().height})},n.state={height:0,itemHeights:c(t.pages)},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("resize",this.handleResize),this.handleResize(),d(this.list,this.state.itemHeights,this.props.currentPageIndex),this.container.focus()},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleResize)},t.prototype.componentWillReceiveProps=function(e){e.pages!==this.props.pages&&this.setState({itemHeights:c(e.pages)})},t.prototype.componentDidUpdate=function(e){var t=this.props.currentPageIndex;t!==e.currentPageIndex&&d(this.list,this.state.itemHeights,t)},t.prototype.render=function(){var e=this,t=this.props,n=t.className,s=t.pages,l=t.currentPageIndex,c=t.isFocused,p=t.onFocus,d=t.onBlur,m=this.state,f=m.height,g=m.itemHeights;return o.createElement("div",{className:r("sidebar",n,{"doc-preview-sidebar-focused":c}),ref:function(t){return e.container=t},role:"tablist",tabIndex:0,onFocus:p,onBlur:d},o.createElement(a.CulledList,{className:"sidebar__list",items:s,listItemHeight:g,ref:function(t){return e.list=i.findDOMNode(t)},renderRow:function(t,n,i){return o.createElement(u,{key:t.thumbnailUrl,page:t,isSelected:l===t.pageIndex,topOffset:i,onClick:e.onClickItem})},shouldUseWindowAsScrollContainer:!1,viewportHeight:f,itemBuffer:5}))},t.defaultProps={currentPageIndex:0,pages:[]},t})(o.PureComponent);t.Sidebar=f}),define("modules/clean/react/previews/pdf_viewer/timing",["require","exports"],function(e,t){"use strict";function n(){return i?window.performance.now():Date.now()}function o(){return new r}Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.OVERALL=0]="OVERALL",e[e.REQUEST=1]="REQUEST",e[e.RENDER=2]="RENDER"})(t.TimingEventType||(t.TimingEventType={}));var i=!(!window.performance||!window.performance.now),r=(function(){function e(){}return e.prototype.time=function(){return this.start=n(),this},e.prototype.timeEnd=function(){return void 0===this.end&&(this.end=n()),this},e.prototype.duration=function(){return this.end-this.start},e})();t.TimingStat=r,t.makeTimer=o}),define("modules/clean/react/previews/pdf_viewer/transform",["require","exports"],function(e,t){"use strict";function n(e,t,n){return n.map(function(e){return e.coordinates.map(function(e){return{x:e.x,y:t-e.y}})})}function o(e,t,n,o,i,r,a){return a.map(function(a){return{coordinates:a.map(function(e){return{x:(e.x-t)/r,y:i-(e.y-n)/r}}),page:e,page_size:{width:o,height:i}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.transformPdfCoordinates=n,t.transformViewportCoordinates=o}),define("modules/clean/react/previews/pdf_viewer/urls",["require","exports","modules/core/uri","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function i(e,t){return n.URI.parse(e).updateQuery(t).toString()}function r(e){return n.URI.parse(e).getAuthority().toLocaleLowerCase().indexOf("dropbox.com")<0}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){var t=e.imageUrl,n=e.textUrl,o=e.refreshUrl;this.useCanned=!1,this.imageUrlTmpl=t,this.textUrlTmpl=n,this.refreshUrlString=o}return e.prototype.setUseCannedFile=function(){this.useCanned=!0},e.prototype.imageUrl=function(e,t){void 0===t&&(t=0);var n={page:e.toString()};o.SVG_PDF_PREVIEW&&t>0?n.format="svg":n.scale_percent=t.toString();var r=i(this.imageUrlTmpl,n);return this.useCanned&&(r=i(r,{canned_file_name:"spdf/audi.pdf."+e+".png"})),r},e.prototype.textUrl=function(e,t,n){var o=this.textUrlTmpl;return e&&(o=i(o,{metadata:"1"})),void 0!==t&&(o=i(o,{text:"1",page_start:""+t,page_end:""+n})),this.useCanned&&(o=i(o,{canned_file_name:"spdf/audi.pdf.json"})),o},e.prototype.refreshUrl=function(){return this.refreshUrlString},e.prototype.newSetWithBlob=function(t,n){return new e({imageUrl:this.imageUrlTmpl.replace(t,n),textUrl:this.textUrlTmpl.replace(t,n),refreshUrl:this.refreshUrlString?this.refreshUrlString.replace(t,n):void 0})},e})();t.SsrUrlSet=a,t.updateQueryParam=i,t.skipCsrfTokenInjection=r}),define("modules/clean/react/previews/pdf_viewer/utils",["require","exports","tslib","modules/clean/react/previews/constants","modules/clean/react/previews/pdf_viewer/event_emitter"],function(e,t,n,o,i){"use strict";function r(e){if(g===e)return h;var t=[];return e.forEach(function(e){for(var n=e[0],o=e[1],i=e[2],r=0;r<i;r++)t.push([n,o])}),g=e,h=t,t}function a(e,t,n){return e.map(function(e){return[e[0]*t,e[1]*t]}).reduce(function(e,t){var o=e[0],i=e[1],r=t[0],a=t[1];return[Math.max(o,r),i+n+a]},[0,0])}function s(e,t){for(var n=r(e),o=[],i=0;i<n.length;i++){var a=n[i],s=a[0],l=a[1];o.push(t(i,s,l))}return o}function l(e){(new Image).src=e}function c(e,t){if(e.postMessageToParent("annotation-hidden"),i.eventEmitter.emit("resize"),t){var n=document,o=window.getSelection?window.getSelection():n.selection;if(o){var r=o.anchorNode,a=o.focusNode;t.contains(r)&&t.contains(a)&&(window.getSelection?window.getSelection().removeAllRanges():n.selection&&n.selection.empty())}}}function p(e,t){if(e)return n.__assign({},e,{annotations:e.annotations[t]||[]})}function d(e){return"http"===e.substr(0,4)?e:"http://"+e}function u(e){return!!e&&new RegExp("^"+o.HYPERLINK_REGEX_STRING+"$","i").test(e)}function m(e){return new RegExp("^"+o.EMAIL_REGEX_STRING+"$","i").test(e)}function f(e,t){void 0===t&&(t={});var n=e[0],o=e[1],i=t.maxWidth,r=t.maxHeight;if(void 0!==i&&void 0!==r){var a=Math.min(i/n,r/o);return[a*n,a*o]}return void 0!==i?[i,i/n*o]:void 0!==r?[r/o*n,r]:e}Object.defineProperty(t,"__esModule",{value:!0});var g,h;t.expandDimensions=r,t.getTotalSize=a,t.mapPages=s,t.prefetchImage=l,t.resetAnnotationState=c,t.annotationsAtPage=p,t.normalizeUrl=d,t.isHyperlink=u,t.isEmailAddress=m,t.scaleDimension=f}),define("modules/clean/react/previews/pdf_viewer/viewer",["require","exports","tslib","external/classnames","external/lodash","external/react","spectrum/snackbar","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/sidebar_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/keyboard_bindings","modules/clean/react/previews/pdf_viewer/pdf_viewer","modules/clean/react/previews/pdf_viewer/placeholder_image","modules/clean/react/previews/pdf_viewer/sidebar","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n","modules/clean/react/file_viewer/constants","modules/clean/react/previews/pdf_viewer/ppt_viewer","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,m,f,g,h,v,w,_,b,P,y,E,S){"use strict";var C=this;Object.defineProperty(t,"__esModule",{value:!0});var M=l.Loadable({loader:function(){return n.__awaiter(C,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,w.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,n){e(["modules/clean/react/previews/pdf_viewer/print_modal"],t,n)})];case 2:return t=n.sent().PrintModal,[2,t]}})})}}),F=(function(e){function t(t){var n=e.call(this,t)||this;return n.viewerRef=function(e){return n.viewer=e},n.iframeRef=function(e){e&&e.contentWindow&&(e.contentWindow.addEventListener("load",n.onResize),e.contentWindow.addEventListener("resize",n.onResize))},n.onResize=function(){n.props.metadata&&(n.props.annotationProps&&E.resetAnnotationState(n.props.annotationProps.frameMessenger,n.containerDOM),n.viewer&&n.fitToContainer(n.props.metadata.dimensions,n.getViewportDimensions(),n.state.fittingMode))},n.zoomIn=function(){var e=Math.min(1.1*n.state.clientScaleFactor,10);n.setState({clientScaleFactor:e}),n.setFittingMode(S.FittingMode.NONE)},n.zoomOut=function(){var e=Math.max(n.state.clientScaleFactor/1.1,.1);n.setState({clientScaleFactor:e}),n.setFittingMode(S.FittingMode.NONE)},n.enterFullscreen=function(){n.props.isFullscreen||c.enterFullScreen(!0,P.UserActionContext.Keyboard)},n.onFirstPageError=function(){n.setState({firstPageFailed:!0})},n.onError=function(e){n.setState({error:e})},n.onImageError=function(){n.setState({error:b._("Some pages failed to load")})},n.onReload=function(){_.reload(!0)},n.onDismissError=function(){n.setState({error:void 0})},n.onPageRenderComplete=function(e,t,o){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,o),n.setState({pageRendered:!0})},n.state={fittingMode:n.props.isFullscreen?S.fullscreenFittingMode():s.isPptExtension(t.fileExtension)?S.FittingMode.FIT_PAGE:S.FittingMode.FIT_TO_WIDTH},n.keyboardBindings=f.getViewerKeyboardBindings(n.zoomIn,n.zoomOut,n.enterFullscreen),n}return n.__extends(t,e),t.prototype.getViewportDimensions=function(){return this.viewer&&this.viewer.getViewportDimensions()||this.containerDOM&&this.containerDOM.getBoundingClientRect()},t.prototype.setFittingMode=function(e){this.setState({fittingMode:e})},t.prototype.isSidebarOpen=function(e,t){void 0===t&&(t=this.props);var n=t.isSidebarOpen,o=t.sizeClass,i=t.isFullscreen;return p.isSidebarEnabled(e,o,!!i)&&(n||{})[e]},t.prototype.fitToContainer=function(e,t,n){if(n!==S.FittingMode.NONE&&t){var o=t.width,i=t.height;this.setState({clientScaleFactor:S.computeClientScaleFactor(n,e,i,o)})}},t.prototype.componentDidMount=function(){m.eventEmitter.on("zoom-in",this.zoomIn),m.eventEmitter.on("zoom-out",this.zoomOut),m.eventEmitter.on("error",this.onError),this.props.metadata&&this.viewer&&this.fitToContainer(this.props.metadata.dimensions,this.getViewportDimensions(),this.state.fittingMode)},t.prototype.componentWillUnmount=function(){m.eventEmitter.off("zoom-in",this.zoomIn),m.eventEmitter.off("zoom-out",this.zoomOut),m.eventEmitter.off("error",this.onError)},t.prototype.componentWillReceiveProps=function(e){var t=this.state.fittingMode;this.props.isFullscreen!==e.isFullscreen&&(t=e.isFullscreen?S.fullscreenFittingMode():s.isPptExtension(e.fileExtension)?S.FittingMode.FIT_PAGE:S.FittingMode.FIT_TO_WIDTH,this.setState({fittingMode:t}))},t.prototype.componentDidUpdate=function(e){var t=s.isPptExtension(this.props.fileExtension)?P.DocType.ppt:P.DocType.pdf,n=this.getViewportDimensions();!this.props.metadata||!n||this.state.clientScaleFactor&&this.isSidebarOpen(t,e)===this.isSidebarOpen(t)||this.fitToContainer(this.props.metadata.dimensions,n,this.state.fittingMode)},t.prototype.renderErrorSnackbar=function(){if(!this.state.error)return null;var e={"pdf-snackbar":!0,"pdf-snackbar__toolbar-visible":this.props.isToolbarVisible};return r.createElement(a.Snackbar,{className:o(e),title:this.state.error,variant:"fail",disablePositioningAndBackdrop:!0},r.createElement(a.SnackbarAction,{onClick:this.onReload},"Reload"),r.createElement(a.SnackbarAction,{onClick:this.onDismissError},"Close"))},t.prototype.renderViewer=function(){var e=this,t=this.props.links||{},o=this.props,a=o.annotationProps,l=o.fileExtension,c=o.isFullscreen,p=o.metadata,d=o.onPageImageLoad,u=o.text,m=o.sizeClass,f=o.urls;if(p&&u){var h={annotationProps:a,clientScaleFactor:this.state.clientScaleFactor,isFullscreen:c,onImageError:this.onImageError,onPageImageLoad:d,onPageRenderComplete:this.onPageRenderComplete,urls:f,sizeClass:m},w=E.expandDimensions(p.dimensions),_=i.range(0,p.page_count).map(function(n){return{pageIndex:n,dimension:w[n],textboxes:u[n],links:t[n]||[],thumbnailUrl:e.props.urls.imageUrl(n,Math.ceil(200*v.SIDEBAR_THUMBNAIL_WIDTH/w[n][0]))}});return s.isPptExtension(l)&&y.deviceSupported()?r.createElement(y.PowerPointViewer,n.__assign({isSidebarOpen:this.isSidebarOpen(P.DocType.ppt),pages:_,ref:this.viewerRef},h)):r.createElement(g.PdfViewer,n.__assign({isSidebarOpen:this.isSidebarOpen(P.DocType.pdf),metadata:p,pages:_,ref:this.viewerRef},h))}return null},t.prototype.renderCloseFullscreenButton=function(){return this.props.isFullscreen?r.createElement("div",{className:"close-x"},r.createElement("button",{onClick:this.props.onExitFullscreen,className:"close-x-button","aria-label":b._("Close")},"")):null},t.prototype.renderPlaceholder=function(){var e=this.props.placeholderImageUrl;return this.state.pageRendered||!e||this.state.firstPageFailed?null:r.createElement(h.PlaceholderImage,{url:e,onError:this.onFirstPageError,onLoad:this.props.onPlaceholderImageLoad})},t.prototype.render=function(){var e=this,t=this.renderViewer(),n=s.isPptExtension(this.props.fileExtension)?P.DocType.ppt:P.DocType.pdf,i=this.renderCloseFullscreenButton(),a={"preview-ssr-viewer":!0,"region-creation":this.props.annotationProps&&this.props.annotationProps.isAnnotationRegionEnabled,"fit-page":this.state.fittingMode===S.FittingMode.FIT_PAGE,"fit-to-width":this.state.fittingMode===S.FittingMode.FIT_TO_WIDTH,"single-page-scroll":S.defaultScrollMode(this.props.fileExtension)===S.ScrollMode.SINGLE_PAGE,"continuous-scroll":S.defaultScrollMode(this.props.fileExtension)===S.ScrollMode.CONTINUOUS,fullscreen:this.props.isFullscreen},l={"viewer-container":!0,"sidebar-visible":this.isSidebarOpen(n)},c=null,p=this.renderPlaceholder(),m=this.state.pageRendered?null:r.createElement(u.LoadingIndicator,{className:"loading-indicator"}),f=this.props.metadata&&this.props.printProps?r.createElement(M,{urls:this.props.urls,metadata:this.props.metadata,printProps:this.props.printProps}):null;return t&&(c=r.createElement("iframe",{"aria-hidden":"true",ref:this.iframeRef,style:{position:"absolute",left:0,bottom:0,top:0,width:"100%",zIndex:-1e3,opacity:0}})),r.createElement("div",{className:o(a)},m,p,c,i,r.createElement(d.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement("div",{className:o(l),style:{visibility:this.state.pageRendered?"visible":"hidden"},ref:function(t){return e.containerDOM=t}},t),this.renderErrorSnackbar(),f)},t})(r.PureComponent);t.Viewer=F}),define("modules/clean/react/previews/pdf_viewer/zoom",["require","exports","modules/clean/previews/util","modules/core/browser"],function(e,t,n,o){"use strict";function i(){return c.FIT_PAGE}function r(e){return n.isPptExtension(e)&&!o.is_mobile_or_tablet()?u.SINGLE_PAGE:u.CONTINUOUS}function a(e,t,n,o){var i=1;if(e===c.FIT_PAGE){for(var r=0,a=0,s=0,l=t;s<l.length;s++){var p=l[s],u=p[0],m=p[1];a=Math.max(u,a),r=Math.max(m,r)}i=Math.min(n/r,o/a)}else e===c.FIT_TO_WIDTH&&(i=o/t[0][0]);return Math.min(i,d)}function s(e,t){return 2048/Math.max(e,t)}function l(e,t){if(t){var n=t.originalHeight;if(s(t.originalWidth,n)>e)return 0}for(var o=0,i=p;o<i.length;o++){var r=i[o];if(r>=e)return r}return d}Object.defineProperty(t,"__esModule",{value:!0});var c,p=[1,2,4],d=Math.max.apply(Math,p);(function(e){e[e.NONE=0]="NONE",e[e.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",
e[e.FIT_PAGE=2]="FIT_PAGE"})(c=t.FittingMode||(t.FittingMode={}));var u;(function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.SINGLE_PAGE=1]="SINGLE_PAGE"})(u=t.ScrollMode||(t.ScrollMode={})),t.fullscreenFittingMode=i,t.defaultScrollMode=r,t.computeClientScaleFactor=a,t.calculatedFetchedScaleFactor=l}),define("modules/clean/react/previews/preview_pdf",["require","exports","tslib","external/lodash","external/react","modules/clean/web_timing_logger","modules/clean/previews/util","modules/clean/react/previews/pdf_viewer/app","modules/clean/react/previews/pdf_viewer/frame_messenger_shims","modules/clean/react/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/frame_interface","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,o,i,r,a,s,l,c,p,d,u,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.onError=function(e){e===c.ErrorType.LoadError&&n.onDownloadFailed(),n.props.onError&&n.props.onError(e)},n.onDownloadAttempted=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadAttempted)},n.onDownloadSucceeded=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadSucceeded)},n.onMetadataLoad=function(e){n.setState({metadata:e})},n.onDownloadFailed=function(){n.logFilePreviewEvent(p.EventType.FilePreviewDownloadFailed)},n.onFirstRenderSucceeded=function(){n.markPrimaryEvent(),n.logFilePreviewEvent(p.EventType.FilePreviewRenderSucceeded),n.props.setRenderStatusSuccess()},n.onPlaceholderImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("placeholder_loaded")},n.onFirstImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("first_image_loaded")},n.onPasswordPrompt=function(){n.markPrimaryEvent()},n.sendIdleMouse=o.debounce(function(){n.frameMessengerClient.postMessageToParent("idle-mouse")},1500),n.onMouseMove=o.throttle(function(){n.frameMessengerClient.postMessageToParent("active-mouse"),n.sendIdleMouse()},16),n.onToolbarShow=function(){n.setState({isToolbarVisible:!0})},n.onToolbarHide=function(){n.setState({isToolbarVisible:!1})},n.onLoad=function(){n.frameMessengerClient.postMessageToParent("viewer-ready"),n.props.onLoad&&n.props.onLoad()},n.state={isToolbarVisible:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.props.filePreviewSession&&(this.props.filePreviewSession.isSSR=!0),this.logFilePreviewEvent(p.EventType.FilePreviewSupportConfirmed),this.frameMessengerChannel=l.makeChannel(),this.frameMessengerHost=new l.FrameMessengerHostShim(this.frameMessengerChannel),this.frameMessengerClient=new l.FrameMessengerClientShim(this.frameMessengerChannel),this.frameMessengerClient.configureParentMessaging(function(e){return f.eventEmitter.emit(e.action,e.parameters)},["open-file","page-up","page-down","file-feedback-ui-ready","update-annotations","enable-annotation-creation","disable-annotation-creation","enable-region-creation","disable-region-creation","zoom-in","zoom-out","print","remove-all-annotations","scroll-to-annotation"]),this.frameMessengerClient.startListening(),d.FileViewerFrameInterface.setFrameMessengerFactory(function(){return new l.FrameMessengerHostShim(e.frameMessengerChannel)}),this.props.invalidateFrameMessenger&&this.props.invalidateFrameMessenger()},t.prototype.componentWillUnmount=function(){d.FileViewerFrameInterface.setFrameMessengerFactory(void 0)},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markPrimaryEvent=function(){r.mark_time_to_view(),r.mark_time_to_interactive(),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent()},t.prototype.canPrint=function(){var e=this.props,t=e.fileHref,n=e.sharePermission;return!(null!=t&&n&&n.canPrintRoles&&0===n.canPrintRoles.length)},t.prototype.getPrintProps=function(){return{canPrint:this.canPrint(),isSharedLink:this.props.isSharedLink||!1,fileBlockServerUrl:this.props.src,fileHref:this.props.fileHref}},t.prototype.renderPreviewContent=function(){var e=new m.SsrUrlSet({imageUrl:this.props.imageUrl,textUrl:this.props.textUrl,refreshUrl:this.props.refreshUrl});return this.props.forceTestPdf&&e.setUseCannedFile(),i.createElement(s.App,{fileExtension:this.props.fileExtension,filePreviewSession:this.props.filePreviewSession,frameMessenger:this.frameMessengerClient,isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isToolbarVisible:this.state.isToolbarVisible,key:e.refreshUrl(),onError:this.onError,onExitFullscreen:g.exitFullScreen,onLoad:this.onLoad,onMetadataLoad:this.onMetadataLoad,previewThumbnailUrl:this.props.previewThumbnailUrl,printProps:this.getPrintProps(),sizeClass:this.props.sizeClass,timelineCallbacks:{onDownloadAttempted:this.onDownloadAttempted,onDownloadSucceeded:this.onDownloadSucceeded,onFirstRenderSucceeded:this.onFirstRenderSucceeded,onPlaceholderImageLoad:this.onPlaceholderImageLoad,onFirstImageLoad:this.onFirstImageLoad,onPasswordPrompt:this.onPasswordPrompt},urls:e})},t.prototype.render=function(){var e=this.props,t=e.fileExtension,n=e.isArchiveFile,o=e.isFullscreen,r=e.isSidebarOpen,s=e.onCloseViewer,l=e.sharePermission,c=e.shouldDisableAnnotations,d=e.sizeClass,m=this.state.metadata,f=a.isPptExtension(t)?p.DocType.ppt:p.DocType.pdf;return i.createElement("div",{className:"preview-content preview-pdf preview-pdf-ssr",onMouseMove:this.onMouseMove,onTouchStart:this.onMouseMove,onTouchMove:this.onMouseMove},this.renderPreviewContent(),m?i.createElement(u.PreviewToolbarContainer,{forceDisableRegionAnnotation:c,isSidebarOpen:!!r[f],isFullscreen:o,previewToolbarProps:{afterFileViewerExit:s,docType:f,isArchiveFile:n,fileExtension:t,isFullscreen:o,sharePermission:l,pagesCount:m.page_count,shouldDisplayRegionCreationButton:!1,frameMessenger:this.frameMessengerHost,onToolbarShow:this.onToolbarShow,onToolbarHide:this.onToolbarHide,sizeClass:d}}):null)},t})(i.PureComponent);t.PreviewPDF=h});
//# sourceMappingURL=pkg-file_viewer_pdf.min.js-vflh5AdrO.map