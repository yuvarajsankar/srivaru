define("modules/clean/groups/api",["require","exports","jquery","modules/clean/ajax","modules/clean/contacts/cache_store","modules/clean/viewer"],function(e,t,o,n,i,r){"use strict";function s(){}function a(e,t){return void 0===e&&(e={}),void 0===t&&(t=function(){return{}}),b({method:"get_groups_for_user",data:e,success:t})}function l(e,t){return void 0===e&&(e={}),void 0===t&&(t=function(){return{}}),b({method:"get_group_info",data:e,success:t})}function c(e,t){return void 0===t&&(t=function(){return{}}),b({method:"get_users_in_group",data:e,success:t})}function d(e,t){return void 0===t&&(t=function(){return{}}),b({method:"make_new_group",data:e,success:t,reload_contacts:!0})}function u(e,t){return void 0===t&&(t=function(){return{}}),b({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})}function _(e,t){return void 0===t&&(t=function(){return{}}),b({method:"remove_group",data:e,success:t,reload_contacts:!0})}function p(e,t,o){return void 0===o&&(o=function(){return{}}),b({method:"rename_group",data:e,success:t,error:o,reload_contacts:!0})}function h(e,t){return void 0===t&&(t=function(){return{}}),b({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})}function m(e,t){return void 0===t&&(t=function(){return{}}),b({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})}function f(e,t){return void 0===t&&(t=function(){return{}}),b({method:"change_group_member_type",data:e,success:t})}function g(e,t){return void 0===t&&(t=function(){return{}}),b({method:"make_group_join_request",data:e,success:t})}function b(e){var t="/groups_ajax/"+e.method,s=e.reload_contacts||!1,a=function(t){var n=JSON.parse(t);if(n.ok&&(e.success(n.data),o(".error_msg").hide()),s){i.DefaultContactsCacheStore.getOrCreateForViewer().load_contacts(!0)}},l=function(t){var n=t.responseText;e.error&&(e.error(n.slice(4)),o(".error_msg").hide())};return n.WebRequest({url:t,type:"post",data:e.data,subject_user:r.Viewer.get_viewer().work_user,success:a,error:l})}Object.defineProperty(t,"__esModule",{value:!0});t.ready=s,t.get_groups_for_user=a,t.get_group_info=l,t.get_users_for_group=c,t.create_group=d,t.create_group_with_users=u,t.remove_group=_,t.rename_group=p,t.add_users_to_group=h,t.remove_user_from_group=m,t.change_group_member_type=f,t.make_group_join_request=g,t.metaserver_ajax=b}),define("modules/clean/growth/shared_link_signup_modals",["require","exports","jquery","modules/clean/analytics","modules/clean/auth_event_logger","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/legacy_pyxl_controllers/login_form","modules/clean/register_form","modules/clean/sharing/signup_modal_proxy","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,o,n,i,r,s,a,l,c,d,u,_){"use strict";return(function(){function e(e){var t=this;this.handle_direct_download=function(e){t.direct_download_override_callback=e},this.handle_direct_download_cancel=function(e){t.on_direct_download_cancel=e},this.handle_default_modal_authenticate=function(e){t.on_default_modal_authenticate=e},this.handle_default_modal_cancel=function(e){t.on_default_modal_cancel=e},this.init_modals=this.init_modals.bind(this),this.before_signup_modal=this.before_signup_modal.bind(this),this.before_default_signup_modal=this.before_default_signup_modal.bind(this),this.before_download_signup_modal=this.before_download_signup_modal.bind(this),this.before_create_password_modal=this.before_create_password_modal.bind(this),this.show_welcome_modal=this.show_welcome_modal.bind(this),this.show_create_password_modal=this.show_create_password_modal.bind(this),this.on_request_direct_download=this.on_request_direct_download.bind(this),this.on_request_default_signup=this.on_request_default_signup.bind(this),this.direct_download=this.direct_download.bind(this),this.save_to_dropbox=this.save_to_dropbox.bind(this),this.show_login_form=this.show_login_form.bind(this),this.register_success=this.register_success.bind(this),this.kind=e,this.init_modals(),c.signupModalProxy.connectModal(this),"immediate"===this.kind&&(n.WebMiscActivityLogger.log("signup_modal-show-upfront",{auth_google:null!=o.find(".auth-google")}),this.default_signup_modal.show()),"download"!==this.kind?(o("#download_button_link, #default_content_download_button").click(this.direct_download),this.has_seen_modal=!0):o("#download_button_link, #default_content_download_button").click(function(){return t.has_seen_modal?t.direct_download():(t.has_seen_modal=!0,n.WebMiscActivityLogger.log("signup_modal-show-download",{auth_google:null!=o.find(".auth-google")}),t.download_type="direct_download",t.download_signup_modal.show())}),o(".add_to_my_dropbox_link, #default_content_a2md").click(function(){return t.download_type="add_to_dropbox",t.download_signup_modal.show()})}return e.prototype.init_modals=function(){var e=this;return this.default_signup_modal=new r.DBModal({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.default_signup_modal.on_hide=function(){if(!e._has_authenticated)return void(e.on_default_modal_cancel&&e.on_default_modal_cancel())},this.download_signup_modal=new r.DBModal({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.download_signup_modal.on_hide=function(){if(!e._direct_download_started)return void(e.on_direct_download_cancel&&e.on_direct_download_cancel())},this.welcome_modal=new r.DBModal({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new r.DBModal({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},e.prototype.before_signup_modal=function(e){var t=this;e.find(".toggle-form-link").click(function(){return t.toggle_form(e)});var o=e.find(".register-form");o.length&&(o.on(l.RegisterForm.NEW_ACCOUNT_FROM_3RD_PARTY,function(o,n){return t.profile_info=n,t.show_create_password_modal(e,t.profile_info)}),o.on(l.RegisterForm.USER_EXISTS,function(o){return t.show_login_form(e,o)}),o.on(l.RegisterForm.REGISTER_SUCCESS,function(e,o){return t.user_info=o,t.register_success(t.user_info)}));var n=e.find(".login-form");if(n.length)return n.on(a.LOGIN_SUCCESS,function(e,o){return t.user_info=o,_.Notify.success(u._("Successfully signed in to Dropbox")),t.download_type?"direct_download"===t.download_type?(t.direct_download(),t.reload()):"add_to_dropbox"===t.download_type?t.save_to_dropbox(!1):void 0:t.reload()})},e.prototype.before_default_signup_modal=function(e){var t=this;return this.before_signup_modal(e),e.find(".close-link").click(function(){return t.default_signup_modal.hide()})},e.prototype.before_download_signup_modal=function(e){var t=this;return this.before_signup_modal(e),this._direct_download_started=!1,"add_to_dropbox"===this.download_type&&(e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(){return t.direct_download(),t.download_signup_modal.hide()})},e.prototype.before_create_password_modal=function(e){var t=this;return e.find(".close-link").click(function(){return t.create_password_modal.hide()}),e.find(".create-password-form-component").find(".register-form").on(l.RegisterForm.REGISTER_SUCCESS,function(e,o){return t.user_info=o,t.register_success(t.user_info)})},e.prototype.before_welcome_modal=function(e){return s.log("sharing","shared_link_welcome_modal_view"),e.find(".go-to-dropbox-button").click(function(){return s.log("sharing","shared_link_welcome_modal_button_click")}),e.find(".welcome-modal-no-thanks a").click(function(){return d.reload()})},e.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},e.prototype.show_create_password_modal=function(e,t){this.default_signup_modal.hide(),this.download_signup_modal.hide();var o={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token};return this.create_password_modal.show("input[name=password]",o)},e.prototype.on_request_direct_download=function(){if(this.has_seen_modal)return this.direct_download();this.has_seen_modal=!0,n.WebMiscActivityLogger.log("signup_modal-show-download",{auth_google:null!=o.find(".auth-google")}),this.download_type="direct_download",this.download_signup_modal.show()},e.prototype.on_request_default_signup=function(){this.download_type="add_to_dropbox",this._has_authenticated=!1,this.default_signup_modal.show()},e.prototype.direct_download=function(){if(this._direct_download_started=!0,this.direct_download_override_callback)return void this.direct_download_override_callback();var e=d.get_uri().updateQuery({dl:1});return d.redirect(e)},e.prototype.reload=function(){return d.reload()},e.prototype.save_to_dropbox=function(e){if(this.on_default_modal_authenticate)return this.on_default_modal_authenticate(this.user_info.id),this._has_authenticated=!0,void this.default_signup_modal.hide()},e.prototype.show_login_form=function(e,t){var o=e.find(".login-form-component"),n=o.find(".login-form");for(var i in t.prefill){var r=t.prefill[i];n.find(i).val(r)}if(n.find(t.focus).focus(),!o.is(":visible"))return this.toggle_form(e,!0)},e.prototype.toggle_form=function(e,t){var n=e.find(".register-form-component"),r=e.find(".login-form-component");return n.is(":visible")?(i.AuthEventLogger.log_web_login_intent(),n.fadeOut({complete:function(){if(r.show(),null!=t)return setTimeout(function(){return o(r.find(".login-form .login-password input[name='login_password']")[0]).focus()},0)}})):r.fadeOut({complete:function(){return n.show()}})},e.prototype.register_success=function(e){return _.Notify.success(u._("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.direct_download(),this.show_welcome_modal()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},e})()}),define("modules/clean/legacy_pyxl_controllers/bubble_picker",["require","exports","jquery","modules/clean/keycode"],function(e,t,o,n){"use strict";var i=(function(){function e(e){this._listen=this._listen.bind(this),this.set_value=this.set_value.bind(this),this.hide_dropdown=this.hide_dropdown.bind(this),this.show_dropdown=this.show_dropdown.bind(this),this.disable_option=this.disable_option.bind(this),this.enable_option=this.enable_option.bind(this),this._on_option_mouseenter=this._on_option_mouseenter.bind(this),this._on_option_keydown=this._on_option_keydown.bind(this),this._on_button_keydown=this._on_button_keydown.bind(this),this.$bubble_picker=e,this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label_wrapper.on("keydown",this._on_button_keydown),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this.$options=this.$bubble_picker.find("*[role='option']"),this.$options.on("mouseenter",this._on_option_mouseenter),this.$options.on("keydown",this._on_option_keydown),this._dropdown_shown=!1,this._listen()}return e.initClass=function(){this.CHANGED="db:bubblepicker:changed"},e.prototype._listen=function(){var t=this;return o(document).click(function(e){var n=o(e.target).closest(t.$label_wrapper).length>0,i=o(e.target).closest(t.$dropdown).length>0;return t._dropdown_shown&&!i?t.hide_dropdown():n?t.show_dropdown():void 0}),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(n){n.preventDefault();var i=o(n.currentTarget);if(!i.hasClass("disabled")){var r=t.get_value();return t.set_value(i.data("value")),t.$bubble_picker.trigger(e.CHANGED,{clicked_val:i.data("value"),old_val:r}),t.hide_dropdown(),t.$label_wrapper.focus()}})},e.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},e.prototype.set_value=function(e){this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),this.$bubble_picker.find(".bubble-picker-option--selected").removeClass("bubble-picker-option--selected");var t=this.$bubble_picker.find("[data-value='"+e+"']").addClass("bubble-picker-option--selected");return this.$label.html(t.clone().html())},e.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this.$label_wrapper.attr("aria-expanded",!1),this._dropdown_shown=!1},e.prototype.show_dropdown=function(){var e;this.$dropdown.show(),this.$label_wrapper.attr("aria-expanded",!0),this._dropdown_shown=!0,this.$options.attr({tabindex:-1,"aria-selected":!1});var t=this.$bubble_picker.attr("data-selected-value");return e=t?this.$bubble_picker.find(".bubble-picker-option[data-value='"+t+"']")[0]:this.$bubble_picker.find(".bubble-picker-option")[0],o(e).attr({tabindex:0,"aria-selected":!0}).focus()},e.prototype.disable_option=function(e,t){var n=this.$bubble_picker.find(".bubble-picker-option[data-value="+e+"]:not('.disabled')");if(n.length>0){var i=o(n.find(".role-option"));i.attr("saved-title",i.attr("title")),i.attr("title",t),i.attr("aria-disabled",!0)}return n.addClass("disabled")},e.prototype.enable_option=function(e){var t=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+e+"]"),n=o(t.find(".role-option"));return n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),n.attr("aria-disabled",!1),t.removeClass("disabled")},e.prototype._change_focus=function(e,t){return o(e).attr({tabindex:-1,"aria-selected":!1}),o(t).attr({tabindex:0,"aria-selected":!0}).focus()},e.prototype._focus_previous=function(e){var t=this.$options.index(e);if(t>0)return this._change_focus(e,this.$options.get(t-1))},e.prototype._focus_next=function(e){var t=this.$options.index(e);if(t<this.$options.length-1)return this._change_focus(e,this.$options.get(t+1))},e.prototype._on_option_mouseenter=function(e){return this.$dropdown.removeClass("bubble-picker-dropdown--keyboard")},e.prototype._on_option_keydown=function(e){this.$dropdown.addClass("bubble-picker-dropdown--keyboard"),e.keyCode===n.KeyCode.ESC?(this.hide_dropdown(),this.$label_wrapper.focus()):e.keyCode===n.KeyCode.DOWN?(this._focus_next(e.target),e.preventDefault()):e.keyCode===n.KeyCode.UP?(this._focus_previous(e.target),e.preventDefault()):e.keyCode!==n.KeyCode.TAB||e.shiftKey||this.hide_dropdown()},e.prototype._on_button_keydown=function(e){e.keyCode===n.KeyCode.ENTER?this.$dropdown.addClass("bubble-picker-dropdown--keyboard"):e.keyCode===n.KeyCode.TAB&&e.shiftKey&&this.hide_dropdown()},e})();return i.initClass(),i}),define("modules/clean/legacy_pyxl_controllers/role_picker",["require","exports","tslib","external/lodash","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer","modules/core/controller_helpers","modules/core/exception"],function(e,t,o,n,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c={ALL:"all",PERSONAL:"personal",WORK:"work"};t.RolePickerState=c;var d=(function(){function e(e){null==e&&(e={}),this.get_state=this.get_state.bind(this),this.set_state=this.set_state.bind(this),this.ensure_role_is_visible=this.ensure_role_is_visible.bind(this),this.is_role_visible=this.is_role_visible.bind(this),this.is_user_visible=this.is_user_visible.bind(this),this._do_login=this._do_login.bind(this),this._actually_set_state=this._actually_set_state.bind(this),this._allow_merged_state=null==e.allow_merged_state||e.allow_merged_state,this._limit_to_role=null!=e.limit_to_role?e.limit_to_role:null;var t=s.Viewer.get_viewer(),o=t.is_role_signed_in(c.PERSONAL)&&t.is_role_signed_in(c.WORK);if(e.initial_state){var i=n.values(c);l.assert(Array.from(i).includes(e.initial_state),"RolePicker requires initial_state to be one of: "+i),this.set_state(e.initial_state)}else if(this._allow_merged_state&&o)this.set_state(c.ALL);else{var r=t.get_users();l.assert(r.length,"tried to use RolePicker on a page with no users");var a=r[0];this.set_state(a.role)}}return e.prototype.get_state=function(){return this._state},e.prototype.set_state=function(e){var t;if(l.assert(this._allow_merged_state||e!==c.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&l.assert(e===c.ALL||e===this._limit_to_role,"some awful assert about roles"),e===c.ALL){for(var o=0,n=["personal","work","photos"];o<n.length;o++)if(t=n[o],!s.Viewer.get_viewer().is_role_signed_in(t))return void this._do_login(t,e)}else if(t=e,!s.Viewer.get_viewer().is_role_signed_in(t))return void this._do_login(t,e);return this._actually_set_state(e)},e.prototype.update_picker_ui=function(){},e.prototype.ensure_role_is_visible=function(e){if(!this.is_role_visible(e))return this._allow_merged_state?this.set_state(c.ALL):this.set_state(e)},e.prototype.is_role_visible=function(e){return this._state===c.ALL||this._state===e},e.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},e.prototype._do_login=function(e,t){var o=this;return i.show_modal({role:e,on_success:function(){return o._actually_set_state(t)}})},e.prototype._actually_set_state=function(e){if(e!==this._state)return this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0},e})();t.RolePicker=d;var u=(function(e){function t(t,o){var n=this;return null==o&&(o={}),t.find(".bubble-picker").on("db:bubblepicker:changed",function(e,t){n.on_ui_change(e,t)}),n=e.call(this,o)||this,n.on_ui_change=n.on_ui_change.bind(n),n.update_picker_ui=n.update_picker_ui.bind(n),n.limit_to_role=n.limit_to_role.bind(n),n.$container=t,n.$bubble_picker=n.$bubble_picker,n}return o.__extends(t,e),t.prototype.on_ui_change=function(e,t){var o=t.clicked_val;if(o!==this._state)return a.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(o)},t.prototype.update_picker_ui=function(){return a.get_controller(this.$bubble_picker).set_value(this._state)},t.prototype.limit_to_role=function(e,t){var o,n;if(null!=e){this.ensure_role_is_visible(e);for(o in c)n=c[o],n!==e&&n!==c.ALL&&a.get_controller(this.$bubble_picker).disable_option(n,t)}else for(o in c)n=c[o],a.get_controller(this.$bubble_picker).enable_option(n);return this._limit_to_role=e},t})(d);t.RoleSelect=u;var _=(function(e){function t(t,o){return null==o&&(o={}),o.allow_merged_state=!1,e.call(this,t,o)||this}return o.__extends(t,e),t.prototype.on_state_change=function(e){var t=(function(){switch(e){case c.PERSONAL:return"personal";case c.WORK:return"work"}})();return r.emit(t)},t})(u);t.PageRoleSelect=_}),define("modules/clean/react/file_sidebar/comments_wrapper_component",["require","exports","external/react","modules/clean/activity/constants","modules/clean/comments/action_creators","modules/clean/react/css","modules/clean/comments/components/file_comments_pane_container"],function(e,t,o,n,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){var t=e.activityContext,r=e.commentsDisabledOnFile,a=e.currentFile,l=e.sharedLinkInfo,c=e.shouldInitiallyFocusInput,d=e.user,u=d?d.id:void 0,_=null;switch(t){case n.ActivityContext.BROWSE_FILE_VIEWER:_=a.fq_path;break;case n.ActivityContext.SHARED_CONTENT_LINK_VIEW:case n.ActivityContext.SHARED_LINK_VIEW:l&&(_=l.url)}return o.createElement("div",{className:"react-file-viewer__activity"},o.createElement(s,{actionCreators:i,actorId:u,commentsDisabledOnFile:r,context:t,contextData:_,currentFile:a,previewSelector:".react-file-viewer__preview .flex-preview-container",shouldInitiallyFocusInput:c,showToggleButton:!1}))},l=["/static/css/comments-vfla7c47a.css","/static/css/comments_annotations-vflT6HX_-.css","/static/css/file_comments_pane-vflMEOpSG.css"];t.CommentsWrapperComponent=r(a,l)}),define("modules/clean/react/file_viewer/container",["require","exports","tslib","external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/open_in_app/actions","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/clean/react/file_viewer/data/store","modules/clean/web_timing_logger","modules/constants/file_viewer"],function(e,t,o,n,i,r,s,a,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(t){function _(e){var o=t.call(this,e)||this;o.onCloseViewer=function(){return window.open(o.props.onCloseUrl,"_self")};var n=l.Viewer.get_viewer(),r=e.userId?n.get_user_by_id(e.userId):n.work_user||n.personal_user;o.state={user:r},d.log_js_modules_application_code_start();var s=o.props.sharedLinkInfo?[o.props.sharedLinkInfo]:[],a=o.props.shareToken?[o.props.shareToken]:[],_=o.props.sharePermission?[o.props.sharePermission]:[],p={sharedLinkInfos:s,shareTokens:a,sharePermissions:_,disableFlipping:!1},h=e.file;u.REDUX_FILE_VIEWER||i.setup([h],0,p);var m=c.getStoreForFileViewer();return c.hydrateFileViewerNamespace(m,{file:h}),o}return o.__extends(_,t),_.prototype.componentWillUnmount=function(){u.REDUX_FILE_VIEWER||i.cleanup()},_.prototype.componentDidMount=function(){var t=this,o=this.props.shareEmail;if(o&&this.state.user&&new Promise(function(t,o){e(["modules/clean/react/browse/models"],t,o)}).then(function(e){var n=e.File;a.asyncShowPrefilledShareModal({user:t.state.user,sharePrefillEmail:o,content:new n(t.props.file)})}),this.props.openImmediatelyInApp){var n=this.props.file;s.openImmediately(n.open_in_app_data)}},_.prototype.render=function(){var e=this.props,t=e.fileViewerProps,i=e.onCloseUrl,s=e.isEmbedded,a=e.sharedLinkInfo,l=e.shareToken,c=e.sharePermission;null!=i&&(t.onCloseViewer=this.onCloseViewer);var d=n.createElement(r.FileViewer,o.__assign({},t,{fileCount:1,fileIndex:0,sharedLinkInfo:a,shareToken:l,sharePermission:c,user:this.state.user,transparentBackground:!0}));return s?n.createElement("div",{className:"embedded"},d):d},_})(n.Component);t.FileViewerContainer=_}),define("modules/clean/react/share_sync/actions",["require","exports","modules/clean/multiaccount_login","modules/clean/viewer","modules/clean/sharing/shared_content_link_mount_folder"],function(e,t,o,n,i){"use strict";function r(e,t,r){new Promise(function(e,i){n.Viewer.get_viewer().is_role_signed_in(t)?e():o.show_modal({role:t,on_success:function(){e()}})}).then(function(){i.mountSharedFolder(e,t,r)})}Object.defineProperty(t,"__esModule",{value:!0}),t.syncToDropbox=r}),define("modules/clean/react/share_sync/button",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/share_sync/models","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/sync_coachmark","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n","modules/constants/payments"],function(e,t,o,n,i,r,s,a,l,c,d,u,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.options.map(function(e){return n.createElement(r.BubbleMenuItem,{onClick:function(){return e.handler()},disabled:e.isDisabled},n.createElement(d,{group:"web",name:e.spriteName,text:e.text}))});return n.createElement(r.BubbleMenu,{targetButton:this.props.targetButton,position:r.BubbleMenu.POSITIONS.BOTTOM,verticalDisplacement:4,items:e})},t})(n.Component),m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.onClickedOption=function(e,t){e.preventDefault(),t.handler()},t.prototype.getSyncOptions=function(){var e=this,t=this.props.sharePermission.canSyncToDropboxRoles,o=u.Viewer.get_viewer();return t.map(function(t){return s.ShareSyncActionOption.buildOption(e.props.folder,o,t,l.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE)})},t.prototype.renderSyncCoachmark=function(){var e=this.props.sharePermission.canSyncToDropboxRoles.length>0;return this.props.showSyncCoachmark&&e?n.createElement("div",{className:"sync-button__coachmark-container"},n.createElement(c.SharingSyncCoachmark,null)):null},t.prototype.renderSyncButton=function(){var e=this;if(""!==this.props.shareToken.subPath)return null;if(0===this.props.sharePermission.canSyncToDropboxRoles.length)return null;var t="button-primary control__button sync-button";if(this.props.outOfQuota){var o=p.OUT_OF_SPACE_URL+"?oqa=wb_oq_pre_fo_up_b";return n.createElement("a",{className:t,href:o},_._("Upgrade to Add Folder"))}var r=void 0;if(this.props.user&&this.props.user.is_cdm_member){var s=i.filename(this.props.user.cdm_tmf_path);r=s.length>25?_._("Add to my member folder"):a.reactFormat(_._("Add to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:s,strong:n.createElement("strong",{style:{fontWeight:800}})})}else r=_._("Add to Dropbox");var l=this.getSyncOptions();if(1===l.length)return n.createElement("button",{className:t,style:{display:"-webkit-box"},onClick:function(t){return e.onClickedOption(t,l[0])}},r);var c=n.createElement("button",{className:t},r);return n.createElement(h,{targetButton:c,folder:this.props.folder,shareToken:this.props.shareToken,options:l})},t.prototype.render=function(){return n.createElement("div",null,this.renderSyncCoachmark(),this.renderSyncButton())},t})(n.Component);t.ShareSyncButton=m}),define("modules/clean/react/share_sync/models",["require","exports","tslib","external/immutable","external/react","modules/clean/filepath","modules/clean/react/share_sync/actions","modules/clean/react_format","modules/core/i18n"],function(e,t,o,n,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c={text:void 0,handler:void 0,isDisabled:!1,spriteName:void 0},d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.buildOption=function(e,o,n,c){var d=l._("Save to my Dropbox"),u="dropbox",_=o.get_user_by_role(n);if(_&&_.is_cdm_member){var p=r.filename(_.cdm_tmf_path);d=p.length>12?l._("Save to my member folder"):a.reactFormat(l._("Save to <strong>%(cdm_tmf_name)s</strong> folder"),{cdm_tmf_name:p,strong:i.createElement("strong",null)}),o.is_paired&&(u="s_briefcase")}else if(o.is_paired)switch(n){case"personal":d=l._("Save to personal Dropbox"),u="s_house";break;case"work":d=l._("Save to %(team_name)s Dropbox").format({team_name:o.team_name}),u="s_briefcase"}return new t({text:d,handler:function(){s.syncToDropbox(e.shared_folder_id,n,c)},spriteName:u})},t})(n.Record(c));t.ShareSyncActionOption=d}),define("modules/clean/sharing/notifications",["require","exports","jquery","modules/clean/browse_interface","modules/clean/sharing/api/client","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,o,n,i,r,s,a,l,c,d){"use strict";function u(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){var t=o(e).closest("form");return u(t.closest(".sc-invite-action"),function(e){return e.addClass("loading")}),t.length&&new i.ShareApiClient({userId:t[0]._subject_uid.value}).dismissInviteNotification({contentId:t[0].content_id.value}).finally(function(){return t.closest(".sc-invite-action").removeClass("loading"),t.closest(".feed-row").remove()}),!1};t.register_dismiss=_;var p=function(e){var t=o(e);t.closest(".sc-invite-action").addClass("loading");var a=s.Viewer.get_viewer().get_user_by_id(e._subject_uid.value);return new i.FolderShareApiClient({userId:a.id}).mount({contentId:e.sf_id.value,origin:"NOTIFICATION_WEB"}).then(function(e){t.closest(".sc-invite-action").addClass("sf-mounted");var o=e.path_lower,i=new d.URI({path:n.get_browse_root(a)+o}).toString();return l.redirect(i),r.sharingNotificationSuccess(c._("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))}).finally(function(){return t.closest(".sc-invite-action").removeClass("loading")}),!1};t.register_mount=p;var h=function(){r.sharingNotificationInfo(c._("Continue upgrading to add the shared folder to your Dropbox."));var e=a.BUY_URL,t=new d.URI({scheme:"https",authority:"www.dropbox.com",path:e});return t.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),l.redirect(t.toString()),!1};t.upgrade_to_mount=h}),define("modules/clean/sharing/views/sync_coachmark",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/react/bubble","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,o,n,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=c.i18n_default_project("sharing")._,u=(function(e){function t(){var t=e.call(this)||this;return t.hideSyncCoachmark=function(){t.setState({show:!1})},t.state={show:!0},t}return o.__extends(t,e),t.prototype.componentWillMount=function(){i.BackgroundRequest({url:"/sharing/seen_sync_coachmark"})},t.prototype.render=function(){return this.state.show?n.createElement(r,{arrow:r.ARROW.TOP_RIGHT,className:"sync-coachmark u-pad-s"},n.createElement(a.Image,{className:"u-l-ib",src:l.static_url("/static/images/sharing/sync_coachmark-vflyzarQZ.png"),srcHiRes:l.static_url("/static/images/sharing/sync_coachmark@2x-vflMrQ12G.png")}),n.createElement("div",{className:"u-l-ib u-pad-left-s sync-coachmark__content"},n.createElement("h2",null,d("Stay in sync")),n.createElement("p",null,d("For easy access to this folder in the future, add it to your Dropbox.")),n.createElement("button",{className:"c-btn c-btn--secondary",onClick:this.hideSyncCoachmark},d("Got it")))):n.createElement("div",null)},t.displayName="SharingSyncCoachmark",t})(n.Component);t.SharingSyncCoachmark=s(u,["/static/css/sharing/sync_coachmark-vfl_8vkAL.css"])}),define("modules/clean/teams/limited_team_invite_form",["require","exports","tslib","external/classnames","external/react","external/react-dom-factories","modules/core/uri","modules/core/i18n","modules/clean/react_format","modules/clean/ajax","modules/clean/analytics","modules/clean/css","modules/clean/contacts/contact_token_state","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/react/input","modules/core/browser"],function(e,t,o,n,i,r,s,a,l,c,d,u,_,p,h,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=m.textarea,b=(function(){function e(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}return e.prototype.whenReady=function(e){this.inFlight?this.callbacks.push(e):e()},e.prototype.resultArrived=function(e,t){if(this.inFlight){this.inFlight=!1,this.canInvite=e,this.reason=t;for(var o=0,n=this.callbacks;o<n.length;o++){(0,n[o])()}this.callbacks=[]}},e})(),v=(function(){function e(e){var t=this;this.checkEmails=function(e,o){var n={},i=e.length;if(0===i)return o(n);for(var r=[],s=function(e){var s=t.checkedEmails[e];s||(s=t.checkedEmails[e]=new b,r.push(e)),s.whenReady(function(){n[e]=s,0===--i&&o(n)})},a=0,l=e;a<l.length;a++){s(l[a])}(function(e){c.WebRequest({url:t.checkUrl,data:{emails:e.join(",")},success:function(e){var o=JSON.parse(e);for(var n in o)if(o[n]){var i=o[n],r=i.can_invite,s=i.reason;t.checkedEmails[n]&&t.checkedEmails[n].resultArrived(r,s)}},error:function(){for(var o=0,n=e;o<n.length;o++){var i=n[o];delete t.checkedEmails[i]}}})})(r)},this.getEmailCheckResult=function(e){return t.checkedEmails[e]},this.checkUrl=e,this.checkedEmails={}}return e})();t.InvitationContexts={existingTeam:{id:"existingTeam",checkUrl:"/team/manage/check_can_invite"},createLimitedTeam:{id:"createLimitedTeam",checkUrl:"/team/create_limited/check_can_invite"}};var w={};for(var y in t.InvitationContexts)if(t.InvitationContexts[y]){var k=t.InvitationContexts[y],C=k.id,x=k.checkUrl;w[C]=new v(x)}var S=(function(e){function c(t){var o=e.call(this,t)||this;return o._isUnMounted=!1,o.getContacts=function(){return o.refs.tokenizer.getContacts()},o.getFinalData=function(e){var t;o.refs.tokenizer.tokenizeAll();var n=o.getContacts()
;o.props.includeCustomMessage&&(t=o.refs.customMessage.getValue()),o._ensureContactsStateUpdated(n,function(){var i=n.filter(function(e){return e.type===h.EMAIL}),r=i.map(function(e){return e.email});o._updateErrorMessage(function(){d.TeamsWebActionsLogger.log("suggest_members_entered_email_error",{error_message:o.state.errorMessage,url:f.get_href()})}),e({emails:r,custom_message:t})})},o.areAllContactsValid=function(){if(o._overInviteLimit())return!1;var e=o.refs.tokenizer.serializeInputData().tokens;return 0===e.length||e.every(function(e){return o._validateContact(e).state===_.ContactTokenState.ok})},o.isEmpty=function(){var e=o.refs.tokenizer.serializeInputData(),t=e.tokens,n=e.value;return 0===t.length&&0===n.length},o._ensureContactsStateUpdated=function(e,t){e=e.filter(function(e){return e.type===h.EMAIL&&!e.invalid&&!e.on_team});var n=e.map(function(e){return e.email});o.state.emailCheckerStore.checkEmails(n,function(){o._isUnMounted||t()})},o._validateContact=function(e){var t;if(e.invalid)t={state:_.ContactTokenState.invalid,msg:a._("Invalid email.")};else if(e.on_team)t={state:_.ContactTokenState.invalid,msg:a._("User is already a member of this team.")};else{var n=o.state.emailCheckerStore.getEmailCheckResult(e.email),i=null;n?n.inFlight?t={state:_.ContactTokenState.pending,msg:i}:n.canInvite?t={state:_.ContactTokenState.ok,msg:i}:("team_member"===n.reason?i=a._("This person is already on another team."):"already_on_this_team"===n.reason?i=a._("User is already invited to this team."):"error"===n.reason&&(i=a._("User isn’t eligible to join this team.")),t={state:_.ContactTokenState.invalid,msg:i}):t={state:_.ContactTokenState.invalid,msg:i}}return t},o._overInviteLimit=function(){var e=o.refs.tokenizer.serializeInputData().tokens;return void 0!==o.props.memberInviteLimit&&e.length>o.props.memberInviteLimit},o._updateErrorMessage=function(e){for(var t=0,n=o.refs.tokenizer.serializeInputData().tokens;t<n.length;t++){var i=n[t],c=o._validateContact(i),d=c.state,u=c.msg;if(d!==_.ContactTokenState.ok)return void o.setState({errorMessage:u},e)}if(o._overInviteLimit()){var p={tk:String(o.props.maxTeamSize),_camp:"invite"},h=new s.URI({path:"/team/upgrade",query:p});return void o.setState({errorMessage:l.reactFormat(a.ungettext("You have %(num_rem)s invite remaining. <upgradeLink>Upgrade</upgradeLink> now to add as   many members as you like to your team.","You have %(num_rem)s invites remaining. <upgradeLink>Upgrade</upgradeLink> now to add as   many members as you like to your team.",o.props.memberInviteLimit),{num_rem:o.props.memberInviteLimit,upgradeLink:r.a({href:h.toString()})})},e)}o.setState({errorMessage:null})},o.onContentsChange=function(e,t){o._ensureContactsStateUpdated(e,function(){o._updateErrorMessage(),o.props.onChange&&o.props.onChange()})},o._customContactFilter=function(e){return!(e.type!==h.EMAIL||e.team||!e.name||e.email===o.props.user.email)},o.state={errorMessage:null,emailCheckerStore:o.props.emailCheckerStore||w[o.props.invitationContext.id]},o}return o.__extends(c,e),c.prototype.componentWillMount=function(){var e=this;u.require_css("/static/css/teams/limited_team_invite_form-vflcSjpys.css"),u.require_css("/static/css/react/contacts_tokenizer-vflQsfYaG.css"),this.props.populatedContacts&&this.props.populatedContacts.length>0&&this._ensureContactsStateUpdated(this.props.populatedContacts,function(){e._updateErrorMessage(),e.props.onChange&&e.props.onChange()})},c.prototype.componentDidUnMount=function(){this._isUnMounted=!0},c.prototype.render=function(){var e,t={"limited-team-invite-form":!0,"error-message-fixed":this.props.errorMessageSpaceFixed,"has-custom-message":this.props.includeCustomMessage};return this.props.includeCustomMessage&&(e=i.createElement(g,{ref:"customMessage",className:"custom-message","disable-errors":!0,placeholder:this.props.messagePlaceholder,value:this.props.populatedCustomMessage})),i.createElement("div",{className:n(t,this.props.customClass)},i.createElement("div",{className:"error-message u-mar-bottom-xss"},this.props.customErrorMessage||this.state.errorMessage),i.createElement(p.ContactsTokenizer,{ref:"tokenizer",user:this.props.user,placeholder:this.props.emailPlaceholder,onContentsChange:this.onContentsChange,autofocus:this.props.autofocusTokenizer,populatedInputData:{tokens:this.props.populatedContacts,value:""},tokenSpacing:this.props.tokenSpacing,customContactValidator:this._validateContact,customContactFilter:this._customContactFilter}),e)},c.displayName="LimitedTeamInviteForm",c.defaultProps={customClass:"",invitationContext:t.InvitationContexts.existingTeam,populatedContacts:[],emailPlaceholder:a._("Name or email"),messagePlaceholder:a._("Add a message (optional)"),includeCustomMessage:!0,autofocusTokenizer:!0},c})(i.Component);t.LimitedTeamInviteForm=S}),define("modules/clean/top_notif",["require","exports","jquery","modules/clean/ajax"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={HIDE_EVENT:"db:topnotificationbar:hide",show:function(){(e=document.body.classList).add.apply(e,["top-notification-bar","has-top-notification"]);var e},hide:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o("#top-notification-bar-container").remove(),o(".top-notification-bar-silo").remove(),(n=document.body.classList).remove.apply(n,["top-notification-bar","has-top-notification"]),o(".embedded-app.IndexRebrandPage.top-notification-bar").removeClass("top-notification-bar"),o(".maestro #notify-wrapper.with-top-notification").removeClass("with-top-notification"),o(document).trigger(this.HIDE_EVENT);var n},hideById:function(e){document.querySelector(".top-notification-bar-container #"+e)&&i.hide()}};t.TopNotificationBar=i;var r={init:function(){return i.show(),o(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_eu_cookie_notification"})})}};t.EUCookieNotificationBar=r;var s={init:function(){return i.show(),o(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_expired_ios_notification"})})}};t.ExpiredIOSNotificationBar=s;var a={init:function(){return i.show(),o("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_locale_switch_banner"})})}};t.LocaleSwitchBar=a;var l={init:function(){return i.show(),o("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_super_inactive_recover_bar"})})}};t.SuperInactiveRecoverBar=l;var c={init:function(){return i.show(),o("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_browser_msg"})})}};t.UnsupportedBrowser=c;var d={init:function(e){return i.show(),o(".expired-dismiss").on("click",function(t){return t.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_expired_cc_notification",data:{source:e}})})}};t.ExpiredCCNotificationBar=d;var u={init:function(e){return i.show(),o(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),i.hide(),n.SilentBackgroundRequest({url:"/dismiss_beta_locale_notification",data:{source:e}})})}};t.BetaLocaleNotificationBar=u});
//# sourceMappingURL=pkg-legacy-aa.min.js-vflVr0DJr.map