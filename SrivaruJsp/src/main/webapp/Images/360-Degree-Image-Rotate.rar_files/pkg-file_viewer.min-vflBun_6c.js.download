define("modules/clean/activity/activity_user",["require","exports","tslib","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,o=void 0===n?null:n,r=t.fname,a=void 0===r?null:r,s=t.lname,l=void 0===s?null:s,c=t.display_name,u=void 0===c?null:c,d=t.email,p=void 0===d?null:d,m=t.photo_url,h=void 0===m?null:m,f=t.photo_circle_url,v=void 0===f?null:f,_=t.initials,g=void 0===_?null:_,y=t.is_email_verified,w=void 0!==y&&y,b=t.is_signed_in,C=void 0!==b&&b;this.id=o,this.fname=a,this.lname=l,this.display_name=u,this.email=p,this.photo_url=h,this.photo_circle_url=v,this.initials=g,this.is_email_verified=w,this.is_signed_in=C,i(this)}return e.fromDict=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?c.Emstring.em_snippet(this.display_name,22):null!=this.email?c.Emstring.em_snippet(this.email,22):s._("Anonymous user")},e.__anonymous=new e,n.__decorate([o.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:a.Maybe(String),photo_circle_url:a.Maybe(String)})],e,"fromDict",null),e})();t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/annotations/annotation",["require","exports"],function(e,t){"use strict";function n(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var i={MARKER:0,HIGHLIGHT:1,REGION:2};t.AnnotationTypes=i;var o={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}};t.AnnotationSubtypes=o;var r=(function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n=new e;return n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=t.viewportCoordinates?t.viewportCoordinates:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e={type:this.type,subtype:this.subtype};return this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===i.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){switch(this.type){case i.MARKER:var e=this.getFirstViewportCoordinates();return{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case i.HIGHLIGHT:return this._getViewportBoundingRectangle();case i.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var o=this.getBoundingBox();return o.left=o.left-n,o.right=o.right-n,o.top=o.top-i,o.bottom=o.bottom-i,o.top=Math.min(Math.max(o.top,0),t-1),o.right=Math.min(Math.max(o.right,0),e-1),o.bottom=Math.min(Math.max(o.bottom,0),t-1),o.left=Math.min(Math.max(o.left,0),e-1),o},e.prototype._getViewportBoundingRectangle=function(){for(var e,t,n=e=this.getFirstViewportCoordinates().x,i=t=this.getFirstViewportCoordinates().y,o=0,r=Array.from(this.viewportCoordinates);o<r.length;o++)for(var a=r[o],s=0,l=Array.from(a);s<l.length;s++){var c=l[s];n=Math.min(n,c.x),e=Math.max(e,c.x),i=Math.min(i,c.y),t=Math.max(t,c.y)}return{top:i,right:e,bottom:t,left:n}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){return n(null!=this.image_coordinates?this.image_coordinates[0].coordinates:void 0,function(e){return e[0]})},e.prototype.getFirstPdfCoordinates=function(){return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=this.pdf_coordinates[0].coordinates?this.pdf_coordinates[0].coordinates[0]:void 0},e.prototype.getFirstPdfPage=function(){return this.isOldCoordinatesFormat()?null!=this.pdf_coordinates?this.pdf_coordinates.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===i.MARKER?this.annotationSize:null},e})();t.Annotation=r}),define("modules/clean/annotations/annotation_controller",["require","exports","external/create-react-class","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_region"],function(e,t,n,i,o,r,a,s,l,c,u,d){"use strict";function p(e,t,n){return void 0!==e&&null!==e&&"function"==typeof e[t]?n(e,t):void 0}return n({displayName:"AnnotationController",propTypes:{controllerEventHandlers:a.object,onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,isAnnotationMarkerEnabled:a.bool,isAnnotationHighlightEnabled:a.bool,isAnnotationRegionEnabled:a.bool,isAnnotationCreationEnabled:a.bool,parentContainerOffset:a.object,draftAnnotationVersion:a.number},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){return null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onHideAnnotation=this.onHideAnnotation),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseMoveCallback=this.onMouseMoveCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseDownCallback=this.onMouseDownCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onMouseUpCallback=this.onMouseUpCallback),null!=this.props.controllerEventHandlers&&(this.props.controllerEventHandlers.onScrollCallback=this.onScrollCallback),null!=this.props.controllerEventHandlers?this.props.controllerEventHandlers.onScaleChangeCallback=this.onScaleChangeCallback:void 0},componentDidUpdate:function(e,t){if(this.props.draftAnnotationVersion>e.draftAnnotationVersion)return this._allowAnnotationTypeSwitch(),this.setState(this.getInitialState())},_getViewerX:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageX:void 0)||0},_getViewerY:function(){return(null!=this.state.currentMouseEvent?this.state.currentMouseEvent.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(){return"function"==typeof t?t():void 0}),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var t=o.findDOMNode(this.refs.activeAnnotation);return null!=t&&(e.target===t||s.contains(t,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case l.AnnotationTypes.MARKER:return this.props.isAnnotationMarkerEnabled;case l.AnnotationTypes.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case l.AnnotationTypes.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n=s(e.target),i=n.contents(),o=(null!=(t=n.css("cursor"))?t:"").split(",");if(o=o[o.length-1].trim(),"text"===o||"vertical-text"===o||n.is("a")&&0===i.length)return!0;if("auto"!==o)return!1;for(var r=!1,a=0,l=Array.from(i);a<l.length;a++){l[a].nodeType===Node.TEXT_NODE&&(r=!0)}return r},_deselectAllText:function(){return p(window.getSelection(),"removeAllRanges",function(e){return e.removeAllRanges()})},onHideAnnotation:function(){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.hideAnnotation():void 0},onMouseDownCallback:function(e){var t=this;if(!this.isMouseDown){if(this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},!this.allowAnnotationTypeSwitch)return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseDownCallback(e):void 0;var n=this.state.activeAnnotationType;return!this._isOnRegion(e)&&this._isOnText(e)?(n=l.AnnotationTypes.HIGHLIGHT,this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseDownCallback(e):void 0})):void 0}},onMouseMoveCallback:function(e){var t=this;if(this.isMouseDown){if(null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;return this.isMouseDown&&null===n&&(n=l.AnnotationTypes.REGION),this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseMoveCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseMoveCallback(e):void 0}},onMouseUpCallback:function(e){var t=this;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){var n=this.state.activeAnnotationType;if(null===n){if(this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.MARKER))n=l.AnnotationTypes.MARKER;else if(this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.REGION))return void this._trySetActiveAnnotationType(l.AnnotationTypes.REGION,function(){return p(t.refs.activeAnnotation,"createDefaultRegion",function(t){return t.createDefaultRegion(e)})})}else if(n===l.AnnotationTypes.REGION&&this._isAnnotationTypeCreationEnabled(l.AnnotationTypes.MARKER)){var i={x:e.pageX,y:e.pageY},o=i.x-this.positionAtLastMouseDown.x,r=i.y-this.positionAtLastMouseDown.y,a=Math.sqrt(o*o+r*r);a<=34&&(n=l.AnnotationTypes.MARKER)}return this._trySetActiveAnnotationType(n,function(){return null!=t.refs.activeAnnotation?t.refs.activeAnnotation.onMouseUpCallback(e):void 0})}return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){return null!=this.refs.activeAnnotation?this.refs.activeAnnotation.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){return this._disallowAnnotationTypeSwitch(),"function"==typeof this.props.onAnnotationPlacedCallback?this.props.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){return"function"==typeof this.props.onAnnotationStartDragCallback?this.props.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){return"function"==typeof this.props.onAnnotationEndDragCallback?this.props.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){return"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){return"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){return"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){return"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case l.AnnotationTypes.MARKER:return i.createElement(u,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case l.AnnotationTypes.HIGHLIGHT:return i.createElement(c,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case l.AnnotationTypes.REGION:return i.createElement(d,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return r.div({className:"ephemeral-annotation-container"},this._renderActiveAnnotation())}})}),define("modules/clean/annotations/annotation_highlight",["require","exports","tslib","external/react","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s){"use strict";return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isShown:!1},t.hideAnnotation=function(){return t._hideAnnotation()},t._updateViewportBoundaries=function(){var e=window.getSelection();if(e.rangeCount>0){var n=void 0;n=t._isBrowserIE()?t._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):t._extractViewportClientRectangles(e.getRangeAt(0));var i=t._consolidateClientRectangles(n);return t._setViewportCoordinatesFromRectangles(i)}},t._extractViewportClientRectangles=function(e){for(var t=[],n=e.endContainer,i=e.endOffset,o=e.cloneRange();n!==e.commonAncestorContainer;)o.setStart(n,0),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),i=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return o=e.cloneRange(),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),t},t._extractViewportClientRectanglesIEHack=function(e){if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();var t=[],n=e.cloneRange();n.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,n.getClientRects());for(var i=e.startContainer.parentNode.nextSibling;i!==e.endContainer.parentNode;)Array.prototype.push.apply(t,i.getClientRects()),i=i.nextSibling;return n.setStart(e.endContainer,0),n.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,n.getClientRects()),t},t._isBrowserIE=function(){var e=window.navigator.userAgent,t=e.indexOf("Trident/"),n=e.indexOf("Edge/");return t>0||n>0},t._consolidateClientRectangles=function(e){for(var n=[],i=0,o=Array.from(e);i<o.length;i++){var r=o[i];if(0!==r.width&&0!==r.height){if(n.length>0){var a=n[n.length-1];if(t._isWithinConsolidationVerticalBuffer(a,r)&&t._isWithinConsolidationHorizontalBuffer(a,r)){var s=t._calculateBoundingBox(a,r);a.top=s.top,a.right=s.right,a.bottom=s.bottom,a.left=s.left;continue}}n.push({top:r.top,right:r.right,bottom:r.bottom,left:r.left})}}return n},t._isWithinConsolidationVerticalBuffer=function(e,n){return Math.abs(e.top-n.top)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-n.bottom)<t.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},t._isWithinConsolidationHorizontalBuffer=function(e,n){var i=t._calculateBoundingBox(e,n);return i.right-i.left-(n.width+(e.right-e.left))<t.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},t._calculateBoundingBox=function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},t._setViewportCoordinatesFromRectangles=function(e){var n=t.annotation.viewportCoordinates,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(e=Array.from(e),0!==e.length){var r=e.map(function(e){return[{x:e.left+i,y:e.top+o},{x:e.right+i,y:e.bottom+o}]});n.splice.apply(n,[0,n.length].concat(r))}},t._getPositionRelativeToParentContainer=function(e){return{x:e.x-t.props.parentContainerOffset.left,y:e.y-t.props.parentContainerOffset.top}},t._updateHighlightedText=function(){return t.annotation.text_highlight={snippet_before:t._getTextBeforeHighlight(),text:t._getHighlightedText(),snippet_after:t._getTextAfterHighlight()}},t._generateAnnotation=function(){return t.annotation=new s.Annotation(t.type,t.subtype),t._updateViewportBoundaries(),t._updateHighlightedText()},t._hideAnnotation=function(){return t._isBrowserIE()&&t.state.isShown&&t.setState({isShown:!1,viewportCoordinates:null}),t.annotation=null,t.props.onAnnotationHiddenCallback()},t._updateViewportCoordinatesFromUI=function(){if(t.state.isShown){for(var e=[],n=t.annotation.viewportCoordinates,i=0,o=Array.from(a(".annotation-highlight"));i<o.length;i++){var r=o[i],s=[],l=a(r),c=l.offset();s.push({x:c.left,y:c.top}),s.push({x:c.left+l.width(),y:c.top+l.height()}),e.push(s)}n.splice.apply(n,[0,n.length].concat(e))}},t._getHighlightedText=function(){var e=window.getSelection().toString().trim();return e=e.replace(/\s+/g," ")},t._getTextBeforeHighlight=function(){return""},t._getTextAfterHighlight=function(){return""},t._isTextSelected=function(){return""!==t._getHighlightedText()},t.onMouseDownCallback=function(e){return{}},t.onMouseMoveCallback=function(e){return{}},t.onMouseUpCallback=function(e){return setTimeout(function(){if(!t._isTextSelected())return t._hideAnnotation();if(t._generateAnnotation(),t.props.onAnnotationPlacedCallback(t.annotation),t._isBrowserIE()){for(var e=[],n=0,i=Array.from(t.annotation.viewportCoordinates);n<i.length;n++){var o=i[n],r=[],a=t._getPositionRelativeToParentContainer(o[0]),s=t._getPositionRelativeToParentContainer(o[1]);r.push({x:a.x,y:a.y}),r.push({x:s.x,y:s.y}),e.push(r)}return t.setState({isShown:!0,viewportCoordinates:e})}},0)},t.onScrollCallback=function(){if(null!=t.annotation)return t._isBrowserIE()?t._updateViewportCoordinatesFromUI():t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScrollCallback?t.props.onAnnotationScrollCallback(t.annotation):void 0},t.onScaleChangeCallback=function(){if(null!=t.annotation)return t._updateViewportBoundaries(),"function"==typeof t.props.onAnnotationScaleChangeCallback?t.props.onAnnotationScaleChangeCallback(t.annotation):void 0},t._onMarkerMouseDown=function(e){return{}},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseUp=function(e){return{}},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.type=s.AnnotationTypes.HIGHLIGHT,this.subtype=s.AnnotationSubtypes.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},t.prototype.render=function(){var e=this;return o.div({className:"annotation-highlight-container",ref:"highlightContainer"},(function(){if(e.state.isShown){for(var t=[],n=0,i=Array.from(e.state.viewportCoordinates);n<i.length;n++){var r=i[n],a=r[0].x,s=r[0].y,l=r[1].x,c=r[1].y,u={left:a,top:s,width:l-a,height:c-s};t.push(o.div({className:"annotation-highlight",style:u}))}return t}})())},t.displayName="AnnotationHighlight",t.propTypes={onAnnotationPlacedCallback:r.func,onAnnotationHiddenCallback:r.func,onAnnotationStartDragCallback:r.func,onAnnotationEndDragCallback:r.func,onAnnotationOverCallback:r.func,onAnnotationScrollCallback:r.func,onAnnotationScaleChangeCallback:r.func,onAnnotationEnterCallback:r.func,onAnnotationLeaveCallback:r.func,parentContainerOffset:r.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(i.Component)}),define("modules/clean/annotations/annotation_highlight_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l,c){"use strict";function u(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHover:!1},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onHighlightClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseEnter=function(e){return t.setState({isHover:!0}),clearTimeout(t.mouseLeaveTimeout),t._updateViewportCoordinates(),"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}):void 0},t._onHighlightMouseOver=function(e){return{}},t._onHighlightMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback&&t.props.onAnnotationLeaveCallback({annotation:t.annotation,commentActivity:t.props.commentActivity}),t.mouseLeaveTimeout=setTimeout(function(){return t.setState({isHover:!1})},100)},t._updateViewportCoordinates=function(){for(var e=l(r.findDOMNode(t.refs.highlightContainer)),n=[],i=e.children(),o=0,a=Array.from(i);o<a.length;o++){var s=a[o],c=[],u=l(s).offset();c.push({x:u.left,y:u.top}),c.push({x:u.left+l(s).width(),y:u.top+l(s).height()}),n.push(c)}return t.annotation.viewportCoordinates=n},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=c.Annotation.createAnnotationFromDict(this.props.annotation)},t.prototype.render=function(){for(var e,t,n,o=this,r=[],s=u(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),l=i({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":s,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),c=-1,d=0,p=Array.from(this.initialViewport);d<p.length;d++){var m=p[d];t=m[0].x,n=m[0].y;var h=m[1].x,f=m[1].y;(c===-1||n<c)&&(e=t,c=n);var v={left:t*this.props.scaleFactor,top:n*this.props.scaleFactor,width:h-t,height:f-n,transform:"scale("+this.props.scaleFactor+")",transformOrigin:"top left"};r.push(a.div({className:l,style:v,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}))}return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},r,(function(){if(o.props.options.isAnnotationNumberingEnabled){var t={left:e*o.props.scaleFactor-9,top:c*o.props.scaleFactor-9},n=i({"annotation-number":!0,"annotation-number--resolved":s,"annotation-number--hover":o.state.isHover});return a.div({className:n,style:t},o.props.options.annotationNumber)}})())},t.displayName="AnnotationHighlightUI",t.propTypes={annotation:s.object,commentActivity:s.object,scaleFactor:s.number,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(o.Component)}),define("modules/clean/annotations/annotation_marker",["require","exports","tslib","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.hideAnnotation=function(){return i._hideAnnotation()},i._getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},i._hasSelectedText=function(){return""!==i._getSelectionText()},i._resetPositionDelta=function(){return i.positionDelta={x:0,y:0}},i._getOffsetPosition=function(e){var t=e.offsetX||(null!=e.nativeEvent?e.nativeEvent.offsetX:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerX}),n=e.offsetY||(null!=e.nativeEvent?e.nativeEvent.offsetY:void 0)||c(null!=e.nativeEvent?e.nativeEvent.originalEvent:void 0,function(e){return e.layerY});return{x:t-i.annotation.getSize()/2,y:n-i.annotation.getSize()/2}},i._getPositionRelativeToParentContainer=function(e){return{x:e.pageX-i.props.parentContainerOffset.left,y:e.pageY-i.props.parentContainerOffset.top}},i._calculateMarkerPos=function(e){var t=i._getPositionRelativeToParentContainer(e),n=i.size/2;return{x:t.x-n-i.positionDelta.x,y:t.y-n-i.positionDelta.y}},i._generateAnnotation=function(e){return i.annotation=new l.Annotation(i.type,i.subtype,i.size),i._updateViewportCoordinatesFromEvent(e),i.annotation},i._updateViewportCoordinatesFromEvent=function(e){var t={x:e.clientX-i.positionDelta.x,y:e.clientY-i.positionDelta.y};return i.annotation.viewportCoordinates[0]=[t]},i._hideAnnotation=function(e){return i.annotation=null,i.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof i.props.onAnnotationHiddenCallback?i.props.onAnnotationHiddenCallback():void 0},i._placeAnnotation=function(e){return i.setState({isToolVisible:!0,viewerX:i._calculateMarkerPos(e).x,viewerY:i._calculateMarkerPos(e).y},function(){return i._generateAnnotation(e),"function"==typeof i.props.onAnnotationPlacedCallback?i.props.onAnnotationPlacedCallback(i.annotation):void 0})},i.updateViewportCoordinatesFromMarker=function(){if(i.state.isToolVisible){var e=o.findDOMNode(i.refs.annotationMarker);if(e){var t=s(e),n=t.offset(),r={x:n.left+i.annotation.getSize()/2,y:n.top+i.annotation.getSize()/2};i.annotation.viewportCoordinates[0]=[r]}}return null},i._startAnnotationDrag=function(e){return e.preventDefault(),i.isInDragMode=!0,i.positionDelta=i._getOffsetPosition(e),i._updateViewportCoordinatesFromEvent(e),"function"==typeof i.props.onAnnotationStartDragCallback?i.props.onAnnotationStartDragCallback(i.annotation):void 0},i._endAnnotationDrag=function(e){return e.preventDefault(),i.isInDragMode=!1,i._updateViewportCoordinatesFromEvent(e),i._resetPositionDelta(),"function"==typeof i.props.onAnnotationEndDragCallback?i.props.onAnnotationEndDragCallback(i.annotation):void 0},i._isOnMarker=function(e){if(i.state.isToolVisible){var t=o.findDOMNode(i.refs.annotationMarker);return null!=t&&(e.target===t||s.contains(t,e.target))}},i.onMouseDownCallback=function(e){if(i.state.isToolVisible&&i._isOnMarker(e))return i._startAnnotationDrag(e),e.preventDefault()},i.onMouseMoveCallback=function(e){if(i.isInDragMode&&i.state.isToolVisible)return i.setState({viewerX:i._calculateMarkerPos(e).x,viewerY:i._calculateMarkerPos(e).y}),e.preventDefault()},i.onMouseUpCallback=function(e){return i.state.isToolVisible?i.isInDragMode?i._endAnnotationDrag(e):i._hideAnnotation(e):i._hasSelectedText()?void 0:(i._placeAnnotation(e),e.preventDefault())},i.onScrollCallback=function(){if(i.state.isToolVisible)return i.updateViewportCoordinatesFromMarker(),"function"==typeof i.props.onAnnotationScrollCallback?i.props.onAnnotationScrollCallback(i.annotation):void 0},i.onScaleChangeCallback=function(){return i.updateViewportCoordinatesFromMarker(),"function"==typeof i.props.onAnnotationScaleChangeCallback?i.props.onAnnotationScaleChangeCallback(i.annotation):void 0},i._onMarkerMouseDown=function(e){return{}},i._onMarkerMouseOver=function(e){return"function"==typeof i.props.onAnnotationOverCallback?i.props.onAnnotationOverCallback(i.annotation):void 0},i._onMarkerMouseUp=function(e){return{}},i._onMarkerMouseEnter=function(e){return"function"==typeof i.props.onAnnotationEnterCallback?i.props.onAnnotationEnterCallback(i.annotation):void 0},i._onMarkerMouseLeave=function(e){return"function"==typeof i.props.onAnnotationLeaveCallback?i.props.onAnnotationLeaveCallback(i.annotation):void 0},i.type=l.AnnotationTypes.MARKER,i.subtype=l.AnnotationSubtypes.MARKER.CIRCLE,i.size=28,i.isInDragMode=!1,i._resetPositionDelta(),i.state={isToolVisible:!1,viewerX:0,viewerY:0},i}return n.__extends(t,e),t.prototype.componentWillMount=function(){return{}},t.prototype.render=function(){var e=[];return this.state.isToolVisible&&(e=[r.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},r.div({className:"annotation-maker-inner"}))]),r.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)},t.displayName="AnnotationMarker",t.propTypes={onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},t.defaultProps={parentContainerOffset:{left:0,top:0}},t})(i.Component)}),
define("modules/clean/annotations/annotation_marker_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onMarkerClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseEnter=function(e){var n=l(r.findDOMNode(t.refs.annotationMarker)),i=t.props.annotation;return null==i.viewportCoordinates&&(i.viewportCoordinates=[]),i.viewportCoordinates[0]=[{x:n.offset().left+i.annotationSize/2,y:n.offset().top+i.annotationSize/2}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:i,commentActivity:t.props.commentActivity}):void 0},t._onMarkerMouseOver=function(e){return{}},t._onMarkerMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},t.prototype.render=function(){var e=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),t=i({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!e,"annotation-marker--resolved":e,"annotation-marker--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-marker-container",ref:"markerContainer"},a.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:t,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},a.div({className:"annotation-maker-inner"})))},t.displayName="AnnotationMarkerUI",t.propTypes={annotation:s.object,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={options:{}},t})(o.Component)}),define("modules/clean/annotations/annotation_region",["require","exports","external/classnames","external/create-react-class","external/react-dom","external/react-dom-factories","external/prop-types","external/lodash","jquery","modules/clean/annotations/annotation"],function(e,t,n,i,o,r,a,s,l,c){"use strict";return i({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:a.func,onAnnotationHiddenCallback:a.func,onAnnotationStartDragCallback:a.func,onAnnotationEndDragCallback:a.func,onAnnotationOverCallback:a.func,onAnnotationScrollCallback:a.func,onAnnotationScaleChangeCallback:a.func,onAnnotationEnterCallback:a.func,onAnnotationLeaveCallback:a.func,parentContainerOffset:a.object},TYPE:c.AnnotationTypes.REGION,SUBTYPE:c.AnnotationSubtypes.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e=this.state.rectangle.top+this.props.parentContainerOffset.top,t=this.state.rectangle.right+this.props.parentContainerOffset.left,n=this.state.rectangle.bottom+this.props.parentContainerOffset.top,i=this.state.rectangle.left+this.props.parentContainerOffset.left;return this.annotation.viewportCoordinates[0]=[{x:i,y:e},{x:i,y:n},{x:t,y:n},{x:t,y:e}]},_isOnRegion:function(e){if(this.state.isToolVisible){var t=o.findDOMNode(this.refs.annotationRegion);if(null!=t)return e.target===t||l.contains(t,e.target)}return!1},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:s.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:s.clone(t),anchorRectangle:s.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new c.Annotation(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof this.props.onAnnotationHiddenCallback?this.props.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t=this;e.preventDefault();var n=this._getPositionRelativeToParentContainer(e),i=n.x,o=n.y,r=this.DEFAULT_REGION_SIZE/2;return this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:o-r,right:i+r,bottom:o+r,left:i-r}},function(){return t._updateAnnotationFromState(),"function"==typeof t.props.onAnnotationPlacedCallback?t.props.onAnnotationPlacedCallback(t.annotation):void 0})},onMouseDownCallback:function(e){e.preventDefault();var t=this._getPositionRelativeToParentContainer(e);return this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startDragging(t)):void 0:this._showNewRectangle(t)},onMouseMoveCallback:function(e){var t;if(e.preventDefault(),!this.state.isToolVisible)return t=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(t);if(this._isModifying()){t=this._getPositionRelativeToParentContainer(e);var n={x:t.x-this.state.anchorMouse.x,y:t.y-this.state.anchorMouse.y},i=s.clone(this.state.anchorRectangle);return this.state.isInDragMode?i={top:this.state.anchorRectangle.top+n.y,right:this.state.anchorRectangle.right+n.x,bottom:this.state.anchorRectangle.bottom+n.y,left:this.state.anchorRectangle.left+n.x}:this.isResizing&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?i.top=this.state.anchorRectangle.top+n.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(i.bottom=this.state.anchorRectangle.bottom+n.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?i.left=this.state.anchorRectangle.left+n.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(i.right=this.state.anchorRectangle.right+n.x)),i={top:Math.min(i.top,i.bottom),right:Math.max(i.left,i.right),bottom:Math.max(i.top,i.bottom),left:Math.min(i.left,i.right)},this.setState({rectangle:i})}},onMouseUpCallback:function(e){if(e.preventDefault(),this.state.isToolVisible)return this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof this.props.onAnnotationPlacedCallback&&this.props.onAnnotationPlacedCallback(this.annotation):"function"==typeof this.props.onAnnotationEndDragCallback&&this.props.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e)},onScrollCallback:function(){if(this.state.isToolVisible)return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScrollCallback?this.props.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationScaleChangeCallback?this.props.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){return"function"==typeof this.props.onAnnotationOverCallback?this.props.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){return this.setState({isHovering:!0}),"function"==typeof this.props.onAnnotationEnterCallback?this.props.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){return this.setState({isHovering:!1}),"function"==typeof this.props.onAnnotationLeaveCallback?this.props.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){e.preventDefault(),this.isResizing=!0;var n=this._getPositionRelativeToParentContainer(e);return this._updateAnnotationFromState(),"function"==typeof this.props.onAnnotationStartDragCallback&&this.props.onAnnotationStartDragCallback(this.annotation),this._startResizing(n,t)},_renderSideHandles:function(){var e=this;return r.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},Array.from(s.values(this.Directions)).map(function(t){return(function(t){return r.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})})(t)}))},_renderCornerHandles:function(){var e=this;return[this.Directions.TOP,this.Directions.BOTTOM].map(function(t){return[e.Directions.LEFT,e.Directions.RIGHT].map(function(n){return(function(t,n){return r.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(i){return e._onHandleMouseDown(i,[t,n])}},r.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))})(t,n)})})},render:function(){var e=[];if(this.state.isToolVisible){var t={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering};e=[r.div({key:"annotationRegion",ref:"annotationRegion",className:n(t),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]}return r.div({className:"annotation-region-container"},this.state.isToolVisible?e:void 0)}})}),define("modules/clean/annotations/annotation_region_ui",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/react-dom-factories","external/prop-types","jquery"],function(e,t,n,i,o,r,a,s,l){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t._isGhostAnnotation=function(){return t.props.options.isGhostAnnotation||!1},t._onRegionClick=function(e){return"function"==typeof t.props.onAnnotationClickCallback?t.props.onAnnotationClickCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseEnter=function(e){var n=l(r.findDOMNode(t.refs.annotationRegion)),i=t.props.annotation;null==i.viewportCoordinates&&(i.viewportCoordinates=[]);var o=n.offset().top,a=n.offset().left,s=o+n.height(),c=a+n.width();return i.viewportCoordinates[0]=[{x:a,y:o},{x:a,y:s},{x:c,y:s},{x:c,y:o}],"function"==typeof t.props.onAnnotationEnterCallback?t.props.onAnnotationEnterCallback({annotation:i,commentActivity:t.props.commentActivity}):void 0},t._onRegionMouseOver=function(e){return{}},t._onRegionMouseLeave=function(e){return"function"==typeof t.props.onAnnotationLeaveCallback?t.props.onAnnotationLeaveCallback({annotation:t.props.annotation,commentActivity:t.props.commentActivity}):void 0},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=c(null!=this.props.commentActivity?this.props.commentActivity.comment:void 0,function(e){return e.resolved}),n=this.props.annotation.getBoundingBox(),o=i({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":t,"annotation-region--ui--resolved":t,"annotation-region--ghost":this._isGhostAnnotation()});return a.div({className:"annotation-region-container"},a.div({key:"annotationRegion",ref:"annotationRegion",className:o,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:n.left*this.props.scaleFactor,top:n.top*this.props.scaleFactor,width:(n.right-n.left)*this.props.scaleFactor,height:(n.bottom-n.top)*this.props.scaleFactor}},a.div({className:"annotation-region-inner"}),(function(){if(e.props.options.isAnnotationNumberingEnabled){var n=i({"annotation-number":!0,"annotation-number--resolved":t});return a.div({className:n},e.props.options.annotationNumber)}})()))},t.displayName="AnnotationRegionUI",t.propTypes={annotation:s.object,scaleFactor:s.number,commentActivity:s.object,options:s.shape({isGhostAnnotation:s.bool,isAnnotationNumberingEnabled:s.bool,annotationNumber:s.number}),onAnnotationEnterCallback:s.func,onAnnotationOverCallback:s.func,onAnnotationLeaveCallback:s.func,onAnnotationClickCallback:s.func},t.defaultProps={scaleFactor:1},t})(o.Component)}),define("modules/clean/annotations/annotation_renderer_utils",["require","exports","external/lodash","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/react","jquery"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){return void 0!==e&&null!==e?t(e):void 0}return(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){if((null!=e.annotations?e.annotations.length:void 0)!==s(Object.keys(t),function(e){return e.length}))return!0;for(var i=0,o=Array.from(e.annotations);i<o.length;i++){var r=o[i],a=r.commentActivity.activity_key;if(!n.isEqual(t[a],r))return!0}return!1},e.prototype.renderAnnotation=function(e,t,n){if(null==e.annotation||null==e.commentActivity)return null;var s=i.Annotation.createAnnotationFromDict(e.annotation),l=e.commentActivity;if(null==(null!=s?s.type:void 0)||t(l.activity_key))return null;var c=null;switch(s.type){case i.AnnotationTypes.MARKER:c=r;break;case i.AnnotationTypes.HIGHLIGHT:c=o;break;case i.AnnotationTypes.REGION:c=a}return null==c?null:n(c,s,l,null!=e.options?e.options:{})},e})()}),define("modules/clean/annotations/preview_image_annotations_toolbar",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/lodash","jquery","modules/clean/keycode","modules/clean/react/css_timing","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/dom","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isToolbarVisible:!0},t.onMouseMove=function(e){if(t.state.isToolbarVisible||t.setState({isToolbarVisible:!0}),t.state.isToolbarVisible)return clearTimeout(t.hideToolbarTimeout),t.hideToolbarTimeout=setTimeout(function(){return t.maybeHideToolbar(e)},3e3)},t.onKeydown=function(e){var n;if(f.focus_in_input()||f.is_input(e.target))return!0;var i=e.keyCode;return[l.KeyCode.EQUALS,l.KeyCode.PLUS_EQUALS_FF,l.KeyCode.PLUS_CHROME,l.KeyCode.PLUS_EQUALS_FF_GERMAN].includes(i)?("function"==typeof t.props.onZoomIn&&t.props.onZoomIn(),n=!0):[l.KeyCode.MINUS_FF_MAC,l.KeyCode.MINUS_FF,l.KeyCode.MINUS_CHROME].includes(i)?("function"==typeof t.props.onZoomOut&&t.props.onZoomOut(),n=!0):i===l.KeyCode.P?(t.props.onPrint&&t.onPrint(d.UserActionContext.Keyboard)(),n=!0):t.props.onKeyPress&&(n=t.props.onKeyPress(e)),n&&null!=e.preventDefault&&e.preventDefault(),!n},t.maybeHideToolbar=function(e){if(0===s(e.target).closest(r.findDOMNode(t.refs.previewToolbar)).length)return t.setState({isToolbarVisible:!1})},t.flipLabelText=function(){return v._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:t.props.index+1,num_total_files:t.props.count})},t.zoomToolTipText=function(){return 1===t.props.zoomPercent?v._("Zoom to fit"):v._("View actual size")},t.getZoomLabel=function(){return t.props.zoomPercent?v.format_percent(Math.round(100*t.props.zoomPercent)):""},t.onZoomMouseDown=function(e,n){return t.isZooming||u.logUserAction(n.action,n.context),t.isZooming=!0,t.keepZooming(e,400)},t.keepZooming=function(e,n){if(t.isZooming)return e(),setTimeout(function(){return t.keepZooming(e,75)},n)},t.onZoomMouseUp=function(){return t.isZooming=!1},t.onZoomMouseLeave=function(){return t.isZooming=!1},t.onClickPrevious=function(){return t.props.onPrevious(),u.logUserAction(d.UserAction.FlipPrevious,d.UserActionContext.Toolbar)},t.onClickNext=function(){return t.props.onNext(),u.logUserAction(d.UserAction.FlipNext,d.UserActionContext.Toolbar)},t.onClickFullscreen=function(){return t.props.onFullscreen(),u.logUserAction(d.UserAction.ToggleFullscreenOn,d.UserActionContext.Toolbar)},t.onPrint=function(e){return function(){return t.props.onPrint(),u.logUserAction(d.UserAction.Print,e)}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){return window.addEventListener("mousemove",this.onMouseMove)},t.prototype.componentWillUnmount=function(){return window.removeEventListener("mousemove",this.onMouseMove),clearTimeout(this.hideToolbarTimeout)},t.prototype.showFlipButtons=function(){return this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext},t.prototype.showZoomButtons=function(){return null!=this.props.onZoomOut||null!=this.props.onZoomIn},t.prototype.canPrint=function(){return!(this.props.sharePermission&&this.props.sharePermission.canPrintRoles&&0===this.props.sharePermission.canPrintRoles.length)},t.prototype.render=function(){if(!this.state.isToolbarVisible)return null;if(this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen)return null;var e={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},t={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&null!=this.props.zoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},n={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation};return o.createElement("div",{className:"preview-toolbar-overlay-container"},o.createElement(p.KeyboardBindingConnector,{allKeyCallback:this.onKeydown}),o.createElement("div",{className:"preview-toolbar-overlay",ref:"previewToolbar"},o.createElement("div",{className:"preview-toolbar-content image-toolbar"},this.showFlipButtons()?o.createElement("span",{className:"flip-buttons image-toolbar__item"},o.createElement(h.TitleBubble,{content:v._("Previous"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"flip-button flip-button--previous",onClick:this.onClickPrevious},o.createElement(m.Sprite,{group:"web",name:"s_flip_left",alt:v._("Previous")}))),o.createElement("div",{className:"nav-text"},this.flipLabelText()),o.createElement(h.TitleBubble,{content:v._("Next"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"flip-button flip-button--next",onClick:this.onClickNext},o.createElement(m.Sprite,{group:"web",name:"s_flip_right",alt:v._("Next")})))):null,this.showZoomButtons()?o.createElement("span",{className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?o.createElement(h.TitleBubble,{content:v._("Zoom out"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:i(e),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomOut,{action:d.UserAction.ZoomOut,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},o.createElement(m.Sprite,{group:"web",name:"zoomout",alt:v._("Zoom out")}))):null,null!=this.props.onZoomOriginalOrFit?o.createElement(h.TitleBubble,{content:this.zoomToolTipText(),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this.getZoomLabel())):null,null!=this.props.onZoomIn?o.createElement(h.TitleBubble,{content:v._("Zoom in"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:i(t),onMouseDown:a.partial(this.onZoomMouseDown,this.props.onZoomIn,{action:d.UserAction.ZoomIn,context:d.UserActionContext.Toolbar}),onMouseUp:this.onZoomMouseUp,onMouseLeave:this.onZoomMouseLeave},o.createElement(m.Sprite,{group:"web",name:"zoom",alt:v._("Zoom in")}))):null):null,null!=this.props.onFullscreen?o.createElement(h.TitleBubble,{content:v._("Fullscreen"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"fullscreen image-toolbar__item item-w-label",onClick:this.onClickFullscreen},o.createElement(m.Sprite,{group:"web",name:"fullscreen",alt:v._("Fullscreen")}))):null,this.props.onPrint&&this.canPrint()?o.createElement(h.TitleBubble,{content:v._("Print"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:"print-button",onClick:this.onPrint(d.UserActionContext.Toolbar)},o.createElement(m.Sprite,{group:"web",name:"print",alt:v._("Print")}))):null,o.createElement(h.TitleBubble,{content:v._("Comment"),position:h.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.createElement("button",{className:i(n),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},o.createElement(m.Sprite,{group:"web",name:"ic_comment_area_large",alt:v._("Comment")}))))))},t})(o.Component),g=c.requireCssWithComponent(_,["/static/css/preview_toolbar-vflDVMGvs.css"]);t.PreviewImageAnnotationsToolbar=g}),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),define("modules/clean/callback_chain/callback_chain",["require","exports"],function(e,t){"use strict";function n(e){return void 0!==e.abortCallbackChain}function i(e){var t=e,n=!1;return t.abortCallbackChain=function(){n=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return n}}),t}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=n(e)?e:i(e),o=0,r=this.callbacks;o<r.length;o++){var a=r[o];if(t.callbackChainAborted)break;a(t)}},e})();t.CallbackChain=o}),define("modules/clean/comments/actions",["require","exports","external/reflux","external/lodash"],function(e,t,n,i){"use strict";var o=["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"];return n.createActions(i.zipObject(o,o.map(function(e){return{sync:!0}})))}),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,i){this.__commentsEvents.push([e,n,i]),t.CommentsEvents.on(e,n,i)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],i=e[1],o=e[2];t.CommentsEvents.off(n,i,o)}),this.__commentsEvents=null}}}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,i,o){o.value=n.takes.apply(void 0,e.concat([o.value]))}}function o(e){return function(t,i,o){o.value=n.returns(e,o.value)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takes=i,t.returns=o}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/lodash","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,i=void 0===n?null:n,r=t.annotation,a=void 0===r?null:r,s=t.sticker_id,l=void 0===s?null:s,c=t.thumbnail_url,u=void 0===c?null:c;this.revision=i,this.annotation=a,this.sticker_id=l,this.thumbnail_url=u,o(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return i.pickBy({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},n.__decorate([s.takes({revision:r.Any,annotation:r.Any,stickers:r.Maybe({id:Number}),thumbnail_url:r.Maybe(String)})],e,"fromDict",null),e})();t.CommentMetadata=c;var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,i=void 0===n?"":n,r=t.commenter,a=void 0===r?l.ActivityUser.anonymous:r,s=t.comment_text,c=void 0===s?"":s,u=t.raw_comment_text,d=void 0===u?"":u,p=t.when_mses,m=void 0===p?0:p,h=t.resolved,f=void 0!==h&&h,v=t.comment_metadata,_=void 0===v?null:v;this.comment_gid=i,this.commenter=a,this.comment_text=c,this.raw_comment_text=d,this.when_mses=m,this.resolved=f,this.comment_metadata=_,o(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:l.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?c.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return a.set(this,"resolved",!0)},e.prototype.unresolve=function(){return a.set(this,"resolved",!1)},n.__decorate([s.takes({comment_gid:String,commenter_dict:r.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:r.Maybe(Object)})],e,"fromDict",null),e})();t.Comment=u}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/deep-freeze","external/lodash","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,i,o,r,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n,i(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!o.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},n.__decorate([l.takes({user_ids_who_can_delete:Array})],e,"fromDict",null),e})();t.CommentActivityPermissions=u;var d=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,r=t.comment_activities,a=void 0===r?[]:r,s=t.users_to_notify,l=void 0===s?[]:s,d=t.is_seen,p=void 0!==d&&d,m=t.highlight_as_unread,h=void 0!==m&&m,f=t.comment,v=void 0===f?new c.Comment:f,_=t.permissions,g=void 0===_?new u:_,y=t.status,w=void 0===y?"POSTED":y;this.activity_key=o,this.comment_activities=a,this.users_to_notify=l,this.is_seen=p,this.highlight_as_unread=h,this.comment=v,this.permissions=g,this.status=w,i(this)}return e.createLocalInstance=function(t){var n=t.activityKey,i=void 0===n?o.uniqueId("local-comment-activity-"):n,r=t.commenter,a=t.rawCommentText,s=t.metadata,l=void 0===s?null:s,u=t.status,d=void 0===u?"POSTING":u;return new e({activity_key:i,comment:new c.Comment({comment_gid:o.uniqueId("pending-comment-gid-"),commenter:r,comment_text:a,raw_comment_text:a,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:l}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:c.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){
return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return a.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return a.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return a.set(this,"status",e)},e.prototype.markSeen=function(){return a.merge(this,{is_seen:!0,highlight_as_unread:!1})},n.__decorate([l.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],e,"fromDict",null),e})();t.CommentActivity=d}),define("modules/clean/comments/models/loading_spinner",["require","exports"],function(e,t){"use strict";return function(e,t){return(null==t||t.comment_activities.length>0)&&e}}),define("modules/clean/comments/revisions",["require","exports","tslib","external/lodash"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){var o=i.pick(t,"direct_blockserver_link","preview_ssr_image_url_tmpl","preview_ssr_text_url_tmpl","preview_ssr_refresh_url");return o.preview_url=t.preview_link,null!=e.set?n.__assign({},e,o):i.assignIn({},e,o)};t.getFileWithRevision=o;var r=function(e,t){return t.when-e.when};t.compareRevision=r;var a=function(e,t){return r(e,t)>0};t.isRevisionOlderThan=a;var s=function(e,t){return r(e,t)<0};t.isRevisionNewerThan=s;var l=function(e,t){return 0===r(e,t)};t.isRevisionEqual=l}),define("modules/clean/comments/store",["require","exports","external/reflux","external/lodash","modules/clean/comments/actions","modules/clean/comments/components/ui_constants","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/react/file_comments/logger","modules/constants/comments_panel","modules/core/exception","modules/clean/react/file_viewer/data/legacy_flux_integration","modules/clean/annotations/annotation","modules/clean/annotations/annotation","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p){"use strict";function m(e,t){return void 0!==e&&null!==e?t(e):void 0}return n.createStore({listenables:o,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:u.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:r.TUTORIAL_INITIATOR,showCommentsPref:u.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(e){return i.assignIn(this.state,e),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){if(null!=this.state.activity?this.state.activity.users_to_notify:void 0)for(var t=0,n=Array.from(this.state.activity.users_to_notify);t<n.length;t++){var i=n[t];if(i.id===e)return!0}return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:null==this.state.viewing.file||!this.state.viewing.file.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){return null!=this.state.activity?this.state.activity.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){return!!(null!=this.state.activity?this.state.activity.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){if(null==this.state.activity)return null;var e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)};return this.state.activity.comment_activities.reduce(t,0)},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n=e.actorId,i=e.context,o=e.contextData,r=e.oref,a=e.file,l=(e.previewSelector,e.showCommentsOverride),c=e.showTutorialOverride;return t=null===this.state.contextData||s(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:n,viewing:{context:i,contextData:o,file:a,revision:null,showCommentsOverride:l,showTutorialOverride:c},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:t,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return a.CommentsEvents.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{conversationHover:e});return this.setState({viewAnnotation:t})}},onUpdateAnnotationUiHover:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{annotationHover:e});return this.setState({viewAnnotation:t})}},onShowAnnotationConversation:function(e){var t=e.annotation,n=e.activityKey;return d.assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),d.assert(null!=t,"Invalid annotation to show"),d.assert(null!=this.state.activity.findConversationByKey(n),"Invalid inline comment to show: "+n),this.setState({viewAnnotation:{annotation:t,activityKey:n,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(e){if(null!=this.state.viewAnnotation){var t=i.assignIn({},this.state.viewAnnotation,{replyFocused:e});return this.setState({viewAnnotation:t})}},onStartAnnotationCreation:function(e){var t=e.annotation;return this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(e){var t,n=e.activityKey,o=e.text;return n in this.state.annotationReplyTextByKey&&!o?(t=i.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:t})):(t=i.assignIn({},this.state.annotationReplyTextByKey,(r={},r[n]=o,r)),this.setState({annotationReplyTextByKey:t}));var r},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(e){var t,n=e.revision,o=e.commentActivity;if(d.assert(null!=n,"Revision to switch to must not be null!"),d.assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!l.isRevisionEqual(n,this.state.viewing.revision)){if(l.isRevisionEqual(n,this.state.activity.latest_revision))t=u.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,p.reduxRestoreRevision();else{t=u.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION;var r=l.getFileWithRevision(this.state.viewing.file,n);p.reduxSwitchRevision(r)}return this.setState({viewing:i.assignIn({},this.state.viewing,{revision:n}),isPreviewReady:!1}),a.CommentsEvents.emit("revision-did-change"),c.log_annotation_event(t,this.state.activity.activity_key,null!=o?o.activity_key:void 0,this.state.actorId,this.state.viewing.context,m(null!=o?o.comment.comment_metadata:void 0,function(e){return e.annotation}))}},onShowComments:function(){return this.setState({viewing:i.assignIn(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:i.assignIn(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){if(null!=this.state.createAnnotation)return this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null);if(null!=this.state.viewAnnotation){var e=this.state.viewAnnotation.activityKey;return this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})}},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(e){return u.SHOW_COMMENTS_TUTORIAL=e,this.setState({showTutorial:e,viewing:i.assignIn(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===r.TUTORIAL_CREATE_ANNOTATION&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:r.TUTORIAL_CREATE_ANNOTATION_SUCCESS}):this.state.currentTutorialStep===r.TUTORIAL_REPLY&&this.state.expandedComment?this.setState({currentTutorialStep:r.TUTORIAL_REPLY_SUCCESS}):this.state.currentTutorialStep===r.TUTORIAL_MENTION&&this.state.mentionedContact?this.setState({currentTutorialStep:r.TUTORIAL_MENTION_SUCCESS}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})}})}),define("modules/clean/file_activity/api",["require","exports","external/lodash","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","modules/core/types"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={actorId:a.Maybe(Number),oref:a.Maybe(String),isBackgroundRequest:a.Maybe(Boolean)},l=function(e){var t=e.url,o=e.type,r=e.data,a=e.actorId,s=e.oref,l=e.isBackgroundRequest,c=l?i.SilentBackgroundRequestOref:i.WebRequestOref;return new Promise(function(e,i){return c({url:t,type:o,data:n.assignIn({oref:s},r),subject_user:a,success:e,error:function(e,t,n){if("abort"!==t)return i(Error(n))}})}).then(JSON.parse)},c=function(e){if("error"===e.status){var t=null!=e.payload?e.payload.error_text:void 0,n=Error(t);throw n.payload=e.payload,n.error_text=t,n}return e.payload},u=function(e){return[c(e),e.bolt_data]},d=function(e){return r.FileActivity.fromDict(e)},p=n.assignIn({commentActivityKey:a.Maybe(String),context:Number,contextData:String,text:String,metadata:a.Maybe(Object)},s),m=a.takes(p,a.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKey,i=e.context,r=e.contextData,a=e.text,s=e.metadata,u=e.oref,d=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:i,activity_context_data:r,comment_text:a,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:u,isBackgroundRequest:d}).then(c).then(o.CommentActivity.fromDict)}));t.addComment=m;var h=n.assignIn({commentActivityKey:String,context:Number,contextData:String},s),f=a.takes(h,a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.deleteComment=f;var v=n.assignIn({enableComment:Boolean,context:Number,contextData:String},s),_=a.takes(v,a.returns(Promise,function(e){var t=e.actorId,n=e.enableComment;return l({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_off:!n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateCommentSetting=_;var g=n.assignIn({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},s),y=a.takes(g,a.returns(Promise,function(e){var t=e.actorId,n=e.resolved;return l({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:e.commentActivityKey,activity_context:e.context,activity_context_data:e.contextData,resolved:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateResolveComment=y;var w=n.assignIn({commentActivityKeys:Array,context:Number,contextData:String},s),b=a.takes(w,a.returns(Promise,function(e){var t=e.actorId,n=e.commentActivityKeys,i=e.context,o=e.contextData,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:i,activity_context_data:o},oref:r,isBackgroundRequest:a}).then(c)}));t.markCommentSeenBatch=b;var C=n.assignIn({context:Number,contextData:String},s),S=function(e){return l({actorId:e.actorId,url:"/file_activity/file_activity",type:"GET",data:{activity_context:e.context,activity_context_data:e.contextData},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest})},E=a.takes(C,a.returns(Promise,function(e){return S(e).then(c).then(d)}));t.fetchFileActivity=E;var A=a.takes(C,a.returns(Promise,function(e){return S(e).then(u).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.from(e[0]),i=n[0],o=n[1];return[d(i),o]})}));t.fetchFileActivityWithBoltData=A;var T=n.assignIn({context:Number,contextDataList:Array},s),P=a.takes(T,a.returns(Promise,function(e){var t=e.actorId,i=e.context,o=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:i,activity_context_data_batch:JSON.stringify(o)},oref:r,isBackgroundRequest:a}).then(function(e){return n.mapValues(e,d)})}));t.fetchFileActivities=P;var k=n.assignIn({subscribed:Boolean,context:Number,contextData:String},s),x=a.takes(k,a.returns(Promise,function(e){var t=e.actorId,n=e.subscribed;return l({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,subscribed:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.updateFileActivitySubscription=x;var R=n.assignIn({context:Number,contextDataList:Array},s),I=a.takes(R,a.returns(Promise,function(e){var t=e.actorId,i=e.context,o=e.contextDataList,r=e.oref,a=e.isBackgroundRequest;return l({actorId:t,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:i,activity_context_data_batch:JSON.stringify(o)},oref:r,isBackgroundRequest:a}).then(c).then(function(e){return n.mapValues(e,function(e){return{feedback_off:e.feedback_off,comment_count:e.comment_count,unresolved_comment_count:e.unresolved_comment_count}})})}));t.fetchCommentStatusBatch=I;var O=n.assignIn({feedbackText:String,context:Number,contextData:String},s),F=a.takes(O,a.returns(Promise,function(e){var t=e.actorId,n=e.feedbackText;return l({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:e.context,activity_context_data:e.contextData,feedback_text:n},oref:e.oref,isBackgroundRequest:e.isBackgroundRequest}).then(c)}));t.submitProductFeedback=F;var M=a.takes({actorId:Number},a.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(c)}));t.markCommentingOnboardingSeen=M;var D=a.takes({actorId:Number},a.returns(Promise,function(e){var t=e.actorId;return new Promise(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:n,subject_user:t})}).then(JSON.parse).then(c)}));t.shouldShowCommentingOnboarding=D;var L=a.takes({actorId:Number,shouldShow:Boolean},a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(c)}));t.setCommentingPaneVisibility=L;var N=a.takes({shouldShow:Boolean},a.returns(Promise,function(e){return l({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:e.shouldShow}}).then(c)}));t.setSessionCommentingPaneVisibility=N;var U=a.takes({actorId:Number,shouldShow:Boolean},a.returns(Promise,function(e){return l({actorId:e.actorId,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:e.shouldShow}}).then(c)}));t.setShowCommentsTutorial=U}),define("modules/clean/file_activity/clients/file_activity_bolt_client",["require","exports","tslib","external/eventemitter3","modules/clean/analytics","modules/clean/bolt","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage","modules/core/exception","modules/core/types"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";var d=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},p=function(e){return{revision:e.revision,token:e.token}},m=void 0,h=(function(e){function t(){var t=e.call(this)||this;return t._onBoltUpdate=t._onBoltUpdate.bind(t),t._onBoltRefresh=t._onBoltRefresh.bind(t),m.apply(t,arguments)}return n.__extends(t,e),t.initClass=function(){m=u.takes({actorId:u.Maybe(Number),context:Number,contextData:String,oref:u.Maybe(String)},function(e){var t=e.actorId,n=e.context,i=e.contextData,o=e.oref;return this.__requestOptions={actorId:t,context:n,contextData:i,oref:o,isBackgroundRequest:!0},this.__optimist=new s.Optimist(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0})},t.prototype.getFileActivity=function(){return this.__optimist.getValue()},t.prototype.isReady=function(){return this.__isReady},t.prototype.isLive=function(){return this.__isLive},t.prototype.rebase=function(e){c.assert(this.__isReady,"Cannot rebase when server data is not ready");var t=this.getFileActivity();return this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},t.prototype.commitOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready");var t=this.getFileActivity(),n=this.__optimist.commit(e);return this.emit("updated",this.getFileActivity(),t),n},t.prototype.rollbackOptimisticUpdate=function(e){c.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready");var t=this.getFileActivity();if(this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},t.prototype.init=function(){var e=this;c.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(){if(o.CommentsVortexLogger.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}).catch(function(){return e.__canInit=!0})},t.prototype.startLiveUpdate=function(){return c.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},t.prototype.stopLiveUpdate=function(){return this.__isLive=!1,null!=this.__boltClient?this.__boltClient.unsubscribe():void 0},t.prototype._doStartLiveUpdate=function(){var e=d(this.getFileActivity(),this.__boltData);return this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},t.prototype._pullFromServer=function(){var e=this;l.SessionStorage.set("reload-timestamp",(new Date).getTime());var t=a.fetchFileActivityWithBoltData(this.__requestOptions);return t.then(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=Array.from(t[0]),o=i[0],r=i[1];e.__boltData=r;var a=e.__optimist.getValue();return e.__optimist.rebase(function(){return o}),o=e.__optimist.getValue(),e.__isReady?e.emit("updated",o,a):(e.__isReady=!0,e.emit("ready",o))}),t.catch(function(t){return e.emit("error",t)}),t},t.prototype._onBoltUpdate=function(e){var t=this;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key){var n=e[0];return this.__boltData=p(n),this._pullFromServer().then(function(){if(t.__isLive)return n=d(t.getFileActivity(),t.__boltData),t.__boltClient.update_states([n])})}},t.prototype._onBoltRefresh=function(e){var t=this;return this._pullFromServer().then(function(){if(t.__isLive)return t.stopLiveUpdate(),t.startLiveUpdate()})},t})(i);return h.initClass(),h}),define("modules/clean/file_activity/clients/file_activity_data_source",["require","exports","external/lru","external/lodash","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(e,t,n,i,o,r,a,s){"use strict";var l=function(e,t,n,i){return void 0===i&&(i=""),e=null!=e?e:"",e+":"+t+":"+n+":"+i};return(function(){function e(e){var t=e._cache,n=e._unsubscribeStore,i=e._sendFileActivity,o=e._state;this.onStoreUpdate=this.onStoreUpdate.bind(this),this.onClientUpdated=this.onClientUpdated.bind(this),this._cache=t,this._unsubscribeStore=n,this._sendFileActivity=i,this._state=o}return e.initInstance=function(){var t=e;if(null==t.__instance)return t.__instance=t.create(r,function(e){return o.CommentsEvents.emit("file-activity-updated",e)})},e.getInstance=function(){var t=e;return s.assert(null!=t.__instance,"expected singleton to have been initialized"),t.__instance},e.create=function(t,i,o){void 0===o&&(o=10);var r=new n(o);r.shift=function(){var e=n.prototype.shift.call(this),t=e.value;return null!=t&&t.removeAllListeners(),null!=t&&t.stopLiveUpdate(),e};var a=new e({_cache:r,_state:{},_sendFileActivity:i});return a._unsubscribeStore=t.listen(a.onStoreUpdate),a.onStoreUpdate(t.state),a},e.prototype.dispose=function(){return this._unsubscribeStore()},e.prototype.resetCache=function(){return this._cache.removeAll()},e.prototype.replaceState=function(e){if(this.shouldUpdate(e)){this.willUpdate(e);var t=this._state;return this._state=e,this.didUpdate(t)}},e.prototype.getState=function(){return this._state},e.prototype.onStoreUpdate=function(e){var t=e.actorId,n=e.oref,i=e.viewing,o=i.context,r=i.contextData,a={oref:n,actorId:t,context:o,contextData:r};return this.replaceState(a)},e.prototype.shouldUpdate=function(e){return!i.isEqual(this._state,e)},e.prototype.willUpdate=function(e){var t=this.getCurrentClient();if(null!=t)return this.deactivateClient(t)},e.prototype.didUpdate=function(e){var t=this.getCurrentFetchKey();if(!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},e.prototype.getFetchKey=function(e){return l(e.actorId,e.context,e.contextData,e.oref)},e.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},e.prototype.getCurrentClient=function(){var e=this.getCurrentFetchKey();return this._cache.get(e)},e.prototype.isFetching=function(e){var t=this._cache.find(this.getFetchKey(e));return null!=t&&!t.isReady()},e.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},e.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},e.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},e.prototype.deactivateCurrentClient=function(){var e=this.getCurrentClient();if(null!=e)return this.deactivateClient(e)},e.prototype.fetchAndSend=function(e){var t=e.actorId,n=e.context,i=e.contextData,o=e.oref,r=l(t,n,i,o),a=this._cache.get(r);if(null!=a)return this.activateClient(a);var s=this.createFileActivityBoltClient({actorId:t,context:n,contextData:i,oref:o});return s.init(),this._cache.set(r,s),this.activateClient(s)},e.prototype.onClientUpdated=function(e){return this.sendActivity(e)},e.prototype.onClientError=function(e){throw e},e.prototype.sendActivity=function(e){return this._sendFileActivity(e)},e.prototype.createFileActivityBoltClient=function(e){return new a(e)},e.prototype.rebase=function(e){var t=this.getCurrentClient();return null!=t&&t.rebase(e)},e.prototype.commitOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t?t.commitOptimisticUpdate(e):null},e.prototype.rollbackOptimisticUpdate=function(e){var t=this.getCurrentClient();return null!=t&&t.rollbackOptimisticUpdate(e)},e})()}),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/deep-freeze","external/lodash","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,o=void 0===n?"":n,r=t.feedback_off,a=void 0!==r&&r,s=t.can_edit_feedback,l=void 0===s||s,c=t.comment_activities,u=void 0===c?[]:c,d=t.users_to_notify,p=void 0===d?[]:d,m=t.latest_revision,h=void 0===m?null:m;this.activity_key=o,this.feedback_off=a,this.can_edit_feedback=l,this.comment_activities=u,this.users_to_notify=p,this.latest_revision=h,i(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(c.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return a.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return a.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=a.thaw(this),n=this.comment_activities.map(a.thaw);return t.comment_activities=n,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(a.thaw)}),e(t),i(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=function(t){return t.activity_key===e},i=0;i<this.comment_activities.length;i++){var o=this.comment_activities[i];if(n(o))return["comment_activities",i];if(!t)for(var r=0;r<o.comment_activities.length;r++)if(n(o.comment_activities[r]))return["comment_activities",i,"comment_activities",r]}return null},e.prototype._updateComment=function(e,t){return e?a.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return a.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),a.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=function(t){return t.activity_key===e},n=0;n<this.comment_activities.length;n++){var i=this.comment_activities[n];if(t(i))return i;for(var o=0;o<i.comment_activities.length;o++){var r=i.comment_activities[o];if(t(r))return r}}return null},e.prototype.findConversationByKey=function(e){return o.find(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return a.updateIn(this,t,function(e){return a.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return a.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return e.includes(t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},n.__decorate([l.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),latest_revision:u.RevisionShape})],e,"fromDict",null),e})();t.FileActivity=d}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o instanceof RegExp&&e.match(o))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,i){"use strict";function o(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var i=e
;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(i),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var i=n[t],o=""+i.getAttribute("src"),r=this.getOriginFromUrl(o);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var i=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+i},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),o(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var i=this.getTrustedChildOriginForPosting();if(null!==i){var o=this.packagePostMessage(t,n);e.forEach(function(e){e.contentWindow&&e.contentWindow.postMessage(o,i)})}},t})(i.FrameMessengerBase);t.FrameMessengerHost=r}),define("modules/clean/growth/showcase_upsell/preview_loader",["require","exports","tslib","external/react","modules/clean/react/size_class/constants","modules/clean/react/async/loadable"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/growth/showcase_upsell/preview_gate"],t,n)}).then(function(e){return e.ShowcaseUpsellPreviewGate})}}),s=[".jpg",".jpeg",".pdf",".ppt",".pptx",".png",".tif"],l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.shouldRender=function(){var e=this.props,t=e.user,n=e.currentFile,i=e.sharedLinkInfo,r=e.variant,a=e.sizeClass,l=e.isFullscreen,c=e.hidePageChrome,u="V1"===r||"CONTROL"===r,d=t&&!t.is_team&&!t.paid,p=!i,m=n.fq_path,h=n.ext?n.ext:m?"."+m.substr(m.lastIndexOf(".")+1):"",f=s.indexOf(h)>=0,v=a===o.SizeClass.Large;return u&&d&&p&&f&&!l&&!c&&v},t.prototype.render=function(){var e=this.props,t=e.user,n=e.currentFile,o=e.variant;return t&&n&&"OFF"!==o&&this.shouldRender()?i.createElement(a,{user:t,currentFile:n,variant:o}):null},t})(i.Component);t.ShowcaseUpsellPreviewLoader=l}),define("modules/clean/image_annotations",["require","exports","jquery","modules/clean/image_preview_util","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer"],function(e,t,n,i,o,r){"use strict";function a(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){var e=this;this.onTransitionEnd=function(){e.forceResizeAndUpdateOffsets()},this.forceResizeAndUpdateOffsets=function(){e._resizeAnnotationContainer(),null!=e.annotationInterface&&e.annotationInterface.onScaleChangeCallback()},this._handleMessage=this._handleMessage.bind(this),this._onScroll=this._onScroll.bind(this),this.onResize=this.onResize.bind(this)}return e.prototype.onImageLoad=function(e){return void 0===e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},e.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new r,window.addEventListener("resize",this.onResize),i.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("transitionend",this.onTransitionEnd),window.addEventListener("message",this._handleMessage),this._postPageRendered()},e.prototype._prepareAnnotationInterface=function(){if(0===i.getAnnotationContainer().length){var e=i.getPreviewImageWrapper(),t=n("<div class='"+i.ANNOTATION_CONTAINER+"' />");this.$annotationContainer=t.appendTo(e)}return this._resizeAnnotationContainer(),this.annotationInterface=new o,i.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(this.forceResizeAndUpdateOffsets,0)},e.prototype._handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}switch(t.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=this.annotationInterface&&this.annotationInterface._updateOffset(),null!=this.annotationRenderer?this.annotationRenderer.updateAnnotations(t.parameters):void 0;case"remove-annotation":var n=t.parameters.commentActivity;return null!=this.annotationRenderer?this.annotationRenderer.removeAnnotation(n):void 0;case"remove-all-annotations":return null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0;case"enable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=this.annotationInterface?this.annotationInterface.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=this.annotationInterface?this.annotationInterface.onHideAnnotation():void 0;case"scroll-to-annotation":return n=t.parameters.commentActivity,null!=this.annotationRenderer?this.annotationRenderer.highlightAnnotation(n):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},e.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},e.prototype._postMessage=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._setRegionCreationEnabled=function(e){return e?null!=this.annotationInterface&&this.annotationInterface.enableRegionCreation():null!=this.annotationInterface&&this.annotationInterface.disableRegionCreation(),this._resizeAnnotationContainer(),null!=this.annotationInterface?this.annotationInterface._updateOffset():void 0},e.prototype._onScroll=function(){return null!=this.annotationInterface?this.annotationInterface.onScrollCallback():void 0},e.prototype.onResize=function(e){var t=this;void 0===e&&(e=!0),null!=this.annotationRenderer&&this.annotationRenderer.removeAllAnnotations(),this._postMessage("scale-change");var n=function(){return t._resizeAnnotationContainer(),t._postPageRendered(),null!=t.annotationInterface&&t.annotationInterface.onScaleChangeCallback(),"function"==typeof t.resizeImageCallback?t.resizeImageCallback():void 0};return clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},e.prototype._resizeAnnotationContainer=function(){var e=i.getPreviewImage();if(null!=e&&null!=e.offset()&&null!=a(e.offsetParent(),function(e){return e.offset()})){var t=e.offset().top-e.offsetParent().offset().top,n=e.offset().left-e.offsetParent().offset().left;return t<0&&(t=0),n<0&&(n=0),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-top",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-bottom",t),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-left",n),null!=this.$annotationContainer&&this.$annotationContainer.css("margin-right",n),(null!=this.annotationInterface?this.annotationInterface.isAnnotationRegionEnabled:void 0)?(null!=this.$annotationContainer&&this.$annotationContainer.height(e.height()),null!=this.$annotationContainer?this.$annotationContainer.width(e.width()):void 0):(null!=this.$annotationContainer&&this.$annotationContainer.height(0),null!=this.$annotationContainer?this.$annotationContainer.width(0):void 0)}},e.prototype.removeAnnotations=function(){return null!=this.annotationRenderer?this.annotationRenderer.removeAllAnnotations():void 0},e.prototype.reset=function(){return null!=this.annotationRenderer&&this.annotationRenderer.reset(),null!=this.annotationInterface&&this.annotationInterface.reset(),i.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),i.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),window.removeEventListener("transitionend",this.onTransitionEnd),this._postMessage("reset-file-feedback-ui")},e})();t.ImageAnnotations=s}),define("modules/clean/image_preview_util",["require","exports","jquery","modules/clean/react/size_class/constants","modules/clean/react/previews/image/constants","modules/clean/annotations/annotation"],function(e,t,n,i,o){"use strict";return{PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return n("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return n("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return n("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return n("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return n("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){for(var t=[],n=this.getPreviewImageElement(),i=n.clientWidth,o=n.clientHeight,r=0,a=Array.from(e.image_coordinates);r<a.length;r++){for(var s=a[r],l=[],c=0,u=Array.from(s.coordinates);c<u.length;c++){var d=u[c],p=d.x*i,m=d.y*o;l.push({x:p,y:m})}t.push(l)}return t},convertAnnotationViewportCoordinatesToImagePoints:function(e,t,n){for(var i=[],o=this.getPreviewImageElement(),r=o.clientWidth,a=o.clientHeight,s=0,l=Array.from(e.viewportCoordinates);s<l.length;s++){for(var c=l[s],u=[],d=0,p=Array.from(c);d<p.length;d++){var m=p[d],h=(m.x-t)/r,f=(m.y-n)/a;u.push({x:h,y:f})}i.push({coordinates:u})}return i},getImagePadding:function(e){return e===i.SizeClass.Large?{height:o.IMAGE_LARGE_PADDING_HEIGHT,width:o.IMAGE_LARGE_PADDING_WIDTH}:{height:o.IMAGE_PADDING_HEIGHT,width:o.IMAGE_PADDING_WIDTH}},getMinimumZoomPercent:function(e){var t=e.windowDimensions,n=e.imagePadding,i=e.imageDimensions,o=(t.height-n.height)/i.height,r=(t.width-n.width)/i.width;return Math.min(o,r,1)}}}),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,o=i;n<o.length;n++){var r=o[n],a=r[0],s=r[1],l=r[2];if(s>=e||l>=t)return a}return i[i.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),define("modules/clean/image_viewer_annotation_interface",["require","exports","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(e,t,n,i,o,r,a){"use strict";return(function(){function e(){this._prepareAnnotationController=this._prepareAnnotationController.bind(this),this._refreshAnnotationController=this._refreshAnnotationController.bind(this),this._prepareAnnotationCoords=this._prepareAnnotationCoords.bind(this),this.onHideAnnotation=this.onHideAnnotation.bind(this),this.onMouseDownCallback=this.onMouseDownCallback.bind(this),this.onMouseMoveCallback=this.onMouseMoveCallback.bind(this),this.onMouseUpCallback=this.onMouseUpCallback.bind(this),this.onKeyDownCallback=this.onKeyDownCallback.bind(this),this.onScrollCallback=this.onScrollCallback.bind(this),this.onScaleChangeCallback=this.onScaleChangeCallback.bind(this),this.onAnnotationHiddenCallback=this.onAnnotationHiddenCallback.bind(this),this.onAnnotationPlacedCallback=this.onAnnotationPlacedCallback.bind(this),this.onAnnotationStartDragCallback=this.onAnnotationStartDragCallback.bind(this),this.onAnnotationEndDragCallback=this.onAnnotationEndDragCallback.bind(this),this.onAnnotationScrollCallback=this.onAnnotationScrollCallback.bind(this),this.onAnnotationScaleChangeCallback=this.onAnnotationScaleChangeCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this.controllerEventHandlers={onMouseMoveCallback:o.noop,onMouseDownCallback:o.noop,onMouseUpCallback:o.noop,onHideAnnotation:o.noop,onScrollCallback:o.noop,onScaleChangeCallback:o.noop,onKeyDownCallback:o.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype._isOnAnnotationUI=function(e){return o(e.target).parents(".db-annotation-layer").length>0},e.prototype._isOnAnnotationOverlay=function(e){return o(e.target).parents("#annotation-overlay").length>0},e.prototype._destroyAnnotationController=function(){var e=a.getAnnotationLCanvasLayer();if((null!=e?e.length:void 0)>0)return i.unmountComponentAtNode(e[0]),e.remove()},e.prototype._prepareAnnotationController=function(){var e=a.getAnnotationContainer();if(0===e.find("."+a.ANNOTATION_CANVAS_LAYER_CSS).length){var t=o("<div class='"+a.ANNOTATION_CANVAS_LAYER_CSS+"' />");return this.$parentContainerEl=t.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()}},e.prototype._refreshAnnotationController=function(e){if(null!=this.$parentContainerEl?this.$parentContainerEl.get(0):void 0)return this.annotationController=i.render(n.createElement(r,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},e.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},e.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=a.convertAnnotationViewportCoordinatesToImagePoints(e,this.parentContainerOffset.left,this.parentContainerOffset.top),e},e.prototype._updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},e.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},e.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},e.prototype.enableRegionCreation=function(){return o("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},e.prototype.disableRegionCreation=function(){return o("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},e.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),a.getAnnotationContainer().remove()},e.prototype.onHideAnnotation=function(){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation():void 0},e.prototype.onMouseDownCallback=function(e){if(!this._isOnAnnotationUI(e)&&!this._isOnAnnotationOverlay(e))return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseDownCallback(e):void 0},e.prototype.onMouseMoveCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseMoveCallback(e):void 0},e.prototype.onMouseUpCallback=function(e){return null!=this.controllerEventHandlers?this.controllerEventHandlers.onMouseUpCallback(e):void 0},e.prototype.onKeyDownCallback=function(e){var t=e.keyCode||e.which||e.charCode;return this._sendToParent("on-keydown",{keyCode:t})},e.prototype.onScrollCallback=function(e){if(this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onScrollCallback():void 0),!(null!=this.annotationController?this.annotationController.hasVisibleActiveAnnotation():void 0))return this._sendToParent("scroll")},e.prototype.onScaleChangeCallback=function(e){return this._updateOffset(null!=this.controllerEventHandlers?this.controllerEventHandlers.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},e.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},e.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},e.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},e.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},e.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},e})()}),define("modules/clean/image_viewer_annotation_renderer",["require","exports","external/react","external/react-dom","jquery","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui"],function(e,t,n,i,o,r,a){"use strict";var s=new r;return(function(){function e(){this.removeAnnotation=this.removeAnnotation.bind(this),this.updateAnnotations=this.updateAnnotations.bind(this),this._renderAnnotation=this._renderAnnotation.bind(this),this.onAnnotationClickCallback=this.onAnnotationClickCallback.bind(this),this.onAnnotationEnterCallback=this.onAnnotationEnterCallback.bind(this),this.onAnnotationLeaveCallback=this.onAnnotationLeaveCallback.bind(this),this._annotationsByActivityKey={}}return e.prototype._isAnnotationAlreadyRendered=function(e){return o("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},e.prototype.removeAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=o("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0);return i.unmountComponentAtNode(t),t.remove()}},e.prototype.removeAllAnnotations=function(){return this.reset()},e.prototype.reset=function(){for(var e=a.getAnnotationLayers(),t=0,n=Array.from(e);t<n.length;t++){var o=n[t];i.unmountComponentAtNode(o)}return e.remove(),this._annotationsByActivityKey={}},e.prototype.highlightAnnotation=function(e){if(this._isAnnotationAlreadyRendered(e.activity_key)){var t=o("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']");return t.removeClass("start-highlight-animation"),t.width(t.width()),t.addClass("start-highlight-animation")}},e.prototype.updateAnnotations=function(e){var t=this;if(s.shouldUpdateAnnotations(e,this._annotationsByActivityKey))return this.removeAllAnnotations(),(function(){for(var n=[],i=0,o=Array.from(e.annotations);i<o.length;i++){var r=o[i];s.renderAnnotation(r,t._isAnnotationAlreadyRendered,t._renderAnnotation);var a=r.commentActivity.activity_key;n.push(t._annotationsByActivityKey[a]=r)}return n})()},e.prototype._renderAnnotation=function(e,t,r,s){var l=a.getAnnotationContainer();if((null!=l?l.length:void 0)>0){t.viewportCoordinates=a.convertAnnotationImagePointsToViewportCoordinates(t);var c=o("<div class='"+a.ANNOTATION_LAYER_CSS+"' />");c.attr({"data-comment-activity-key":r.activity_key});var u=c.appendTo(l).get(0);return i.render(n.createElement(e,{annotation:t,commentActivity:r,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),u)}},e.prototype._sendToParent=function(e,t){return void 0===t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},e.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},e.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},e.prototype.onAnnotationOverCallback=function(e){return{}},e.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},e})()}),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,i,o,r,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p={};p[r.EventType.FilePreviewSessionEnded]="preview_session_ended",p[r.EventType.FilePreviewAttemptStarted]="preview_attempted",p[r.EventType.FilePreviewSupportConfirmed]="support_confirmed",p[r.EventType.FilePreviewSupportDenied]="support_denied",p[r.EventType.FilePreviewDownloadAttempted]="download_attempted",p[r.EventType.FilePreviewDownloadSucceeded]="download_succeeded",p[r.EventType.FilePreviewDownloadFailed]="download_failed",p[r.EventType.FilePreviewRenderSucceeded]="render_succeeded",p[r.EventType.FilePreviewRenderFailed]="render_failed",p[r.EventType.FilePreviewQualityPopupAsked]="quality_popup_asked",p[r.EventType.FilePreviewQualityPopupAnswered]="quality_popup_answered",p[r.EventType.FilePreviewQualityPopupDismissed]="quality_popup_dismissed",p[r.EventType.FilePreviewUserAction]="user_action",p[r.EventType.ArchivePreviewContentsScanned]="archive_contents_scanned";var m=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=e;n<i.length;n++){var o=i[n],r=o[0],a=o[1];this._eventHandlers[r]=a}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var i=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:p[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:i?JSON.stringify(i):null,file_preview_size:t.previewSize};o.SilentBackgroundBeaconRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),h=(function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,i){void 0===i&&(i={}),Object.keys(n).forEach(function(e){var t=parseInt(e,10);i[l.getQuestionLoggerKey(t)]=n[t]}),t._log(r.EventType.FilePreviewQualityPopupAnswered,e,i)},t._logQuestion=function(e,n){for(var i={},o=0,a=n;o<a.length;o++){var s=a[o];i[l.getQuestionLoggerKey(s)]="1"}t._log(r.EventType.FilePreviewQualityPopupAsked,e,i)},t._logDismissed=function(e,n){var i={stage:s.getPopupStageLoggerKey(n)};t._log(r.EventType.FilePreviewQualityPopupDismissed,e,i)},t.addEventHandlers([r.EventType.FilePreviewQualityPopupAsked,t._logQuestion],[r.EventType.FilePreviewQualityPopupAnswered,t._logAnswers],[r.EventType.FilePreviewQualityPopupDismissed,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,i){void 0===i&&(i={}),i._client_time=+Date.now();var o=n.sourceContext,r=n.sourceAction;o&&(i._source_context=o),r&&(i._source_action=r),e.prototype._log.call(this,t,n,i)},t})(m);t.FilePreviewQualityPopupLogger=h;var f=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(r.EventType.FilePreviewAttemptStarted,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportConfirmed,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(r.EventType.FilePreviewSupportDenied,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadAttempted,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadSucceeded,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewDownloadFailed,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderSucceeded,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(r.EventType.FilePreviewRenderFailed,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(r.EventType.FilePreviewSessionEnded,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([r.EventType.FilePreviewAttemptStarted,n._handleFilePreviewAttemptStarted],[r.EventType.FilePreviewSupportConfirmed,n._handleFilePreviewSupportConfirmed],[r.EventType.FilePreviewSupportDenied,n._handleFilePreviewSupportDenied],[r.EventType.FilePreviewDownloadAttempted,n._handleFilePreviewDownloadAttempted],[r.EventType.FilePreviewDownloadSucceeded,n._handleFilePreviewDownloadSucceeded],[r.EventType.FilePreviewDownloadFailed,n._handleFilePreviewDownloadFailed],[r.EventType.FilePreviewRenderSucceeded,n._handleFilePreviewRenderSucceeded],[r.EventType.FilePreviewRenderFailed,n._handleFilePreviewRenderFailed],[r.EventType.FilePreviewSessionEnded,n._handleFilePreviewSessionEnded]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,n.source_context=t.sourceContext,n.source_action=t.sourceAction,n.is_mounted=t.isMounted,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark());var o=c.start_time();void 0!==o&&(n.navigation_start=o),null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailInfo&&(n.preview_thumbnail_info=JSON.stringify(t.previewThumbnailInfo)),t.didFallbackToPdfjs&&(n.fallback_pdfjs=!0),t.isSSR&&(n.is_ssr="1"),null!=t.lastEvent&&(n.last_event=p[t.lastEvent]),i.isEmpty(t.ssrTimestamps)||(n.ssr_timestamps=JSON.stringify(t.ssrTimestamps)),i.isEmpty(t.ssrTiming)||(n.ssr_timing=JSON.stringify(t.ssrTiming));var s=t.previewTimeline[r.EventType.FilePreviewRenderSucceeded];if(s&&(n.time_to_render=t.timeToMark(s.timestamp)),t.sourceAction===a.PreviewSourceAction.Visit){var l=c.time_since_start();if(null!=l&&(n.time_to_event=l),e===r.EventType.FilePreviewRenderSucceeded){var m=c.time_to_view();null!=m&&null!=o&&(n.ttv_ts=m);var h=c.time_to_interactive();null!=h&&null!=o&&(n.time_to_interactive=h-o);var f=d.performance();if(null!=f){var v=f.timing;null!=v&&null!=o&&(n.time_to_first_byte=v.responseStart-o,n.web_timing_data=JSON.stringify(v))}window._timingData&&window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img))}}e===r.EventType.FilePreviewSessionEnded&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched),n.zoom_scales=JSON.stringify(t.zoomScales),n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var i=e.previewTimeline[n],o=this._timelineKey(n);t[o]=i.timestamp}return t},t.prototype._timelineKey=function(e){return p[e]+"_ts"},t})(m);t.FilePreviewTimelineLogger=f;var v=(function(e){function t(){var t=e.call(this)||this;return t.logContentsScanned=function(e,n){t._log(r.EventType.ArchivePreviewContentsScanned,e,n)},t.addEventHandlers([r.EventType.ArchivePreviewContentsScanned,t.logContentsScanned]),t}return n.__extends(t,e),t})(m);t.FilePreviewArchiveLogger=v;var _=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,i,o){o.action=n,o.context=i,t._log(r.EventType.FilePreviewUserAction,e,o)},t.addEventHandlers([r.EventType.FilePreviewUserAction,t._logUserAction]),t}return n.__extends(t,e),t})(m);t.FilePreviewUserActionLogger=_}),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/file_store/utils","modules/constants/python"],function(e,t,n,i,o,r){"use strict";function a(){return i.UserActivityLogger.start("web","file_view_first_page_rendered"),i.PreviewActivityLogger.start("file_view_first_page_rendered"),i.FileViewLogger.start()}function s(e,t){e=e;for(var r=o.getExtension(e),a=n.__assign({},t.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),s=0,l=t.stats;s<l.length;s++){var u=l[s];a[c[u.name]]=u.end-u.start}return i.UserActivityLogger.stop("web","file_view_first_page_rendered",a),i.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(a)})}function l(e,t,n,a,s,l,c){void 0===c&&(c=!1);var u={user_id:null!=t?t.id:void 0,target:n,platform:r.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:a,action:s,shared_link_url:l,extra:{file_ext:o.getExtension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),is_ndsl:c}};return i.FileViewLogger.stop(u)}Object.defineProperty(t,"__esModule",{value:!0});var c={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.start=a,t.logPageRendered=s,t.logView=l
}),define("modules/clean/loggers/video_preview_logger",["require","exports","modules/clean/ajax","modules/clean/perf_tools/web_timing_utils"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t){this.videoTruncated=!1,this.filePreviewSessionId=t?t.id:"",this.videoFormat=e}return e.prototype.populateVideoDuration=function(e){this.videoDuration=Math.round(e)},e.prototype.setVideoTruncated=function(){this.videoTruncated=!0},e.prototype.logEvent=function(e,t){var o=i.WebTimingUtil.getNow(),r={event_name:e,client_timestamp_ms:o,file_preview_session_id:this.filePreviewSessionId,video_format:this.videoFormat,video_duration_seconds:this.videoDuration,video_truncated:this.videoTruncated,extra:t?JSON.stringify(t):void 0};n.SilentBackgroundBeaconRequest({url:"/log/video_preview",data:r})},e})();t.VideoPreviewLogger=o}),define("modules/clean/open_with",["require","exports","external/lodash","modules/clean/filepath","modules/core/uri"],function(e,t,n,i,o){"use strict";var r=void 0,a=void 0,s=void 0,l=(function(){function e(){}return e.initClass=function(){this.PRELOAD_URLS={},this.MAX_SUPPORTED_FILE_SIZE_B=157286400,r=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],a=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"google_dss_docs",ext:["gdoc"],icon:"google_dss_docs",name:"Google Docs Online Editor"},{id:"google_dss_sheets",ext:["gsheet"],icon:"google_dss_sheets",name:"Google Sheets Online Editor"},{id:"google_dss_slides",ext:["gslides"],icon:"google_dss_slides",name:"Google Slides Online Editor"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],s=function(e){var t=i.filename(e),o=i.file_extension(t);return n.find(a,function(e){return Array.from(e.ext).includes(o)})}},e.get_open_handler_for=function(t,n){var i=s(t.fq_path);if(!i||!e.is_app_supported_for_file(i.id,t))return null;var r=o.URI.encode_parts(t.fq_path),a=e.uri_path_base(i.id),l="personal"===n.role?"/personal":"/work";return{icon:i.icon,name:i.name,uri:""+a+l+r}},e.uri_path_base=function(e){switch(e){case"google_dss_docs":return"/google_dss/docs/edit/path";case"google_dss_sheets":return"/google_dss/sheets/edit/path";case"google_dss_slides":return"/google_dss/slides/edit/path";default:return"/ow/msft/edit"}},e.file_supported=function(e){return!!s(e.fq_path)},e.is_adobe_app=function(e){return Array.from(r).includes(e)},e.is_app_supported_for_file=function(e,t){switch(e){case"google_dss_docs":return t.is_cloud_doc;case"google_dss_sheets":return t.is_cloud_doc;case"google_dss_slides":return t.is_cloud_doc;case"word":case"excel":case"powerpoint":return!0;case"wopitest":return!1;case"wopitest-unsupported":return!1;default:return!1}},e})();return l.initClass(),l}),define("modules/clean/optimistic_update",["require","exports","external/lodash"],function(e,t,n){"use strict";function i(e){return n.isString(e)}Object.defineProperty(t,"__esModule",{value:!0});var o={},r=(function(){function e(e){this._base=e,this._journal=[],this._head=o}return e.prototype.getValue=function(){return this._head===o&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=o,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(i(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=o,this._base=t.patch(this._base,e),!0)}return this._head=o,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=o,this._journal.splice(t,1)[0])},e})();t.Optimist=r}),define("modules/clean/previews/actions",["require","exports","modules/clean/previews/file_view_rams_common","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){var i=n.getNativePrintUrl(e,t);return null!=i&&(window.open(i,"_blank"),!0)}function l(e,t,n,r){return!!(e&&null!=n?c(n,t):u(t))&&(i.logUserAction(o.UserAction.Print,r),!0)}function c(e,t){return s(a.URI.parse(e).setQuery({preview:"1"}),a.URI.parse(t).getAuthority())}function u(e){return s(a.URI.parse(e),a.URI.parse(e).getAuthority())}function d(e){var t=window.open("about:blank");if(!t)throw new Error(r._("Could not open new window"));window.setTimeout(function(){var n=t.document.createElement("style");n.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(n);var i=function(){t.print()},o=function(){t.close()},r=t.document.createElement("img");r.src=e,r.onload=i,r.onerror=o,t.document.body.appendChild(r)},50)}Object.defineProperty(t,"__esModule",{value:!0}),t.nativePrint=l,t.imagePrint=d}),define("modules/clean/previews/cookie_preview_tracer",["require","exports","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/core/cookies","modules/constants/file_viewer"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t){var a=this;this.sessionId=e,this.onPreviewAttempt=function(){o.Cookies.create(r.FILE_PREVIEW_SESSION_ID_COOKIE,a.sessionId,null,r.FILE_PREVIEW_SESSION_ID_COOKIE_DOMAIN)},this.onPreviewCompleted=function(){o.Cookies.delete(r.FILE_PREVIEW_SESSION_ID_COOKIE)},this.previewEventEmitter=t,t.addListener(n.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var s=0,l=i.FilePreviewSessionEndEvents;s<l.length;s++){var c=l[s];t.addListener(c,this.onPreviewCompleted)}}return e.prototype.teardown=function(){this.previewEventEmitter.removeListener(n.EventType.FilePreviewAttemptStarted,this.onPreviewAttempt);for(var e=0,t=i.FilePreviewSessionEndEvents;e<t.length;e++){var o=t[e];this.previewEventEmitter.removeListener(o,this.onPreviewCompleted)}this.onPreviewCompleted()},e})();t.CookiePreviewTracer=a}),define("modules/clean/previews/file_view_rams_common",["require","exports","modules/core/browser","modules/core/uri"],function(e,t,n,i){"use strict";function o(e){return e=e.toLowerCase(),s.indexOf(e)>-1||e.endsWith("dl.dropboxusercontent.com")}function r(){return n.chrome||n.safari||n.edge}function a(e,t){if(!r())return null;if(!o(t))return null;var n=e.clone();n.updateQuery({disable_range:"1",from_native_print:"1"});var a=i.URI.parse("https://"+t+"/nativeprint");return a.updateQuery({file:n.toString()}),a.toString()}Object.defineProperty(t,"__esModule",{value:!0});var s=["dl-web.dropbox.com","previews.dropbox.com","previews.dropboxusercontent.com","dl.dropboxusercontent.com"];t.getNativePrintUrl=a}),define("modules/clean/previews/pending_upload_watcher",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t,n){void 0===n&&(n=""),this.pollUrl=new r.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void i.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():o.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=a}),define("modules/clean/previews/util",["require","exports","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/previews/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";function d(){return".react-file-viewer__preview iframe"}function p(){return c.PASS_PLATFORM_INFO}function m(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function h(e){var t=r.file_extension(e);return c.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:c.LOGGING_EXT_PLACEHOLDER}function f(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":case"wpd":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function v(e,t){var n,i=f(e),o=u.URI.parse(t);return"xls"===i&&(n="xls/preview",o.setPath(o.getPath().replace("/pri/get/","/get/")),o.setPath(o.getPath().replace("/get/","/"+n+"/"))),o}function _(e){if(e.ts)return o.getActingTime(1e3*e.ts)}function g(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function y(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function w(e,t){return y(new u.URI({path:"/history"+e.fq_path}),t.id)}function b(e,t){i.UserActivityLogger.log("web","view_version_history");var o=w(e,t);n.redirect(o.toString())}function C(e){return c.PRESENTATION_EXTS.map(function(e){return e.slice(1)}).includes(e)}function S(e){return["doc","docm","docx"].includes(e)}function E(e){return["odp","odt","rtf","wpd"].includes(e)}function A(e){return t.VALID_PREVIEW_TYPES.indexOf(e.preview_type)>-1}function T(e){var t=s.getExtension(e),n=e.bytes;if(void 0===n)return!0;var i=Number.MAX_VALUE;return"pdf"===t?i=Number(524288e3):S(t)||E(t)?i=a.MAX_WORD_DOC_FILE_SIZE_B:C(t)?i=a.MAX_PPT_FILE_SIZE_B:e.preview_type===a.PreviewType.Archive?i=a.MAX_ARCHIVE_FILE_SIZE_B:e.preview_type===a.PreviewType.Text?i=Number(8388608):e.preview_type===a.PreviewType.Linkfile?i=Number(10240):n=0,n<=i}function P(e){return 0===e.bytes}function k(e){return A(e)&&T(e)}function x(e){var t=s.getExtension(e);return k(e)&&R(t)}function R(e){var t=f(e);return["doc","ppt","xls","key","eps","ai"].indexOf(t)>-1}function I(e,t){return[a.PreviewType.Doc,a.PreviewType.Excel,a.PreviewType.Text].indexOf(e)>-1&&"epub"!==t}function O(e){var t=l.ErrorType.LoadError;return e===l.RivieraConvertResponseType.TooBig?t=l.ErrorType.FileSizeError:e===l.RivieraConvertResponseType.PasswordProtected&&(t=l.ErrorType.PasswordProtectedError),t}function F(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}function M(e,t){return e&&t?u.URI.parse(e).updateQuery({psid:t.id}).toString():e}function D(e){return a.IworkExtensions.includes(s.getExtension(e))&&!e.is_dir}function L(e){return a.IworkExtensions.includes(s.getExtension(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.getIframeQuery=d,t.shouldShowPlatformInfo=p,t.is_excel2_file=m,t.getWhitelistedExtension=h,t.normalize_extension=f,t.get_progressive_url=v,t.getModifierString=_,t.update_url_for_annotation=g,t.update_url_with_user_id=y,t.getVersionHistoryUrl=w,t.redirectToVersionHistory=b,t.VALID_PREVIEW_TYPES=[a.PreviewType.Archive,a.PreviewType.Audio,a.PreviewType.CloudDoc,a.PreviewType.Doc,a.PreviewType.Excel,a.PreviewType.HTML,a.PreviewType.Linkfile,a.PreviewType.Photo,a.PreviewType.Text,a.PreviewType.Video],t.isPptExtension=C,t.isWordDocExtension=S,t.isLibreOfficeExtension=E,t.extensionSupported=A,t.filesizeSupported=T,t.isEmptyFile=P,t.isPreviewable=k,t.canGeneratePreview=x,t.extCanGeneratePreview=R,t.usesFrameMessenger=I,t.mapRivieraStatusToErrorType=O,t.generateDucId=function(e){var t,n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{t=(crypto||window.msCrypto).getRandomValues(new Uint8Array(e))}catch(e){t=[]}null==t&&(t=[]);for(var i="",o=0;o<e;++o){var r=void 0;r=e===t.length?t[o]%n.length:Math.floor(Math.random()*n.length),i+=n[r]}return i},t.iOSIframeScrollStyles=F,t.tagCriticalPathContentRequest=M,t.isLimitedPreview=D,t.isSupportedBundleFile=L}),define("modules/clean/react/comments2/components/mobile_web_comments",["require","exports","tslib","external/react","modules/clean/web_timing_logger","modules/clean/react/async/loadable","modules/clean/react/file_sidebar/base_comments_tab","modules/clean/react/comments2/util"],function(e,t,n,i,o,r,a,s){"use strict";function l(e){var o=e.currentFile,r=e.sharedLinkInfo,l=e.user;if(s.shouldUseComments2MobileWeb({previewType:o.preview_type||void 0,viewer:l})&&null!=o.ns_id){var c={currentFile:o,sharedLinkInfo:r,user:l,isMobile:!0};return i.createElement(a.BaseCommentsTab,n.__assign({},c,{commentsDisabledOnFile:!1,shouldInitiallyFocusInput:!0,content:function(){return i.createElement(t.AsyncMobileWebComments,n.__assign({},c))}}))}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMobileWebComments=r.Loadable({loader:function(){return o.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/comments2/components/comments_pane"],t,n)}).then(function(e){return e.CommentsPane})})}}),t.MobileWebComments=l}),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","modules/core/browser","modules/clean/react/comments2/data/api","modules/clean/api_v2/error","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/util","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/helper","modules/clean/react/comments2/logger","modules/clean/bolt"],function(e,t,n,i,o,r,a,s,l,c,u,d,p){"use strict";function m(e){var t=this,i=e.userId,r=e.startAction,a=e.successAction,s=e.clientFn,l=e.errorAction,c=e.loggingFn,d=e.loggingData;return function(e){return n.__awaiter(t,void 0,void 0,function(){var t,p,m;return n.__generator(this,function(n){switch(n.label){case 0:e(r()),t=new o.Comments2Api(i),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s(t)];case 2:return p=n.sent(),e(a(p)),c&&d&&c(i,d,p),[3,4];case 3:return m=n.sent(),e(l(m)),d&&u.Comments2Helper.logCommentError(i,d),[3,4];case 4:return[2]}})})}}function h(){return{type:s.ActionType.ListCommentsRequest,payload:{}}}function f(){return{type:s.ActionType.ListCommentsError,payload:{}}}function v(e,t,n){return{type:s.ActionType.ListCommentsSuccess,payload:{threads:e,authors:t,activeCommentId:n}}}function _(e,t,n,i,o){return{type:s.ActionType.AddCommentRequest,payload:{author:e,content:t,annotation:i,threadId:o,guid:n}}}function g(e){return{type:s.ActionType.AddCommentError,payload:{guid:e}}}function y(e,t){return{type:s.ActionType.AddCommentSuccess,payload:{id:e,guid:t}}}function w(e,t){return{type:s.ActionType.EditCommentRequest,payload:{commentId:e,content:t}}}function b(e,t){return{type:s.ActionType.EditCommentError,payload:{commentId:e,error:t}}}function C(e){return{type:s.ActionType.EditCommentSuccess,payload:{commentId:e}}}function S(e){return{type:s.ActionType.ActivateThread,payload:{thread:e}}}function E(){return{type:s.ActionType.DeactivateAllThreads,payload:{}}}function A(){return{type:s.ActionType.MarkThreadReadRequest,payload:{}}}function T(){return{type:s.ActionType.MarkThreadReadError,payload:{}}}function P(e){return{type:s.ActionType.MarkThreadReadSuccess,payload:{threadId:e}}}function k(){return{type:s.ActionType.MarkThreadUnreadRequest,payload:{}}}function x(){return{type:s.ActionType.MarkThreadUnreadError,payload:{}}}function R(e){return{type:s.ActionType.MarkThreadUnreadSuccess,payload:{threadId:e}}}function I(e){return{type:s.ActionType.MarkThreadResolvedRequest,payload:{threadId:e}}}function O(e,t){return{type:s.ActionType.MarkThreadResolvedError,payload:{threadId:e,error:t}}}function F(e){return{type:s.ActionType.MarkThreadResolvedSuccess,payload:{threadId:e}}}function M(){return{type:s.ActionType.MarkThreadUnresolvedRequest,payload:{}}}function D(){return{type:s.ActionType.MarkThreadUnresolvedError,payload:{}}}function L(e){return{type:s.ActionType.MarkThreadUnresolvedSuccess,payload:{threadId:e}}}function N(){return{type:s.ActionType.ToggleShowResolved,payload:{}}}function U(e){return{type:s.ActionType.DeleteCommentRequest,payload:{commentId:e}}}function q(e,t){return{type:s.ActionType.DeleteCommentError,payload:{commentId:e,error:t}}}function V(e){return{type:s.ActionType.DeleteCommentSuccess,payload:{commentId:e}}}function B(e){return{type:s.ActionType.UpdatePlayerCurrentTime,payload:{currentTime:e}}}function H(){return{type:s.ActionType.CheckOnboardingStatusRequest,payload:{}}}function K(){return{type:s.ActionType.CheckOnboardingStatusError,payload:{}}}function z(e){return{type:s.ActionType.CheckOnboardingStatusSuccess,payload:{onboardingResult:e}}}function W(){return{type:s.ActionType.MarkHasOnboardedRequest,payload:{}}}function j(e){return{type:s.ActionType.MarkHasOnboardedSuccess,payload:{onboardingKey:e}}}function G(){return{type:s.ActionType.MarkHasOnboardedError,payload:{}}}function Z(e){var t=e.user,n=e.author,i=e.stream,o=e.comment,r=e.content,a=e.annotation,s=e.threadId,l=e.guid;return m({userId:t.id,startAction:function(){return _(n,r,l,a,s)},clientFn:function(e){return e.addComment(i,o,s)},successAction:function(e){return y(e.id,l)},errorAction:function(e){return g(l)},loggingFn:u.Comments2Helper.getLoggingFnWithCommentAcknowledgementResult,loggingData:{event:s?"reply_to_comment":"new_comment",stream:i,threadId:s}})}function Q(e,t){return m({userId:e.id,startAction:W,clientFn:function(e){return e.markHasOnboarded(t)},successAction:function(e){return j(t)},errorAction:function(e){return G()},loggingFn:null,loggingData:null})}function Y(e,t,n){return m({userId:e.id,startAction:function(){return U(n)},clientFn:function(e){return e.deleteComment(t,n)},successAction:function(e){return V(n)},errorAction:function(e){return q(n,e)},loggingFn:u.Comments2Helper.getLoggingFnWithCommentAcknowledgementResult,loggingData:{event:"delete_comment",stream:t,commentId:n}})}function X(e,t,n,i){var o=a.iCommentContentToUserSubmittedComment({content:i,stream:t});return m({userId:e.id,startAction:function(){return w(n,i)},clientFn:function(e){return e.editComment(t,n,o)},successAction:function(e){return C(n)},errorAction:function(e){return b(n,e)},loggingFn:u.Comments2Helper.getLoggingFnWithCommentAcknowledgementResult,loggingData:{event:"edit_comment",stream:t,commentId:n}})}function J(e,t,n,i){return m({userId:e.id,startAction:A,clientFn:function(e){return e.markThreadRead(t,n)},successAction:function(e){return P(e.id)},errorAction:function(e){return T()},loggingFn:u.Comments2Helper.getLoggingFnWithThreadAcknowledgementResult,loggingData:{event:i===s.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read",stream:t,threadId:n}})}function $(e,t,n){return m({userId:e.id,startAction:k,clientFn:function(e){return e.markThreadUnread(t,n)},successAction:function(e){return R(e.id)},errorAction:function(e){return x()},loggingFn:u.Comments2Helper.getLoggingFnWithThreadAcknowledgementResult,loggingData:{event:"mark_thread_as_unread",stream:t,threadId:n}})}function ee(e,t,n){return m({userId:e.id,startAction:function(){return I(n)},clientFn:function(e){return e.markThreadResolved(t,n)},successAction:function(e){return F(e.id)},errorAction:function(e){return O(n,e)},loggingFn:u.Comments2Helper.getLoggingFnWithThreadAcknowledgementResult,loggingData:{event:"resolve_thread",stream:t,threadId:n}})}function te(e,t,n){return m({userId:e.id,startAction:M,clientFn:function(e){return e.markThreadUnresolved(t,n)},successAction:function(e){return L(e.id)},errorAction:function(e){return D()},loggingFn:u.Comments2Helper.getLoggingFnWithThreadAcknowledgementResult,loggingData:{event:"unresolve_thread",stream:t,threadId:n}})}function ne(e){return m({userId:e,startAction:H,clientFn:function(e){return e.checkOnboardingStatus()},successAction:function(e){return z(e)},errorAction:function(e){return K()},loggingFn:null,loggingData:null})}function ie(e){var t=this,i={type:s.ActionType.SuppressOnboardingForSession,payload:{onboardingKey:e}};return function(e){return n.__awaiter(t,void 0,void 0,function(){return n.__generator(this,function(t){return e(i),[2]})})}}function oe(e){return{type:s.ActionType.RecordPausePlay,payload:{isPaused:e}}}function re(){var e=/comment_id=(.*)/.exec(i.get_uri().getFragment());return e?e[1]:void 0}function ae(e){var t=this;return void 0===e&&(e=!0),function(i,a){return n.__awaiter(t,void 0,void 0,function(){var t,l,u,p,m,_,g,y,w,b,C,S;return n.__generator(this,function(n){switch(n.label){case 0:if(t=a(),l=c.getContext(t),!l)return[2];i(h()),u=l.stream,p=l.viewer,n.label=1;case 1:return n.trys.push([1,6,,7]),m=p?new o.Comments2Api(p.id):new o.Comments2LoggedOutApi,[4,m.listComments(u)];case 2:if(_=n.sent(),g=_.bolt_info,y=_.status,w=_.threads,b=_.users,C=c.getContextStatus(t),C===s.Comments2ContextStatus.Pending)switch(y[".tag"]){case"disabled":i(ce(s.Comments2ContextStatus.Disabled));break;case"enabled":case"readonly":i(ce(s.Comments2ContextStatus.Comments2));break;case"comments1":i(ce(s.Comments2ContextStatus.Comments1))}return C!==s.Comments2ContextStatus.Comments2&&(C!==s.Comments2ContextStatus.Pending||"enabled"!==y[".tag"]&&"readonly"!==y[".tag"])?[3,5]:[4,i(se(g))];case 3:return n.sent(),[4,i(v(w,b,e?re():void 0))];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:return S=n.sent(),S instanceof r.ApiError&&(S.error&&"file_not_found"===S.error[".tag"]?i(ce(s.Comments2ContextStatus.Disabled)):p&&d.commentLogger.logEvent(p.id,"comment_error",u)),i(f()),[3,7];case 7:return[2]}})})}}function se(e){var n=e.revision,i=e.token;return function(e,o){var r=c.getContext(o());r&&t.bolt.subscribe({id:r.stream.id,revision:n,token:i},function(){return e(ae(!1))})}}function le(e){return{type:s.ActionType.SetContext,payload:{context:e}}}function ce(e){return{type:s.ActionType.SetContextStatus,payload:{status:e}}}function ue(e){var i=this;return function(o,r){return n.__awaiter(i,void 0,void 0,function(){var i,a;return n.__generator(this,function(n){switch(n.label){case 0:return i=r(),a=c.getContext(i),l.isContextSame(a,e)?[3,3]:(t.bolt.unsubscribe(),o(le(e)),e?l.shouldUseComments2({previewType:e.stream.previewType,viewer:e.viewer})?[4,o(ae())]:[3,2]:[3,3]);case 1:return n.sent(),[3,3];case 2:o(ce(s.Comments2ContextStatus.Comments1)),n.label=3;case 3:return[2]}})})}}Object.defineProperty(t,"__esModule",{value:!0});t.listCommentsRequest=h,t.listCommentsError=f,t.listCommentsSuccess=v,t.addCommentRequest=_,t.addCommentError=g,t.addCommentSuccess=y,t.editCommentRequest=w,t.editCommentError=b,t.editCommentSuccess=C,t.activateThread=S,t.deactivateAllThreads=E,t.markThreadReadRequest=A,t.markThreadReadError=T,t.markThreadReadSuccess=P,t.markThreadUnreadRequest=k,t.markThreadUnreadError=x,t.markThreadUnreadSuccess=R,t.markThreadResolvedRequest=I,t.markThreadResolvedError=O,t.markThreadResolvedSuccess=F,t.markThreadUnresolvedRequest=M,t.markThreadUnresolvedError=D,t.markThreadUnresolvedSuccess=L,t.toggleShowResolved=N,t.deleteCommentRequest=U,t.deleteCommentError=q,t.deleteCommentSuccess=V,t.updatePlayerCurrentTime=B,t.checkOnboardingStatusRequest=H,t.checkOnboardingStatusError=K,t.checkOnboardingStatusSuccess=z,t.markHasOnboardedRequest=W,t.markHasOnboardedSuccess=j,t.markHasOnboardedError=G,t.addComment=Z,t.markOnboarded=Q,t.deleteComment=Y,t.editComment=X,t.markThreadRead=J,t.markThreadUnread=$,t.markThreadResolved=ee,t.markThreadUnresolved=te,t.checkOnboardingStatus=ne,t.suppressOnboardingForSession=ie,t.recordPausePlay=oe,t.listComments=ae,t.bolt={client:null,subscribe:function(e,n){var i=e.id,o=e.revision,r=e.token;if(null===t.bolt.client){var a=new p.SignedChannelState("comments2",i,o,r),s=function(){t.bolt.client=new p.BoltClient([a],n,l),t.bolt.client.start()},l=function(e){t.bolt.unsubscribe(),s()};s()}},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}},t.setFileContext=ue}),define("modules/clean/react/comments2/data/api",["require","exports","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/core/browser"],function(e,t,n,i,o){"use strict";function r(e){return"file"===e.type}function a(e){var t={".tag":e.type},n=null;return r(e)&&(n=e.linkUrl?{".tag":"shared_link_details",url:e.linkUrl}:{".tag":"file_path_or_id",file_path_or_id:e.id}),{type:t,identifier:n}}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){this.routes=(new n.ApiV2Client).ns("comments2"),this.params={subjectUserId:null}}return e.prototype.listComments=function(e){return this.routes.rpc("logged_out/list_comments",{stream:a(e)},this.params)},e})();t.Comments2LoggedOutApi=s;var l=(function(){function e(e){this.routes=(new i.ApiV2RootAwareClient).ns("comments2"),this.params={subjectUserId:e}}return e.prototype.addComment=function(e,t,n){return this.routes.rpc("add_comment",{stream:a(e),comment:t,thread_id:n},this.params)},e.prototype.deleteComment=function(e,t){return this.routes.rpc("delete_comment",{stream:a(e),id:t},this.params)},e.prototype.editComment=function(e,t,n){return this.routes.rpc("edit_comment",{stream:a(e),id:t,comment:n},this.params)},e.prototype.listComments=function(e){return this.routes.rpc("list_comments",{stream:a(e)},this.params)},e.prototype.markThreadRead=function(e,t){return this.routes.rpc("mark_thread_read",{stream:a(e),id:t},this.params)},e.prototype.markThreadUnread=function(e,t){return this.routes.rpc("mark_thread_unread",{stream:a(e),id:t},this.params)},e.prototype.markThreadResolved=function(e,t){return this.routes.rpc("resolve_thread",{stream:a(e),id:t},this.params)},e.prototype.checkOnboardingStatus=function(){return this.routes.rpc("check_onboarding_status",void 0,this.params)},e.prototype.markHasOnboarded=function(e){var t={".tag":e};return this.routes.rpc("mark_has_onboarded",{type:t},this.params)},e.prototype.markThreadUnresolved=function(e,t){return this.routes.rpc("unresolve_thread",{stream:a(e),id:t},this.params)},e.prototype.logEvent=function(e,t,n,i){return this.routes.rpc("log_event",{event:e,stream:a(t),thread_id:n,comment_id:i,oref:o.get_uri().getQuery().oref},this.params)},e})();t.Comments2Api=l}),define("modules/clean/react/comments2/data/initial_state",["require","exports","modules/clean/react/comments2/data/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={context:void 0,threads:[],authors:{},activatedThread:void 0,onboardingInfo:{initial_video_land:n.OnboardingStatus.Unknown,video_first_paused:n.OnboardingStatus.Unknown},playerCurrentTime:0,showResolved:!1,sort:n.SortType.VideoTimeCode,lastRequestStatuses:{},pauseCount:0}}),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/types","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/initial_state"],function(e,t,n,i,o,r,a,s){"use strict";function l(e,t,n){var o=i.partition(e,t),r=o[0],a=o[1];switch(r.length){case 0:if(n)return[void 0,a];throw new Error("No values matching predicate found in "+e);case 1:return[r[0],a];default:throw new Error("Too many items, "+r.length+" in total, matched the predicate")}}function c(e,t){return l(e,t,!0)}function u(e){switch(e.onboardingInfo.initial_video_land){case r.OnboardingStatus.SuppressOnboardingForSession:case r.OnboardingStatus.HasCompletedOnboarding:return!0;default:return!1}}function d(e,t){return e.map(function(e){return e.id===t.id?n.__assign({},e,t):e})}function p(e,t){var i,a=c(t.threads,function(t){return t.id===e.threadId}),s=a[0],l=a[1],u={id:e.guid,threadId:s?s.id:e.guid,timestamp:new Date,author:e.author,content:e.content,userPermissions:{canDelete:!1,canEdit:!1}};i=s?n.__assign({},s,{comments:s.comments.concat([u])}):{id:e.guid,timestamp:new Date,read:!0,resolved:!1,comments:[u],annotation:e.annotation};var d=n.__assign({},i,{pending:{action:r.ActionType.AddCommentRequest,originalValue:s,pendingValue:i}});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(p={},p[r.RequestType.AddComment]=o.ApiClientStatus.Fetch,p)),threads:l.concat([d])});var p}function m(e,t){var i=t.threads.map(function(t){var i=c(t.comments,function(t){return t.id===e.guid}),o=i[0],r=i[1];if(o){var a=t.id===e.guid?e.id:t.id;return n.__assign({},t,{pending:void 0,comments:r.concat([n.__assign({},o,{id:e.id})]),id:a})}return t});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(a={},a[r.RequestType.AddComment]=o.ApiClientStatus.Success,a)),threads:i});var a}function h(e,t){var i=t.threads.map(function(t){var i=c(t.comments,function(t){return t.id===e.guid}),o=i[0],r=i[1];return o?n.__assign({},t,{pending:void 0,comments:r.slice()}):t}).filter(function(e){return e.comments.length>0});return n.__assign({},t,{lastRequestStatuses:n.__assign({},t.lastRequestStatuses,(a={},a[r.RequestType.AddComment]=o.ApiClientStatus.Error,a)),threads:i});var a}function f(e){function t(e){return e?r.OnboardingStatus.HasCompletedOnboarding:r.OnboardingStatus.NotOnboarded}return{initial_video_land:t(e.initial_video_land),video_first_paused:t(e.video_first_paused)}}function v(e,t,i){return t.map(function(t){var o=t.comments.map(function(t){return t.id===e?i(t):t});return n.__assign({},t,{comments:o})})}function _(e,t){switch(void 0===e&&(e=s.INITIAL_STATE),t.type){case r.ActionType.ActivateThread:return n.__assign({},e,{activatedThread:t.payload.thread});case r.ActionType.DeactivateAllThreads:return n.__assign({},e,{activatedThread:void 0});case r.ActionType.ListCommentsRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(P={},P[r.RequestType.ListComments]=o.ApiClientStatus.Fetch,P))});case r.ActionType.ListCommentsSuccess:var i=a.usersToIUserMap(t.payload.authors),c=a.threadsToIThreads(t.payload.threads,i),_=t.payload.activeCommentId?c.find(function(e){return e.comments.some(function(e){return e.id===t.payload.activeCommentId})}):void 0;return n.__assign({},e,{threads:c,authors:i,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(k={},k[r.RequestType.ListComments]=o.ApiClientStatus.Success,k)),activatedThread:_});case r.ActionType.ListCommentsError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(x={},x[r.RequestType.ListComments]=o.ApiClientStatus.Error,x))});case r.ActionType.AddCommentRequest:return p(t.payload,e);case r.ActionType.AddCommentSuccess:return m(t.payload,e);case r.ActionType.AddCommentError:return h(t.payload,e);case r.ActionType.EditCommentRequest:var c=v(t.payload.commentId,e.threads,function(e){var i={action:r.ActionType.EditCommentRequest,originalValue:e.content,pendingValue:t.payload.content};return n.__assign({},e,{content:t.payload.content,pending:i})});return n.__assign({},e,{threads:c,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(R={},R[r.RequestType.EditComment]=o.ApiClientStatus.Fetch,R))});case r.ActionType.EditCommentSuccess:var c=v(t.payload.commentId,e.threads,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{threads:c,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(I={},I[r.RequestType.EditComment]=o.ApiClientStatus.Success,I))});case r.ActionType.EditCommentError:var c=v(t.payload.commentId,e.threads,function(e){return n.__assign({},e,{content:e.pending.originalValue,pending:n.__assign({},e.pending,{error:t.payload.error})})});return n.__assign({},e,{threads:c,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(O={},O[r.RequestType.EditComment]=o.ApiClientStatus.Error,O))});case r.ActionType.MarkThreadReadRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(F={},F[r.RequestType.MarkThreadRead]=o.ApiClientStatus.Fetch,F))});case r.ActionType.MarkThreadReadSuccess:return n.__assign({},e,{
lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(M={},M[r.RequestType.MarkThreadRead]=o.ApiClientStatus.Success,M)),threads:d(e.threads,{id:t.payload.threadId,read:!0})});case r.ActionType.MarkThreadReadError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(D={},D[r.RequestType.MarkThreadRead]=o.ApiClientStatus.Error,D))});case r.ActionType.MarkThreadUnreadRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(L={},L[r.RequestType.MarkThreadUnread]=o.ApiClientStatus.Fetch,L))});case r.ActionType.MarkThreadUnreadSuccess:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(N={},N[r.RequestType.MarkThreadUnread]=o.ApiClientStatus.Success,N)),threads:d(e.threads,{id:t.payload.threadId,read:!1})});case r.ActionType.MarkThreadUnreadError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(U={},U[r.RequestType.MarkThreadUnread]=o.ApiClientStatus.Error,U))});case r.ActionType.MarkThreadResolvedRequest:var g=t.payload.threadId,y=l(e.threads,function(e){return e.id===g}),w=y[0],c=y[1],b=n.__assign({},w,{resolved:!0,pending:{action:r.ActionType.MarkThreadResolvedRequest,originalValue:w.resolved,pendingValue:!0}}),C=c.concat([b]);return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(q={},q[r.RequestType.MarkThreadResolved]=o.ApiClientStatus.Fetch,q)),threads:C});case r.ActionType.MarkThreadResolvedSuccess:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(V={},V[r.RequestType.MarkThreadResolved]=o.ApiClientStatus.Success,V)),threads:d(e.threads,{id:t.payload.threadId,resolved:!0,pending:void 0})});case r.ActionType.MarkThreadResolvedError:var S=t.payload.threadId,E=l(e.threads,function(e){return e.id===S}),w=E[0],c=E[1],C=c;if(w.pending){var b=n.__assign({},w,{resolved:w.pending.originalValue,pending:n.__assign({},w.pending,{error:t.payload.error})});C=c.concat([b])}return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(B={},B[r.RequestType.MarkThreadRead]=o.ApiClientStatus.Error,B)),threads:C});case r.ActionType.MarkThreadUnresolvedRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(H={},H[r.RequestType.MarkThreadUnresolved]=o.ApiClientStatus.Fetch,H))});case r.ActionType.MarkThreadUnresolvedSuccess:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(K={},K[r.RequestType.MarkThreadUnresolved]=o.ApiClientStatus.Success,K)),threads:d(e.threads,{id:t.payload.threadId,resolved:!1})});case r.ActionType.MarkThreadUnresolvedError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(z={},z[r.RequestType.MarkThreadUnresolved]=o.ApiClientStatus.Error,z))});case r.ActionType.ToggleShowResolved:return n.__assign({},e,{showResolved:!e.showResolved});case r.ActionType.DeleteCommentRequest:var c=v(t.payload.commentId,e.threads,function(e){return n.__assign({},e,{deleted:!0,pending:{action:r.ActionType.DeleteCommentRequest,originalValue:e.deleted,pendingValue:!0}})});return n.__assign({},e,{threads:c,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(W={},W[r.RequestType.DeleteComment]=o.ApiClientStatus.Fetch,W))});case r.ActionType.DeleteCommentSuccess:var c=v(t.payload.commentId,e.threads,function(e){return n.__assign({},e,{pending:void 0})});return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(j={},j[r.RequestType.DeleteComment]=o.ApiClientStatus.Success,j)),threads:c});case r.ActionType.DeleteCommentError:var c=v(t.payload.commentId,e.threads,function(e){return n.__assign({},e,{deleted:e.pending.originalValue,pending:n.__assign({},e.pending,{error:t.payload.error})})});return n.__assign({},e,{threads:c,lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(G={},G[r.RequestType.MarkThreadUnread]=o.ApiClientStatus.Error,G))});case r.ActionType.UpdatePlayerCurrentTime:return n.__assign({},e,{playerCurrentTime:t.payload.currentTime});case r.ActionType.CheckOnboardingStatusRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(Z={},Z[r.RequestType.CheckOnboardingStatus]=o.ApiClientStatus.Fetch,Z))});case r.ActionType.CheckOnboardingStatusSuccess:return n.__assign({},e,{onboardingInfo:f(t.payload.onboardingResult),lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(Q={},Q[r.RequestType.CheckOnboardingStatus]=o.ApiClientStatus.Success,Q))});case r.ActionType.CheckOnboardingStatusError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(Y={},Y[r.RequestType.CheckOnboardingStatus]=o.ApiClientStatus.Error,Y))});case r.ActionType.MarkHasOnboardedRequest:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(X={},X[r.RequestType.MarkHasOnboarded]=o.ApiClientStatus.Fetch,X))});case r.ActionType.MarkHasOnboardedSuccess:return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(J={},J[t.payload.onboardingKey]=r.OnboardingStatus.HasCompletedOnboarding,J)),lastRequestStatuses:n.__assign({},e.lastRequestStatuses,($={},$[r.RequestType.MarkHasOnboarded]=o.ApiClientStatus.Success,$))});case r.ActionType.SuppressOnboardingForSession:return n.__assign({},e,{onboardingInfo:n.__assign({},e.onboardingInfo,(ee={},ee[t.payload.onboardingKey]=r.OnboardingStatus.SuppressOnboardingForSession,ee))});case r.ActionType.MarkHasOnboardedError:return n.__assign({},e,{lastRequestStatuses:n.__assign({},e.lastRequestStatuses,(te={},te[r.RequestType.MarkHasOnboarded]=o.ApiClientStatus.Error,te))});case r.ActionType.RecordPausePlay:var A=t.payload.isPaused,T=A&&u(e);return n.__assign({},e,{isPaused:A,pauseCount:e.pauseCount+ +T});case r.ActionType.SetContext:return t.payload.context?n.__assign({},e,{context:n.__assign({},t.payload.context,{status:r.Comments2ContextStatus.Pending})}):n.__assign({},e,{context:void 0});case r.ActionType.SetContextStatus:return n.__assign({},e,{context:n.__assign({},e.context,{status:t.payload.status})})}return e;var P,k,x,R,I,O,F,M,D,L,N,U,q,V,B,H,K,z,W,j,G,Z,Q,Y,X,J,$,ee,te}Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=_}),define("modules/clean/react/comments2/data/selectors",["require","exports","external/lodash","modules/clean/redux/selectors","modules/clean/redux/types","modules/constants/comments2","modules/clean/react/comments2/data/types"],function(e,t,n,i,o,r,a){"use strict";function s(e){for(var n=[],i=t.getState(e).onboardingInfo,o=0,r=a.ALL_ONBOARDING_KEYS;o<r.length;o++){var s=r[o];switch(i[s]){case a.OnboardingStatus.NotOnboarded:case a.OnboardingStatus.SuppressOnboardingForSession:n.push(s)}}return n}function l(e){var n=t.getState(e),i=n.isPaused,o=n.pauseCount,s=n.onboardingInfo;return!!i&&s.initial_video_land!==a.OnboardingStatus.NotOnboarded&&s.video_first_paused===a.OnboardingStatus.NotOnboarded&&o%r.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY===1&&o<r.COMMENTS2_VIDEO_ONBOARDING_FREQUENCY*r.COMMENTS2_VIDEO_ONBOARDING_COUNT}function c(e){return p(t.getState(e).threads||[],t.getSort(e))}function u(e){var n=t.getState(e).activatedThread;return n?n.id:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=function(e){return i.getStateAtNamespace(e,o.COMMENTS2_NAMESPACE_KEY)};var d=function(e){return-1*e.timestamp.getTime()},p=n.memoize(function(e,t){switch(t){case a.SortType.Chronological:return n.sortBy(e,[d]);case a.SortType.VideoTimeCode:var i=n.groupBy(e,function(e){return e.annotation?"video":"global"}),o=i.video,r=i.global;return n.sortBy(o,[function(e){return e.annotation.time},d]).concat(n.sortBy(r,[d]))}});t.getContext=function(e){var n=t.getState(e).context;return n?{stream:n.stream,viewer:n.viewer}:void 0},t.getContextStatus=function(e){var n=t.getState(e).context;return n?n.status:void 0},t.getSort=function(e){return t.getState(e).sort},t.getOnboardingKeysNotYetMarked=s,t.getShowOnboardingOnVideo=l,t.getShowOnboardingOnCommentsPane=function(e){return t.getState(e).onboardingInfo.initial_video_land===a.OnboardingStatus.NotOnboarded},t.getThreads=c,t.getActivatedThreadId=u,t.getShowResolved=function(e){return t.getState(e).showResolved},t.getPlayerCurrentTime=function(e){return t.getState(e).playerCurrentTime}}),define("modules/clean/react/comments2/data/store",["require","exports","external/lodash","modules/clean/redux/types","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForComments2=n.once(function(){return r.getStoreAndRegisterReducers((e={},e[i.COMMENTS2_NAMESPACE_KEY]=o.reducer,e));var e})}),define("modules/clean/react/comments2/data/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Disabled=0]="Disabled",e[e.Pending=1]="Pending",e[e.Comments1=2]="Comments1",e[e.Comments2=3]="Comments2"})(t.Comments2ContextStatus||(t.Comments2ContextStatus={}));(function(e){e.ListCommentsRequest="COMMENTS2__LIST_COMMENTS_REQUEST",e.ListCommentsSuccess="COMMENTS2__LIST_COMMENTS_RECEIVED",e.ListCommentsError="COMMENTS2__LIST_COMMENTS_ERROR",e.AddCommentRequest="COMMENTS2__ADD_COMMENT_REQUEST",e.AddCommentSuccess="COMMENTS2__ADD_COMMENT_SUCCESS",e.AddCommentError="COMMENTS2__ADD_COMMENT_ERROR",e.EditCommentRequest="COMMENTS2__EDIT_COMMENT_REQUEST",e.EditCommentSuccess="COMMENTS2__EDIT_COMMENT_SUCCESS",e.EditCommentError="COMMENTS2__EDIT_COMMENT_ERROR",e.ActivateThread="COMMENTS2__ACTIVATE_THREAD",e.DeactivateAllThreads="COMMENTS2__DEACTIVATE_ALL_THREADS",e.MarkThreadReadRequest="COMMENTS2__MARK_THREAD_READ_REQUEST",e.MarkThreadReadSuccess="COMMENTS2__MARK_THREAD_READ_SUCCESS",e.MarkThreadReadError="COMMENTS2__MARK_THREAD_READ_ERROR",e.MarkThreadUnreadRequest="COMMENTS2__MARK_THREAD_UNREAD_REQUEST",e.MarkThreadUnreadSuccess="COMMENTS2__MARK_THREAD_UNREAD_SUCCESS",e.MarkThreadUnreadError="COMMENTS2__MARK_THREAD_UNREAD_ERROR",e.MarkThreadResolvedRequest="COMMENTS2__MARK_THREAD_RESOLVED_REQUEST",e.MarkThreadResolvedSuccess="COMMENTS2__MARK_THREAD_RESOLVED_SUCCESS",e.MarkThreadResolvedError="COMMENTS2__MARK_THREAD_RESOLVED_ERROR",e.MarkThreadUnresolvedRequest="COMMENTS2__MARK_THREAD_UNRESOLVED_REQUEST",e.MarkThreadUnresolvedSuccess="COMMENTS2__MARK_THREAD_UNRESOLVED_SUCCESS",e.MarkThreadUnresolvedError="COMMENTS2__MARK_THREAD_UNRESOLVED_ERROR",e.DeleteCommentRequest="COMMENTS2__DELETE_COMMENT_REQUEST",e.DeleteCommentSuccess="COMMENTS2__DELETE_COMMENT_SUCCESS",e.DeleteCommentError="COMMENTS2__DELETE_COMMENT_ERROR",e.ToggleShowResolved="COMMENTS2__TOGGLE_SHOW_RESOLVED",e.UpdatePlayerCurrentTime="COMMENTS2__UPDATE_PLAYER_CURRENT_TIME",e.CheckOnboardingStatusRequest="COMMENTS2__CHECK_ONBOARDING_STATUS_REQUEST",e.CheckOnboardingStatusSuccess="COMMENTS2__CHECK_ONBOARDING_STATUS_SUCCESS",e.CheckOnboardingStatusError="COMMENTS2__CHECK_ONBOARDING_STATUS_ERROR",e.MarkHasOnboardedRequest="COMMENTS2__MARK_HAS_ONBOARDED_REQUEST",e.MarkHasOnboardedSuccess="COMMENTS2__MARK_HAS_ONBOARDED_SUCCESS",e.MarkHasOnboardedError="COMMENTS2__MARK_HAS_ONBOARDED_ERROR",e.SuppressOnboardingForSession="COMMENTS2__MARK_HAS_ONBOARDED_LOCALLY",e.RecordPausePlay="COMMENTS2__RECORD_PAUSE_PLAY",e.SetContext="COMMENTS2__SET_CONTEXT",e.SetContextStatus="COMMENTS2__SET_CONTEXT_STATUS"})(t.ActionType||(t.ActionType={}));(function(e){e[e.Unknown=0]="Unknown",e[e.NotOnboarded=1]="NotOnboarded",e[e.SuppressOnboardingForSession=2]="SuppressOnboardingForSession",e[e.HasCompletedOnboarding=3]="HasCompletedOnboarding"})(t.OnboardingStatus||(t.OnboardingStatus={})),t.ALL_ONBOARDING_KEYS=["initial_video_land","video_first_paused"];(function(e){e.ListComments="LIST_COMMENTS",e.AddComment="ADD_COMMENT",e.EditComment="EDIT_COMMENT",e.MarkThreadRead="MARK_THREAD_READ",e.MarkThreadUnread="MARK_THREAD_UNREAD",e.MarkThreadResolved="MARK_THREAD_RESOLVED",e.MarkThreadUnresolved="MARK_THREAD_UNRESOLVED",e.DeleteComment="DELETE_COMMENT",e.CheckOnboardingStatus="CHECK_ONBOARDING_STATUS",e.MarkHasOnboarded="MARK_HAS_ONBOARDED"})(t.RequestType||(t.RequestType={}));(function(e){e.Chronological="NATURAL",e.VideoTimeCode="VIDEO_TIME_CODE"})(t.SortType||(t.SortType={}));(function(e){e[e.ThreadActivated=0]="ThreadActivated",e[e.UIButtonClicked=1]="UIButtonClicked"})(t.MarkThreadReadOrigin||(t.MarkThreadReadOrigin={}))}),define("modules/clean/react/comments2/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Comments2Event=new n}),define("modules/clean/react/comments2/helper",["require","exports","modules/clean/react/comments2/logger"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){function t(e,t,i){var o=t.event,r=t.stream,a=t.threadId,s=i.id;n.commentLogger.logEvent(e,o,r,a,s)}function i(e,t,i){var o=t.event,r=t.stream,a=i.id;n.commentLogger.logEvent(e,o,r,a)}function o(e,t){var i=t.stream,o=t.threadId,r=t.commentId;n.commentLogger.logEvent(e,"comment_error",i,o,r)}e.getLoggingFnWithCommentAcknowledgementResult=t,e.getLoggingFnWithThreadAcknowledgementResult=i,e.logCommentError=o})(t.Comments2Helper||(t.Comments2Helper={}))}),define("modules/clean/react/comments2/logger",["require","exports","modules/clean/react/comments2/data/api","modules/core/exception"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.userIdToClient={}}return e.prototype.logEvent=function(e,t,o,r,a){if(e in this.userIdToClient||(this.userIdToClient[e]=new n.Comments2Api(e)),"other"===t)return void i.reportStack("Attempted to log with an invalid event name",{severity:i.SEVERITY.NONCRITICAL,tags:["comments2"]});this.userIdToClient[e].logEvent({".tag":t},o,r,a)},e.prototype.stopLoggingForUser=function(e){e in this.userIdToClient&&delete this.userIdToClient[e]},e})();t.commentLogger=new o}),define("modules/clean/react/comments2/transforms",["require","exports","tslib","external/lodash","modules/core/user_i18n"],function(e,t,n,i,o){"use strict";function r(e){return{time:e.time}}function a(e,t,n){return{author:n[e.author_id],content:{metadata:h(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}function s(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:o.getInitials(e.name),public:o.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}function l(e){return{id:e.account_id,name:{display:e.display_name,initials:o.getInitials(e.display_name),public:o.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}function c(e){var t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function u(e){return n.__assign({".tag":"video"},e)}function d(e){var t=e.annotation,n=e.content,i=e.stream;return{annotation_data:t?u(t):void 0,content:n.text,metadata:p(n.metadata),revision:f(i)}}function p(e){return{formatting:e.filter(function(e){return"style"===e.type}).map(function(e){return{format:{".tag":e.style},location:e.location}}),mentions:e.filter(function(e){return"mention"===e.type}).map(function(e){return{user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}})}}function m(e){var t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');var n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function h(e){return e.formatting.map(c).concat(e.mentions.map(m))}function f(e){return"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function v(e,t){var n=e.comments.map(function(n){return a(n,e.id,t)});return{annotation:e.annotation_data?r(e.annotation_data):void 0,comments:n,id:e.id,read:e.read,resolved:e.resolved,timestamp:n[0].timestamp}}function _(e,t){return e.map(function(e){return v(e,t)})}function g(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function y(e){var t=e.map(g);return i.keyBy(t,"id")}Object.defineProperty(t,"__esModule",{value:!0}),t.annotationToIAnnotation=r,t.commentToIComment=a,t.contactToIMentionUser=s,t.dbxUserToIUser=l,t.iAnnotationToAnnotation=u,t.iCommentContentToUserSubmittedComment=d,t.iCommentMetadataToUserSubmittedMetadata=p,t.metadataToIMetadata=h,t.streamToRevision=f,t.threadToIThread=v,t.threadsToIThreads=_,t.userToIUser=g,t.usersToIUserMap=y}),define("modules/clean/react/comments2/util",["require","exports","modules/core/browser","modules/clean/previews/constants","modules/constants/comments2"],function(e,t,n,i,o){"use strict";function r(e,t){return!e&&!t||e.id===t.id}function a(e,t){return!e&&!t||e.type===t.type&&e.id===t.id}function s(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&(a(e.stream,t.stream)&&r(e.viewer,t.viewer))}function l(e){var t=e.previewType,n=e.viewer,r=o.COMMENTS2_FRONTEND.PERSONAL,a=o.COMMENTS2_FRONTEND.WORK,s=o.COMMENTS2_FRONTEND.SESSION;return t===i.PreviewType.Video&&(s||n&&("personal"===n.role?r:a))}function c(e){var t=e.previewType,n=e.viewer;return u()&&l({previewType:t,viewer:n})}function u(){return o.COMMENTS2_MOBILE_WEB&&n.is_supported_mobile_browser()&&window.matchMedia("(orientation: portrait)").matches}Object.defineProperty(t,"__esModule",{value:!0}),t.isUserSame=r,t.isStreamSame=a,t.isContextSame=s,t.shouldUseComments2=l,t.shouldUseComments2MobileWeb=c,t.isComments2Mobile=u}),define("modules/clean/react/css_timing",["require","exports","modules/clean/react/css","modules/clean/js_client_stopwatch"],function(e,t,n,i){"use strict";function o(e,t,o){void 0===o&&(o=[]);var r=e.displayName||"UnnamedComponent";return n(e,t,o,{onWillLoadCss:function(){return i.JSStopwatch.startSpan("requireCssWithComponent_"+r)},onCssResponse:function(){return i.JSStopwatch.endSpan("requireCssWithComponent_"+r)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.requireCssWithComponent=o}),define("modules/clean/react/file_comments/logger",["require","exports","modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n,i,o){"use strict";return new((function(){function e(){this.disabled=!1}return e.prototype.set_disabled=function(e){return this.disabled=e},e.prototype.log_event=function(e,t,i,r,a,s,l,c,u){if(void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),!this.disabled)return o.assert(e,"event_type not provided"),o.assert(t,"file_activity_key not provided"),n.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:e,file_activity_key:t,comment_activity_key:i,client_origin_type:r,activity_context:s,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:a})},e.prototype.log_annotation_event=function(e,t,n,o,r,a){void 0===a&&(a=null);var s,l,c;if(null!=a){var u=i.Annotation.createAnnotationFromDict(a);c=u.type,l=u.subtype,s=u.getFirstPdfPage()}return this.log_event(e,t,n,null,o,r,c,l,s)},e})())}),define("modules/clean/react/file_sidebar/base_comments_tab",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){var t=e.currentFile,n=t.file_id,i=t.ns_id,o=t.preview_type,r=t.sjid,a=e.sharedLinkInfo;return{id:n,linkUrl:a?a.url:void 0,ns_id:i,sjid:r,type:"file",previewType:o||void 0}},l=(function(e){function t(t){var n=e.call(this,t)||this;return n.clearContext=function(){n.store.dispatch(r.setFileContext())},n.setContext=function(e){n.store.dispatch(r.setFileContext({stream:s(e),viewer:e.user}))},n.store=a.getStoreForComments2(),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setContext(this.props)},t.prototype.componentWillUnmount=function(){this.clearContext()},t.prototype.componentWillUpdate=function(e){this.setContext(e)},t.prototype.render=function(){return this.store?i.createElement(o.Provider,{store:this.store},this.props.content()):null},t})(i.Component);t.BaseCommentsTab=l}),define("modules/clean/react/file_sidebar/constants",["require","exports","external/prop-types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=n.shape({dispatch:n.func.isRequired,getState:n.func.isRequired,subscribe:n.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSidebar=i.Loadable({loader:function(){return o.waitForTTI().then(function(){return new Promise(function(t,n){e(["modules/clean/react/file_sidebar/file_sidebar_component"],t,n)}).then(function(e){return e.FileSidebar})})},loading:n.createElement("div",{className:"file-sidebar"})})}),define("modules/clean/react/file_sidebar/file_sidebar_connect",["require","exports","tslib","external/react","external/react-redux","modules/clean/react/file_sidebar/constants","external/hoist-non-react-statics"],function(e,t,n,i,o,r,a){"use strict";function s(e,t){var s=o.connect(e,t);return function(e){var t=s(e);return a((function(e){function a(t,n){var i=e.call(this,t,n)||this;return i.state={store:n.fileSidebarStore},i}return n.__extends(a,e),a.prototype.componentWillReceiveProps=function(e,t){this.setState({store:t.fileSidebarStore})},a.prototype.render=function(){if(!this.state.store)return null;var e=n.__assign({},this.props,{store:this.state.store});return i.createElement(t,n.__assign({},e))},a.displayName="FileSidebar"+t.displayName,a.WrappedComponent=t,a.contextTypes=(o={},o[r.STORE_KEY]=r.STORE_SHAPE,o),a})(i.Component),t);var o}}Object.defineProperty(t,"__esModule",{value:!0}),t.fileSidebarConnect=s}),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","modules/clean/ajax","modules/clean/viewer","modules/clean/api_v2/client","modules/clean/react/file_viewer/models"],function(e,t,n,i,o,r){"use strict";function a(e,t){var i=r.FileViewerSession.currentSession,o=r.FilePreviewSession.currentSession;if(o&&i){var a={event_name:e,file_viewer_session_id:i.id,file_preview_session_id:o.id,file_ns_id:o.file.ns_id,file_sjid:o.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:a})}}function s(e){a("sidebar_tab_selected",e)}function l(e){a("sidebar_opened",e)}function c(e){a("sidebar_closed",e)}function u(e){a("file_view_activity_expanded",e)}function d(e,t){m({event:"get_stream_timing",int_value:e,bool_value:t})}function p(e){m({event:"load_sidebar_timing",int_value:e})}function m(e){var t=i.Viewer.get_viewer().get_user_ids(),n=t.length?t[0]:null,r=new o.ApiV2Client;n?r.ns("file_activity_stream").rpc("log_event",e,{subjectUserId:n}):r.ns("file_activity_stream").rpc("logged_out/log_event",e,{subjectUserId:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.logSidebarTabSelected=s,t.logSidebarOpened=l,t.logSidebarClosed=c,t.logFileViewActivityCardExpanded=u,t.logGetActivityStreamTiming=d,t.logLoadSidebarTiming=p}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream"],function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(t){function s(n){var i=t.call(this,n)||this,o=e.defined("modules/clean/react/file_sidebar/store/instance"),r=o?e("modules/clean/react/file_sidebar/store/instance").store:void 0;return i.state={loaded:o,store:r},i}return n.__extends(s,t),s.prototype.getChildContext=function(){return e={},e[r.STORE_KEY]=this.state.store,e;var e},s.prototype.componentWillMount=function(){var t=this;a.IS_ON&&!this.state.loaded&&e(["modules/clean/react/file_sidebar/store/instance"],function(e){var n=e.store;t.setState({loaded:!0,store:n})})},s.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},s.prototype.render=function(){return i.Children.only(this.props.children)},s.propTypes={children:o.element.isRequired},s.childContextTypes=(l={},l[r.STORE_KEY]=r.STORE_SHAPE,l),s})(i.Component);t.FileSidebarProvider=s;var l}),define("modules/clean/react/file_sidebar/store/app/reducer",["require","exports","tslib"],function(e,t,n){"use strict";function i(e,i){switch(void 0===e&&(e=t.INITIAL_STATE),i.type){case"APP_SET_STATE":var o=i.hideComments,r=i.hidePageChrome;return n.__assign({},e,{hideComments:o,hidePageChrome:r})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={hideComments:!1,hidePageChrome:!1},t.reducer=i}),define("modules/clean/react/file_sidebar/store/comments_adapter",["require","exports","modules/clean/comments/store"],function(e,t,n){"use strict";function i(){var e=n.state;return{enabled:n.isCommentingEnabled(),canEnable:n.canEnableComments(),commentCount:e.activity&&e.activity.comment_activities&&e.activity.comment_activities.length||0,initialized:n.isStoreInitialized(),ready:n.isFileActivityReady(),unreadCommentCount:n.unreadCommentCount()}}Object.defineProperty(t,"__esModule",{value:!0}),t.getCommentingState=i}),define("modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/sorted_set"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(n){return void 0===n&&(n=[]),e.call(this,n,t.compare,t.equals)||this}return n.__extends(t,e),t.compare=function(e,t){return e.id===t.id?0:t.timestamp.getTime()-e.timestamp.getTime()},t.equals=function(e,t){return e.id===t.id},t})(i.SortedSet);t.ActivitySortedSet=o}),define("modules/clean/react/file_sidebar/store/file_activity/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set","modules/constants/file_activity_stream"],function(e,t,n,i,o){"use strict";function r(e){return e.filter(function(e){switch(e.type){case"file_settings_change":return o.IS_FILE_SETTINGS_CHANGE_CARD_ON;case"shared_link_change":return o.IS_SHARED_LINK_CHANGE_CARD_ON;case"view":return o.IS_VIEW_CARD_ON;default:return!0}})}function a(e){return r(e).map(function(e){return e.isGroup?n.__assign({},e,{groupActivities:r(e.groupActivities)}):e})}function s(e){return e.map(function(e){return e.isGroup&&1===e.groupActivities.length?e.groupActivities[0]:e})}function l(e,o){switch(void 0===e&&(e=t.INITIAL_STATE),o.type){case"FILE_ACTIVITY|RESET":return n.__assign({},t.INITIAL_STATE,{feedback:e.feedback});case"FILE_ACTIVITY|RESET_FILE_STATE":return n.__assign({},e,{activities:t.INITIAL_STATE.activities});case"FILE_ACTIVITY|LOADING_START":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:void 0,loading:!0}),userId:o.userId,file:o.file});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{activities:n.__assign({},e.activities,{loaded:!0,loading:!1}),feedback:n.__assign({},e.feedback,{shouldShow:e.activities.value.length>0&&!e.feedback.responded&&Math.random()<.1})});case"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY":var r=a(o.activities);r=s(r);var l=o.enabled,c=l?new i.ActivitySortedSet(e.activities.value.concat(r)).toArray():[];return n.__assign({},e,{activities:n.__assign({},e.activities,{value:c}),enabled:o.enabled});case"FILE_ACTIVITY|RECEIVE_STREAM_ERROR":return n.__assign({},e,{activities:n.__assign({},e.activities,{error:o.error})});case"FILE_ACTIVITY|FEEDBACK_SENT":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{responded:!0})});case"FILE_ACTIVITY|HIDE_FEEDBACK":return n.__assign({},e,{feedback:n.__assign({},e.feedback,{shouldShow:!1})})}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activities:{error:void 0,loaded:!1,loading:!1,value:[]},enabled:!1,userId:-1,feedback:{shouldShow:!1,responded:o.FEEDBACK_RECEIVED}},t.filterActivitiesBasedOnStormcrows=r,t.filterGroupActivitiesBasedOnStormcrows=a,t.ungroupSingleActivityGroups=s,t.reducer=l}),define("modules/clean/react/file_sidebar/store/file_activity/selectors",["require","exports"],function(e,t){"use strict";function n(e){return e.fileActivity}function i(e){return n(e).activities.value}function o(e){return n(e).activities}function r(e){return n(e).feedback}function a(e){return r(e).responded}function s(e){return i(e).length}function l(e){return n(e).file}function c(e){return n(e).userId}function u(e){return{file:l(e),userId:c(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=n,t.getActivities=i,t.getActivitiesMetadata=o,t.getFeedbackState=r,t.didRespondToFeedback=a,t.getVisibleActivityCount=s,t.getFile=l,t.getUserId=c,t.getContext=u}),define("modules/clean/react/file_sidebar/store/file_activity/sorted_set",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){void 0===e&&(e=[]),this.items=[],this.compare=t,this.equals=n,this.add(e)}return e.prototype.add=function(e){var t=this;Array.isArray(e)||(e=[e]);var n=this.items.concat(e);return n.sort(this.compare),this.items=n.filter(function(e,n,i){return 0===n||!t.equals(e,i[n-1])}),this},e.prototype.toArray=function(){return Array.prototype.slice.call(this.items)},e})();t.SortedSet=n}),define("modules/clean/react/file_sidebar/store/instance",["require","exports","external/redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/comments/events","modules/clean/comments/store","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/react/comments2/events"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";function h(e,t){return"::RESET"===t.type&&(e=void 0),_(e,t)}function f(){return n.createStore(h,n.applyMiddleware(u.thunk(),d.reactor(p.reactors)))}function v(){t.store.dispatch(l.setCommentingState(c.getCommentingState()))}Object.defineProperty(t,"__esModule",{value:!0});var _=n.combineReducers({app:i.reducer,fileActivity:o.reducer,sidebar:r.reducer});t.store=f(),s.listen(v),v(),a.CommentsEvents.on("reveal-comment-in-pane",function(){t.store.dispatch(l.open("annotation_select")),t.store.dispatch(l.selectTab("comments"))}),m.Comments2Event.on("reveal-comments2-in-pane",function(){t.store.dispatch(l.setComments2State({shouldShow:!0}))})}),define("modules/clean/react/file_sidebar/store/middleware/reactor",["require","exports","modules/clean/shallow_equal"],function(e,t,n){"use strict";function i(e){return"function"==typeof e.changes}function o(e){return"function"==typeof e.changesIn}function r(e){return"function"==typeof e.changesFrom&&"function"==typeof e.changesTo}function a(){function e(e,t,n){void 0===n&&(n=s);var l;if(i(e))l=function(t,n){return{changed:e.changes(t,n)}};else if(o(e))l=function(t,i){var o=e.changesIn(t),r=e.changesIn(i);return{prevValue:o,nextValue:r,changed:!n(o,r)}};else{if(!r(e))throw new Error;l=function(t,n){var i=e.changesFrom(t),o=e.changesTo(n);return{changed:i&&o}}}a.push({checkForChange:l,onChange:t})}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var a=[],l=0,c=t;l<c.length;l++){(0,c[l])(e)}return function(e){var t=e.getState;return function(e){return function(n){for(var i=t(),o=e(n),r=t(),s=0,l=a;s<l.length;s++){var c=l[s],u=c.checkForChange(i,r),d=u.prevValue,p=u.nextValue;u.changed&&c.onChange({nextValue:p,prevValue:d,nextState:r,prevState:i})}return o}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){return n.shallowEqual(e,t)};t.reactor=a}),
define("modules/clean/react/file_sidebar/store/middleware/thunk",["require","exports"],function(e,t){"use strict";function n(){return function(e){var t=e.dispatch,n=e.getState;return function(e){return function(i){return"function"==typeof i?i(t,n):e(i)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.thunk=n}),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/file_activity/api","modules/clean/react/file_sidebar/store/comments_adapter","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/comments/store"],function(e,t,n,i,o,r,a,s,l,c){"use strict";function u(){return{type:l.ActionType.SidebarReset}}function d(e){return function(n,o){var r=o();if(!i.getSidebarState(r).open){var a=i.getSidebarContext(r).user;t.LegacyCommentsStoreAction.setStickyOpen(!0,a?a.id:null)}n({type:l.ActionType.SidebarOpen,payload:{reason:e}})}}function p(){return function(e,n){var r=n();if(i.getSidebarState(r).open){var a=i.getSidebarContext(r).user;t.LegacyCommentsStoreAction.setStickyOpen(!1,a?a.id:null),e({type:l.ActionType.SidebarClose}),s.logSidebarClosed({num_comments:i.getTabState(r,"comments").extra.commentCount,num_events:o.getVisibleActivityCount(r),viewing_user_id:a?a.id:null})}}}function m(){return function(e,t){var n=t();e(i.getSidebarState(n).open?p():d("toggle_button"))}}function h(){return function(e){e(d("toggle_button_after_transition"))}}function f(e){return{type:l.ActionType.SidebarSelectTab,payload:{tabName:e}}}function v(e){return function(t,o){var r=o(),s=i.getSidebarContext(r);n.isContextChanged(s,e)&&(t({type:l.ActionType.SidebarOpenFile,payload:e}),t(_(a.getCommentingState())))}}function _(e){return{type:l.ActionType.SidebarSetCommentState,payload:e}}function g(e){return{type:l.ActionType.SidebarSetComments2State,payload:e}}function y(e){return{type:l.ActionType.SidebarSetComments2FetchStatus,payload:e}}function w(e,t){t?r.setCommentingPaneVisibility({actorId:t,shouldShow:e}):r.setSessionCommentingPaneVisibility({shouldShow:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.reset=u,t.open=d,t.close=p,t.toggle=m,t.completeToggleOpen=h,t.selectTab=f,t.openFile=v,t.setCommentingState=_,t.setComments2State=g,t.setComments2FetchStatus=y,t.LegacyCommentsStoreAction={showComments:function(){setTimeout(function(){c.onShowComments()})},hideComments:function(){setTimeout(function(){c.onHideComments()})},setStickyOpen:function(e,t){w(e,t)}}}),define("modules/clean/react/file_sidebar/store/sidebar/helpers",["require","exports","modules/clean/file_store/utils"],function(e,t,n){"use strict";function i(e,t){return!e&&!t||!!e&&!!t&&n.areFilesEqual(e,t)}function o(e,t){return!e&&!t||!!e&&!!t&&e.id===t.id}function r(e,t){return!i(e.file,t.file)||!o(e.user,t.user)}Object.defineProperty(t,"__esModule",{value:!0}),t.isFileSame=i,t.isUserSame=o,t.isContextChanged=r}),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","external/lodash","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],function(e,t,n,i,o,r){"use strict";function a(e){var t=o.getSidebarState(e),n=t.open,i=t.ready;return n&&i}function s(e){return!a(e)}function l(e){return n.values(o.getTabsState(e)).every(function(e){return e.ready})}function c(e){return!l(e)}function u(e){var t=o.getSidebarContext(e);return(t.file?t.file.file_id:-1)+":"+(t.user?t.user.id:-1)}function d(e){var t=o.getSidebarContext(e).user;i.logSidebarOpened({reason:o.getOpenReason(e),num_comments:o.getTabState(e,"comments").extra.commentCount,num_events:r.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}function p(e){e({changesFrom:s,changesTo:a},function(e){d(e.nextState)}),e({changes:function(e,t){if(a(e)&&a(t)){var n=t.sidebar.tabs,i=e.sidebar.tabs;return!(i.activity.ready&&i.comments.ready)&&n.activity.ready&&n.comments.ready}return!1}},function(e){d(e.nextState)});var t=-1,n="";e({changes:function(e,t){return u(e)!==u(t)}},function(e){var i=e.nextState;t=Date.now(),n=u(i)}),e({changesFrom:c,changesTo:l},function(e){n===u(e.prevState)&&i.logLoadSidebarTiming(Date.now()-t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.reactors=p}),define("modules/clean/react/file_sidebar/store/sidebar/reducer",["require","exports","tslib","modules/constants/comments_panel","modules/clean/react/file_sidebar/store/sidebar/types","modules/clean/react/file_sidebar/store/sidebar/actions"],function(e,t,n,i,o,r){"use strict";function a(e,i){switch(i.type){case o.ActionType.SidebarReset:return n.__assign({},t.INITIAL_STATE,{open:e.open});case o.ActionType.SidebarOpen:return n.__assign({},e,{open:!0,openReason:i.payload.reason});case o.ActionType.SidebarClose:return n.__assign({},e,{open:!1,openReason:void 0});case o.ActionType.SidebarSelectTab:return n.__assign({},e,{activeTab:i.payload.tabName});case o.ActionType.SidebarOpenFile:var r=i.payload,a=r.file,s=r.isVersionHistoryMode,l=r.user;return n.__assign({},e,{openReason:void 0,context:{file:a,isVersionHistoryMode:s,user:l},tabs:{activity:{ready:!l,show:s===!1&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}}});case"FILE_ACTIVITY|LOADING_END":return n.__assign({},e,{tabs:n.__assign({},e.tabs,{activity:{ready:!0,show:e.context.isVersionHistoryMode===!1&&i.state.enabled,count:0}})});case o.ActionType.SidebarSetCommentState:var c=i.payload,u=c.enabled,d=c.canEnable,p=c.commentCount,m=c.initialized,h=c.ready,f=c.unreadCommentCount,v=e.tabs.comments.ready,_=e.tabs.comments.show,g=v||m&&h,y=!g||!v&&g&&(u||d)||_;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:g,show:y,count:f,extra:{commentCount:p,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}})});case o.ActionType.SidebarSetComments2State:var w=i.payload.shouldShow;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:{ready:w,show:w,count:0,extra:{commentCount:0,comments2PermissionStatus:e.tabs.comments.extra.comments2PermissionStatus}}})});case o.ActionType.SidebarSetComments2FetchStatus:var b=i.payload.status;return n.__assign({},e,{tabs:n.__assign({},e.tabs,{comments:n.__assign({},e.tabs.comments,{ready:!0,extra:{commentCount:0,comments2PermissionStatus:b}})})})}return e}function s(e,n){void 0===e&&(e=t.INITIAL_STATE);var i=a(e,n);return i.ready=e.ready||i.tabs.activity.ready&&i.tabs.comments.ready,!e.ready&&i.ready&&(i.tabs.comments.show&&!i.tabs.activity.show?i.activeTab="comments":!i.tabs.comments.show&&i.tabs.activity.show&&(i.activeTab="activity"),i.tabs.comments.show&&i.tabs.comments.count>0&&(i.open=!0,i.openReason=i.openReason||"unread_comments",i.activeTab="comments"),"comments"===i.activeTab?r.LegacyCommentsStoreAction.showComments():r.LegacyCommentsStoreAction.hideComments()),i.ready&&i.open&&!i.openReason&&(i.openReason="sticky_state"),!i.open||"comments"!==i.activeTab||"toggle_button"===i.openReason||e.open&&"toggle_button"!==e.openReason&&"comments"===e.activeTab?!e.open||"comments"!==e.activeTab||i.open&&"comments"===i.activeTab||r.LegacyCommentsStoreAction.hideComments():r.LegacyCommentsStoreAction.showComments(),i}Object.defineProperty(t,"__esModule",{value:!0});var l=i.SHOW_COMMENTS_PANEL||!1;t.INITIAL_STATE={activeTab:"comments",open:l,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0,comments2PermissionStatus:o.PermissionStatus.NOT_YET_RECEIVED}}}},t.reducer=s}),define("modules/clean/react/file_sidebar/store/sidebar/selectors",["require","exports","modules/clean/react/file_sidebar/store/sidebar/types"],function(e,t,n){"use strict";function i(e){return e.sidebar}function o(e){var t=i(e);return{activeTab:t.activeTab,open:t.open,ready:t.ready}}function r(e){return i(e).openReason}function a(e){return i(e).context}function s(e,t){return i(e).tabs[t]}function l(e){return i(e).tabs}function c(e){return i(e).tabs.comments.extra.comments2PermissionStatus!==n.PermissionStatus.NOT_YET_RECEIVED}function u(e){return i(e).tabs.comments.extra.comments2PermissionStatus===n.PermissionStatus.DISABLED}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=i,t.getSidebarState=o,t.getOpenReason=r,t.getSidebarContext=a,t.getTabState=s,t.getTabsState=l,t.getIsComments2PermissionFetchComplete=c,t.getIsComments2PermissionDenied=u}),define("modules/clean/react/file_sidebar/store/sidebar/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.NOT_YET_RECEIVED=0]="NOT_YET_RECEIVED",e[e.RECEIVED=1]="RECEIVED",e[e.DISABLED=2]="DISABLED"})(t.PermissionStatus||(t.PermissionStatus={}));(function(e){e.SidebarOpen="SIDEBAR|OPEN",e.SidebarReset="SIDEBAR|RESET",e.SidebarClose="SIDEBAR|CLOSE",e.SidebarSelectTab="SIDEBAR|SELECT_TAB",e.SidebarOpenFile="SIDEBAR|OPEN_FILE",e.SidebarToggle="SIDEBAR|TOGGLE",e.SidebarSetCommentState="SIDEBAR|SET_COMMENTING_STATE",e.SidebarSetComments2State="SIDEBAR|SET_COMMENTS2_STATE",e.SidebarSetComments2FetchStatus="SIDEBAR|SET_COMMENTS2_FETCH_STATUS"})(t.ActionType||(t.ActionType={}))}),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(r.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(r.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(r.UserAction.AppDownloadInterstitialInstall)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(r.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,i=t.fileViewerSession,o=t.previewSourceAction,r=void 0===o?l.PreviewSourceAction.Visit:o,a=t.previewSourceContext,c=void 0===a?l.PreviewSourceContext.SharedLinkFile:a;i&&(this.filePreviewSession=new s.FilePreviewSession({file:n,isMounted:!1,fileViewerSession:i,sourceAction:r,sourceContext:c}))},t.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,i=t.file;this.filePreviewSession&&n&&i.ns_id&&i.sjid&&o.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,i.ns_id,i.sjid,{context:r.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,o=e.sharedLinkInfo,r=n.__rest(e,["file","sharedLinkInfo"]);return i.createElement(u.AppDownloadInterstitial,n.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:o.ownerName,ownerTeamName:o.ownerTeamName,onClose:this.onClose},r))},t})(i.PureComponent);t.FilePreviewAppDownloadInterstitial=d}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return i.createElement("div",{className:"fileviewer-upsell-banner"},s.reactFormat(a._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:i.createElement("a",{href:e})}))},t})(i.Component);t.ExpFileViewerUpsellBannerV2=o(l,["/static/css/exp_file_preview_upsell-vflhhQSQ0.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/previews/constants","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/clean/react/previews/preview_error","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/archive/preview_archive_loadable","modules/constants/file_viewer","modules/core/i18n","modules/core/browser","modules/core/exception","modules/clean/react/file_viewer/file_preview_logging_manager"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w,b,C,S,E){"use strict";function A(e){var t=e.file,i=e.sharedLinkUrl,r=e.sourceAction,a=e.sourceContext;return o.createElement(E.FilePreviewSessionManager,{file:t,isMounted:!!i,sourceAction:r,sourceContext:a,render:function(t){return o.createElement(O,n.__assign({},e,{filePreviewSession:t}))}})}Object.defineProperty(t,"__esModule",{value:!0});var T=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)}).then(function(e){return e.PreviewImageZoom})}}),P=l.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/limited_preview_message"],t,n)}).then(function(e){return e.LimitedPreviewMessage})}}),k=C.get_uri().getQuery(),x=k.forceRivieraException,R=k.forceTestPdf,I=k.forceTestExcelHtml,O=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={fallbackToPdfJs:!1,hasError:!1},t.onContextMenu=function(e){t.props.sharePermission&&0===t.props.sharePermission.canViewContextMenuRoles.length&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.handleErrorWithRetry=function(e,n){u.shouldFetchRivieraStatusCode(t.props.file)?t.activeRequest=u.fetchRivieraStatusCode(e,function(e){t.activeRequest=void 0,t.setState({hasError:!0,errorType:n,rivieraStatusCode:e})},function(){t.activeRequest=void 0,t.triggerError(n)}):t.triggerError(n)},t.getErrorMessage=function(e,t,n){if(n&&"sketch"===c.getExtension(n)&&e===d.ErrorType.LoadError&&t===d.RivieraConvertResponseType.UnsupportedFormat)return b._("This file can’t be previewed. Previews are               only available for files created in Sketch v43 and up.")},t.triggerError=function(e){t.setState({hasError:!0,errorType:e})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){r.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},t.prototype.componentDidMount=function(){window.setTimeout(u.cleanupPrerenderPreview)},t.prototype.componentWillUnmount=function(){this.activeRequest&&this.activeRequest.readyState!==XMLHttpRequest.DONE&&this.activeRequest.abort()},t.prototype.renderImagePreview=function(){var e=this,t=this.props.file,i=c.getExtension(t),r=t.preview_url||t.thumbnail_url_tmpl;if(null==r)return this.renderUnsupportedErrorPreview();if(this.props.isFullscreen)return o.createElement(T,{thumbnailUrlTmpl:r,fileExtension:i,isFlippable:!0,fileCount:this.props.count,fileIndex:this.props.index,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,fileName:c.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var a={"preview-url":r,"file-extension":c.getExtension(t),isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!s.isLimitedPreview(t),shouldDisableAnnotations:c.isArchiveFile(t),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return e.handleErrorWithRetry(r,d.ErrorType.LoadError)},onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,onContextMenu:this.onContextMenu,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:c.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess};return o.createElement(f.PreviewImage,n.__assign({},a))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!c.isArchiveFile(this.props.file)},enumerable:!0,configurable:!0}),t.prototype.renderVideoPreview=function(){var e=this.props.file;return o.createElement(_.PreviewVideo,{title:c.getFilenameWithoutExtension(e),fileExtension:c.getExtension(e),previewUrl:e.video_transcode_url,thumbnailUrlTmpl:e.thumbnail_url_tmpl,videoMetadataUrl:e.video_metadata_url,videoContainer:e.video_container,isFullscreen:this.props.isFullscreen,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.video_thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderLinkfilePreview=function(){var e=this.props.file;return o.createElement(v.PreviewLinkfile,{filename:c.getFilename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.renderPDFPreview=function(){var e=this.props.file;return e.preview_ssr_image_url_tmpl&&e.preview_ssr_text_url_tmpl?o.createElement(g.PreviewPDFLoadable,{fileExtension:c.getExtension(e),fileHref:e.href,filePreviewSession:this.props.filePreviewSession,imageUrl:e.preview_ssr_image_url_tmpl,isArchiveFile:c.isArchiveFile(e),isFullscreen:this.props.isFullscreen,isSidebarOpen:this.props.isSidebarOpen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,forceTestPdf:!!R,previewThumbnailUrl:e.preview_thumbnail_url,refreshUrl:e.preview_ssr_refresh_url||void 0,src:e.preview_url,sharePermission:this.props.sharePermission,shouldDisableAnnotations:c.isArchiveFile(e),sizeClass:this.props.sizeClass,textUrl:e.preview_ssr_text_url_tmpl,invalidateFrameMessenger:this.props.invalidateFrameMessenger,setRenderStatusSuccess:this.props.setRenderStatusSuccess}):this.renderUnsupportedErrorPreview()},t.prototype.renderHTMLPreview=function(){var e=this.props.file,t=e.preview_type,n=c.getExtension(e),i=e.direct_blockserver_link;if(t===a.PreviewType.Excel&&i){var r=s.normalize_extension(n);i=s.get_progressive_url(r,i).toString()}else i=e.htmlified_link||i;if(!i)return this.renderUnsupportedErrorPreview();var l=s.usesFrameMessenger(t,n);return o.createElement(h.PreviewHTML,{src:i,filename:c.getFilename(this.props.file),previewType:t,forceRivieraException:Array.isArray(x)?x[0]:"",forceTestExcelHtml:!!I,isFullscreen:this.props.isFullscreen,onError:this.triggerError,fileExtension:n,usesFrameMessenger:l,sharePermission:this.props.sharePermission,filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sizeClass:this.props.sizeClass})},t.prototype.renderAudioPreview=function(){var e=this.props.file;return w.HLS_AUDIO?o.createElement(_.PreviewVideo,{title:c.getFilenameWithoutExtension(e),fileExtension:c.getExtension(e),previewUrl:e.preview_url,videoContainer:e.video_container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,audioUrl:this.props.file.direct_blockserver_link,bytes:this.props.file.bytes}):o.createElement(m.PreviewAudio,{bytes:this.props.file.bytes,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,src:this.props.file.direct_blockserver_link})},t.prototype.renderArchivePreview=function(){return o.createElement(y.PreviewArchiveLoadable,{file:this.props.file,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user})},t.prototype.renderCloudDocPreview=function(){return this.props.file.preview_url?(C.replace_location(this.props.file.preview_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(d.ErrorType.SupportError)},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,i=n.count,r=n.file,a=n.filePreviewSession,s=n.index,l=n.isMobileUserAgent,d=n.maxFilenameEmLength,m=n.onNext,h=n.onPrevious,f=n.sharedLinkInfo,v=n.sharePermission,_=n.shareToken,g=n.user,y=this.props.shouldDisplayToolbar&&u.FlippableHelpers.isFlippableFile(r)&&!c.isArchiveFile(r);return o.createElement(p.PreviewError,{file:r,maxFilenameEmLength:d,filePreviewSession:a,errorType:e,user:g,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:f,shareToken:_,sharePermission:v,shouldDisplayToolbar:y,index:s,isMobileUserAgent:l,count:i,onPrevious:h,onNext:m,message:this.getErrorMessage(e,t,r)})},t.prototype.choosePreview=function(){var e=this.props,t=e.file,n=e.previewTypeWhitelist;if(t.is_dir&&!s.isSupportedBundleFile(t))return this.renderErrorPreview(d.ErrorType.ExtensionError);if(null==t.ns_id&&!c.isArchiveFile(t))return this.renderErrorPreview(d.ErrorType.PendingUploadError);if(c.isSymLink(t))return this.renderErrorPreview(d.ErrorType.SymLinkError);if(s.isEmptyFile(t)&&t.preview_type!==a.PreviewType.CloudDoc)return this.renderErrorPreview(d.ErrorType.EmptyFileError);var i=null==n||n.includes(t.preview_type);if(!s.extensionSupported(t)||!i)return this.renderErrorPreview(d.ErrorType.ExtensionError);if(!s.filesizeSupported(t))return this.renderErrorPreview(d.ErrorType.FileSizeError);switch(t.preview_type){case a.PreviewType.Photo:return this.renderImagePreview();case a.PreviewType.Video:return this.renderVideoPreview();case a.PreviewType.Linkfile:return this.renderLinkfilePreview();case a.PreviewType.Doc:return this.renderPDFPreview();case a.PreviewType.Excel:case a.PreviewType.HTML:case a.PreviewType.Text:return this.renderHTMLPreview();case a.PreviewType.Audio:return this.renderAudioPreview();case a.PreviewType.Archive:return this.renderArchivePreview();case a.PreviewType.CloudDoc:return this.renderCloudDocPreview();default:S.assert(!1,"Preview type "+t.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}return null},t.prototype.render=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,r=e.shareToken,a=e.sharePermission,l=e.sizeClass,u=e.user,d=this.state,p=d.errorType;return d.hasError?this.renderErrorPreview(p):o.createElement("div",{className:i({"flex-preview-container":!0,"no-download":a&&0===a.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},c.isArchiveFile(t)?null:o.createElement(E.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),t.preview_type&&s.isLimitedPreview(t)?o.createElement(P,{extension:c.getExtension(t),file:t,sharedLinkInfo:n,shareToken:r,sharePermission:a,shouldShowActionables:this.shouldShowActionables,sizeClass:l,user:u}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:r.noop,user:null},t})(o.Component);t.FilePreview=O,t.FilePreviewWithLogging=A}),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","external/react","modules/clean/loggers/file_preview_logger","modules/clean/previews/cookie_preview_tracer","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","external/lodash"],function(e,t,n,i,o,r,a,s,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setUpFilePreviewLogger=function(e){t.teardownFilePreviewLogger(),t.filePreviewTimelineLogger=new o.FilePreviewTimelineLogger(e),t.filePreviewTimelineLogger.listenTo(l.filePreviewEventEmitter),t.filePreviewUserActionLogger=new o.FilePreviewUserActionLogger,t.filePreviewUserActionLogger.listenTo(l.filePreviewEventEmitter)},t.teardownFilePreviewLogger=function(){null!=t.filePreviewTimelineLogger&&t.filePreviewTimelineLogger.unlistenTo(l.filePreviewEventEmitter),null!=t.filePreviewUserActionLogger&&t.filePreviewUserActionLogger.unlistenTo(l.filePreviewEventEmitter)},t.logPreviewSessionEnded=function(e){void 0===e&&(e=u.PreviewSessionEndReason.Unknown);var n={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};t.state.filePreviewSession.recordEvent(s.EventType.FilePreviewSessionEnded,n)},t.startNewFilePreviewSession=function(e){var n=e.file,i=e.isMounted,o=e.sourceAction,r=e.sourceContext,a=new c.FilePreviewSession({file:n,fileViewerSession:c.FileViewerSession.currentSession,isMounted:i,sourceAction:o,sourceContext:r});c.FilePreviewSession.currentSession=a,t.setState({filePreviewSession:a}),t.setUpFilePreviewLogger(a.id),t.teardownFilePreviewCookieTracer(),t.setupCookiePreviewTracer(a.id,l.filePreviewEventEmitter),a.recordEvent(s.EventType.FilePreviewAttemptStarted)},t.setupCookiePreviewTracer=function(e,n){t.filePreviewCookieTracer=new r.CookiePreviewTracer(e,n)},t.teardownFilePreviewCookieTracer=function(){t.filePreviewCookieTracer&&t.filePreviewCookieTracer.teardown()},t.windowCloseHandler=function(){t.logPreviewSessionEnded(u.PreviewSessionEndReason.BeforeUnload)},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.startNewFilePreviewSession(this.props)},t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(u.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),this.teardownFilePreviewCookieTracer(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){p.isEqual(e.file,this.props.file)||(this.logPreviewSessionEnded(u.PreviewSessionEndReason.NewFile),this.startNewFilePreviewSession(e))},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(i.Component);t.FilePreviewSessionManager=m;var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var n=t.props.file,i=e.action,o=e.parameters;"pagerendered"===i&&a.logPageRendered(n,o)},t.startLogger=function(){t.frameMessenger=new d.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(i.Component);t.FilePreviewPaasLoggerManager=h}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","external/classnames","external/keymaster","external/lodash","external/react","external/react-dom","external/react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/react/comments2/util","modules/clean/analytics","modules/clean/history","modules/clean/loggers/file_viewer_logger","modules/clean/previews/constants","modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/title_bar","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/location/with_location","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/web_timing_logger","modules/constants/file_activity_stream","modules/constants/file_viewer","modules/constants/python","modules/core/browser","modules/core/dom","modules/core/uri","modules/clean/react/file_viewer/data/selectors","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/flux_connector","modules/clean/file_store/utils","modules/clean/growth/showcase_upsell/preview_loader","modules/clean/react/file_viewer/open_in_paper","modules/constants/file_viewer"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w,b,C,S,E,A,T,P,k,x,R,I,O,F,M,D,L,N,U,q,V,B,H,K,z,W,j,G,Z,Q,Y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var X="",J="",$=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.previewSourceAction=t.props.initialPreviewSourceAction,t.previewSourceContext=t.props.initialPreviewSourceContext,t.focusInViewer=function(){if(!W.modalIsUp()&&!t.props.shouldFocusCommentInput){var e=s.findDOMNode(t).querySelector(".button-primary");if(e)e.focus();else{var n=V.getTabbableElementsIn(".react-file-viewer");n.length&&n[0].focus()}}},t.flipNext=function(){t.props.onFlipNext&&t.props.onFlipNext()},t.flipPrevious=function(){t.props.onFlipPrevious&&t.props.onFlipPrevious()},t.setupKeymaster=function(){W.FlippableHelpers.isFlippableFile(t.props.file)&&(o("left","fileviewer",function(){t.flipPrevious(),_.logUserAction(z.UserAction.FlipPrevious,z.UserActionContext.Keyboard)}),o("right","fileviewer",function(){t.flipNext(),_.logUserAction(z.UserAction.FlipNext,z.UserActionContext.Keyboard)})),o("esc","fileviewer",function(e){V.focus_in_input()||V.is_input(e.target)||document.querySelector(".annotation-bubble")||t.props.isFullscreen||t.fileSubpath||null!=t.props.onCloseViewer&&t.props.onCloseViewer()}),X=o.getScope(),o.setScope("fileviewer")},t.cleanupKeymaster=function(){o.clearScope("fileviewer"),o.setScope(X)},t.shouldShowOpenInAppBanner=function(){var e=t.props,n=e.hidePageChrome,i=e.isMobileUserAgent;return!n&&(!(!q.is_tablet()||!W.renderOpenInAppAsBanner())||(i||q.is_mobile_or_tablet()))},t.openInAppBannerOnClick=function(){_.logUserAction(z.UserAction.OpenInApp,z.UserActionContext.OpenInAppBanner)},
t.onInterstitialClose=function(){t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){t.props.onAppDownloadInterstitialDismissed()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.setUpLogging()},t.prototype.componentDidMount=function(){var e=this.props,t=e.file,n=e.fetchShowOverQuotaUpsell,i=e.onComponentDidMount,o=e.user;null!=i&&i(),this.flipNext=r.throttle(this.flipNext,100),this.flipPrevious=r.throttle(this.flipPrevious,100),this.setupPreviewUrl(t),this.setDocumentTitle(G.getFilename(t),!0),V.scroll_lock_document(),m.start(),this.logView(),n(o)},t.prototype.componentWillUpdate=function(e){var t=e.file;t!==this.props.file&&(this.updatePreviewUrl(t),this.setDocumentTitle(G.getFilename(t)),this.previewSourceAction=I.PreviewSourceAction.Click,this.previewSourceContext=I.PreviewSourceContext.FileViewer),o.setScope("fileviewer")},t.prototype.componentDidUpdate=function(e){G.areFilesEqual(e.file,this.props.file)||this.logView()},t.prototype.componentWillUnmount=function(){this.teardownPreviewUrl(),this.unsetDocumentTitle(),V.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),x.Modal.close()},Object.defineProperty(t.prototype,"fileSubpath",{get:function(){return E.getFileSubpath(this.props.location)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isViewingFileSubpath",{get:function(){return this.props.file.preview_type===h.PreviewType.Archive&&!!this.fileSubpath},enumerable:!0,configurable:!0}),t.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},t.prototype.setUpLogging=function(){if(A.FileViewerSession.currentSession=new A.FileViewerSession,this.props.fileViewTarget===U.FileViewTargetType.SHARED_CONTENT_LINK){var e=D.start_time(),t=(new Date).getTime();this.props.user&&d.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER","PREVIEW_PAGE",{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},t.prototype.setupPreviewUrl=function(e){this.props.skipOuterRouting||this.setPreviewUrl(e)},t.prototype.updatePreviewUrl=function(e){this.setPreviewUrl(e,!1)},t.prototype.teardownPreviewUrl=function(){this.props.skipOuterRouting||this.unsetPreviewUrl()},t.prototype.setPreviewUrl=function(e,t){if(void 0===t&&(t=!0),!this.props.disableRouting){var n=G.getFilename(e),i=B.URI.parse(p.get_url()),o=B.URI.encode_parts(i.getPath()),r=i.removeQuery("select").updateQuery({preview:n}).getQuery();t?p.push_state(o,r,{immediatelyRestoreState:!1}):p.replace_state(o,r)}},t.prototype.unsetPreviewUrl=function(){if(!this.props.disableRouting){var e=B.URI.parse(p.get_url()),t=B.URI.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery();p.push_state(t,n,{immediatelyRestoreState:!1})}},t.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},t.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},t.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),t&&(J=document.title),document.title=e},t.prototype.unsetDocumentTitle=function(){""!==J&&(document.title=J)},t.prototype.logView=function(){null===this.props.file.ns_id||W.determinePathContext()===z.PathContext.SharedLinkCollection||this.props.hidePageChrome||m.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled())},t.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===F.SizeClass.Small||this.props.hidePageChrome)},t.prototype.renderFlippableControls=function(){if(W.FlippableHelpers.isFlippableFile(this.props.file)&&!this.props.isFullscreen&&!this.isImagePreviewAnnotationEnabled()&&null!=this.props.fileIndex)return a.createElement(S.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious})},t.prototype.renderShowcaseUpsell=function(){return a.createElement(Z.ShowcaseUpsellPreviewLoader,{user:this.props.user,currentFile:this.props.file,sharedLinkInfo:this.props.sharedLinkInfo,variant:N.UJ_SHOWCASE_UPSELL_PREVIEW_VARIANT,sizeClass:this.props.sizeClass,isFullscreen:this.props.isFullscreen,hidePageChrome:this.props.hidePageChrome})},t.prototype.renderFilePreview=function(){return a.createElement("div",{className:"react-file-viewer__preview react-file-preview"},a.createElement("div",{className:"flex-preview-container"},this.renderPreviewQualityPopup(),this.shouldShowOpenInAppBanner()&&a.createElement(R.OpenInAppBanner,{urls:this.props.file.open_in_app_data,onClick:this.openInAppBannerOnClick}),a.createElement(C.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,file:this.props.file,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:z.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onNext:this.flipNext,onPrevious:this.flipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.props.user}),this.renderFlippableControls()))},t.prototype.renderSidebar=function(){return this.props.sizeClass!==F.SizeClass.Large||this.props.isFullscreen||this.props.hidePageChrome||q.is_mobile_or_tablet()||this.isViewingFileSubpath||null==this.props.file.ns_id?null:a.createElement(f.FileSidebar,{activityContext:this.props.activityContext,currentFile:this.props.file,headerComponent:this.props.sidebarHeaderComponent,commentsDisabledOnFile:!!this.props.hideComments,isVersionHistoryMode:!!this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,shouldInitiallyFocusInput:!!this.props.shouldFocusCommentInput,user:this.props.user})},t.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,i=e.user;return this.props.isFullscreen||this.isViewingFileSubpath?null:a.createElement(c.MobileWebComments,{currentFile:t,sharedLinkInfo:n,user:i})},t.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&this.props.file.preview_type!==h.PreviewType.Archive?null:a.createElement("div",{className:"react-file-viewer__title-bar"},a.createElement(T.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,file:this.props.file,fileSubpath:this.fileSubpath,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,hidePageChrome:this.props.hidePageChrome,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,isViewingFileSubpath:this.isViewingFileSubpath,maxFilenameEmLength:z.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onRestoreRevision:this.props.onRestoreRevision,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sizeClass:this.props.sizeClass,user:this.props.user||null,onMount:this.focusInViewer}),this.renderUpsellBanner())},t.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},t.prototype.renderPreviewQualityPopup=function(){var e=this.props,t=e.file,n=e.hidePageChrome,i=e.renderStatus,o=e.sizeClass;return W.shouldShowPreviewQualityPopup({sizeClass:o,hidePageChrome:n,renderStatus:i})?a.createElement(O.PreviewQualityPopup,{allowFileDonation:this.shouldAllowFileDonation(),file:t,showProbability:N.PREVIEW_QUALITY_POPUP_PROBABILITY}):null},t.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?a.createElement(b.ExpFileViewerUpsellBannerV2,null):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.file,o=e.hidePageChrome,r=e.isFullscreen,s=e.sharePermission,l=e.sharedLinkInfo,c=e.sizeClass,d=e.transparentBackground,p=e.user,m=G.getFilename(n);return this.shouldShowAppDownloadInterstitial()?a.createElement("div",{"aria-label":m},a.createElement(g.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:l,file:n,fileViewerSession:A.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue})):a.createElement(P.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},a.createElement(ee,{ns_id:n.ns_id},a.createElement("div",{"aria-label":m,className:i("react-file-viewer",t,{"no-background":d&&!r}),role:"dialog"},this.renderTitleBar(),c!==F.SizeClass.Large||r||o?null:a.createElement(Q.OpenInPaperBanner,{currentFile:n,sharedLinkInfo:l,sharePermission:s,user:p}),a.createElement("div",{className:i("react-file-viewer__content",{"comments2-mobile-web":u.shouldUseComments2MobileWeb({previewType:n.preview_type||void 0,viewer:p})})},this.renderFilePreview(),this.renderSidebar(),this.renderShowcaseUpsell(),this.renderMobileComments()))))},t.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",disableRouting:!1,hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:U.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:F.SizeClass.Large,skipOuterRouting:!1,fileCount:0},t})(a.Component);t._FileViewer=$;var ee=function(e){var t=e.children,n=e.ns_id;return L.IS_ON&&null!=n?a.createElement(v.FileSidebarProvider,null,t):a.Children.only(t)},te=function(e){return null!=e.file?a.createElement($,n.__assign({},e)):a.createElement("div",null)},ne=j.connectFileViewerToLegacyFlux(te);t._FileViewerWithLegacyFlux=ne;var ie=Y.REDUX_FILE_VIEWER?k.withLocation(te):k.withLocation(ne),oe=M.withSizeClass(ie,{isResponsiveEnabled:W.isResponsiveEnabled,responsiveClassName:z.ResponsiveClassName}),re=l.connect(function(e,t){var n=H.getAppDownloadInterstitial(e);return void 0===n&&t&&(n=t.appDownloadInterstitialDismissed),{appDownloadInterstitialDismissed:n,file:H.getActiveFile(e),isFullscreen:H.getIsFullScreen(e),isSidebarOpen:H.getIsSidebarOpen(e),renderStatus:H.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:H.getShowOverQuotaUpsell(e)}},{onAppDownloadInterstitialDismissed:y.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:y.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:y.setRenderStatusSuccessForCurrentFile})(oe),ae=w.getStoreForFileViewer(),se=function(e){return a.createElement(l.Provider,{store:ae},a.createElement(re,n.__assign({},e)))},le=["/static/css/preview_flexbox_layout-vflQUUZaq.css","/static/css/react_file_viewer-vflnqLj1q.css","/static/css/react_title_bar-vflzpT8c1.css","/static/css/spectrum/index.web-vflBdlkSG.css"],ce=K(se,le);t.FileViewer=ce}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=r._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=r._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return i.createElement("div",{className:"react-file-viewer__controls"},i.createElement("button",{className:"nav-control",alt:e,onClick:this.handlePreviousClick},i.createElement(o.Sprite,{group:"web",name:"s_flip_left",alt:e})),i.createElement("div",{className:"nav-text"},this.getNavText()),i.createElement("button",{className:"nav-control",alt:t,onClick:this.handleNextClick},i.createElement(o.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})(i.Component);t.FlippableControls=a}),define("modules/clean/react/file_viewer/flux_connector",["require","exports","tslib","external/react","external/hoist-non-react-statics","modules/clean/react/file_viewer/store","modules/constants/file_viewer"],function(e,t,n,i,o,r,a){"use strict";function s(e){return o((function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=n.__assign({},e.getStateFromStore()),e.onUpdateFromStore=function(){e.setState(e.getStateFromStore)},e.getReduxOverrides=function(){var t=e.props,n=e.state,i={};return l.forEach(function(e){i[e]=null!=t[e]?t[e]:n[e]}),i},e}return n.__extends(o,t),o.prototype.componentDidMount=function(){this.removeStoreListener=r.FileViewerStore.instance.addListener(this.onUpdateFromStore)},o.prototype.componentWillUnmount=function(){this.removeStoreListener()},o.prototype.getStateFromStore=function(e){return{file:r.FileViewerStore.instance.getCurrentFile(),sharedLinkInfo:r.FileViewerStore.instance.getSharedLinkInfo(),sharePermission:r.FileViewerStore.instance.getSharePermissions(),shareToken:r.FileViewerStore.instance.getShareToken()}},o.prototype.render=function(){var t=this.props;return a.REDUX_FILE_VIEWER?i.createElement(e,n.__assign({},t)):i.createElement(e,n.__assign({},this.state,t,this.getReduxOverrides()))},o})(i.Component),e)}Object.defineProperty(t,"__esModule",{value:!0});var l=["file","sharedLinkInfo","sharePermission","shareToken"];t.connectFileViewerToLegacyFlux=s}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r){"use strict";function a(e){document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e)}function s(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e)}function l(e){window.addEventListener("popstate",e)}function c(e){window.removeEventListener("popstate",e)}function u(){var e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function d(){var e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}function p(){C.dispatch(i.setFullScreen(!0))}function m(){C.dispatch(i.setFullScreen(!1))}function h(){b()||y(r.UserActionContext.Browser)}function f(){y(r.UserActionContext.Browser)}function v(){a(h),l(f)}function _(){s(h),c(f)}function g(e,t){p(),e&&(u(),v()),t&&o.logUserAction(r.UserAction.ToggleFullscreenOn,t)}function y(e){_(),m(),d(),e&&o.logUserAction(r.UserAction.ToggleFullscreenOff,e)}function w(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen}function b(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}Object.defineProperty(t,"__esModule",{value:!0});var C=n.getStoreForFileViewer();t.enterFullScreen=g,t.exitFullScreen=y,t.browserSupportFullScreen=w,t.isBrowserFullscreen=b}),define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,n)}).then(function(e){return e.OpenButton})}})}),define("modules/clean/react/file_viewer/open_in_paper",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/react/file_viewer/utils","modules/constants/file_viewer"],function(e,t,n,i,o,r){"use strict";function a(){return"VARIANT_A"===r.OPEN_IN_PAPER_VARIANT}Object.defineProperty(t,"__esModule",{value:!0});var s=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/paper/open_in_paper_banner"],t,n)}).then(function(e){return e.OpenInPaperBanner})}});t.OpenInPaperBanner=function(e){var t=e.currentFile,i=e.sharedLinkInfo,r=e.sharePermission,l=e.user;return a()&&o.canUserUsePaper(l)&&o.canDownloadFile(i,r)?n.createElement(s,{file:t,sharedLink:i.url,source:null!=i?"shared_file_actions":"mounted_file_actions"}):null}}),define("modules/clean/react/file_viewer/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","modules/clean/flux/dispatcher","modules/constants/file_viewer"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.files=[],n.currentIndex=0,n.sharedLinkInfos={},n.shareTokens={},n.sharePermissions={},n.renderStatuses={},n.openInAppBannerClosed=!1,n.previewQualityPopupClosed=!1,n.cachedLatestRevision=null,n.disableFlipping=!1,n}return n.__extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.INSTANCE},enumerable:!0,configurable:!0}),t.prototype.getSharedLinkInfo=function(){return this.sharedLinkInfos[a.getFileRevisionId(this.getCurrentFile())]},t.prototype.getShareToken=function(){return this.shareTokens[a.getFileRevisionId(this.getCurrentFile())]},t.prototype.getSharePermissions=function(){return this.sharePermissions[a.getFileRevisionId(this.getCurrentFile())]},t.prototype.getCurrentFile=function(){return this.files[this.currentIndex]},t.prototype.renderStatus=function(){return this.getCurrentFile()?this.renderStatuses[a.getFileRevisionId(this.getCurrentFile())]:o.PreviewRenderStatus.Unknown},t.prototype.shouldShowPreviewQualityPopup=function(){if(l.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)return!1;var e=a.getFileRevisionId(this.getCurrentFile());return this.renderStatuses[e]===o.PreviewRenderStatus.Succeeded&&!this.previewQualityPopupClosed},t.prototype.shouldShowOpenInAppBanner=function(){if(this.openInAppBannerClosed)return!1;var e=this.getCurrentFile();return!!e&&!!e.open_in_app_data},t.prototype.setup=function(e){this.disableFlipping=e.disableFlipping,void 0!==e.files&&void 0!==e.currentIndex&&this.updateFiles(e.files[e.currentIndex],{files:e.files},e.sharedLinkInfos,e.shareTokens,e.sharePermissions)},t.prototype.updateFiles=function(e,t,n,i,s){if(void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===s&&(s=[]),t.files){this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={};for(var l=0;l<t.files.length;l++){var c=a.getFileRevisionId(t.files[l]);n.length>l&&(this.sharedLinkInfos[c]=n[l]),i.length>l&&(this.shareTokens[c]=i[l]),s.length>l&&(this.sharePermissions[c]=s[l]),this.renderStatuses[c]=o.PreviewRenderStatus.Unknown}var u=r.FlippableHelpers.isFlippableFile(e),d=this.getFileIndex(t.files,e)>=0;!this.disableFlipping&&u&&d?(this.files=r.FlippableHelpers.filterFlippableFiles(t.files),this.currentIndex=this.getFileIndex(this.files,e)):(this.files=[e],this.currentIndex=0),this.__emitChange()}},t.prototype.cleanup=function(){this.files=[],this.currentIndex=0,this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={},this.cachedLatestRevision=null},t.prototype.nextFile=function(){this.restoreRevision(),this.currentIndex===this.files.length-1?this.currentIndex=0:this.currentIndex=this.currentIndex+1,this.__emitChange()},t.prototype.previousFile=function(){this.restoreRevision(),0===this.currentIndex?this.currentIndex=this.files.length-1:this.currentIndex=this.currentIndex-1,this.__emitChange()},t.prototype.switchRevision=function(e){this.cachedLatestRevision||(this.cachedLatestRevision=this.files[this.currentIndex]),this.files[this.currentIndex]=e.file,this.__emitChange()},t.prototype.restoreRevision=function(){this.cachedLatestRevision&&(this.files[this.currentIndex]=this.cachedLatestRevision,this.cachedLatestRevision=null,this.__emitChange())},t.prototype.saveForwardRevision=function(e){this.cachedLatestRevision=e.file,this.__emitChange()},t.prototype.updateRenderStatus=function(e){this.getCurrentFile()&&(this.renderStatuses[a.getFileRevisionId(this.getCurrentFile())]=e.newStatus,this.__emitChange())},t.prototype.markPreviewQualityPopupAsClosed=function(){this.previewQualityPopupClosed=!0,this.__emitChange()},t.prototype.markOpenInAppBannerAsClosed=function(){this.openInAppBannerClosed=!0,this.__emitChange()},t.prototype.getFileIndex=function(e,t){for(var n=0;n<e.length;n++)if(a.areFilesEqual(t,e[n]))return n;return-1},t.prototype.__onDispatch=function(e){switch(e.action.type){case o.ActionType.Setup:this.setup(e.action.data);break;case o.ActionType.Cleanup:this.cleanup();break;case o.ActionType.UpdateFiles:this.updateFiles(this.getCurrentFile(),e.action.data);break;case o.ActionType.FlipNext:this.nextFile();break;case o.ActionType.FlipPrevious:this.previousFile();break;case o.ActionType.SaveForwardRevision:this.saveForwardRevision(e.action.data);break;case o.ActionType.SwitchRevision:this.switchRevision(e.action.data);break;case o.ActionType.RestoreRevision:this.restoreRevision();break;case o.ActionType.BroadcastRenderStatus:this.updateRenderStatus(e.action.data);break;case o.ActionType.ClosePreviewQualityPopup:this.markPreviewQualityPopupAsClosed();break;case o.ActionType.HideOpenInAppBanner:this.markOpenInAppBannerAsClosed()}},t.INSTANCE=new t(s.Dispatcher),t})(i.FluxStore);t.FileViewerStore=c}),define("modules/clean/react/file_viewer/title_bar",["require","exports","external/react","modules/clean/react/async/loadable"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TitleBar=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/file_viewer/title_bar_component"],t,n)}).then(function(e){return e.TitleBar})},loading:n.createElement("div",{className:"react-title-bar"})})}),define("modules/clean/react/file_viewer/utils",["require","exports","external/lodash","modules/clean/activity/constants","modules/clean/ajax","modules/core/browser","modules/clean/previews/util","modules/clean/open_with","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/constants/file_viewer","modules/core/uri","modules/clean/react/previews/constants","modules/constants/python","modules/clean/react/file_viewer/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/file_store/utils","modules/clean/previews/path_context_utils","modules/clean/previews/responsive_utils"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w,b){"use strict";function C(e){return W.indexOf(e.preview_type)>-1&&!a.isLimitedPreview(e)}function S(e){return Array.isArray(e)?e.filter(function(e){return C(e)}).map(function(e){return e}):[]}function E(e,t){return u.WOPI_BUTTON_VISIBLE&&e.bytes<=s.MAX_SUPPORTED_FILE_SIZE_B&&null!==s.get_open_handler_for(e,t)}function A(e,t){return s.get_open_handler_for(e,t)}function T(e,t){var n=A(e,t),i=n.uri+"?hpt_click_ts="+Date.now();r.redirect(i)}function P(e,t){o.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function k(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o],a=r.extensions;if(a.indexOf(t)>-1)return{vendor:n,application:o}}}return null}function x(e,t,n){"acrobat_or_reader"===n?o.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):o.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}function R(e,t){if(e===c.SplitButtonActionLocation.Main){if(t===c.FileViewerPane.TitleBar)return c.UserActionContext.TitleBarMain;if(t===c.FileViewerPane.PreviewContent)return c.UserActionContext.PreviewContentMain}else if(e===c.SplitButtonActionLocation.Split){if(t===c.FileViewerPane.TitleBar)return c.UserActionContext.TitleBarSplitButton;if(t===c.FileViewerPane.PreviewContent)return c.UserActionContext.PreviewContentSplitButton}return c.UserActionContext.Unknown}function I(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++){e="none"!==window.getComputedStyle(t[n]).display}return e}function O(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}function F(){return new d.URI({path:"/login",query:{cont:r.get_href()}}).toString()}function M(){return"BANNER"===u.OPEN_IN_APP_VARIANT}function D(e,t){if([i.ActivityContext.BROWSE_FILE_VIEWER,i.ActivityContext.SHARED_LINK_VIEW,i.ActivityContext.SHARED_CONTENT_LINK_VIEW].indexOf(e)>=0)switch(t){case l.PreviewType.Photo:return c.FileViewerInterfaceType.Window;case l.PreviewType.Doc:return c.FileViewerInterfaceType.Frame}}function L(e){return!e}function N(e,t){return L(e)||t&&t.canDownloadRoles.length>0}function U(e){return null!=e&&!e.is_paper_disabled}function q(e){switch(e){case m.FileViewTargetType.SHARED_LINK:return i.ActivityContext.SHARED_LINK_VIEW;case m.FileViewTargetType.SHARED_CONTENT_LINK:return i.ActivityContext.SHARED_CONTENT_LINK_VIEW;default:return i.ActivityContext.BROWSE_FILE_VIEWER}}function V(e){switch(e){case h.PathContext.SharedLinkCollection:return p.PreviewSourceContext.SharedLinkCollection;case h.PathContext.VersionHistory:return p.PreviewSourceContext.VersionHistory;default:return p.PreviewSourceContext.Browse}}function B(e){switch(e){case h.PathContext.SharedLinkFile:case h.PathContext.SharedLinkFolder:return p.PreviewSourceAction.Visit;default:return p.PreviewSourceAction.Click}}function H(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(i){var o=(t+i+e.length)%e.length;n.indexOf(o)===-1&&n.push(o)}),n.forEach(function(t){if(e.length>t&&e[t].preview_type===l.PreviewType.Photo){var n=e[t],i=n.preview_url||n.thumbnail_url_tmpl;i&&f.preloadResponsiveImage(i).then(function(e){var n=v.FileViewerSession.currentSession;null==n||t in n.imagesFetched||(n.imagesFetched[t]=e)})}})}}function K(e){var t=e.renderStatus,n=e.hidePageChrome,i=e.sizeClass;return!(u.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)&&(t===_.PreviewRenderStatus.Succeeded&&(!n&&i!==g.SizeClass.Small))}function z(e){return"sketch"===y.getExtension(e)}Object.defineProperty(t,"__esModule",{value:!0});var W=[l.PreviewType.Photo];t.FlippableHelpers={isFlippableFile:C,filterFlippableFiles:S},t.OpenWithHelpers={canOpenWith:E,getOpenWithHandlerData:A,openWith:T},t.TooltipHelpers={fetchTooltipInfo:P,getVendorAndApplication:k,logImpression:x},t.getSplitButtonUserActionContext=R,t.modalIsUp=I,t.cleanupPrerenderPreview=O,t.getSharedLinkLoginUrl=F,t.sharedLinkLoginUrl=F(),t.renderOpenInAppAsBanner=M,t.determinePathContext=w.determinePathContext,t.isResponsiveEnabled=b.isResponsiveEnabled,t.getFileViewerInterfaceType=D,t.isMountedFile=L,t.canDownloadFile=N,t.canUserUsePaper=U,t.getActivityContext=q,t.getSourceContext=V,t.getSourceAction=B,t.preloadImages=H,t.shouldShowPreviewQualityPopup=K,t.fetchRivieraStatusCode=function(e,t,i){void 0===i&&(i=function(){});var o=new XMLHttpRequest;return o.open("GET",e),o.withCredentials=!0,o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE)try{var e=o.getResponseHeader("x-dropbox-metadata");if(e){var r=JSON.parse(e),a=n.get(r,"rivieraStatusCode");void 0!==a&&t(a)}else i()}catch(e){i()}},o.send(),o},t.shouldFetchRivieraStatusCode=z}),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/lodash","modules/clean/keycode"],function(e,t,n,i,o){"use strict";function r(e){return n.__assign({},t.genericKeyboardEventCriteria,{which:e})}function a(e){return n.__assign({},y,{which:e})}function s(e){return{keyboardEventCriteria:n.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:w}}function l(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}}function c(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}}function u(e){return n.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})}function d(e,t){return[(n={which:e},n[t]=!0,n),(i={which:e},i[t]=!1,i)];var n,i}function p(e){return function(t){return d(t,e)}}function m(e){return i.flatten(e.map(p("shiftKey")))}function h(e,t){return e.map(function(e){return s({keyboardEventCriteria:e,callback:t})})}function f(e){return h(b,e)}function v(e){return h(C,e)}function _(e){return void 0!==e.preventDefault}function g(e){return function(t){e(),_(t)&&t.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var y={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(y),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=r,t.generateUnmodifiedSimpleKeyboardEvent=a;var w=function(){};t.hydrateKeyboardBinding=s,t.getKeyboardEventCriteria=l,t.getSimpleKeyboardEvent=c,t.addLegacyPropertiesToSimpleKeyboardEvent=u;var b=m([o.KeyCode.EQUALS,o.KeyCode.PLUS_EQUALS_FF,o.KeyCode.PLUS_CHROME,o.KeyCode.PLUS_EQUALS_FF_GERMAN]),C=m([o.KeyCode.MINUS_FF_MAC,o.KeyCode.MINUS_FF,o.KeyCode.MINUS_CHROME]);t.getEqualsKeyBindings=f,t.getMinusKeyBindings=v,t.isKeyboardEvent=_,t.withPreventDefault=g}),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","external/react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(t,n){var i=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return i}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},
t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=o.KeyboardBindingProviderContextTypes,t})(i.Component);t.KeyboardBindingConnector=r}),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","external/react","external/prop-types","modules/clean/callback_chain/callback_chain","modules/clean/keycode","modules/clean/react/keyboard_binding/keyboard_binding"],function(e,t,n,i,o,r,a,s){"use strict";function l(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach(function(e){n+=e+":"+t[e]+","}),n}function c(e){return e.reduce(function(e,t){return t.reduce(function(e,t){var n=t.keyboardEventCriteria,i=t.callback,o=l(n);return e[o]=e[o]||[],e[o].push(i),e},e)},{})}function u(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new r.CallbackChain(p).run(t)}function d(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,i=e.which,o="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,r=["submit","button"].indexOf(t.type)!==-1,s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();return!(o&&!r||s)||(i===a.KeyCode.ESC||i===a.KeyCode.TAB)}Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:o.func,registerKeyBindings:o.func,unregisterKeyBindings:o.func,updateKeyBindings:o.func};var p=[];t.noop=function(e){};var m=(function(e){function o(n){var i=e.call(this,n)||this;return i.registrationIdentifier=0,i.registeredBindings=[],i.keyboardBindingsByCriteria={},i.allKeyHandlers=[],i.registerKeyBindings=function(e){var n=i.registrationIdentifier++;return i.updateKeyBindings(n,e),i.allKeyHandlers[n]||(i.allKeyHandlers[n]=t.noop),n},i.registerAllKeyCallback=function(e,n){i.allKeyHandlers[e]=null!=n?n:t.noop},i.unregisterKeyBindings=function(e){i.updateKeyBindings(e,[]),i.allKeyHandlers[e]=t.noop},i.updateKeyBindings=function(e,t){i.registeredBindings[e]=null!=t?t:[],i.keyboardBindingsByCriteria=c(i.registeredBindings)},i.onKeyDown=function(e){if(d(e)){var t=i.getCallbacksForKey(e);new r.CallbackChain(t).run(e)}},i.allKeyHandlers=[],i.registeredBindings=[],i}return n.__extends(o,e),o.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=p.length,p.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},o.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),p[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},o.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},o.prototype.getCallbacksForKey=function(e){var t=l(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},o.prototype.render=function(){return i.Children.only(this.props.children)},o.childContextTypes=t.KeyboardBindingProviderContextTypes,o})(i.Component);t.KeyboardBindingProvider=m,t.getIndexForkeyboardBindingsByCriteria=l,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=c,t.simulateKeyEvent=u}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],function(e,t,n,i,o,r,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){s.logUserAction(l.UserAction.OpenInApp,n.props.userActionContext),r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return i.createElement(o.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?a._("Install app?"):a._("Open in app"))},t})(i.Component);t.OpenInAppButton=c}),define("modules/clean/react/previews/archive/preview_archive_loadable",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewArchiveLoadable=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/archive/preview_archive"],t,n)}).then(function(e){return e.PreviewArchive})}})}),define("modules/clean/react/previews/audio/preview_audio",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/radio_illustration","modules/clean/react/previews/audio/utils","modules/clean/react/previews/loading_indicator","modules/core/browser","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={time:0,duration:0,bufferedLength:0,isPlaying:!1,isInitialized:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1},t.setAudioRef=function(e){t.audio=e},t.setAudioWrapperRef=function(e){t.audioWrapper=e},t.handleResize=r.debounce(function(){t.setWaveformWidth()},100),t.markReady=r.once(function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),setTimeout(t.setContainer,500),t.props.bytes&&t.props.bytes<7e7&&t.sendWaveFormRequest()}),t.setContainer=function(){t.setState({isContainerSet:!0})},t.handleCanPlay=function(){t.markReady()},t.handleLoadedMetadata=function(){t.setState({isInitialized:!0})},t.handleProgress=function(){var e=t.getBufferProgress();t.setState({bufferedLength:e})},t.handleTimeUpdate=function(){t.setState({time:t.audio.currentTime})},t.handleSeek=function(e){t.audio.currentTime=e,t.setState({time:e})},t.handleDurationChange=function(){var e=t.getBufferProgress();t.setState({duration:t.audio.duration,bufferedLength:e})},t.handleEnded=function(){t.pauseFile()},t.handlePlayButtonClick=function(){t.playOrPause()},t.handleMuteToggle=function(){var e=t.state.isMuted?t.state.volumeLevel||.1:0;t.audio.volume=e;var n={isMuted:!t.state.isMuted};0===t.state.volumeLevel&&(n.volumeLevel=e),t.setState(n)},t.handleVolumeChange=function(e){t.audio.volume=e,t.setState({volumeLevel:e,isMuted:!e})},t.handleError=function(){y.Notify.error(g._("An audio error occurred")),_.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:_.SEVERITY.NONCRITICAL}),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed),t.props.onError()},t.updateWaveformState=function(e){t.isRendered&&t.setState({rawWaveformHeights:e})},t.checkIfRendered=function(){return t.isRendered},t.parseWaveFormBuffer=function(e){return t.setWaveformWidth(),m.buildFromBuffer(e,1e3,100,t.checkIfRendered,t.updateWaveformState)},t.generateWaveform=function(){var e=Math.floor((t.state.waveformWidth-1)/3);return m.returnWaveform(t.state.rawWaveformHeights,e,.85)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.isRendered=!0,this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),v.mark_time_to_view(),v.mark_time_to_interactive(),this.setWaveformWidth(),window.addEventListener("resize",this.handleResize)},t.prototype.componentWillUnmount=function(){this.isRendered=!1,window.removeEventListener("resize",this.handleResize),null!=this.audioContext&&null!=this.audioContext.close&&this.audioContext.close()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.setWaveformWidth=function(){this.isRendered&&this.setState({waveformWidth:this.audioWrapper.offsetWidth})},t.prototype.getSrcUrl=function(){var e=w.URI.parse(this.props.src);e.updateQuery({duc_id:"dropbox_duc_id"});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.getBufferProgress=function(){return this.audio.duration&&this.audio.buffered&&this.audio.buffered.length?this.audio.buffered.end(this.audio.buffered.length-1):0},t.prototype.playOrPause=function(){this.state.isPlaying?this.pauseFile():this.playFile()},t.prototype.playFile=function(){this.audio.play(),this.setState({isPlaying:!0})},t.prototype.pauseFile=function(){this.audio.pause(),this.setState({isPlaying:!1})},t.prototype.sendWaveFormRequest=function(){var e=this;if(this.setAudioContext(),null==this.audioContext)this.logFailedWaveformGeneration();else{if(f.is_mobile_or_tablet())return;var t=new XMLHttpRequest;t.open("GET",this.getSrcUrl()),t.responseType="arraybuffer",t.withCredentials=!0,t.onreadystatechange=function(){4===t.readyState&&e.isRendered&&(200===t.status?e.audioContext.decodeAudioData(t.response,e.parseWaveFormBuffer,e.logFailedWaveformGeneration):e.logFailedWaveformGeneration())},t.send()}},t.prototype.logFailedWaveformGeneration=function(){_.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:_.SEVERITY.NONCRITICAL})},t.prototype.setAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)},t.prototype.renderAudioTag=function(){return o.createElement("audio",{onCanPlay:this.handleCanPlay,onDurationChange:this.handleDurationChange,onEnded:this.handleEnded,onError:this.handleError,onLoadedMetadata:this.handleLoadedMetadata,onProgress:this.handleProgress,onTimeUpdate:this.handleTimeUpdate,preload:"auto",crossOrigin:"use-credentials",ref:this.setAudioRef,src:this.getSrcUrl()})},t.prototype.renderRadio=function(){var e=0!==this.state.rawWaveformHeights.length,t=i({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isInitialized||e});return o.createElement("div",{className:t},o.createElement(p.RadioIllustration,null))},t.prototype.renderWaveForm=function(){return o.createElement(u.PreviewAudioVisuals,{generateWaveform:this.generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,barWidth:2,barSpacing:1,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isContainerSet:this.state.isContainerSet,key:1,onSeek:this.handleSeek})},t.prototype.renderToolbar=function(){return o.createElement("div",{className:"toolbar",key:2},this.renderPlayButton(),this.renderDetails(),this.renderVolume())},t.prototype.renderPlayButton=function(){return o.createElement(c.PreviewAudioPlayButton,{isPlaying:this.state.isPlaying,onClick:this.handlePlayButtonClick})},t.prototype.renderDetails=function(){return o.createElement(l.PreviewAudioDetails,{time:this.state.time,duration:this.state.duration})},t.prototype.renderVolume=function(){return f.iOS?null:o.createElement(d.PreviewAudioVolume,{isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this.handleVolumeChange,onMuteToggle:this.handleMuteToggle})},t.prototype.render=function(){var e=i({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isInitialized});return o.createElement("div",{className:"flex-preview-container"},o.createElement("div",{className:"preview-audio preview-content preview-content--center"},o.createElement("div",{className:"preview-audio__wrapper",ref:this.setAudioWrapperRef},o.createElement("div",{className:"preview-audio__aspect-container"},o.createElement("div",{className:e},this.renderAudioTag(),this.renderRadio(),this.state.isInitialized?[this.renderWaveForm(),this.renderToolbar()]:o.createElement(h.LoadingIndicator,{className:"preview-audio__load-indicator"}))))))},t})(o.Component);t._PreviewAudio=b;var C=a(b,["/static/css/preview_audio-vfljN6-z1.css"]);t.PreviewAudio=C}),define("modules/clean/react/previews/audio/preview_audio_details",["require","exports","tslib","external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.formatString=function(e){return r._("%(time)s").format({time:o.formatAudioTime(e)})},t.prototype.getDisplayString=function(){return i.createElement("span",{className:"toolbar-details__time"},this.formatString(this.props.time)+" / "+this.formatString(this.props.duration))},t.prototype.render=function(){return i.createElement("div",{className:"toolbar-details vertical-align"},i.createElement("div",{className:"toolbar-details__string vertical-align__child"},this.getDisplayString()))},t})(i.Component);t.PreviewAudioDetails=a}),define("modules/clean/react/previews/audio/preview_audio_play_button",["require","exports","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o){"use strict";function r(e){var t=e.isPlaying,r=e.onClick,a=t?"pause":"play",s=t?o._("Pause"):o._("Play");return n.createElement("button",{className:"toolbar-controller vertical-align",onClick:r,title:s},n.createElement("div",{className:"toolbar-controller__button vertical-align__child"},n.createElement(i.Sprite,{group:"web",name:a,alt:s})))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioPlayButton=r}),define("modules/clean/react/previews/audio/preview_audio_visuals",["require","exports","tslib","external/classnames","external/react","external/react-dom"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrubPercentage:0,isMouseDown:!1},t.setWaveformRef=function(e){t.waveform=e},t.scrubTime=function(e){var n=t.getSeekPercentageFromEvent(e);t.updateWaveformScrubToPercentage(n),t.state.isMouseDown&&t.updateTime(e)},t.resetScrub=function(){t.updateWaveformScrubToPercentage(0),t.setMouseUp()},t.updateTime=function(e){var n=t.getSeekPercentageFromEvent(e),i=n*t.props.duration;t.props.onSeek(i)},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t}return n.__extends(t,e),t.prototype.getSeekPercentageFromEvent=function(e){var t=r.findDOMNode(this.waveform).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getProgress=function(){return this.props.time/(this.props.duration||1)},t.prototype.getBuffered=function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},t.prototype.getWidthObject=function(e){return{width:e+"%"}},t.prototype.updateWaveformScrubToPercentage=function(e){this.setState({scrubPercentage:e})},t.prototype.getScrubObject=function(e){return{onClick:this.updateTime,onMouseMove:this.scrubTime,onMouseLeave:this.resetScrub,onMouseDown:this.setMouseDown,onMouseUp:this.setMouseUp,className:e}},t.prototype.getWavebarClasses=function(e){return i({wavebar__single:!0,"wavebar__single--scrubbed":e})},t.prototype.renderWaveBar=function(e,t){var n,i=1-e,r={top:100*i+"%",height:100*e+"%"},a=this.props.waveformWidth,s=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth;if(this.state.scrubPercentage>0){var l=this.state.scrubPercentage*a;n=this.getWavebarClasses(s<l)}else{var c=this.getProgress()*a;n=this.getWavebarClasses(s<c)}return[o.createElement("div",{className:"wavebar__single wavebar__space",key:1}),o.createElement("div",{className:n,style:r,key:2})]},t.prototype.renderWaveBars=function(){var e,t=this,r=i({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady});return e=this.props.isWaveformReady?this.getScrubObject(r):{className:r},o.createElement("div",n.__assign({},e),this.props.generateWaveform().map(function(e,n){return t.renderWaveBar(e,n)}))},t.prototype.renderWaveForm=function(){var e;return e=this.props.isWaveformReady?this.getWidthObject(100*this.state.scrubPercentage):this.getWidthObject(0),o.createElement("div",{className:"waveform"},o.createElement("div",{className:"waveform__scrub",style:e}),this.renderWaveBars())},t.prototype.renderProgressBar=function(){var e=100*this.getProgress(),t=100*this.getBuffered(),r=i({"audio-progress-bar__done":!0,"audio-progress-bar__showing":!!e});return o.createElement("div",n.__assign({},this.getScrubObject("audio-progress-bar")),o.createElement("div",{className:"audio-progress-bar__buffered",style:this.getWidthObject(t)}),o.createElement("div",{className:r,style:this.getWidthObject(e)}))},t.prototype.render=function(){return o.createElement("div",{className:"visuals",ref:this.setWaveformRef},this.renderWaveForm(),this.renderProgressBar())},t})(o.Component);t.PreviewAudioVisuals=a}),define("modules/clean/react/previews/audio/preview_audio_volume",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/previews/audio/volume_toggle"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMouseDown:!1},t.setVolumeBarRef=function(e){t.volumeBar=e},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t.safeChangeVolume=function(e){if(t.state.isMouseDown)return t.changeVolume(e)},t.changeVolume=function(e){var n=t.getVolumePercentageFromEvent(e);t.props.onVolumeChange(n)},t}return n.__extends(t,e),t.prototype.getVolumePercentageFromEvent=function(e){var t=o.findDOMNode(this.volumeBar).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.renderVolumeBar=function(){var e=this.props.isMuted?0:100*this.props.volumeLevel,t={width:e+"%"};return i.createElement("div",{className:"volume-bar vertical-align__child",onMouseUp:this.setMouseUp,onMouseDown:this.setMouseDown,onMouseLeave:this.setMouseUp,onMouseMove:this.safeChangeVolume,onClick:this.changeVolume},i.createElement("div",{className:"volume-bar__container",ref:this.setVolumeBarRef},i.createElement("div",{className:"volume-bar__selected",style:t})))},t.prototype.render=function(){return i.createElement("div",{className:"toolbar-volume vertical-align"},i.createElement(r.PreviewAudioVolumeToggle,{isMuted:this.props.isMuted,onClick:this.props.onMuteToggle}),this.renderVolumeBar())},t})(i.Component);t.PreviewAudioVolume=a}),define("modules/clean/react/previews/audio/radio_illustration",["require","exports","external/react","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,i,o){"use strict";function r(){return n.createElement(i.Image,{src:o.static_url("/static/images/icons/music_placeholder-vflQRVA8i.png"),srcHiRes:o.static_url("/static/images/icons/music_placeholder@2x-vflHgCx1x.png")})}Object.defineProperty(t,"__esModule",{value:!0}),t.RadioIllustration=r}),define("modules/clean/react/previews/audio/utils",["require","exports","modules/clean/average_counter"],function(e,t,n){"use strict";function i(e,t,i,o,r){function a(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*s.length/t),d=Math.ceil((e+1)*s.length/t),p=d-u;if(p>i)for(var m=0;m<i;m++){var h=Math.floor(Math.random()*p)+u;c.push(Math.abs(s[h]))}else for(var m=u;m<d;m++){var f=Math.floor(Math.abs(s[m]));c.push(f)}var v=new n.AverageCounter;v.addArray(c),l[e]=v.getAverage(),o()&&setTimeout(a(e+1),0)}}var s=e.getChannelData(0),l=new Array(t);setTimeout(a(0),0)}function o(e,t,i){void 0===i&&(i=1);var o=[];if(0===e.length||t<=0)return o;for(var r=[],a=0;a<t;a++)r.push(new n.AverageCounter);for(var s=0,l=0,a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=r[u];d.add(c),o[u]=d.getAverage(),u!==l&&(s=Math.max(s,o[l]),l=u)}return s=Math.max(s,o[t-1]),o.map(function(e){return e*i/s})}Object.defineProperty(t,"__esModule",{value:!0}),t.buildFromBuffer=i,t.returnWaveform=o}),define("modules/clean/react/previews/audio/volume_toggle",["require","exports","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o){"use strict";function r(e){var t=e.isMuted,r=e.onClick,a=t?"volumeMuted":"volume",s=t?o._("Unmute"):o._("Mute");return n.createElement("div",{className:"toolbar-volume__button vertical-align__child"},n.createElement("button",{onClick:r,title:s},n.createElement(i.Sprite,{group:"web",name:a,alt:s})))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioVolumeToggle=r}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),e.call(this,n)||this}return n.__extends(t,e),t})(i.FrameMessengerHost);t.PreviewFrameMessengerHost=o}),define("modules/clean/react/previews/image/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_LARGE_PADDING_HEIGHT=148,t.IMAGE_LARGE_PADDING_WIDTH=72,t.IMAGE_PADDING_HEIGHT=50,t.IMAGE_PADDING_WIDTH=0}),define("modules/clean/react/previews/image_helpers",["require","exports","modules/constants/python","modules/clean/photos/thumbnail_url_util"],function(e,t,n,i){"use strict";function o(e,t){var o;return o=t?l.filter(function(e){var n=e[0],i=e[1];return n<=t[0]&&i<=t[1]}):l,o.map(function(t){var o=t[0],r=t[1];return i.thumbnailUrlForSize(e,o,r,n.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+o+"w"}).join(", ")}function r(e){return i.thumbnailUrlForSize(e,800,600,3)}function a(e){return s(r(e),{srcset:o(e),sizes:t.IMG_SIZES_ATTR})}function s(e,t){return new Promise(function(n,i){var o=Date.now(),r=new Image;r.onload=function(){n({started:o,completed:Date.now()})},r.onerror=function(){i({started:o,failed:Date.now()})},t&&(t.srcset&&(r.srcset=t.srcset),t.sizes&&(r.sizes=t.sizes)),r.src=e})}Object.defineProperty(t,"__esModule",{value:!0});var l=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=o,t.getFallbackSrc=r,t.preloadResponsiveImage=a,t.preloadImage=s}),define("modules/clean/react/previews/loading_indicator",["require","exports","external/classnames","external/react"],function(e,t,n,i){"use strict";function o(e){return i.createElement("div",{className:n("c-loader",e.className)})}Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingIndicator=o}),define("modules/clean/react/previews/pdf_viewer/placeholder_image",["require","exports","external/react","modules/clean/react/previews/image_helpers","modules/core/i18n"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderImage=function(e){var t=e.url,r=e.onError,a=e.onLoad;return n.createElement("div",{className:"placeholder-image-wrapper"},n.createElement("div",{className:"placeholder-image-wrapper__border"},n.createElement("img",{className:"placeholder-image disabled-context-menu",alt:o._("Loading"),sizes:i.IMG_SIZES_ATTR,src:i.getFallbackSrc(t),srcSet:i.getSrcSet(t),onError:r,onLoad:a})))}}),define("modules/clean/react/previews/preview_error",["require","exports","tslib","external/classnames","external/react","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/display_format","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/open_in_app/button","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/react/share_download/button","modules/clean/react_format","modules/clean/static_urls","modules/clean/web_timing_logger","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(y.set_tti_exclusion_flow("failed previews not included"),y.mark_time_to_view(),y.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===f.ErrorType.PendingUploadError&&this.props.shareToken){new l.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}},Object.defineProperty(t.prototype,"isSharedFile",{get:function(){return this.props.sharedLinkInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.renderActionable=function(){if(!this.props.areActionablesEnabled&&null!=this.props.areActionablesEnabled)return o.createElement("div",null);if(this.isSharedFile){var e=this.props.file;return this.allowOpenInApp?o.createElement(m.OpenInAppButton,{urls:e.open_in_app_data,userActionContext:u.UserActionContext.PreviewContentMain}):o.createElement(v.ShareDownloadButton,{copyable:e,importance:"primary",location:u.FileViewerPane.PreviewContent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,user:this.props.user})}var e=this.props.file;return o.createElement(p.OpenButton,{file:e,user:this.props.user,justifyRight:!1,location:u.FileViewerPane.PreviewContent,importance:"primary"})},t.prototype.renderFileInfo=function(){var e=d.getFilename(this.props.file);return this.props.errorType===f.ErrorType.PendingUploadError||this.props.file.is_dir||void 0===this.props.file.bytes?o.createElement("div",{className:"preview-error__info"},s.Emstring.em_snippet(e,this.props.maxFilenameEmLength)):o.createElement("div",{className:"preview-error__info"},s.Emstring.em_snippet(e,this.props.maxFilenameEmLength),o.createElement("span",{className:"bottom-dot"}," · "),a.format_bytes(this.props.file.bytes))},t.prototype.renderErrorInfo=function(e,t){return o.createElement("div",null,o.createElement("div",{className:"u-mar-bottom-s"},e),o.createElement("div",{className:"preview-error__message"},t))},t.prototype.getBadFiletypeErrorImage=function(){return o.createElement(h.Image,{src:g.static_url("/static/images/previews/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:g.static_url("/static/images/previews/error/filetype_not_supported_2x-vflE8HW8X.png")})},t.prototype.getTooBigErrorImage=function(){return o.createElement(h.Image,{src:g.static_url("/static/images/previews/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:g.static_url("/static/images/previews/error/file_too_large_2x-vfl-r0UPt.png")})},t.prototype.getPasswordProtectedErrorImage=function(){return o.createElement(h.Image,{src:g.static_url("/static/images/previews/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:g.static_url("/static/images/previews/error/password_protected_2x-vflnBXZ1k.png")})},t.prototype.getNoPreviewErrorImage=function(){return o.createElement(h.Image,{src:g.static_url("/static/images/previews/error/unavailable_1x-vflG2AHMd.png"),srcHiRes:g.static_url("/static/images/previews/error/unavailable_2x-vflGPrE5d.png")})},t.prototype.getPendingUploadErrorImage=function(){return o.createElement(h.Image,{src:g.static_url("/static/images/previews/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:g.static_url("/static/images/previews/error/file_uploading_2x-vflKOdrWj.png")})},t.prototype.renderError=function(){if(this.props.message)return this.renderErrorInfo(this.getNoPreviewErrorImage(),this.props.message);switch(this.props.errorType){case f.ErrorType.PendingUploadError:return this.renderErrorInfo(this.getPendingUploadErrorImage(),w._("File is uploading..."));case f.ErrorType.EmptyFileError:return this.renderErrorInfo(this.getNoPreviewErrorImage(),w._("Empty files can’t be previewed"));case f.ErrorType.ExtensionError:var e=d.getExtension(this.props.file);if(e){var t=d.isArchiveFile(this.props.file)&&this.props.file.preview_type?w._("<span>.%(extension)s</span> files can’t be previewed from an archive file.",{comment:"Like '.exe files can’t be previewed from an archive file'"}):w._("<span>.%(extension)s</span> files can’t be previewed.",{comment:"Like '.exe files can’t be previewed'"}),n=o.createElement("span",null,_.reactFormat(t,{span:o.createElement("span",{className:"preview-error__message--bold"}),extension:e}));return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n)}return this.renderErrorInfo(this.getBadFiletypeErrorImage(),u.NoExtensionErrorMessage);case f.ErrorType.FileSizeError:return this.renderErrorInfo(this.getTooBigErrorImage(),w._("This file is too big to preview"));case f.ErrorType.PasswordProtectedError:return this.renderErrorInfo(this.getPasswordProtectedErrorImage(),w._("This file is password-protected"));case f.ErrorType.NeedFlashError:return this.renderErrorInfo(this.getNoPreviewErrorImage(),_.reactFormat(w._("Install <a>Adobe Flash Player</a> to preview this video."),{a:o.createElement("a",{href:"https://get.adobe.com/flashplayer/"})}));case f.ErrorType.SymLinkError:case f.ErrorType.LoadError:default:return this.renderErrorInfo(this.getNoPreviewErrorImage(),w._("This file can’t be previewed"))}},t.prototype.renderHelpLink=function(){return this.props.errorType!==f.ErrorType.ExtensionError||d.isArchiveFile(this.props.file)?null:o.createElement("div",{className:"preview-error__help-link"},o.createElement("a",{href:u.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},w._("Learn more.")))},t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==f.ErrorType.LoadError&&this.props.errorType!==f.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(u.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=this.props,t=e.count,n=e.index,a=e.onNext,s=e.onPrevious,l=e.shouldDisplayToolbar;return o.createElement("div",{className:i({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":l})},o.createElement("div",{className:"preview-error__wrapper"},o.createElement("div",{className:"preview-error__content"},this.renderError(),this.renderFileInfo(),this.renderActionable(),this.renderHelpLink()),l&&null!=n&&null!=t?o.createElement("div",{className:"preview-toolbar-container"},o.createElement(r.PreviewImageAnnotationsToolbar,{index:n,count:t,onPrevious:s,onNext:a})):null))},t})(o.Component);t._PreviewError=b;var C=c(b,["/static/css/preview_error-vflXgm6jp.css"]);t.PreviewError=C}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","external/react","external/react-dom","modules/clean/previews/constants","modules/clean/react/previews/constants","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h){"use strict"
;Object.defineProperty(t,"__esModule",{value:!0});var f=["failed","viewer-ready"],v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(l.EventType.FilePreviewRenderFailed);var n=a.RivieraConvertResponseType.Unknown;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(s.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(l.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height")}},t.handleIframeLoad=function(){t.logFilePreviewEvent(l.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(l.EventType.FilePreviewRenderSucceeded))},t.handleIframeError=function(){t.logFilePreviewEvent(l.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=h.URI.parse(this.props.src);return this.props.previewType===r.PreviewType.Excel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:l.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.previewType===r.PreviewType.Excel&&m.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),p.mark_time_to_view(),p.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(l.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(l.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new c.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,f),this.frameMessenger.startListening());var e=o.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e={};m.iOS&&(e=s.iOSIframeScrollStyles());var t=this.props,o=t.fileExtension,a=t.isFullscreen,c=t.previewType,p=t.sharePermission,h=t.sizeClass,f=c===r.PreviewType.Excel;return i.createElement("div",{className:"preview-content",style:e},i.createElement("iframe",n.__assign({},this.getIframeProps())),i.createElement(u.PreviewToolbarContainer,{elevateToolbar:f,isFullscreen:a,previewToolbarProps:{shouldDisplayRegionCreationButton:!1,docType:f?l.DocType.spreadsheet:l.DocType.html,fileExtension:o,isFullscreen:a,isSidebarOpen:!1,isHidden:h===d.SizeClass.Small,sharePermission:p,sizeClass:h,pagesCount:1},forceDisableRegionAnnotation:!0,shouldUseImageToolbar:!1}))},t.defaultProps={usesFrameMessenger:!0},t})(i.Component);t.PreviewHTML=v}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","external/classnames","external/lodash","external/react","modules/clean/analytics","modules/clean/image_annotations","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/image_helpers","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/css","spectrum/dimensions"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(t){function g(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={width:"",height:"",zoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1,shouldShowLoadingIndicator:!1},e.showLoadingIndicator=o.debounce(function(){e.state.imageLoaded||e.setState({shouldShowLoadingIndicator:!0})},1e3),e.onImageLoad=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),_.mark_time_to_view(),_.mark_time_to_interactive(),e.logFilePreviewEvent(d.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(d.EventType.FilePreviewRenderSucceeded),e.setState({shouldLoadFullSizeImage:!!e.props.shouldDisplayToolbar,imageLoaded:!0}),e.hideLoadingIndicator(),e.props.shouldDisplayToolbar&&e.imageAnnotations.onImageLoad(),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad()},e.onFullImageLoad=function(){e.setState({zoomFit:!0,zoomPercent:0})},e.onImageClick=function(){e.shouldDisableZoom()||e.openFullscreen()},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==v.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen?p.enterFullScreen(!1):e.previewImageZoom().open(e.props["preview-url"],e.props["file-extension"],e.props.onContextMenu,e.props.fileName)},e.onImageError=function(){e.logFilePreviewEvent(d.EventType.FilePreviewDownloadFailed),null!=e.props.onError&&e.props.onError()},e.onZoom=function(t,n,i){if(void 0===i&&(i=void 0),t+"px"!==e.state.width){if(void 0===i&&(i=e.calculateZoomPercent(n)),i<=e.minimumZoomPercent)return void e.onZoomFit();if(i>16){if(e.previewImageFullSize){var o=16*e.previewImageFullSize.naturalWidth,r=16*e.previewImageFullSize.naturalHeight;e.onZoom(o,r,16)}}else{var a=e.getImageDOMNode().width,s=t/a,c=l.getPreviewImageWrapper(),u=c.scrollLeft(),d=c.scrollTop(),p=c.width(),m=c.height(),h=p*(s-1)/2+u*s,f=m*(s-1)/2+d*s,v=n>=m?"0":"auto",_=t>=p?"0":"auto",g=v+" "+_;e.setState({shouldDisplayFullSizeImage:!!e.previewImageFullSize,width:t+"px",height:n+"px",margin:g,zoomPercent:i,zoomFit:!1},function(){c.scrollLeft(h),c.scrollTop(f),e.imageAnnotations.onResize(!1)})}}},e.onZoomIn=function(){e.zoomWithMultiplier(1.25)},e.onZoomOut=function(){e.zoomWithMultiplier(.8)},e.onZoomOriginalOrFit=function(){e.state.zoomFit?e.onZoomOriginal():e.onZoomFit()},e.onZoomOriginal=function(){if(e.previewImageFullSize){var t=e.previewImageFullSize.naturalWidth,n=e.previewImageFullSize.naturalHeight;e.onZoom(t,n)}},e.onZoomFit=function(){""!==e.state.width&&e.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){e.imageAnnotations.onResize(!1)})},e.onPrint=function(){u.imagePrint(c.fullSizeUrl(e.props["preview-url"]))},e.setPreviewImageRef=function(t){e.previewImage=t},e.setPreviewImageFullSizeRef=function(t){e.previewImageFullSize=t},e}return n.__extends(g,t),g.prototype.componentWillUnmount=function(){null==this.props.isFullscreen&&this.previewImageZoom().close(),null!=this.imageAnnotations&&this.imageAnnotations.reset(),this.hideLoadingIndicator()},g.prototype.componentWillMount=function(){this.imageAnnotations=new s.ImageAnnotations},g.prototype.componentDidMount=function(){this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted),this.logOpen();var t=this.getImageDOMNode();if(null!=t&&t.complete){var n=this.props,i=n.nsId,o=n.sjId,r=i+"_"+o;null!=i&&null!=o&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[r]?this.onImageError():this.onImageLoad()}this.showLoadingIndicator(),new Promise(function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)})},g.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed,t),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted,t),this.logOpen(),this.props.shouldDisplayToolbar&&this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1,imageLoaded:!1}),this.showLoadingIndicator()}},Object.defineProperty(g.prototype,"minimumZoomPercent",{get:function(){if(!this.previewImageFullSize)return 0;var e=this.props,t=e.sizeClass,n=e.windowHeight,i=e.windowWidth,o=this.previewImageFullSize,r=o.naturalHeight,a=o.naturalWidth;if(!r||!a)return 0;var s=l.getImagePadding(t);return l.getMinimumZoomPercent({windowDimensions:{height:n,width:i},imagePadding:s,imageDimensions:{height:r,width:a}})},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"zoomPercent",{get:function(){return this.state.zoomFit?this.minimumZoomPercent:this.state.zoomPercent},enumerable:!0,configurable:!0}),g.prototype.hideLoadingIndicator=function(){this.showLoadingIndicator.cancel(),this.setState({shouldShowLoadingIndicator:!1})},g.prototype.previewImageZoom=function(){return e("modules/clean/react/previews/preview_image_zoom").PreviewImageZoom},g.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},g.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},g.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===v.SizeClass.Small},g.prototype.getImageDOMNode=function(){return this.state.shouldDisplayFullSizeImage?this.previewImageFullSize:this.previewImage},g.prototype.zoomWithMultiplier=function(e){if(1!==e&&this.previewImageFullSize){var t=this.previewImageFullSize.width,n=this.previewImageFullSize.height,i=this.calculateZoomPercent(n),o=.05*Math.round(i*e/.05);if(Math.abs(o-i)<.05&&(e>1?o+=.05:o-=.05),!(o<0)){var r=o/i,a=Math.round(t*r),s=Math.round(n*r);this.onZoom(a,s,o)}}},g.prototype.calculateZoomPercent=function(e){if(!this.previewImageFullSize)return 0;var t=this.previewImageFullSize.naturalHeight;return e&&t?e/t:0},g.prototype.renderFullSizeImage=function(e){if(this.state.shouldLoadFullSizeImage){var t={"absolute-center":!0};t[""+l.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,t=i(t);var o=n.__assign({},e);return this.state.shouldDisplayFullSizeImage||(o=n.__assign({},o,{visibility:"hidden"})),r.createElement("img",{alt:this.props.fileName,ref:this.setPreviewImageFullSizeRef,src:c.fullSizeUrl(this.props["preview-url"]),className:t,style:o,onClick:this.onImageClick,onDoubleClick:this.onImageDoubleClick,onLoad:this.onFullImageLoad})}},g.prototype.renderSmallImage=function(e){if(!this.state.shouldDisplayFullSizeImage){var t=this.props["preview-url"];return r.createElement("img",{ref:this.setPreviewImageRef,sizes:m.IMG_SIZES_ATTR,src:m.getFallbackSrc(t),srcSet:m.getSrcSet(t),className:i(l.PREVIEW_IMAGE,"absolute-center","preview-image-small",{"disabled-context-menu":!!this.props.onContextMenu}),style:e,onLoad:this.onImageLoad,onError:this.onImageError,onClick:this.onImageClick,onContextMenu:this.props.onContextMenu,onDoubleClick:this.onImageDoubleClick,alt:this.props.fileName})}},g.prototype.render=function(){var e=this.props,t=e.count,n=e.index,o=e.onNext,a=e.onPrevious,s=e.shouldDisplayToolbar,c=e.shouldDisableAnnotations,u=e.isFullscreen,d=this.state,p=d.height,m=d.imageLoaded,v=d.margin,_=d.shouldShowLoadingIndicator,g=d.width,y={};return g&&p&&s&&(y={height:p,margin:v,maxHeight:p,maxWidth:g,width:g}),m||(y={display:"none"}),r.createElement("div",{className:i((w={"flex-preview-container":!0,"image-visible":!0,"annotations-visible":!0,"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":s,"zoom-fit":this.state.zoomFit},w[l.PREVIEW_IMAGE_CONTAINER]=!0,w))},r.createElement("div",{className:l.PREVIEW_IMAGE_WRAPPER+" preview-content"},m||!_?null:r.createElement(h.LoadingIndicator,{className:"loading-indicator"}),this.renderFullSizeImage(y),this.renderSmallImage(y)),s?r.createElement(f.PreviewToolbarContainer,{forceDisableRegionAnnotation:c,isFullscreen:u,previewToolbarProps:{index:n,count:t,zoomPercent:this.zoomPercent,minimumZoomPercent:this.minimumZoomPercent,maximumZoomPercent:16,onPrevious:a,onNext:o,onFullscreen:this.openFullscreen,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,onZoomOriginalOrFit:this.onZoomOriginalOrFit,onPrint:this.onPrint},shouldUseImageToolbar:!0}):null);var w},g})(r.Component);t._PreviewImage=w;var b=function(e){return r.createElement(y.Dimensions,{className:"flex-preview-container"},function(t){var i=t.width,o=t.height;return r.createElement(w,n.__assign({},e,{windowHeight:o,windowWidth:i}))})},C=g(b,["/static/css/preview_image-vfl31cRgx.css"]);t.PreviewImage=C}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadAttempted);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},r.SilentBackgroundRequest(n)):r.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logFilePreviewEvent(c.EventType.FilePreviewDownloadSucceeded),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(c.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()},t.handleLinkDataError=function(){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadFailed),t.markWebTiming(),t.state.isMounted&&t.setState({description:m._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){var n=u.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventType.FilePreviewSupportConfirmed),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",l="";null!=this.props.filename&&(r=s.filename_without_extension(this.props.filename),l=s.file_extension(this.props.filename),""!==l&&(l="."+l));var c=t.MAX_DISPLAYED_FILENAME_CHARS-l.length,u=a.Emstring.em_snippet(r,c),d="-";null!=this.state.description&&(d=this.state.description);var h={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},f=p.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return o.createElement("div",{className:"flex-preview-container"},o.createElement("div",{className:"preview-content preview-content--center"},o.createElement("div",{className:"preview-linkfile-box"},o.createElement("div",{className:i(e)},o.createElement("div",{className:"preview-linkfile-icon"},o.createElement("img",{src:f,alt:""})),o.createElement("div",{className:"preview-linkfile-title"},o.createElement("span",{className:"preview-linkfile-filebase"},u),o.createElement("span",{className:"preview-linkfile-fileext"},l)),o.createElement("div",{className:"preview-linkfile-info"},o.createElement("div",{className:i(h)},d),o.createElement("button",{className:i(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},m._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(o.Component);t._PreviewLinkfile=h;var f=l.requireCssWithComponent(h,["/static/css/preview_linkfile-vflLAlKbW.css"]);t.PreviewLinkfile=f}),define("modules/clean/react/previews/preview_pdf_loadable",["require","exports","external/react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/pdf_viewer/placeholder_image"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_pdf"],t,n)}).then(function(e){return e.PreviewPDF})},loading:function(e){var t=e.previewThumbnailUrl;return t?n.createElement("div",{className:"preview-pdf-ssr"},n.createElement("div",{className:"preview-ssr-viewer"},n.createElement(r.PlaceholderImage,{url:t}))):null}}),s=o.requireCssWithComponent(a,["/static/css/preview_pdf-vflsI7vrl.css","/static/css/snackbar-vflLtw9Um.css"]);t.PreviewPDFLoadable=s}),define("modules/clean/react/previews/preview_toolbar_container",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarContainer=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/preview_toolbar_container_component"],t,n)}).then(function(e){return e.PreviewToolbarContainer})}})}),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","external/react","external/lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h="",f="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){var n="."+t.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close";s(e.target).is(n)||0!==s(e.target).parents(n).length||(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),i("esc",f,function(){e.onCloseFactory({},c.UserActionContext.Keyboard)}),null!=this.props.zoomOutCallback&&i("space",f,this.props.zoomOutCallback),this.props.isFlippable&&(i("left",f,function(){e.startControlsTimer(),e.flipPrevious(c.UserActionContext.Keyboard)}),i("right",f,function(){e.startControlsTimer(),e.flipNext(c.UserActionContext.Keyboard)})),h=i.getScope(),i.setScope(f),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){i.setScope(f)},t.prototype.componentWillUnmount=function(){i.clearScope(f),i.setScope(h),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.isFlippable&&this.props.fileCount?r.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props.renderZoomControls,t=o({"preview-toolbar-container":!0,hidden:this.state.controlsHidden});return r.createElement("div",{className:t,ref:"previewZoomerToolbarContainer"},r.createElement("div",{className:"preview-toolbar-overlay-container"},r.createElement("div",{className:"preview-toolbar-overlay"},r.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?r.createElement("div",{className:o({"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled}),ref:"zoomControlZoomOut"},r.createElement(d.Sprite,{alt:m._("Zoom out"),group:"web",name:"zoomout"})):null,e?r.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer"},r.createElement(p.TitleBubble,{content:m._("View actual size"),position:p.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.createElement("span",{className:"zoom-label",ref:"zoomLabel"}))):null,e?r.createElement("div",{className:o({"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled}),ref:"zoomControlZoomIn"},r.createElement(d.Sprite,{alt:m._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=o({"preview-zoomer-close":!0,hidden:this.state.controlsHidden});return r.createElement("span",null,r.createElement("button",{"aria-label":m._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},r.createElement(d.Sprite,{alt:m._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=o({"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled});return r.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(r.Component);t.PreviewZoomContainer=v}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return o[e]}Object.defineProperty(t,"__esModule",{value:!0});var i;(function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"})(i=t.QualityPopupStage||(t.QualityPopupStage={}));var o=[];o[i.POPUP]="popup",o[i.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}}),define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewQualityPopup=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/quality_popup/preview_quality_popup_component"],t,n)}).then(function(e){return e.PreviewQualityPopup})}})}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,i){"use strict";function o(e,t){var n=h[e];return"ALL_EXTENSIONS"===n||n.indexOf(t)>-1}function r(e){var t=i.PREVIEW_QUALITY_POPUP_QUESTION;if(!m.hasOwnProperty(t))return null;var n=m[t];return o(n,e)?n:null}function a(e){return!!f[e]}function s(e,t){return v[e][t]||v[e].ALL_EXTENSIONS}function l(e){return E[e]}Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.FEEDBACK=2]="FEEDBACK",e[e.DONATE=3]="DONATE"})(c=t.Questions||(t.Questions={}));var u=["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpg","mpeg","mts","oggtheora","ogv","rm","ts","vob","webm","wmv"],d=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"],p=["flac","oga","m4a","mp3","wma","aac","wav"],m={};m.LOOK_GOOD=c.LOOK_GOOD,m.LOAD_QUICKLY=c.LOAD_QUICKLY;var h={};h[c.LOOK_GOOD]="ALL_EXTENSIONS",h[c.LOAD_QUICKLY]="ALL_EXTENSIONS";var f=[];f[c.LOOK_GOOD]=!0;var v=[];v[c.LOOK_GOOD]={};for(var _=0,g=p;_<g.length;_++){var y=g[_];v[c.LOOK_GOOD][y]=n._("Does this audio preview sound okay?")}for(var w=0,b=u;w<b.length;w++){var y=b[w];v[c.LOOK_GOOD][y]=n._("Does this video preview look okay?")}for(var C=0,S=d;C<S.length;C++){var y=S[C];v[c.LOOK_GOOD][y]=n._("Does this image preview look okay?")}v[c.LOOK_GOOD].ALL_EXTENSIONS=n._("Does this file preview look okay?"),v[c.LOAD_QUICKLY]={},v[c.LOAD_QUICKLY].ALL_EXTENSIONS=n._("Did this preview load quickly?");var E=[];E[c.LOOK_GOOD]="look_good",E[c.LOAD_QUICKLY]="load_quickly",E[c.FEEDBACK]="feedback",E[c.DONATE]="donate",t.isQuestionAllowed=o,t.getQuestionToAsk=r,t.shouldShowFeedbackModal=a,t.getQuestionWording=s,t.getQuestionLoggerKey=l}),define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","external/react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],function(e,t,n,i,o,r,a){"use strict";function s(e){return e.sourceContext!==a.PreviewSourceContext.EmbeddedSharedLinkFile?i.createElement(r.PreviewVideoComments2,n.__assign({},e)):i.createElement(o.PreviewVideoBasic,n.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoProps=o.PreviewVideoProps,t.PreviewVideo=s}),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","external/classnames","external/lodash","external/react","jquery","modules/clean/image_size","modules/clean/keycode","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/video/types","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,i,o,r,a,s,l,c,u,d,p,m,h,f,v,_,g,y,w,b,C,S,E,A,T){"use strict";function P(){return"v2"===A.cssVersion()?"/static/css/video-js-5-custom-v2-vflA78eh9.css":"/static/css/video-js-5-custom-v1-vflzWLOoT.css"}function k(e){return E.URI.parse(e).updateQuery({size:s.imageBestFitSize(a(window).width(),a(window).height()),size_mode:"2"}).toString()}Object.defineProperty(t,"__esModule",{value:!0});var x=p.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/previews/video/video_player"],t,n)}).then(function(e){return e.VideoPlayer})}}),R=(function(e){function t(t){var n=e.call(this,t)||this;return n.lastPlaybackRate=1,n.checkRenderSucceeded=function(e){"hls"===n.props.videoContainer&&!e&&o.every(n.successFlags)&&n.markRenderSucceeded()},n.onEmbed=function(){n.logFilePreviewTimelineEvent(h.EventType.FilePreviewSupportConfirmed),n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadAttempted)},n.onLoadedMetadata=function(e){void 0===e&&(e=0),n.videoLogger.populateVideoDuration(e)},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(e){void 0===e&&(e=!1),n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadSucceeded),n.successFlags.playerReady=!0,n.checkRenderSucceeded(e),n.props.filePreviewSession&&n.props.filePreviewSession.markPrimaryEvent(),C.mark_time_to_view(),C.mark_time_to_interactive(),n.videoLogger.logEvent(b.VideoPreviewEvent.PlayerRendered)},n.onPlay=o.once(function(){n.markRenderSucceeded(),n.videoLogger.logEvent(b.VideoPreviewEvent.FirstClickPlay)}),n.onStartsPlaying=o.once(function(e){n.videoLogger.logEvent(b.VideoPreviewEvent.VideoStartsPlaying,{play_latency:e.toString()})}),n.onUserInactive=function(e){e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction(h.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},n.onDarkReleasePrefetchCompleted=function(e){n.logUserAction(h.UserAction.DarkReleasePrefetchCompleted,{prefetch_duration:e})},n.onScrubberThumbnailsLoaded=function(e){e?n.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsLoaded):n.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsFailed)},n.onError=function(e){if("needflash"===e)return n.logFilePreviewTimelineEvent(h.EventType.FilePreviewSupportDenied),void("function"==typeof n.props.onError&&n.props.onError(y.ErrorType.NeedFlashError));n.logFilePreviewTimelineEvent(h.EventType.FilePreviewDownloadFailed),C.mark_time_to_view(),C.mark_time_to_interactive(),n.props.onError&&n.props.onError(y.ErrorType.LoadError)},n.onPlaybackRateChange=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},n.onSeek=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:t.toString()})},n.onStalled=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},n.onTruncated=function(){f.filePreviewEventEmitter.emit(h.EventType.FilePreviewVideoTruncated),n.videoLogger.setVideoTruncated()},n.onThumbLoad=function(e){void 0===e&&(e=!1),n.successFlags.thumbLoaded=!0,n.checkRenderSucceeded(e)},n.onClose=function(e){n.videoLogger.logEvent(b.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},n.onSelectQuality=function(e,t){n.videoLogger.logEvent(b.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},n.handleKeyPress=function(e){return e.keyCode===l.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.keyboardBindings=[{keyboardEventCriteria:_.generateUnmodifiedKeyboardEventCriteria(l.KeyCode.SPACE),callback:n.handleKeyPress}],n.successFlags={thumbLoaded:!1,playerReady:!1},n}return n.__extends(t,e),t.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new c.FilePreviewUserActionLogger,this.userActionLogger.listenTo(f.filePreviewEventEmitter),this.videoLogger=new u.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},t.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(f.filePreviewEventEmitter),delete this.userActionLogger)},t.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},
t.prototype.logUserAction=function(e,t){f.filePreviewEventEmitter.emit(h.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,h.UserActionContext.VideoPlayer,t)},t.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(h.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},t.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},t.prototype.componentDidMount=function(){this.setUpLoggers()},t.prototype.componentWillUnmount=function(){this.teardownLoggers()},t.prototype.shouldComponentUpdate=function(e){return v.compareStateAndProps(e,{})},t.prototype.componentDidUpdate=function(e){this.props.isFullscreen&&!e.isFullscreen&&this.videoLogger.logEvent(b.VideoPreviewEvent.EnterFullscreen)},t.prototype.togglePlayback=function(){f.filePreviewEventEmitter.emit(h.EventType.FilePreviewVideoToggled)},t.prototype.render=function(){var e=this.props,t=e.title,o=e.isFullscreen,a=e.previewUrl,s=e.sourceContext,l=e.thumbnailUrlTmpl,c=e.videoMetadataUrl,u=e.videoContainer,p=e.vttThumbnailsUrl,m=A.video_type(u),h=s!==y.PreviewSourceContext.EmbeddedSharedLinkFile,f=!1,v=!1,_=0;S.is_mobile_or_tablet()&&(f=!0,v=!0,_=1);var b={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:v,playsinline:_};null!=l&&(b.poster=d.tagCriticalPathContentRequest(k(l),this.props.filePreviewSession));var C={src:a,sourceContentType:m,metadataLink:c,title:t,vttThumbnailsUrl:p},E={onLoadedMetadata:this.onLoadedMetadata,onCanPlay:this.onCanPlay,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onStartsPlaying:this.onStartsPlaying,onThumbLoad:this.onThumbLoad,onUserInactive:this.onUserInactive,onDarkReleasePrefetchCompleted:this.onDarkReleasePrefetchCompleted,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},P={videoProps:C,playerCallbacks:E,playerOptions:b,seekPosition:this.props.seekPosition,useFlash:m===A.FLV_CONTAINER,onboardingTemplates:this.props.onboardingTemplates,shouldEnableControls:!this.props.hideControls,noDownload:f,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:h,isAudio:this.props.isAudio,audioUrl:this.props.audioUrl,bytes:this.props.bytes};return o?r.createElement(w.PreviewZoomContainer,{isFlippable:!0,renderZoomControls:!1,onClose:T.exitFullScreen,containerClass:"video-player"},this.props.disableKeyboardShortcuts?null:r.createElement(g.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement(x,n.__assign({},P))):r.createElement("div",{className:i({"flex-preview-container":!0,"touch-device":S.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:r.createElement(g.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),r.createElement("div",{className:"preview-content preview-video"},r.createElement("div",{className:"preview-video__wrapper"},r.createElement("div",{className:"preview-video__aspect-container"},r.createElement("div",{className:"preview-video__container"},r.createElement(x,n.__assign({},P)))))))},t})(r.Component);t._PreviewVideoBasic=R;var I=m(R,["/static/css/preview_video-vflDJJfmC.css",P()]);t.PreviewVideoBasic=I}),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","external/react","external/react-redux","modules/core/i18n","modules/clean/react/comments2/util","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/selectors","modules/clean/react/previews/video/preview_video_basic"],function(e,t,n,i,o,r,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.showOnboarding?{titleText:r._("Want to comment on %(time_code)s?",{comment:"Title of a small dialog, asking if the user wants to leave a comment at `time_code`. time_code will be a representation of a time in a video playback, e.g., 1:48"}),bodyText:r._("Leave feedback on this moment with a time-coded comment.")}:void 0;return i.createElement(u.PreviewVideoBasic,n.__assign({},this.props,{shouldEmitTimeUpdatedEvents:!0,onboardingTemplates:e}))},t})(i.PureComponent);t.ConnectedPreviewVideoComments2=o.connect(function(e){return{showOnboarding:c.getShowOnboardingOnVideo(e)&&!a.isComments2Mobile()}},{onTimeUpdate:l.updatePlayerCurrentTime})(d);var p=(function(e){function r(t){var n=e.call(this,t)||this;return n.store=s.getStoreForComments2(),n}return n.__extends(r,e),r.prototype.render=function(){return i.createElement(o.Provider,{store:this.store},i.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},r})(i.PureComponent);t.PreviewVideoComments2=p}),define("modules/clean/react/previews/video/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.PlayerRendered="player_rendered",e.FirstClickPlay="first_click_play",e.ChangePlaybackRate="change_playback_rate",e.ChangeVideoQuality="change_video_quality",e.EnterFullscreen="enter_fullscreen",e.ClosePreview="close_preview",e.SeekVideo="seek_video",e.VideoStartsPlaying="video_starts_playing",e.VideoStalled="video_stalled",e.VideoSegmentFailure="video_segment_failure",e.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",e.ScrubberThumbnailsFailed="scrubber_thumbnails_failed"})(t.VideoPreviewEvent||(t.VideoPreviewEvent={}))}),define("modules/clean/react/previews/video/utils",["require","exports","modules/constants/file_viewer","modules/core/browser"],function(e,t,n,i){"use strict";function o(e){return n.VIDEO_PREVIEWS.indexOf(e)!==-1}function r(){return o("REFACTOR")?"v2":"v1"}function a(){return"v2"===r()&&o("SETTINGS")}function s(e){return n.VIDEO_OVERRIDE_NATIVE_HLS||e===c&&i.is_android()}function l(e){return"flv"===e?t.FLV_CONTAINER:"webm"===e?"video/webm":c}Object.defineProperty(t,"__esModule",{value:!0}),t.checkVariant=o,t.cssVersion=r,t.shouldShowNewSettingsMenu=a,t.shouldAllowThumbnailsOnScrubbing=function(){return o("THUMBNAILS")},t.shouldOverrideNativeHls=s;var c="application/vnd.apple.mpegurl";t.FLV_CONTAINER="video/flv";t.video_type=l}),define("modules/clean/react/share_download/button",["require","exports","modules/clean/react/async/loadable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadSimpleButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(function(e){return e.DownloadSimpleButton})}}),t.ShareDownloadButton=n.Loadable({loader:function(){return new Promise(function(t,n){e(["modules/clean/react/share_download/button_component"],t,n)}).then(function(e){return e.ShareDownloadButton})}})}),define("modules/clean/shallow_equal",["require","exports"],function(e,t){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function i(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var a=0;a<i.length;a++)if(!o.call(t,i[a])||!n(e[i[a]],t[i[a]]))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.prototype.hasOwnProperty;t.shallowEqual=i}),define("modules/core/type",["require","exports","external/lodash"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t){if(!n.isString(e)&&!n.isFunction(e))throw new TypeError("First parameter needs to be a string identifying the type");if(!n.isFunction(t))throw new TypeError("Second parameter needs to be a predicate defining the type");n.isFunction(e)?this.getTypeString=e:this.getTypeString=function(){return e},this.predicate=t}return e})();t.Type=i;var o=function(e){if(t.isBasicType(e))return!0;if(e instanceof i)return!0;if(n.isFunction(e))return!0;if(n.isArray(e)){if(1!==e.length)return!1;if(!o(e[0]))return!1}else{if(!(n.isObject(e)&&null==e.prototype&&e.constructor===Object&&Object.keys(e).length>0))return!1;for(var r in e){if(!o(e[r]))return!1}}return!0},r=(function(){var e=new i("undefined",n.isUndefined),t=new i("null",n.isNull),r=new i("Boolean",n.isBoolean),a=new i("Number",n.isNumber),s=new i("String",n.isString),l=new i("Object",function(e){return n.isObject(e)&&!n.isFunction(e)&&!n.isArray(e)}),c=new i("Type",o);return function(n){return void 0===n?e:null===n?t:n===Boolean?r:n===Number?a:n===String?s:n===Object?l:n===i?c:void 0}})();t.isBasicType=function(e){return null!=r(e)},t.firstFailingKeypath=function(e,o,a){if(null==a&&(a=[]),t.isBasicType(e)){if(!r(e).predicate(o))return a}else if(e instanceof i){if(!e.predicate(o))return a}else if(n.isFunction(e)){if(!(o instanceof e))return a}else if(n.isArray(e)){if(t.firstFailingKeypath(Array,o,a))return a;for(var s=0;s<o.length;s++){var l=o[s];if(a.push(s),t.firstFailingKeypath(e[0],l,a))return a;a.pop()}}else{if(t.firstFailingKeypath(Object,o,a))return a;for(var c=Object.keys(e),u=Object.keys(o),d=0,p=Array.from(n.difference(c,u));d<p.length;d++){var m=p[d];if(t.firstFailingKeypath(e[m],void 0,a))return a}for(var h=0,f=Array.from(n.intersection(u,c));h<f.length;h++){var m=f[h];if(a.push(m),t.firstFailingKeypath(e[m],o[m],a))return a;a.pop()}}},t.checkType=function(e,n){return null==t.firstFailingKeypath(e,n)},t.getTypeString=function(e){if(t.isBasicType(e))return r(e).getTypeString();if(e instanceof i)return e.getTypeString();if(n.isFunction(e))return e.name;if(n.isArray(e))return"["+t.getTypeString(e[0])+"]";var o=[];for(var a in e){var s=e[a];o.push(a+": "+t.getTypeString(s))}return"{"+o.join(", ")+"}"}}),define("modules/core/types",["require","exports","tslib","external/lodash","modules/core/type"],function(e,t,n,i,o){"use strict";function r(e,t){var n=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r=t.apply(this,n),a=o.firstFailingKeypath(e,r);if(null!=a){var s=c(0,a,e,r);throw new TypeError(s)}return r};return t.isTypeChecked&&(n.isTypeChecked=!0),n}var a=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),s=(function(e){function t(t){return e.call(this,o.getTypeString.bind(null,t),o.checkType.bind(null,t))||this}return n.__extends(t,e),t})(o.Type),l=function(e,t){if(o.isBasicType(e));else if(e instanceof o.Type)null!=e.parameter_types&&i.isFunction(t)&&!t.isTypeChecked&&(t=u.apply(void 0,Array.from(e.parameter_types).concat([t])));else if(i.isFunction(e));else if(i.isArray(e))for(var n=0;n<t.length;n++){var r=t[n],a=l(e[0],r);a!==r&&(t=t.slice(),t[n]=a)}else for(var s in e){var c=e[s],d=l(c,t[s]);d!==t[s]&&(t=i.clone(t),t[s]=d)}return t},c=function(e,t,n,r){for(var a,s=0,l=Array.from(t);s<l.length;s++){var c=l[s];r=r[c],n=i.isArray(n)?n[0]:n[c]}return t.length>0&&(a=", key "+t.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(r,null,"  ")+" doesn't match type "+o.getTypeString(n)},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1),r=e.slice(0,n-1),a=e[n-1],u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r,u=i.find(r,function(e){return e instanceof s});if(null!=u){var d=n.indexOf(u),p=Math.max(e.length-n.length+1,0),m=[d,1];i.times(p,function(){return m.push(u)}),n=n.slice(),n.splice.apply(n,Array.from(m||[]))}for(var h=0;h<n.length;h++){var f=n[h],v=o.firstFailingKeypath(f,e[h]);if(null!=v){var _=c(h,v,f,e[h]);throw new TypeError(_)}e[h]=l(f,e[h])}return a.apply(this,e)};return u.isTypeChecked=!0,u},d=function(e){if(e instanceof o.Type&&e.isOptional||e instanceof s)return e;var t=function(){return"?"+o.getTypeString(e)},n=function(t){return null==t||o.checkType(e,t)},i=new o.Type(t,n);return e instanceof o.Type&&null!=e.parameter_types&&(i.parameter_types=e.parameter_types),i.isOptional=!0,i},p=function(e){return new s(e)},m={takes:r(Function,u(p(o.Type),Function,u)),returns:r(Function,u(o.Type,Function,r)),Maybe:r(o.Type,u(o.Type,d)),Any:new o.Type("Any",function(e){return!0})};return a||(m.takes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]},m.returns=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Math.max(e.length,1);return e.slice(0,n-1),e[n-1]}),m});
//# sourceMappingURL=pkg-file_viewer.min.js-vfl5HEuvJ.map