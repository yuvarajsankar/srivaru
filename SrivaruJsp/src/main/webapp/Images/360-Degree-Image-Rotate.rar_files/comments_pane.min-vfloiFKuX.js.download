define(["require","exports","tslib","external/lodash","external/react","external/react-redux","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/util","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/mentions_api","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","modules/clean/react/comments2/events","modules/clean/video_annotations_prototype/video_annotation_prototype_helper","spectrum_comments/comment/video_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/video_comment_editor","modules/clean/video_annotations_prototype/constants","modules/clean/video_annotations_prototype/video_preview_event_emitter","modules/clean/react/comments2/logger","modules/core/i18n","modules/clean/uuid"],function(e,t,o,n,r,i,a,s,d,m,c,p,l,u,v,h,T,_,g,C,E,w,f,y,O,M,b,A,P){"use strict";function S(e){var t=e.playerCurrentTime,n=e.previewType,i=e.showOnboarding,a=e.onCoachmarkClose;return n===g.PreviewType.Video&&void 0!==t?r.createElement(y.VideoCommentEditor,o.__assign({},e,{currentTime:t,showCoachmark:i,createCoachmark:function(){return r.createElement(v.CoachMark,{title:A._("Target your feedback"),arrowPosition:"top-right",showClose:!0,onCloseButtonClick:a},A._("Adding time codes to comments keeps feedback simple, organized, and all in one place."))}})):r.createElement(f.CommentEditor,o.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0});var k=(function(e){function t(t){var n=e.call(this,t)||this;return n.updateMentionsMatches=function(e){n.setState({mentionsMatches:e})},n.onMentionsQueryUpdated=function(e){n.mentionsApi.query(e,n.updateMentionsMatches)},n.videoPreviewOnboardingDismissed=function(){n.props.dispatch(l.suppressOnboardingForSession("video_first_paused"))},n.videoPreviewToggled=function(e,t,o){n.props.dispatch(l.recordPausePlay(o))},n.toggleShowResolved=function(){var e=n.props,t=e.dispatch,o=e.showResolved,r=e.viewer,i=e.stream,a=o?"hide_resolved_threads":"show_resolved_threads";t(l.toggleShowResolved()),r&&b.commentLogger.logEvent(r.id,a,i)},n.createEditor=function(e){return r.createElement(S,o.__assign({},e,{playerCurrentTime:n.props.playerCurrentTime,previewType:n.props.stream.previewType,showOnboarding:n.props.showOnboarding,onCoachmarkClose:n.onCoachmarkClose}))},n.onCoachmarkClose=function(){n.props.dispatch(l.suppressOnboardingForSession("initial_video_land"))},n.mentionsApi=u.mentionsApi(t.viewer),n.state={mentionsMatches:n.mentionsApi.cache},n}return o.__extends(t,e),t.prototype.updateCommentsMoreOptionGroup=function(){var e=this.props.showResolved?T.FileActionButtonType.HIDE_RESOLVED_COMMENTS:T.FileActionButtonType.SHOW_RESOLVED_COMMENTS,t=new _.MoreOptionGroup({fileActionButtonGroup:T.FileActionButtonGroup.COMMENTS,options:[new _.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return r.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})]});void 0===this.moreOptionGroup?h.moreOptionRegistry.addOption(t):h.moreOptionRegistry.replaceOption(this.moreOptionGroup,t),this.moreOptionGroup=t},t.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),C.Comments2Event.emit("reveal-comments2-in-pane"),M.videoPreviewEventEmitter.addListener(O.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),M.videoPreviewEventEmitter.addListener(O.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled);var e=this.props,t=e.stream,o=e.viewer;o&&b.commentLogger.logEvent(o.id,"show_comments",t)},t.prototype.componentDidUpdate=function(){this.updateCommentsMoreOptionGroup()},t.prototype.componentWillUnmount=function(){this.props.viewer&&b.commentLogger.stopLoggingForUser(this.props.viewer.id),M.videoPreviewEventEmitter.removeListener(O.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),M.videoPreviewEventEmitter.removeListener(O.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled)},Object.defineProperty(t.prototype,"actionsAdapter",{get:function(){var e,t=this.props,r=t.dispatch,i=t.onboardingKeysNotYetMarked,a=t.stream,s=t.viewer,d={onClickTimeCode:function(e){var t=E.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e);M.videoPreviewEventEmitter.emit(O.EventTypes.SEEK_POSITION_AND_PAUSE,t)},onEditorFocused:function(e){M.videoPreviewEventEmitter.emit(O.EventTypes.PAUSE)},onThreadActivated:function(e){if(r(l.activateThread(e)),!e.read&&s&&r(l.markThreadRead(s,a,e.id,p.MarkThreadReadOrigin.ThreadActivated)),e.annotation){var t=E.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time);M.videoPreviewEventEmitter.emit(O.EventTypes.SEEK_POSITION_AND_PAUSE,t)}},onAllThreadsDeactivated:function(){r(l.deactivateAllThreads())}};return e=s?{onThreadCreated:function(e,t){var o=m.iCommentContentToUserSubmittedComment({annotation:t,content:e,stream:a}),n=P.v4();r(l.addComment({user:s,author:m.dbxUserToIUser(s),stream:a,comment:o,content:e,guid:n,annotation:t})).then(function(){if(t&&i.length)for(var e=0,o=i;e<o.length;e++){var n=o[e];r(l.markOnboarded(s,n))}})},onThreadRepliedTo:function(e,t){var o=m.iCommentContentToUserSubmittedComment({content:t,stream:a}),n=P.v4();r(l.addComment({user:s,author:m.dbxUserToIUser(s),stream:a,comment:o,content:t,threadId:e,guid:n}))},onThreadMarkedAsRead:function(e){r(l.markThreadRead(s,a,e,p.MarkThreadReadOrigin.UIButtonClicked))},onThreadMarkedAsUnread:function(e){r(l.markThreadUnread(s,a,e))},onThreadResolved:function(e){r(l.markThreadResolved(s,a,e))},onThreadUnresolved:function(e){r(l.markThreadUnresolved(s,a,e))},onCommentEdited:function(e,t){r(l.editComment(s,a,e,t))},onCommentDeleted:function(e){r(l.deleteComment(s,a,e))},onMentionsQueryUpdated:this.onMentionsQueryUpdated}:{onThreadCreated:n.noop,onThreadRepliedTo:n.noop,onThreadMarkedAsRead:n.noop,onThreadMarkedAsUnread:n.noop,onThreadResolved:n.noop,onThreadUnresolved:n.noop,onCommentEdited:n.noop,onCommentDeleted:n.noop,onMentionsQueryUpdated:n.noop},o.__assign({},d,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentComponent",{get:function(){return this.props.stream.previewType===g.PreviewType.Video?w.VideoComment:void 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=this.props,o=t.showResolved,n=t.isMobile,i=t.stream,a=t.viewer,d=t.activeThreadId,c=this.props.threads.filter(function(e){return o||!e.resolved});return a&&(e=m.dbxUserToIUser(a)),r.createElement("div",{className:"comments-pane-wrapper"},r.createElement(s.CommentStream,{id:i.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,isMobile:!!n,mentionsMatches:this.state.mentionsMatches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:c,user:e,activeThreadID:d}))},t})(r.Component);t.CommentsPaneComponent=k;var R=i.connect(function(e){var t=c.getContext(e),o=t.stream,n=t.viewer;return{activeThreadId:c.getActivatedThreadId(e),playerCurrentTime:c.getPlayerCurrentTime(e),onboardingKeysNotYetMarked:c.getOnboardingKeysNotYetMarked(e),showOnboarding:c.getShowOnboardingOnCommentsPane(e)&&!d.isComments2Mobile(),showResolved:c.getShowResolved(e),stream:o,threads:c.getThreads(e),viewer:n}})(k);t.CommentsPane=a(R,["/static/js/spectrum_comments/index.web-vflyWlPpm.css","/static/css/comments2-sidebar-vflu2ROdS.css"])});
//# sourceMappingURL=comments_pane.min.js-vfldqQ4Tv.map