define(["require","exports","external/react-dom-factories","modules/clean/referrer_cleansing_redirect"],function(r,e,t,n){"use strict";function i(r,e){return void 0!==r&&null!==r?e(r):void 0}Object.defineProperty(e,"__esModule",{value:!0});var o=function(r,e,i){void 0===e&&(e=!0),void 0===i&&(i=null);var o=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,a="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",s=new RegExp("http://"+a+"|https://"+a+"|www."+a+"|"+a,"i"),l=[o,/\n/];e&&l.push(s);for(var p=RegExp("("+Array.from(l).map(function(r){return r.source}).join("|")+")","gi"),h=[],c=0,f=Array.from(r.split(p));c<f.length;c++){var d=f[c];if(d)if(d.match(o)){var v=d.match(/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i),m=v[2].trim();h.push(t.span({className:"comment-mention"},m))}else if(Array.from(l).includes(s)&&d.match(s)){var g=d;g.indexOf("http://")<0&&g.indexOf("https://")<0&&(g="http://"+g);try{g=n.get_redirect_uri(g),h.push(t.a({href:g,target:"_blank",rel:"noopener noreferrer"},d))}catch(r){h.push(d)}}else d.match(/\n/)?h.push(t.br({})):h.push(d)}return u(h,i)};e.convertRawCommentTextToReactDom=o;var u=function(r,e){if(void 0===e&&(e=null),!e)return r;var t=0,n=[];if(e<=0)return r.length>0?"…":r;for(var o=0,u=Array.from(r);o<u.length;o++){var a=u[o];if("object"==typeof a){if(null!=(null!=a.props?a.props.children:void 0)&&(t+=i(null!=a.props?a.props.children:void 0,function(r){return r.length})),n.push(a),t>=e)return n.push("…"),n}else{if(t+a.length>=e){var s=e-t;return n.push(a.substring(0,s)),n.push("…"),n}t+=a.length,n.push(a)}}return r}});
//# sourceMappingURL=comment_dom.min.js-vflUspX1m.map