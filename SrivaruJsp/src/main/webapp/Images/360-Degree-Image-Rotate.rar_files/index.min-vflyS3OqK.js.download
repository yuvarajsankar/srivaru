define(["require","exports","spectrum_comments/comment_editor/reducers/macros/draft","spectrum_comments/comment_editor/reducers/macros/macro","spectrum_comments/comment_editor/macros/mentions_macro_composers","spectrum_comments/comment_editor/core/composer_wrappers","spectrum_comments/comment_editor/components/mention_suggestions_list","spectrum_comments/comment_editor/components/mention_decorator","spectrum_comments/comment_editor/draft_utils","draft-js","spectrum_comments/comment_editor/macros/user_suggestion_composers"],function(e,t,n,o,r,i,c,s,m,a,u){"use strict";function d(e){var t=e.innerProps,n=t.text,o=t.offset,r=t.delimiter,i=t.input,c=o-r.length+i.length;if(n.substring(c,o)+i===r&&(0===c||" "===n.substr(c-1,1)))return{start:c,end:o,text:n.substring(c,o)+i}}function p(e){return Object.keys(e).map(function(t){var r=e[t],i=r.onMacro,c=void 0===i?function(){}:i,s=r.type,m=void 0===s?"macro: "+t:s,a=r.spanProps,u=void 0===a?{}:a,p=r.macroDecorators,f=void 0===p?[]:p,g=r.onAutoComplete,l=r.onDelimiter,v=void 0===l?d:l;return{draft:{values:n.createDraftValuesReducers(m,t,u,c,v,f)},macro:{evts:o.createMacroEventReducers(m,g),values:o.createMacroValuesReducers(m,c)}}})}function f(e){window.setTimeout(function(){g(e)},0)}function g(e){function t(e,t,n,i,c,u){var d=s.createEntity("mention","IMMUTABLE",{identifier:t,type:n}),p=d.getLastCreatedEntityKey(),f=m.replaceText(d,e.blockKey,c,u,"@"+i,p);r.draft.change(m.replaceContent(o.draft.editorState,a.Modifier.insertText(f,f.getSelectionAfter()," ")))}function n(e,t){return e.entityKey===t.getEntity()}var o=e.status,r=e.scopeTriggers,i=o.draft,c=o.macro,s=(o.mentionSuggestions,o.suggestion,i.editorState.getCurrentContent());if(c.active){var d=s.getBlockForKey(c.active.blockKey),p=e.kernel.compose(u.getSelectedUser);if(p){var f=p.name.public,g=p.id?p.id:p.email,l=p.id?"id":"email",v=function(e){return!!c.active&&n(c.active,e)},_=function(e,n){return c.active&&t(c.active,g,l,f,e,n)};d.findEntityRanges(v,_)}else{var y=c.active.content.substring(u.mentionsDelimiter.length);if(m.parseEmail(y)){var v=function(e){return!!c.active&&n(c.active,e)},_=function(e,n){return c.active&&t(c.active,y,"email",y,e,n)};d.findEntityRanges(v,_)}}}}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOnDelimiter=d;var l={strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"mention"===n.getEntity(t).getType()},t)},component:s.MentionDecorator};t.macrosReducers=function(e){var t=e.onMentionSuggestionsQuery;return p({"@":{onDelimiter:d,onMacro:i.bindComposer(r.mentionsMacroComposer,{onMentionSuggestionsQuery:t}),spanProps:{className:"active-mention",chrome:i.wrapComposerComponent(c.mentionSuggestionsListComposer)},macroDecorators:[l],onAutoComplete:f}})}});
//# sourceMappingURL=index.min.js-vflAcWeF-.map